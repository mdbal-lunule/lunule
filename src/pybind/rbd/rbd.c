/* Generated by Cython 0.19 on Wed Jul  3 12:51:14 2019 */

#define PY_SSIZE_T_CLEAN
#ifndef CYTHON_USE_PYLONG_INTERNALS
#ifdef PYLONG_BITS_IN_DIGIT
#define CYTHON_USE_PYLONG_INTERNALS 0
#else
#include "pyconfig.h"
#ifdef PYLONG_BITS_IN_DIGIT
#define CYTHON_USE_PYLONG_INTERNALS 1
#else
#define CYTHON_USE_PYLONG_INTERNALS 0
#endif
#endif
#endif
#include "Python.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#elif PY_VERSION_HEX < 0x02040000
    #error Cython requires Python 2.4+.
#else
#include <stddef.h> /* For offsetof */
#ifndef offsetof
#define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#endif
#ifndef DL_IMPORT
  #define DL_IMPORT(t) t
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef Py_HUGE_VAL
  #define Py_HUGE_VAL HUGE_VAL
#endif
#ifdef PYPY_VERSION
#define CYTHON_COMPILING_IN_PYPY 1
#define CYTHON_COMPILING_IN_CPYTHON 0
#else
#define CYTHON_COMPILING_IN_PYPY 0
#define CYTHON_COMPILING_IN_CPYTHON 1
#endif
#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PY_FORMAT_SIZE_T ""
  #define CYTHON_FORMAT_SSIZE_T ""
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)   __Pyx_PyInt_AsInt(o)
  #define PyNumber_Index(o)    ((PyNumber_Check(o) && !PyFloat_Check(o)) ? PyNumber_Int(o) : \
                                (PyErr_Format(PyExc_TypeError, \
                                              "expected index value, got %.200s", Py_TYPE(o)->tp_name), \
                                 (PyObject*)0))
  #define __Pyx_PyIndex_Check(o) (PyNumber_Check(o) && !PyFloat_Check(o) && \
                                  !PyComplex_Check(o))
  #define PyIndex_Check __Pyx_PyIndex_Check
  #define PyErr_WarnEx(category, message, stacklevel) PyErr_Warn(category, message)
  #define __PYX_BUILD_PY_SSIZE_T "i"
#else
  #define __PYX_BUILD_PY_SSIZE_T "n"
  #define CYTHON_FORMAT_SSIZE_T "z"
  #define __Pyx_PyIndex_Check PyIndex_Check
#endif
#if PY_VERSION_HEX < 0x02060000
  #define Py_REFCNT(ob) (((PyObject*)(ob))->ob_refcnt)
  #define Py_TYPE(ob)   (((PyObject*)(ob))->ob_type)
  #define Py_SIZE(ob)   (((PyVarObject*)(ob))->ob_size)
  #define PyVarObject_HEAD_INIT(type, size) \
          PyObject_HEAD_INIT(type) size,
  #define PyType_Modified(t)
  typedef struct {
     void *buf;
     PyObject *obj;
     Py_ssize_t len;
     Py_ssize_t itemsize;
     int readonly;
     int ndim;
     char *format;
     Py_ssize_t *shape;
     Py_ssize_t *strides;
     Py_ssize_t *suboffsets;
     void *internal;
  } Py_buffer;
  #define PyBUF_SIMPLE 0
  #define PyBUF_WRITABLE 0x0001
  #define PyBUF_FORMAT 0x0004
  #define PyBUF_ND 0x0008
  #define PyBUF_STRIDES (0x0010 | PyBUF_ND)
  #define PyBUF_C_CONTIGUOUS (0x0020 | PyBUF_STRIDES)
  #define PyBUF_F_CONTIGUOUS (0x0040 | PyBUF_STRIDES)
  #define PyBUF_ANY_CONTIGUOUS (0x0080 | PyBUF_STRIDES)
  #define PyBUF_INDIRECT (0x0100 | PyBUF_STRIDES)
  #define PyBUF_RECORDS (PyBUF_STRIDES | PyBUF_FORMAT | PyBUF_WRITABLE)
  #define PyBUF_FULL (PyBUF_INDIRECT | PyBUF_FORMAT | PyBUF_WRITABLE)
  typedef int (*getbufferproc)(PyObject *, Py_buffer *, int);
  typedef void (*releasebufferproc)(PyObject *, Py_buffer *);
#endif
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos) \
          PyCode_New(a, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos) \
          PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
#endif
#if PY_MAJOR_VERSION < 3 && PY_MINOR_VERSION < 6
  #define PyUnicode_FromString(s) PyUnicode_Decode(s, strlen(s), "UTF-8", "strict")
#endif
#if PY_MAJOR_VERSION >= 3
  #define Py_TPFLAGS_CHECKTYPES 0
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#if (PY_VERSION_HEX < 0x02060000) || (PY_MAJOR_VERSION >= 3)
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#if PY_VERSION_HEX < 0x02060000
  #define Py_TPFLAGS_HAVE_VERSION_TAG 0
#endif
#if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
  #define CYTHON_PEP393_ENABLED 1
  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ? \
                                              0 : _PyUnicode_Ready((PyObject *)(op)))
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
  #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
#else
  #define CYTHON_PEP393_ENABLED 0
  #define __Pyx_PyUnicode_READY(op)       (0)
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
  #define __Pyx_PyUnicode_READ(k, d, i)   ((k=k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyStringObject               PyUnicodeObject
  #define PyString_Type                PyUnicode_Type
  #define PyString_Check               PyUnicode_Check
  #define PyString_CheckExact          PyUnicode_CheckExact
#endif
#if PY_VERSION_HEX < 0x02060000
  #define PyBytesObject                PyStringObject
  #define PyBytes_Type                 PyString_Type
  #define PyBytes_Check                PyString_Check
  #define PyBytes_CheckExact           PyString_CheckExact
  #define PyBytes_FromString           PyString_FromString
  #define PyBytes_FromStringAndSize    PyString_FromStringAndSize
  #define PyBytes_FromFormat           PyString_FromFormat
  #define PyBytes_DecodeEscape         PyString_DecodeEscape
  #define PyBytes_AsString             PyString_AsString
  #define PyBytes_AsStringAndSize      PyString_AsStringAndSize
  #define PyBytes_Size                 PyString_Size
  #define PyBytes_AS_STRING            PyString_AS_STRING
  #define PyBytes_GET_SIZE             PyString_GET_SIZE
  #define PyBytes_Repr                 PyString_Repr
  #define PyBytes_Concat               PyString_Concat
  #define PyBytes_ConcatAndDel         PyString_ConcatAndDel
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
  #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
#else
  #define __Pyx_PyBaseString_Check(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj) || \
                                         PyString_Check(obj) || PyUnicode_Check(obj))
  #define __Pyx_PyBaseString_CheckExact(obj) (Py_TYPE(obj) == &PyBaseString_Type)
#endif
#if PY_VERSION_HEX < 0x02060000
  #define PySet_Check(obj)             PyObject_TypeCheck(obj, &PySet_Type)
  #define PyFrozenSet_Check(obj)       PyObject_TypeCheck(obj, &PyFrozenSet_Type)
#endif
#ifndef PySet_CheckExact
  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
#endif
#define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
#if PY_MAJOR_VERSION >= 3
  #define PyIntObject                  PyLongObject
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBoolObject                 PyLongObject
#endif
#if PY_VERSION_HEX < 0x03020000
  typedef long Py_hash_t;
  #define __Pyx_PyInt_FromHash_t PyInt_FromLong
  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
#else
  #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
#endif
#if (PY_MAJOR_VERSION < 3) || (PY_VERSION_HEX >= 0x03010300)
  #define __Pyx_PySequence_GetSlice(obj, a, b) PySequence_GetSlice(obj, a, b)
  #define __Pyx_PySequence_SetSlice(obj, a, b, value) PySequence_SetSlice(obj, a, b, value)
  #define __Pyx_PySequence_DelSlice(obj, a, b) PySequence_DelSlice(obj, a, b)
#else
  #define __Pyx_PySequence_GetSlice(obj, a, b) (unlikely(!(obj)) ? \
        (PyErr_SetString(PyExc_SystemError, "null argument to internal routine"), (PyObject*)0) : \
        (likely((obj)->ob_type->tp_as_mapping) ? (PySequence_GetSlice(obj, a, b)) : \
            (PyErr_Format(PyExc_TypeError, "'%.200s' object is unsliceable", (obj)->ob_type->tp_name), (PyObject*)0)))
  #define __Pyx_PySequence_SetSlice(obj, a, b, value) (unlikely(!(obj)) ? \
        (PyErr_SetString(PyExc_SystemError, "null argument to internal routine"), -1) : \
        (likely((obj)->ob_type->tp_as_mapping) ? (PySequence_SetSlice(obj, a, b, value)) : \
            (PyErr_Format(PyExc_TypeError, "'%.200s' object doesn't support slice assignment", (obj)->ob_type->tp_name), -1)))
  #define __Pyx_PySequence_DelSlice(obj, a, b) (unlikely(!(obj)) ? \
        (PyErr_SetString(PyExc_SystemError, "null argument to internal routine"), -1) : \
        (likely((obj)->ob_type->tp_as_mapping) ? (PySequence_DelSlice(obj, a, b)) : \
            (PyErr_Format(PyExc_TypeError, "'%.200s' object doesn't support slice deletion", (obj)->ob_type->tp_name), -1)))
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyMethod_New(func, self, klass) ((self) ? PyMethod_New(func, self) : PyInstanceMethod_New(func))
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),((char *)(n)))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),((char *)(n)),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),((char *)(n)))
#else
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),(n))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),(n),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),(n))
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_NAMESTR(n) ((char *)(n))
  #define __Pyx_DOCSTR(n)  ((char *)(n))
#else
  #define __Pyx_NAMESTR(n) (n)
  #define __Pyx_DOCSTR(n)  (n)
#endif
#ifndef CYTHON_INLINE
  #if defined(__GNUC__)
    #define CYTHON_INLINE __inline__
  #elif defined(_MSC_VER)
    #define CYTHON_INLINE __inline
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_INLINE inline
  #else
    #define CYTHON_INLINE
  #endif
#endif
#ifdef NAN
#define __PYX_NAN() ((float) NAN)
#else
static CYTHON_INLINE float __PYX_NAN() {
  /* Initialize NaN. The sign is irrelevant, an exponent with all bits 1 and
   a nonzero mantissa means NaN. If the first bit in the mantissa is 1, it is
   a quiet NaN. */
  float value;
  memset(&value, 0xFF, sizeof(value));
  return value;
}
#endif


#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
#endif

#ifndef __PYX_EXTERN_C
  #ifdef __cplusplus
    #define __PYX_EXTERN_C extern "C"
  #else
    #define __PYX_EXTERN_C extern
  #endif
#endif

#if defined(WIN32) || defined(MS_WINDOWS)
#define _USE_MATH_DEFINES
#endif
#include <math.h>
#define __PYX_HAVE__rbd
#define __PYX_HAVE_API__rbd
#include "string.h"
#include "stdio.h"
#include "pythread.h"
#include "datetime.h"
#include "errno.h"
#include "stdint.h"
#include "stdlib.h"
#include "rados/librados.h"
#include "time.h"
#include "limits.h"
#include "rbd/librbd.h"
#ifdef _OPENMP
#include <omp.h>
#endif /* _OPENMP */

#ifdef PYREX_WITHOUT_ASSERTIONS
#define CYTHON_WITHOUT_ASSERTIONS
#endif

#ifndef CYTHON_UNUSED
# if defined(__GNUC__)
#   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
#     define CYTHON_UNUSED __attribute__ ((__unused__))
#   else
#     define CYTHON_UNUSED
#   endif
# elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
#   define CYTHON_UNUSED __attribute__ ((__unused__))
# else
#   define CYTHON_UNUSED
# endif
#endif
typedef struct {PyObject **p; char *s; const Py_ssize_t n; const char* encoding;
                const char is_unicode; const char is_str; const char intern; } __Pyx_StringTabEntry; /*proto*/

#define __PYX_DEFAULT_STRING_ENCODING_IS_ASCII 0
#define __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT 0
#define __PYX_DEFAULT_STRING_ENCODING ""
#define __Pyx_PyObject_FromString __Pyx_PyBytes_FromString
#define __Pyx_PyObject_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
static CYTHON_INLINE char* __Pyx_PyObject_AsString(PyObject*);
static CYTHON_INLINE char* __Pyx_PyObject_AsStringAndSize(PyObject*, Py_ssize_t* length);
#define __Pyx_PyBytes_FromString        PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize PyBytes_FromStringAndSize
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(char*);
#if PY_MAJOR_VERSION < 3
    #define __Pyx_PyStr_FromString        __Pyx_PyBytes_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#else
    #define __Pyx_PyStr_FromString        __Pyx_PyUnicode_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyUnicode_FromStringAndSize
#endif
#define __Pyx_PyObject_AsUString(s)    ((unsigned char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_FromUString(s)  __Pyx_PyObject_FromString((char*)s)
#define __Pyx_PyBytes_FromUString(s)   __Pyx_PyBytes_FromString((char*)s)
#define __Pyx_PyStr_FromUString(s)     __Pyx_PyStr_FromString((char*)s)
#define __Pyx_PyUnicode_FromUString(s) __Pyx_PyUnicode_FromString((char*)s)
#if PY_MAJOR_VERSION < 3
static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u)
{
    const Py_UNICODE *u_end = u;
    while (*u_end++) ;
    return u_end - u - 1;
}
#else
#define __Pyx_Py_UNICODE_strlen Py_UNICODE_strlen
#endif
#define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
#define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
#define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
#define __Pyx_Owned_Py_None(b) (Py_INCREF(Py_None), Py_None)
#define __Pyx_PyBool_FromLong(b) ((b) ? (Py_INCREF(Py_True), Py_True) : (Py_INCREF(Py_False), Py_False))
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static CYTHON_INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x);
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
static CYTHON_INLINE size_t __Pyx_PyInt_AsSize_t(PyObject*);
#if CYTHON_COMPILING_IN_CPYTHON
#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
#else
#define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
#endif
#define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
static int __Pyx_sys_getdefaultencoding_not_ascii;
static int __Pyx_init_sys_getdefaultencoding_params() {
    PyObject* sys = NULL;
    PyObject* default_encoding = NULL;
    PyObject* ascii_chars_u = NULL;
    PyObject* ascii_chars_b = NULL;
    sys = PyImport_ImportModule("sys");
    if (sys == NULL) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    if (default_encoding == NULL) goto bad;
    if (strcmp(PyBytes_AsString(default_encoding), "ascii") == 0) {
        __Pyx_sys_getdefaultencoding_not_ascii = 0;
    } else {
        const char* default_encoding_c = PyBytes_AS_STRING(default_encoding);
        char ascii_chars[128];
        int c;
        for (c = 0; c < 128; c++) {
            ascii_chars[c] = c;
        }
        __Pyx_sys_getdefaultencoding_not_ascii = 1;
        ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
        if (ascii_chars_u == NULL) goto bad;
        ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
        if (ascii_chars_b == NULL || strncmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
            PyErr_Format(
                PyExc_ValueError,
                "This module compiled with c_string_encoding=ascii, but default encoding '%s' is not a superset of ascii.",
                default_encoding_c);
            goto bad;
        }
    }
    Py_XDECREF(sys);
    Py_XDECREF(default_encoding);
    Py_XDECREF(ascii_chars_u);
    Py_XDECREF(ascii_chars_b);
    return 0;
bad:
    Py_XDECREF(sys);
    Py_XDECREF(default_encoding);
    Py_XDECREF(ascii_chars_u);
    Py_XDECREF(ascii_chars_b);
    return -1;
}
#endif
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT && PY_MAJOR_VERSION >= 3
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_DecodeUTF8(c_str, size, NULL)
#else
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_Decode(c_str, size, __PYX_DEFAULT_STRING_ENCODING, NULL)
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
static char* __PYX_DEFAULT_STRING_ENCODING;
static int __Pyx_init_sys_getdefaultencoding_params() {
    PyObject* sys = NULL;
    PyObject* default_encoding = NULL;
    char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (sys == NULL) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    if (default_encoding == NULL) goto bad;
    default_encoding_c = PyBytes_AS_STRING(default_encoding);
    __PYX_DEFAULT_STRING_ENCODING = (char*) malloc(strlen(default_encoding_c));
    strcpy(__PYX_DEFAULT_STRING_ENCODING, default_encoding_c);
    Py_DECREF(sys);
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(sys);
    Py_XDECREF(default_encoding);
    return -1;
}
#endif
#endif


#ifdef __GNUC__
  /* Test for GCC > 2.95 */
  #if __GNUC__ > 2 || (__GNUC__ == 2 && (__GNUC_MINOR__ > 95))
    #define likely(x)   __builtin_expect(!!(x), 1)
    #define unlikely(x) __builtin_expect(!!(x), 0)
  #else /* __GNUC__ > 2 ... */
    #define likely(x)   (x)
    #define unlikely(x) (x)
  #endif /* __GNUC__ > 2 ... */
#else /* __GNUC__ */
  #define likely(x)   (x)
  #define unlikely(x) (x)
#endif /* __GNUC__ */

static PyObject *__pyx_m;
static PyObject *__pyx_d;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static PyObject *__pyx_empty_bytes;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;


static const char *__pyx_f[] = {
  "rbd.pyx",
  "datetime.pxd",
  "type.pxd",
  "bool.pxd",
  "complex.pxd",
  "rados.pxd",
};

/*--- Type declarations ---*/
struct __pyx_obj_5rados_Rados;
struct __pyx_obj_3rbd_SnapIterator;
struct __pyx_obj_5rados_Ioctx;
struct __pyx_obj_3rbd_MirrorImageStatusIterator;
struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__;
struct __pyx_obj_3rbd_MirrorPeerIterator;
struct __pyx_obj_3rbd_Image;
struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__;
struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read;
struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__;
struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__;
struct __pyx_obj_3rbd_Completion;
struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__;
struct __pyx_obj_3rbd_LockOwnerIterator;
struct __pyx_obj_3rbd_MetadataIterator;
struct __pyx_obj_3rbd_TrashIterator;
struct __pyx_obj_3rbd___pyx_scope_struct____iter__;
struct __pyx_defaults;
typedef struct __pyx_defaults __pyx_defaults;
struct __pyx_defaults1;
typedef struct __pyx_defaults1 __pyx_defaults1;
struct __pyx_defaults {
  PyObject *__pyx_arg_old_format;
};
struct __pyx_defaults1 {
  PyObject *__pyx_arg_force;
};

/* "rados.pxd":14
 * 
 * 
 * cdef class Rados(object):             # <<<<<<<<<<<<<<
 *     cdef:
 *         rados_t cluster
 */
struct __pyx_obj_5rados_Rados {
  PyObject_HEAD
  rados_t cluster;
  PyObject *state;
  PyObject *monitor_callback;
  PyObject *monitor_callback2;
  PyObject *parsed_args;
  PyObject *conf_defaults;
  PyObject *conffile;
  PyObject *rados_id;
};


/* "rbd.pyx":2858
 *             free(c_vals)
 * 
 * cdef class SnapIterator(object):             # <<<<<<<<<<<<<<
 *     """
 *     Iterator over snapshot info for an image.
 */
struct __pyx_obj_3rbd_SnapIterator {
  PyObject_HEAD
  rbd_snap_info_t *snaps;
  int num_snaps;
  PyObject *image;
};


/* "rados.pxd":26
 * 
 * 
 * cdef class Ioctx(object):             # <<<<<<<<<<<<<<
 *     cdef:
 *         rados_ioctx_t io
 */
struct __pyx_obj_5rados_Ioctx {
  PyObject_HEAD
  rados_ioctx_t io;
  char *name;
  PyObject *state;
  PyObject *locator_key;
  PyObject *nspace;
  PyObject *safe_completions;
  PyObject *complete_completions;
  PyObject *lock;
};


/* "rbd.pyx":1238
 *             free(self.peers)
 * 
 * cdef class MirrorImageStatusIterator(object):             # <<<<<<<<<<<<<<
 *     """
 *     Iterator over mirror image status for a pool.
 */
struct __pyx_obj_3rbd_MirrorImageStatusIterator {
  PyObject_HEAD
  rados_ioctx_t ioctx;
  size_t max_read;
  char *last_read;
  char **image_ids;
  rbd_mirror_image_status_t *images;
  size_t size;
};


/* "rbd.pyx":2815
 *         self.get_next_chunk()
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         while len(self.next_chunk) > 0:
 *             for pair in self.next_chunk:
 */
struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ {
  PyObject_HEAD
  PyObject *__pyx_v_pair;
  struct __pyx_obj_3rbd_MetadataIterator *__pyx_v_self;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
  PyObject *(*__pyx_t_2)(PyObject *);
};


/* "rbd.pyx":1189
 *             free(counts)
 * 
 * cdef class MirrorPeerIterator(object):             # <<<<<<<<<<<<<<
 *     """
 *     Iterator over mirror peer info for a pool.
 */
struct __pyx_obj_3rbd_MirrorPeerIterator {
  PyObject_HEAD
  rbd_mirror_peer_t *peers;
  int num_peers;
};


/* "rbd.pyx":1338
 * 
 * 
 * cdef class Image(object):             # <<<<<<<<<<<<<<
 *     """
 *     This class represents an RBD image. It is used to perform I/O on
 */
struct __pyx_obj_3rbd_Image {
  PyObject_HEAD
  rbd_image_t image;
  int closed;
  PyObject *name;
  PyObject *ioctx;
  rados_ioctx_t _ioctx;
};


/* "rbd.pyx":2949
 *     __source_string = ['USER', 'MIRRORING']
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         for i in range(self.num_entries):
 *             yield {
 */
struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ {
  PyObject_HEAD
  size_t __pyx_v_i;
  struct __pyx_obj_3rbd_TrashIterator *__pyx_v_self;
  size_t __pyx_t_0;
  size_t __pyx_t_1;
};


/* "rbd.pyx":2519
 *         return status
 * 
 *     def aio_read(self, offset, length, oncomplete, fadvise_flags=0):             # <<<<<<<<<<<<<<
 *         """
 *         Asynchronously read data from the image
 */
struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read {
  PyObject_HEAD
  PyObject *__pyx_v_length;
  PyObject *__pyx_v_oncomplete;
};


/* "rbd.pyx":2779
 *                 raise make_ex(ret, 'error listing lock owners for image %s' % (image.name,))
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         for i in range(self.num_lock_owners):
 *             yield {
 */
struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ {
  PyObject_HEAD
  size_t __pyx_v_i;
  struct __pyx_obj_3rbd_LockOwnerIterator *__pyx_v_self;
  size_t __pyx_t_0;
  size_t __pyx_t_1;
};


/* "rbd.pyx":2893
 *                 raise make_ex(ret, 'error listing snapshots for image %s' % (image.name,))
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         for i in range(self.num_snaps):
 *             yield {
 */
struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ {
  PyObject_HEAD
  int __pyx_v_i;
  struct __pyx_obj_3rbd_SnapIterator *__pyx_v_self;
  int __pyx_t_0;
  int __pyx_t_1;
};


/* "rbd.pyx":551
 *     return ret
 * 
 * cdef class Completion             # <<<<<<<<<<<<<<
 * 
 * cdef void __aio_complete_cb(rbd_completion_t completion, void *args) with gil:
 */
struct __pyx_obj_3rbd_Completion {
  PyObject_HEAD
  struct __pyx_vtabstruct_3rbd_Completion *__pyx_vtab;
  PyObject *image;
  PyObject *oncomplete;
  rbd_completion_t rbd_comp;
  PyObject *buf;
  int persisted;
  PyObject *exc_info;
};


/* "rbd.pyx":1278
 *         self.get_next_chunk()
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         while self.size > 0:
 *             for i in range(self.size):
 */
struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ {
  PyObject_HEAD
  size_t __pyx_v_i;
  struct __pyx_obj_3rbd_MirrorImageStatusIterator *__pyx_v_self;
  size_t __pyx_t_0;
  size_t __pyx_t_1;
};


/* "rbd.pyx":2743
 *         return MetadataIterator(self)
 * 
 * cdef class LockOwnerIterator(object):             # <<<<<<<<<<<<<<
 *     """
 *     Iterator over managed lock owners for an image
 */
struct __pyx_obj_3rbd_LockOwnerIterator {
  PyObject_HEAD
  rbd_lock_mode_t lock_mode;
  char **lock_owners;
  size_t num_lock_owners;
  PyObject *image;
};


/* "rbd.pyx":2791
 *             free(self.lock_owners)
 * 
 * cdef class MetadataIterator(object):             # <<<<<<<<<<<<<<
 *     """
 *     Iterator over metadata list for an image.
 */
struct __pyx_obj_3rbd_MetadataIterator {
  PyObject_HEAD
  PyObject *image_name;
  rbd_image_t image;
  char *last_read;
  uint64_t max_read;
  PyObject *next_chunk;
};


/* "rbd.pyx":2906
 *             free(self.snaps)
 * 
 * cdef class TrashIterator(object):             # <<<<<<<<<<<<<<
 *     """
 *     Iterator over trash entries.
 */
struct __pyx_obj_3rbd_TrashIterator {
  PyObject_HEAD
  rados_ioctx_t ioctx;
  size_t num_entries;
  rbd_trash_image_info_t *entries;
};


/* "rbd.pyx":1225
 *             break
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         for i in range(self.num_peers):
 *             yield {
 */
struct __pyx_obj_3rbd___pyx_scope_struct____iter__ {
  PyObject_HEAD
  int __pyx_v_i;
  struct __pyx_obj_3rbd_MirrorPeerIterator *__pyx_v_self;
  int __pyx_t_0;
  int __pyx_t_1;
};



/* "rbd.pyx":561
 * 
 * 
 * cdef class Completion(object):             # <<<<<<<<<<<<<<
 *     """completion object"""
 * 
 */

struct __pyx_vtabstruct_3rbd_Completion {
  void (*_complete)(struct __pyx_obj_3rbd_Completion *);
  PyObject *(*__pyx___persist)(struct __pyx_obj_3rbd_Completion *);
  PyObject *(*__pyx___unpersist)(struct __pyx_obj_3rbd_Completion *);
};
static struct __pyx_vtabstruct_3rbd_Completion *__pyx_vtabptr_3rbd_Completion;
#ifndef CYTHON_REFNANNY
  #define CYTHON_REFNANNY 0
#endif
#if CYTHON_REFNANNY
  typedef struct {
    void (*INCREF)(void*, PyObject*, int);
    void (*DECREF)(void*, PyObject*, int);
    void (*GOTREF)(void*, PyObject*, int);
    void (*GIVEREF)(void*, PyObject*, int);
    void* (*SetupContext)(const char*, int, const char*);
    void (*FinishContext)(void**);
  } __Pyx_RefNannyAPIStruct;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname); /*proto*/
  #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
#ifdef WITH_THREAD
  #define __Pyx_RefNannySetupContext(name, acquire_gil) \
          if (acquire_gil) { \
              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure(); \
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__); \
              PyGILState_Release(__pyx_gilstate_save); \
          } else { \
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__); \
          }
#else
  #define __Pyx_RefNannySetupContext(name, acquire_gil) \
          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
#endif
  #define __Pyx_RefNannyFinishContext() \
          __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_XINCREF(r)  do { if((r) != NULL) {__Pyx_INCREF(r); }} while(0)
  #define __Pyx_XDECREF(r)  do { if((r) != NULL) {__Pyx_DECREF(r); }} while(0)
  #define __Pyx_XGOTREF(r)  do { if((r) != NULL) {__Pyx_GOTREF(r); }} while(0)
  #define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);}} while(0)
#else
  #define __Pyx_RefNannyDeclarations
  #define __Pyx_RefNannySetupContext(name, acquire_gil)
  #define __Pyx_RefNannyFinishContext()
  #define __Pyx_INCREF(r) Py_INCREF(r)
  #define __Pyx_DECREF(r) Py_DECREF(r)
  #define __Pyx_GOTREF(r)
  #define __Pyx_GIVEREF(r)
  #define __Pyx_XINCREF(r) Py_XINCREF(r)
  #define __Pyx_XDECREF(r) Py_XDECREF(r)
  #define __Pyx_XGOTREF(r)
  #define __Pyx_XGIVEREF(r)
#endif /* CYTHON_REFNANNY */
#define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
#define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_getattro))
        return tp->tp_getattro(obj, attr_name);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_getattr))
        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
#endif
    return PyObject_GetAttr(obj, attr_name);
}
#else
#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
#endif

static PyObject *__Pyx_GetBuiltinName(PyObject *name); /*proto*/

static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found); /*proto*/

static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name); /*proto*/

static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[], \
    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args, \
    const char* function_name); /*proto*/

static CYTHON_INLINE PyObject *__Pyx_GetModuleGlobalName(PyObject *name); /*proto*/

#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_PyObject_DelAttrStr(o,n) __Pyx_PyObject_SetAttrStr(o,n,NULL)
static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_setattro))
        return tp->tp_setattro(obj, attr_name, value);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_setattr))
        return tp->tp_setattr(obj, PyString_AS_STRING(attr_name), value);
#endif
    return PyObject_SetAttr(obj, attr_name, value);
}
#else
#define __Pyx_PyObject_DelAttrStr(o,n)   PyObject_DelAttr(o,n)
#define __Pyx_PyObject_SetAttrStr(o,n,v) PyObject_SetAttr(o,n,v)
#endif

static CYTHON_INLINE int __Pyx_PySequence_Contains(PyObject* item, PyObject* seq, int eq) {
    int result = PySequence_Contains(seq, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause); /*proto*/

#ifndef __PYX_FORCE_INIT_THREADS
  #define __PYX_FORCE_INIT_THREADS 0
#endif

#define __Pyx_GetItemInt(o, i, size, to_py_func, is_list, wraparound, boundscheck) \
    (((size) <= sizeof(Py_ssize_t)) ? \
    __Pyx_GetItemInt_Fast(o, i, is_list, wraparound, boundscheck) : \
    __Pyx_GetItemInt_Generic(o, to_py_func(i)))
#define __Pyx_GetItemInt_List(o, i, size, to_py_func, is_list, wraparound, boundscheck) \
    (((size) <= sizeof(Py_ssize_t)) ? \
    __Pyx_GetItemInt_List_Fast(o, i, wraparound, boundscheck) : \
    __Pyx_GetItemInt_Generic(o, to_py_func(i)))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
#define __Pyx_GetItemInt_Tuple(o, i, size, to_py_func, is_list, wraparound, boundscheck) \
    (((size) <= sizeof(Py_ssize_t)) ? \
    __Pyx_GetItemInt_Tuple_Fast(o, i, wraparound, boundscheck) : \
    __Pyx_GetItemInt_Generic(o, to_py_func(i)))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                     int is_list, int wraparound, int boundscheck);

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type); /*proto*/

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE int __Pyx_ListComp_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len)) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        Py_SIZE(list) = len+1;
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_ListComp_Append(L,x) PyList_Append(L,x)
#endif

static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname);

#define __Pyx_CyFunction_USED 1
#include <structmember.h>
#define __Pyx_CYFUNCTION_STATICMETHOD  0x01
#define __Pyx_CYFUNCTION_CLASSMETHOD   0x02
#define __Pyx_CYFUNCTION_CCLASS        0x04
#define __Pyx_CyFunction_GetClosure(f) \
    (((__pyx_CyFunctionObject *) (f))->func_closure)
#define __Pyx_CyFunction_GetClassObj(f) \
    (((__pyx_CyFunctionObject *) (f))->func_classobj)
#define __Pyx_CyFunction_Defaults(type, f) \
    ((type *)(((__pyx_CyFunctionObject *) (f))->defaults))
#define __Pyx_CyFunction_SetDefaultsGetter(f, g) \
    ((__pyx_CyFunctionObject *) (f))->defaults_getter = (g)
typedef struct {
    PyCFunctionObject func;
    int flags;
    PyObject *func_dict;
    PyObject *func_weakreflist;
    PyObject *func_name;
    PyObject *func_qualname;
    PyObject *func_doc;
    PyObject *func_code;
    PyObject *func_closure;
    PyObject *func_classobj; /* No-args super() class cell */
    void *defaults;
    int defaults_pyobjects;
    PyObject *defaults_tuple;   /* Const defaults tuple */
    PyObject *defaults_kwdict;  /* Const kwonly defaults dict */
    PyObject *(*defaults_getter)(PyObject *);
    PyObject *func_annotations; /* function annotations dict */
} __pyx_CyFunctionObject;
static PyTypeObject *__pyx_CyFunctionType = 0;
#define __Pyx_CyFunction_NewEx(ml, flags, qualname, self, module, code) \
    __Pyx_CyFunction_New(__pyx_CyFunctionType, ml, flags, qualname, self, module, code)
static PyObject *__Pyx_CyFunction_New(PyTypeObject *, PyMethodDef *ml,
                                      int flags, PyObject* qualname,
                                      PyObject *self, PyObject *module,
                                      PyObject* code);
static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *m,
                                                         size_t size,
                                                         int pyobjects);
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *m,
                                                            PyObject *tuple);
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *m,
                                                             PyObject *dict);
static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *m,
                                                              PyObject *dict);
static int __Pyx_CyFunction_init(void);

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact); /*proto*/

#include <string.h>

static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name); /*proto*/

static CYTHON_INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level); /*proto*/

static PyObject *__Pyx_FindPy2Metaclass(PyObject *bases); /*proto*/

static PyObject *__Pyx_CreateClass(PyObject *bases, PyObject *dict, PyObject *name,
                                   PyObject *qualname, PyObject *modname); /*proto*/

static CYTHON_INLINE uint64_t __Pyx_PyInt_from_py_uint64_t(PyObject *);

static CYTHON_INLINE PyObject *__Pyx_PyInt_to_py_time_t(time_t);

static CYTHON_INLINE PyObject *__Pyx_PyInt_to_py_uint64_t(uint64_t);

static CYTHON_INLINE uint8_t __Pyx_PyInt_from_py_uint8_t(PyObject *);

static CYTHON_INLINE uint32_t __Pyx_PyInt_from_py_uint32_t(PyObject *);

static CYTHON_INLINE int __Pyx_ErrOccurredWithGIL(void); /* proto */

static CYTHON_INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject *);

static CYTHON_INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject *);

static CYTHON_INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject *);

static CYTHON_INLINE char __Pyx_PyInt_AsChar(PyObject *);

static CYTHON_INLINE short __Pyx_PyInt_AsShort(PyObject *);

static CYTHON_INLINE int __Pyx_PyInt_AsInt(PyObject *);

static CYTHON_INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject *);

static CYTHON_INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject *);

static CYTHON_INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject *);

static CYTHON_INLINE int __Pyx_PyInt_AsLongDouble(PyObject *);

static CYTHON_INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject *);

static CYTHON_INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject *);

static CYTHON_INLINE long __Pyx_PyInt_AsLong(PyObject *);

static CYTHON_INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject *);

static CYTHON_INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject *);

static CYTHON_INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject *);

static void __Pyx_WriteUnraisable(const char *name, int clineno,
                                  int lineno, const char *filename); /*proto*/

static PyObject* __Pyx_PyObject_CallMethodTuple(PyObject* obj, PyObject* method_name, PyObject* args) {
    PyObject *method, *result = NULL;
    if (unlikely(!args)) return NULL;
    method = __Pyx_PyObject_GetAttrStr(obj, method_name);
    if (unlikely(!method)) goto bad;
    result = PyObject_Call(method, args, NULL);
    Py_DECREF(method);
bad:
    Py_DECREF(args);
    return result;
}
#define __Pyx_PyObject_CallMethod3(obj, name, arg1, arg2, arg3) \
    __Pyx_PyObject_CallMethodTuple(obj, name, PyTuple_Pack(3, arg1, arg2, arg3))
#define __Pyx_PyObject_CallMethod2(obj, name, arg1, arg2) \
    __Pyx_PyObject_CallMethodTuple(obj, name, PyTuple_Pack(2, arg1, arg2))
#define __Pyx_PyObject_CallMethod1(obj, name, arg1) \
    __Pyx_PyObject_CallMethodTuple(obj, name, PyTuple_Pack(1, arg1))
#define __Pyx_PyObject_CallMethod0(obj, name) \
    __Pyx_PyObject_CallMethodTuple(obj, name, (Py_INCREF(__pyx_empty_tuple), __pyx_empty_tuple))

static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

#define __Pyx_Generator_USED
#include <structmember.h>
#include <frameobject.h>
typedef PyObject *(*__pyx_generator_body_t)(PyObject *, PyObject *);
typedef struct {
    PyObject_HEAD
    __pyx_generator_body_t body;
    PyObject *closure;
    PyObject *exc_type;
    PyObject *exc_value;
    PyObject *exc_traceback;
    PyObject *gi_weakreflist;
    PyObject *classobj;
    PyObject *yieldfrom;
    int resume_label;
    char is_running;  // using T_BOOL for property below requires char value
} __pyx_GeneratorObject;
static __pyx_GeneratorObject *__Pyx_Generator_New(__pyx_generator_body_t body,
                                                  PyObject *closure);
static int __pyx_Generator_init(void);
static int __Pyx_Generator_clear(PyObject* self);
#if 1 || PY_VERSION_HEX < 0x030300B0
static int __Pyx_PyGen_FetchStopIterationValue(PyObject **pvalue);
#else
#define __Pyx_PyGen_FetchStopIterationValue(pvalue) PyGen_FetchStopIterationValue(pvalue)
#endif

static int __Pyx_check_binary_version(void);

static int __Pyx_SetVtable(PyObject *dict, void *vtable); /*proto*/

#if !defined(__Pyx_PyIdentifier_FromString)
#if PY_MAJOR_VERSION < 3
  #define __Pyx_PyIdentifier_FromString(s) PyString_FromString(s)
#else
  #define __Pyx_PyIdentifier_FromString(s) PyUnicode_FromString(s)
#endif
#endif

static PyObject *__Pyx_ImportModule(const char *name); /*proto*/

static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name, size_t size, int strict);  /*proto*/

typedef struct {
    int code_line;
    PyCodeObject* code_object;
} __Pyx_CodeObjectCacheEntry;
struct __Pyx_CodeObjectCache {
    int count;
    int max_count;
    __Pyx_CodeObjectCacheEntry* entries;
};
static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
static PyCodeObject *__pyx_find_code_object(int code_line);
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);

static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/


/* Module declarations from 'cython' */

/* Module declarations from 'cpython.version' */

/* Module declarations from 'cpython.ref' */

/* Module declarations from 'cpython.exc' */

/* Module declarations from 'cpython.module' */

/* Module declarations from 'cpython.mem' */

/* Module declarations from 'cpython.tuple' */

/* Module declarations from 'cpython.list' */

/* Module declarations from 'libc.string' */

/* Module declarations from 'libc.stdio' */

/* Module declarations from 'cpython.object' */

/* Module declarations from 'cpython.sequence' */

/* Module declarations from 'cpython.mapping' */

/* Module declarations from 'cpython.iterator' */

/* Module declarations from '__builtin__' */

/* Module declarations from 'cpython.type' */
static PyTypeObject *__pyx_ptype_7cpython_4type_type = 0;

/* Module declarations from 'cpython.number' */

/* Module declarations from 'cpython.int' */

/* Module declarations from '__builtin__' */

/* Module declarations from 'cpython.bool' */
static PyTypeObject *__pyx_ptype_7cpython_4bool_bool = 0;

/* Module declarations from 'cpython.long' */

/* Module declarations from 'cpython.float' */

/* Module declarations from '__builtin__' */

/* Module declarations from 'cpython.complex' */
static PyTypeObject *__pyx_ptype_7cpython_7complex_complex = 0;

/* Module declarations from 'cpython.string' */

/* Module declarations from 'cpython.unicode' */

/* Module declarations from 'cpython.dict' */

/* Module declarations from 'cpython.instance' */

/* Module declarations from 'cpython.function' */

/* Module declarations from 'cpython.method' */

/* Module declarations from 'cpython.weakref' */

/* Module declarations from 'cpython.getargs' */

/* Module declarations from 'cpython.pythread' */

/* Module declarations from 'cpython.pystate' */

/* Module declarations from 'cpython.cobject' */

/* Module declarations from 'cpython.oldbuffer' */

/* Module declarations from 'cpython.set' */

/* Module declarations from 'cpython.buffer' */

/* Module declarations from 'cpython.bytes' */

/* Module declarations from 'cpython.pycapsule' */

/* Module declarations from 'datetime' */

/* Module declarations from 'cpython.datetime' */
static PyTypeObject *__pyx_ptype_7cpython_8datetime_date = 0;
static PyTypeObject *__pyx_ptype_7cpython_8datetime_time = 0;
static PyTypeObject *__pyx_ptype_7cpython_8datetime_datetime = 0;
static PyTypeObject *__pyx_ptype_7cpython_8datetime_timedelta = 0;
static PyTypeObject *__pyx_ptype_7cpython_8datetime_tzinfo = 0;

/* Module declarations from 'cpython' */

/* Module declarations from 'libc' */

/* Module declarations from 'libc.errno' */

/* Module declarations from 'libc.stdint' */

/* Module declarations from 'libc.stdlib' */

/* Module declarations from 'rados' */
static PyTypeObject *__pyx_ptype_5rados_Rados = 0;
static PyTypeObject *__pyx_ptype_5rados_Ioctx = 0;

/* Module declarations from 'rbd' */
static PyTypeObject *__pyx_ptype_3rbd_Completion = 0;
static PyTypeObject *__pyx_ptype_3rbd_MirrorPeerIterator = 0;
static PyTypeObject *__pyx_ptype_3rbd_MirrorImageStatusIterator = 0;
static PyTypeObject *__pyx_ptype_3rbd_Image = 0;
static PyTypeObject *__pyx_ptype_3rbd_LockOwnerIterator = 0;
static PyTypeObject *__pyx_ptype_3rbd_MetadataIterator = 0;
static PyTypeObject *__pyx_ptype_3rbd_SnapIterator = 0;
static PyTypeObject *__pyx_ptype_3rbd_TrashIterator = 0;
static PyTypeObject *__pyx_ptype_3rbd___pyx_scope_struct____iter__ = 0;
static PyTypeObject *__pyx_ptype_3rbd___pyx_scope_struct_1___iter__ = 0;
static PyTypeObject *__pyx_ptype_3rbd___pyx_scope_struct_2_aio_read = 0;
static PyTypeObject *__pyx_ptype_3rbd___pyx_scope_struct_3___iter__ = 0;
static PyTypeObject *__pyx_ptype_3rbd___pyx_scope_struct_4___iter__ = 0;
static PyTypeObject *__pyx_ptype_3rbd___pyx_scope_struct_5___iter__ = 0;
static PyTypeObject *__pyx_ptype_3rbd___pyx_scope_struct_6___iter__ = 0;
static PyObject *__pyx_v_3rbd_errno_to_exception = 0;
static PyObject *__pyx_f_3rbd_make_ex(PyObject *, PyObject *); /*proto*/
static rados_ioctx_t __pyx_f_3rbd_convert_ioctx(struct __pyx_obj_5rados_Ioctx *); /*proto*/
static int __pyx_f_3rbd_no_op_progress_callback(uint64_t, uint64_t, void *); /*proto*/
static char *__pyx_f_3rbd_opt_str(PyObject *); /*proto*/
static void *__pyx_f_3rbd_realloc_chk(void *, size_t); /*proto*/
static void __pyx_f_3rbd___aio_complete_cb(rbd_completion_t, void *); /*proto*/
static int __pyx_f_3rbd_diff_iterate_cb(uint64_t, size_t, int, void *); /*proto*/
#define __Pyx_MODULE_NAME "rbd"
int __pyx_module_is_main_rbd = 0;

/* Implementation of 'rbd' */
static PyObject *__pyx_builtin_Exception;
static PyObject *__pyx_builtin_object;
static PyObject *__pyx_builtin_super;
static PyObject *__pyx_builtin_MemoryError;
static PyObject *__pyx_builtin_range;
static PyObject *__pyx_builtin_TypeError;
static PyObject *__pyx_builtin_map;
static PyObject *__pyx_builtin_zip;
static PyObject *__pyx_builtin_KeyError;
static PyObject *__pyx_pf_3rbd_7OSError___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_message, PyObject *__pyx_v_errno); /* proto */
static PyObject *__pyx_pf_3rbd_7OSError_2__str__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_7OSError_4__reduce__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_cstr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_val, PyObject *__pyx_v_name, PyObject *__pyx_v_encoding, PyObject *__pyx_v_opt); /* proto */
static PyObject *__pyx_pf_3rbd_2decode_cstr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_val, PyObject *__pyx_v_encoding); /* proto */
static int __pyx_pf_3rbd_10Completion___cinit__(struct __pyx_obj_3rbd_Completion *__pyx_v_self, PyObject *__pyx_v_image, PyObject *__pyx_v_oncomplete); /* proto */
static PyObject *__pyx_pf_3rbd_10Completion_2is_complete(struct __pyx_obj_3rbd_Completion *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_10Completion_4wait_for_complete_and_cb(struct __pyx_obj_3rbd_Completion *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_10Completion_6get_return_value(struct __pyx_obj_3rbd_Completion *__pyx_v_self); /* proto */
static void __pyx_pf_3rbd_10Completion_8__dealloc__(struct __pyx_obj_3rbd_Completion *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_version(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_40__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_2create(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_name, PyObject *__pyx_v_size, PyObject *__pyx_v_order, PyObject *__pyx_v_old_format, PyObject *__pyx_v_features, PyObject *__pyx_v_stripe_unit, PyObject *__pyx_v_stripe_count, PyObject *__pyx_v_data_pool); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_4clone(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_p_ioctx, PyObject *__pyx_v_p_name, PyObject *__pyx_v_p_snapname, PyObject *__pyx_v_c_ioctx, PyObject *__pyx_v_c_name, PyObject *__pyx_v_features, PyObject *__pyx_v_order, PyObject *__pyx_v_stripe_unit, PyObject *__pyx_v_stripe_count, PyObject *__pyx_v_data_pool); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_6list(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_8remove(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_10rename(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_src, PyObject *__pyx_v_dest); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_12trash_move(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_name, PyObject *__pyx_v_delay); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_42__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_14trash_remove(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_image_id, PyObject *__pyx_v_force); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_16trash_get(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_image_id); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_18trash_list(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_20trash_restore(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_image_id, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_22mirror_mode_get(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_24mirror_mode_set(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_mirror_mode); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_26mirror_peer_add(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_cluster_name, PyObject *__pyx_v_client_name); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_28mirror_peer_remove(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_uuid); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_30mirror_peer_list(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_32mirror_peer_set_client(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_uuid, PyObject *__pyx_v_client_name); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_34mirror_peer_set_cluster(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_uuid, PyObject *__pyx_v_cluster_name); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_36mirror_image_status_list(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx); /* proto */
static PyObject *__pyx_pf_3rbd_3RBD_38mirror_image_status_summary(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx); /* proto */
static int __pyx_pf_3rbd_18MirrorPeerIterator___init__(struct __pyx_obj_3rbd_MirrorPeerIterator *__pyx_v_self, PyObject *__pyx_v_ioctx); /* proto */
static PyObject *__pyx_pf_3rbd_18MirrorPeerIterator_2__iter__(struct __pyx_obj_3rbd_MirrorPeerIterator *__pyx_v_self); /* proto */
static void __pyx_pf_3rbd_18MirrorPeerIterator_5__dealloc__(struct __pyx_obj_3rbd_MirrorPeerIterator *__pyx_v_self); /* proto */
static int __pyx_pf_3rbd_25MirrorImageStatusIterator___init__(struct __pyx_obj_3rbd_MirrorImageStatusIterator *__pyx_v_self, PyObject *__pyx_v_ioctx); /* proto */
static PyObject *__pyx_pf_3rbd_25MirrorImageStatusIterator_2__iter__(struct __pyx_obj_3rbd_MirrorImageStatusIterator *__pyx_v_self); /* proto */
static void __pyx_pf_3rbd_25MirrorImageStatusIterator_5__dealloc__(struct __pyx_obj_3rbd_MirrorImageStatusIterator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_25MirrorImageStatusIterator_7get_next_chunk(struct __pyx_obj_3rbd_MirrorImageStatusIterator *__pyx_v_self); /* proto */
static int __pyx_pf_3rbd_5Image___init__(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_name, PyObject *__pyx_v_snapshot, PyObject *__pyx_v_read_only); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_2__enter__(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_4__exit__(struct __pyx_obj_3rbd_Image *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_type_, CYTHON_UNUSED PyObject *__pyx_v_value, CYTHON_UNUSED PyObject *__pyx_v_traceback); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_6__get_completion(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_oncomplete); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_8close(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static void __pyx_pf_3rbd_5Image_10__dealloc__(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_12__repr__(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_14resize(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_size); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_16stat(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_18id(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_20block_name_prefix(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_22parent_info(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_24parent_id(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_26old_format(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_28size(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_30features(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_32update_features(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_features, PyObject *__pyx_v_enabled); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_34overlap(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_36flags(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_38is_exclusive_lock_owner(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_40copy(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_dest_ioctx, PyObject *__pyx_v_dest_name, PyObject *__pyx_v_features, PyObject *__pyx_v_order, PyObject *__pyx_v_stripe_unit, PyObject *__pyx_v_stripe_count, PyObject *__pyx_v_data_pool); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_42list_snaps(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_44create_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_46rename_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_srcname, PyObject *__pyx_v_dstname); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_48remove_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_50remove_snap2(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name, PyObject *__pyx_v_flags); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_52rollback_to_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_54protect_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_56unprotect_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_58is_protected_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_60get_snap_limit(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_62set_snap_limit(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_limit); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_64get_snap_timestamp(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_snap_id); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_66remove_snap_limit(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_68set_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_70read(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length, PyObject *__pyx_v_fadvise_flags); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_72diff_iterate(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length, PyObject *__pyx_v_from_snapshot, PyObject *__pyx_v_iterate_cb, PyObject *__pyx_v_include_parent, PyObject *__pyx_v_whole_object); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_74write(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_data, PyObject *__pyx_v_offset, PyObject *__pyx_v_fadvise_flags); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_76discard(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_78flush(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_80invalidate_cache(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_82stripe_unit(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_84stripe_count(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_86create_timestamp(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_88flatten(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_90rebuild_object_map(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_92list_children(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_94list_lockers(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_96lock_acquire(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_lock_mode); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_98lock_release(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_100lock_get_owners(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_102lock_break(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_lock_mode, PyObject *__pyx_v_lock_owner); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_104lock_exclusive(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_cookie); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_106lock_shared(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_cookie, PyObject *__pyx_v_tag); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_108unlock(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_cookie); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_110break_lock(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_client, PyObject *__pyx_v_cookie); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_112mirror_image_enable(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_114mirror_image_disable(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_force); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_116mirror_image_promote(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_force); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_118mirror_image_demote(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_120mirror_image_resync(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_122mirror_image_get_info(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_124mirror_image_get_status(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_8aio_read_oncomplete_(PyObject *__pyx_self, PyObject *__pyx_v_completion_v); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_126aio_read(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length, PyObject *__pyx_v_oncomplete, PyObject *__pyx_v_fadvise_flags); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_128aio_write(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_data, PyObject *__pyx_v_offset, PyObject *__pyx_v_oncomplete, PyObject *__pyx_v_fadvise_flags); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_130aio_discard(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length, PyObject *__pyx_v_oncomplete); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_132aio_flush(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_oncomplete); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_134metadata_get(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_key); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_136metadata_set(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_key, PyObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_138metadata_remove(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_key); /* proto */
static PyObject *__pyx_pf_3rbd_5Image_140metadata_list(struct __pyx_obj_3rbd_Image *__pyx_v_self); /* proto */
static int __pyx_pf_3rbd_17LockOwnerIterator___init__(struct __pyx_obj_3rbd_LockOwnerIterator *__pyx_v_self, struct __pyx_obj_3rbd_Image *__pyx_v_image); /* proto */
static PyObject *__pyx_pf_3rbd_17LockOwnerIterator_2__iter__(struct __pyx_obj_3rbd_LockOwnerIterator *__pyx_v_self); /* proto */
static void __pyx_pf_3rbd_17LockOwnerIterator_5__dealloc__(struct __pyx_obj_3rbd_LockOwnerIterator *__pyx_v_self); /* proto */
static int __pyx_pf_3rbd_16MetadataIterator___init__(struct __pyx_obj_3rbd_MetadataIterator *__pyx_v_self, struct __pyx_obj_3rbd_Image *__pyx_v_image); /* proto */
static PyObject *__pyx_pf_3rbd_16MetadataIterator_2__iter__(struct __pyx_obj_3rbd_MetadataIterator *__pyx_v_self); /* proto */
static void __pyx_pf_3rbd_16MetadataIterator_5__dealloc__(struct __pyx_obj_3rbd_MetadataIterator *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_3rbd_16MetadataIterator_7get_next_chunk(struct __pyx_obj_3rbd_MetadataIterator *__pyx_v_self); /* proto */
static int __pyx_pf_3rbd_12SnapIterator___init__(struct __pyx_obj_3rbd_SnapIterator *__pyx_v_self, struct __pyx_obj_3rbd_Image *__pyx_v_image); /* proto */
static PyObject *__pyx_pf_3rbd_12SnapIterator_2__iter__(struct __pyx_obj_3rbd_SnapIterator *__pyx_v_self); /* proto */
static void __pyx_pf_3rbd_12SnapIterator_5__dealloc__(struct __pyx_obj_3rbd_SnapIterator *__pyx_v_self); /* proto */
static int __pyx_pf_3rbd_13TrashIterator___init__(struct __pyx_obj_3rbd_TrashIterator *__pyx_v_self, PyObject *__pyx_v_ioctx); /* proto */
static PyObject *__pyx_pf_3rbd_13TrashIterator_2__iter__(struct __pyx_obj_3rbd_TrashIterator *__pyx_v_self); /* proto */
static void __pyx_pf_3rbd_13TrashIterator_5__dealloc__(struct __pyx_obj_3rbd_TrashIterator *__pyx_v_self); /* proto */
static PyObject *__pyx_tp_new_3rbd_Completion(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd_MirrorPeerIterator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd_MirrorImageStatusIterator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd_Image(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd_LockOwnerIterator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd_MetadataIterator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd_SnapIterator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd_TrashIterator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct____iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_1___iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_2_aio_read(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_3___iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_4___iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_5___iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_6___iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static char __pyx_k_1[] = "[errno {0}] {1}";
static char __pyx_k_2[] = "utf-8";
static char __pyx_k_4[] = "%s must be a string";
static char __pyx_k_5[] = "realloc failed";
static char __pyx_k_7[] = "format 1 images do not support feature masks, non-default striping, nor data pool";
static char __pyx_k_9[] = "RBD_IMAGE_OPTION_FORMAT";
static char __pyx_k_10[] = "RBD_IMAGE_OPTION_FEATURES";
static char __pyx_k_11[] = "RBD_IMAGE_OPTION_ORDER";
static char __pyx_k_12[] = "RBD_IMAGE_OPTION_STRIPE_UNIT";
static char __pyx_k_13[] = "RBD_IMAGE_OPTION_STRIPE_COUNT";
static char __pyx_k_14[] = "RBD_IMAGE_OPTION_DATA_POOL";
static char __pyx_k_15[] = "error creating image";
static char __pyx_k_16[] = "error creating clone";
static char __pyx_k_17[] = "error listing images";
static char __pyx_k_18[] = "\000";
static char __pyx_k_20[] = "error removing image";
static char __pyx_k_21[] = "error renaming image";
static char __pyx_k_22[] = "error moving image to trash";
static char __pyx_k_23[] = "error deleting image from trash";
static char __pyx_k_24[] = "error restoring image from trash";
static char __pyx_k_25[] = "error getting mirror mode";
static char __pyx_k_26[] = "error setting mirror mode";
static char __pyx_k_27[] = "error adding mirror peer";
static char __pyx_k_28[] = "error removing mirror peer";
static char __pyx_k_29[] = "error setting mirror peer client";
static char __pyx_k_30[] = "error setting mirror peer cluster";
static char __pyx_k_31[] = "error getting mirror image status summary";
static char __pyx_k_32[] = "error listing peers";
static char __pyx_k_33[] = "";
static char __pyx_k_34[] = "error listing mirror images status";
static char __pyx_k_36[] = "error opening image %s at snapshot %s";
static char __pyx_k_37[] = "error getting a completion";
static char __pyx_k_38[] = "error while closing image %s";
static char __pyx_k_39[] = "rbd.Image(ioctx, %r)";
static char __pyx_k_40[] = "error resizing image %s";
static char __pyx_k_41[] = "error getting info for image %s";
static char __pyx_k_42[] = "error getting id for image %s";
static char __pyx_k_43[] = "error getting block name prefix for image %s";
static char __pyx_k_44[] = "error getting parent info for image %s";
static char __pyx_k_45[] = "error getting parent id for image %s";
static char __pyx_k_46[] = "error getting old_format for image %s";
static char __pyx_k_47[] = "error getting size for image %s";
static char __pyx_k_48[] = "error getting features for image %s";
static char __pyx_k_49[] = "error updating features for image %s";
static char __pyx_k_50[] = "error getting overlap for image %s";
static char __pyx_k_51[] = "error getting flags for image %s";
static char __pyx_k_52[] = "error getting lock status for image %s";
static char __pyx_k_53[] = "error copying image %s to %s";
static char __pyx_k_54[] = "error creating snapshot %s from %s";
static char __pyx_k_55[] = "error renaming snapshot of %s from %s to %s";
static char __pyx_k_56[] = "error removing snapshot %s from %s";
static char __pyx_k_57[] = "error removing snapshot %s from %s with flags %llx";
static char __pyx_k_58[] = "error rolling back image %s to snapshot %s";
static char __pyx_k_59[] = "error protecting snapshot %s@%s";
static char __pyx_k_60[] = "error unprotecting snapshot %s@%s";
static char __pyx_k_61[] = "error checking if snapshot %s@%s is protected";
static char __pyx_k_62[] = "error getting snapshot limit for %s";
static char __pyx_k_63[] = "error setting snapshot limit for %s";
static char __pyx_k_64[] = "error getting snapshot timestamp for image: %s, snap_id: %d";
static char __pyx_k_65[] = "error removing snapshot limit for %s";
static char __pyx_k_66[] = "error setting image %s to snapshot %s";
static char __pyx_k_67[] = "error reading %s %ld~%ld";
static char __pyx_k_70[] = "error generating diff from snapshot %s";
static char __pyx_k_71[] = "data must be a byte string";
static char __pyx_k_73[] = "error writing to %s";
static char __pyx_k_74[] = "IncompleteWriteError";
static char __pyx_k_75[] = "Wrote only %ld out of %ld bytes";
static char __pyx_k_76[] = "logic error: rbd_write(%s) returned %d, but %d was the maximum number of bytes it could have written.";
static char __pyx_k_77[] = "error discarding region %d~%d";
static char __pyx_k_78[] = "error flushing image";
static char __pyx_k_79[] = "error invalidating cache";
static char __pyx_k_80[] = "error getting stripe unit for image %s";
static char __pyx_k_81[] = "error getting stripe count for image %s";
static char __pyx_k_82[] = "error getting create timestamp for image: %s";
static char __pyx_k_83[] = "error flattening %s";
static char __pyx_k_84[] = "error rebuilding object map %s";
static char __pyx_k_90[] = "error acquiring lock on image";
static char __pyx_k_91[] = "error releasing lock on image";
static char __pyx_k_92[] = "error breaking lock on image";
static char __pyx_k_93[] = "error acquiring exclusive lock on image";
static char __pyx_k_94[] = "error acquiring shared lock on image";
static char __pyx_k_95[] = "error unlocking image";
static char __pyx_k_96[] = "error enabling mirroring for image %s";
static char __pyx_k_97[] = "error disabling mirroring for image %s";
static char __pyx_k_98[] = "error promoting image %s to primary";
static char __pyx_k_99[] = "error demoting image %s to secondary";
static char __pyx_k__i[] = "i";
static char __pyx_k_100[] = "error to resync image %s";
static char __pyx_k_101[] = "error getting mirror info for image %s";
static char __pyx_k_102[] = "error getting mirror status for image %s";
static char __pyx_k_105[] = "/home/ceph/ceph-src/scaling-mds-ceph/src/pybind/rbd/rbd.pyx";
static char __pyx_k_106[] = "Image.aio_read.<locals>.oncomplete_";
static char __pyx_k_107[] = "error writing %s %ld~%ld";
static char __pyx_k_108[] = "error discarding %s %ld~%ld";
static char __pyx_k_109[] = "error flushing";
static char __pyx_k_110[] = "no metadata %s for image %s";
static char __pyx_k_111[] = "error getting metadata %s for image %s";
static char __pyx_k_112[] = "error setting metadata %s for image %s";
static char __pyx_k_113[] = "error removing metadata %s for image %s";
static char __pyx_k_114[] = "error listing lock owners for image %s";
static char __pyx_k_115[] = "error listing metadata for image %s";
static char __pyx_k_118[] = "error listing snapshots for image %s";
static char __pyx_k_119[] = "error listing trash entries";
static char __pyx_k_120[] = "\nThis module is a thin wrapper around librbd.\n\nIt currently provides all the synchronous methods of librbd that do\nnot use callbacks.\n\nError codes from librbd are turned into exceptions that subclass\n:class:`Error`. Almost all methods may raise :class:`Error`\n(the base class of all rbd exceptions), :class:`PermissionError`\nand :class:`IOError`, in addition to those documented for the\nmethod.\n";
static char __pyx_k_121[] = "RBD_FEATURE_LAYERING";
static char __pyx_k_122[] = "RBD_FEATURE_STRIPINGV2";
static char __pyx_k_123[] = "RBD_FEATURE_EXCLUSIVE_LOCK";
static char __pyx_k_124[] = "RBD_FEATURE_OBJECT_MAP";
static char __pyx_k_125[] = "RBD_FEATURE_FAST_DIFF";
static char __pyx_k_126[] = "RBD_FEATURE_DEEP_FLATTEN";
static char __pyx_k_127[] = "RBD_FEATURE_JOURNALING";
static char __pyx_k_128[] = "RBD_FEATURE_DATA_POOL";
static char __pyx_k_129[] = "RBD_FEATURES_INCOMPATIBLE";
static char __pyx_k_130[] = "RBD_FEATURES_RW_INCOMPATIBLE";
static char __pyx_k_131[] = "RBD_FEATURES_MUTABLE";
static char __pyx_k_132[] = "RBD_FEATURES_SINGLE_CLIENT";
static char __pyx_k_133[] = "RBD_FLAG_OBJECT_MAP_INVALID";
static char __pyx_k_134[] = "RBD_MIRROR_MODE_DISABLED";
static char __pyx_k_135[] = "RBD_MIRROR_MODE_IMAGE";
static char __pyx_k_136[] = "RBD_MIRROR_MODE_POOL";
static char __pyx_k_137[] = "RBD_MIRROR_IMAGE_DISABLING";
static char __pyx_k_138[] = "RBD_MIRROR_IMAGE_ENABLED";
static char __pyx_k_139[] = "RBD_MIRROR_IMAGE_DISABLED";
static char __pyx_k_140[] = "MIRROR_IMAGE_STATUS_STATE_UNKNOWN";
static char __pyx_k_141[] = "MIRROR_IMAGE_STATUS_STATE_ERROR";
static char __pyx_k_142[] = "MIRROR_IMAGE_STATUS_STATE_SYNCING";
static char __pyx_k_143[] = "MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY";
static char __pyx_k_144[] = "MIRROR_IMAGE_STATUS_STATE_REPLAYING";
static char __pyx_k_145[] = "MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY";
static char __pyx_k_146[] = "MIRROR_IMAGE_STATUS_STATE_STOPPED";
static char __pyx_k_147[] = "RBD_LOCK_MODE_EXCLUSIVE";
static char __pyx_k_148[] = "RBD_LOCK_MODE_SHARED";
static char __pyx_k_152[] = "OSError.__init__";
static char __pyx_k_155[] = "OSError.__str__";
static char __pyx_k_158[] = "OSError.__reduce__";
static char __pyx_k_159[] = " `OSError` class, derived from `Error` ";
static char __pyx_k_160[] = "FunctionNotSupported";
static char __pyx_k_167[] = "RBD.version";
static char __pyx_k_170[] = "RBD.create";
static char __pyx_k_174[] = "RBD.clone";
static char __pyx_k_177[] = "RBD.list";
static char __pyx_k_180[] = "RBD.remove";
static char __pyx_k_183[] = "RBD.rename";
static char __pyx_k_187[] = "RBD.trash_move";
static char __pyx_k_190[] = "RBD.trash_remove";
static char __pyx_k_193[] = "RBD.trash_get";
static char __pyx_k_196[] = "RBD.trash_list";
static char __pyx_k_199[] = "RBD.trash_restore";
static char __pyx_k_202[] = "RBD.mirror_mode_get";
static char __pyx_k_205[] = "RBD.mirror_mode_set";
static char __pyx_k_208[] = "RBD.mirror_peer_add";
static char __pyx_k_211[] = "RBD.mirror_peer_remove";
static char __pyx_k_214[] = "RBD.mirror_peer_list";
static char __pyx_k_217[] = "mirror_peer_set_client";
static char __pyx_k_218[] = "RBD.mirror_peer_set_client";
static char __pyx_k_221[] = "mirror_peer_set_cluster";
static char __pyx_k_222[] = "RBD.mirror_peer_set_cluster";
static char __pyx_k_225[] = "mirror_image_status_list";
static char __pyx_k_226[] = "RBD.mirror_image_status_list";
static char __pyx_k_229[] = "mirror_image_status_summary";
static char __pyx_k_230[] = "RBD.mirror_image_status_summary";
static char __pyx_k_231[] = "\n    This class wraps librbd CRUD functions.\n    ";
static char __pyx_k__id[] = "id";
static char __pyx_k__up[] = "up";
static char __pyx_k__RBD[] = "RBD";
static char __pyx_k__key[] = "key";
static char __pyx_k__map[] = "map";
static char __pyx_k__msg[] = "msg";
static char __pyx_k__opt[] = "opt";
static char __pyx_k__rbd[] = "rbd";
static char __pyx_k__ret[] = "ret";
static char __pyx_k__src[] = "src";
static char __pyx_k__sys[] = "sys";
static char __pyx_k__tag[] = "tag";
static char __pyx_k__val[] = "val";
static char __pyx_k__zip[] = "zip";
static char __pyx_k__USER[] = "USER";
static char __pyx_k___src[] = "_src";
static char __pyx_k__args[] = "args";
static char __pyx_k__cstr[] = "cstr";
static char __pyx_k__data[] = "data";
static char __pyx_k__dest[] = "dest";
static char __pyx_k__info[] = "info";
static char __pyx_k__list[] = "list";
static char __pyx_k__mode[] = "mode";
static char __pyx_k__name[] = "name";
static char __pyx_k__opts[] = "opts";
static char __pyx_k__self[] = "self";
static char __pyx_k__send[] = "send";
static char __pyx_k__size[] = "size";
static char __pyx_k__uuid[] = "uuid";
static char __pyx_k__Error[] = "Error";
static char __pyx_k___dest[] = "_dest";
static char __pyx_k___name[] = "_name";
static char __pyx_k___size[] = "_size";
static char __pyx_k___uuid[] = "_uuid";
static char __pyx_k__clone[] = "clone";
static char __pyx_k__close[] = "close";
static char __pyx_k__delay[] = "delay";
static char __pyx_k__errno[] = "errno";
static char __pyx_k__extra[] = "extra";
static char __pyx_k__flags[] = "flags";
static char __pyx_k__force[] = "force";
static char __pyx_k__image[] = "image";
static char __pyx_k__ioctx[] = "ioctx";
static char __pyx_k__major[] = "major";
static char __pyx_k__minor[] = "minor";
static char __pyx_k__order[] = "order";
static char __pyx_k__owner[] = "owner";
static char __pyx_k__range[] = "range";
static char __pyx_k__split[] = "split";
static char __pyx_k__state[] = "state";
static char __pyx_k__super[] = "super";
static char __pyx_k__throw[] = "throw";
static char __pyx_k__type_[] = "type_";
static char __pyx_k__value[] = "value";
static char __pyx_k___delay[] = "_delay";
static char __pyx_k___force[] = "_force";
static char __pyx_k___ioctx[] = "_ioctx";
static char __pyx_k___order[] = "_order";
static char __pyx_k__c_info[] = "c_info";
static char __pyx_k__c_name[] = "c_name";
static char __pyx_k__client[] = "client";
static char __pyx_k__cookie[] = "cookie";
static char __pyx_k__counts[] = "counts";
static char __pyx_k__create[] = "create";
static char __pyx_k__decode[] = "decode";
static char __pyx_k__encode[] = "encode";
static char __pyx_k__format[] = "format";
static char __pyx_k__length[] = "length";
static char __pyx_k__maxlen[] = "maxlen";
static char __pyx_k__object[] = "object";
static char __pyx_k__offset[] = "offset";
static char __pyx_k__p_name[] = "p_name";
static char __pyx_k__remove[] = "remove";
static char __pyx_k__rename[] = "rename";
static char __pyx_k__source[] = "source";
static char __pyx_k__states[] = "states";
static char __pyx_k__IOError[] = "IOError";
static char __pyx_k__NoSpace[] = "NoSpace";
static char __pyx_k__OSError[] = "OSError";
static char __pyx_k__Timeout[] = "Timeout";
static char __pyx_k____str__[] = "__str__";
static char __pyx_k___c_name[] = "_c_name";
static char __pyx_k___p_name[] = "_p_name";
static char __pyx_k__c_ioctx[] = "c_ioctx";
static char __pyx_k__c_names[] = "c_names";
static char __pyx_k__dstname[] = "dstname";
static char __pyx_k__enabled[] = "enabled";
static char __pyx_k__lockers[] = "lockers";
static char __pyx_k__message[] = "message";
static char __pyx_k__p_ioctx[] = "p_ioctx";
static char __pyx_k__primary[] = "primary";
static char __pyx_k__srcname[] = "srcname";
static char __pyx_k__version[] = "version";
static char __pyx_k__Iterable[] = "Iterable";
static char __pyx_k__KeyError[] = "KeyError";
static char __pyx_k____init__[] = "__init__";
static char __pyx_k____main__[] = "__main__";
static char __pyx_k____test__[] = "__test__";
static char __pyx_k___c_ioctx[] = "_c_ioctx";
static char __pyx_k___p_ioctx[] = "_p_ioctx";
static char __pyx_k__datetime[] = "datetime";
static char __pyx_k__encoding[] = "encoding";
static char __pyx_k__exc_info[] = "exc_info";
static char __pyx_k__features[] = "features";
static char __pyx_k__image_id[] = "image_id";
static char __pyx_k__num_objs[] = "num_objs";
static char __pyx_k__obj_size[] = "obj_size";
static char __pyx_k__snapshot[] = "snapshot";
static char __pyx_k__Exception[] = "Exception";
static char __pyx_k__ImageBusy[] = "ImageBusy";
static char __pyx_k__MIRRORING[] = "MIRRORING";
static char __pyx_k__TypeError[] = "TypeError";
static char __pyx_k____class__[] = "__class__";
static char __pyx_k___image_id[] = "_image_id";
static char __pyx_k__data_pool[] = "data_pool";
static char __pyx_k__dest_name[] = "dest_name";
static char __pyx_k__exclusive[] = "exclusive";
static char __pyx_k__global_id[] = "global_id";
static char __pyx_k__lock_mode[] = "lock_mode";
static char __pyx_k__read_only[] = "read_only";
static char __pyx_k__traceback[] = "traceback";
static char __pyx_k__trash_get[] = "trash_get";
static char __pyx_k__LogicError[] = "LogicError";
static char __pyx_k____import__[] = "__import__";
static char __pyx_k____module__[] = "__module__";
static char __pyx_k____reduce__[] = "__reduce__";
static char __pyx_k__dest_ioctx[] = "dest_ioctx";
static char __pyx_k__iterate_cb[] = "iterate_cb";
static char __pyx_k__lock_owner[] = "lock_owner";
static char __pyx_k__old_format[] = "old_format";
static char __pyx_k__oncomplete[] = "oncomplete";
static char __pyx_k__p_snapname[] = "p_snapname";
static char __pyx_k__trash_list[] = "trash_list";
static char __pyx_k__trash_move[] = "trash_move";
static char __pyx_k__ImageExists[] = "ImageExists";
static char __pyx_k__MemoryError[] = "MemoryError";
static char __pyx_k___p_snapname[] = "_p_snapname";
static char __pyx_k__client_name[] = "client_name";
static char __pyx_k__collections[] = "collections";
static char __pyx_k__decode_cstr[] = "decode_cstr";
static char __pyx_k__description[] = "description";
static char __pyx_k__last_update[] = "last_update";
static char __pyx_k__mirror_mode[] = "mirror_mode";
static char __pyx_k__oncomplete_[] = "oncomplete_";
static char __pyx_k__parent_name[] = "parent_name";
static char __pyx_k__parent_pool[] = "parent_pool";
static char __pyx_k__stripe_unit[] = "stripe_unit";
static char __pyx_k____qualname__[] = "__qualname__";
static char __pyx_k___client_name[] = "_client_name";
static char __pyx_k___mirror_mode[] = "_mirror_mode";
static char __pyx_k__cluster_name[] = "cluster_name";
static char __pyx_k__completion_v[] = "completion_v";
static char __pyx_k__return_value[] = "return_value";
static char __pyx_k__stripe_count[] = "stripe_count";
static char __pyx_k__trash_remove[] = "trash_remove";
static char __pyx_k__whole_object[] = "whole_object";
static char __pyx_k__ImageNotFound[] = "ImageNotFound";
static char __pyx_k__ReadOnlyImage[] = "ReadOnlyImage";
static char __pyx_k____metaclass__[] = "__metaclass__";
static char __pyx_k___cluster_name[] = "_cluster_name";
static char __pyx_k___completion_v[] = "_completion_v";
static char __pyx_k__deletion_time[] = "deletion_time";
static char __pyx_k__fadvise_flags[] = "fadvise_flags";
static char __pyx_k__from_snapshot[] = "from_snapshot";
static char __pyx_k__fromtimestamp[] = "fromtimestamp";
static char __pyx_k__trash_restore[] = "trash_restore";
static char __pyx_k__get_next_chunk[] = "get_next_chunk";
static char __pyx_k__include_parent[] = "include_parent";
static char __pyx_k__InvalidArgument[] = "InvalidArgument";
static char __pyx_k__PermissionError[] = "PermissionError";
static char __pyx_k____source_string[] = "__source_string";
static char __pyx_k__mirror_mode_get[] = "mirror_mode_get";
static char __pyx_k__mirror_mode_set[] = "mirror_mode_set";
static char __pyx_k__mirror_peer_add[] = "mirror_peer_add";
static char __pyx_k__RBD_FEATURES_ALL[] = "RBD_FEATURES_ALL";
static char __pyx_k____get_completion[] = "__get_completion";
static char __pyx_k___uuid_max_length[] = "_uuid_max_length";
static char __pyx_k__get_return_value[] = "get_return_value";
static char __pyx_k__mirror_peer_list[] = "mirror_peer_list";
static char __pyx_k__DiskQuotaExceeded[] = "DiskQuotaExceeded";
static char __pyx_k__ImageHasSnapshots[] = "ImageHasSnapshots";
static char __pyx_k__block_name_prefix[] = "block_name_prefix";
static char __pyx_k__ArgumentOutOfRange[] = "ArgumentOutOfRange";
static char __pyx_k__ConnectionShutdown[] = "ConnectionShutdown";
static char __pyx_k__deferment_end_time[] = "deferment_end_time";
static char __pyx_k__mirror_peer_remove[] = "mirror_peer_remove";
static PyObject *__pyx_kp_s_1;
static PyObject *__pyx_n_s_10;
static PyObject *__pyx_kp_s_100;
static PyObject *__pyx_kp_s_101;
static PyObject *__pyx_kp_s_102;
static PyObject *__pyx_kp_s_105;
static PyObject *__pyx_n_s_106;
static PyObject *__pyx_kp_s_107;
static PyObject *__pyx_kp_s_108;
static PyObject *__pyx_kp_s_109;
static PyObject *__pyx_n_s_11;
static PyObject *__pyx_kp_s_110;
static PyObject *__pyx_kp_s_111;
static PyObject *__pyx_kp_s_112;
static PyObject *__pyx_kp_s_113;
static PyObject *__pyx_kp_s_114;
static PyObject *__pyx_kp_s_115;
static PyObject *__pyx_kp_s_118;
static PyObject *__pyx_kp_s_119;
static PyObject *__pyx_n_s_12;
static PyObject *__pyx_n_s_121;
static PyObject *__pyx_n_s_122;
static PyObject *__pyx_n_s_123;
static PyObject *__pyx_n_s_124;
static PyObject *__pyx_n_s_125;
static PyObject *__pyx_n_s_126;
static PyObject *__pyx_n_s_127;
static PyObject *__pyx_n_s_128;
static PyObject *__pyx_n_s_129;
static PyObject *__pyx_n_s_13;
static PyObject *__pyx_n_s_130;
static PyObject *__pyx_n_s_131;
static PyObject *__pyx_n_s_132;
static PyObject *__pyx_n_s_133;
static PyObject *__pyx_n_s_134;
static PyObject *__pyx_n_s_135;
static PyObject *__pyx_n_s_136;
static PyObject *__pyx_n_s_137;
static PyObject *__pyx_n_s_138;
static PyObject *__pyx_n_s_139;
static PyObject *__pyx_n_s_14;
static PyObject *__pyx_n_s_140;
static PyObject *__pyx_n_s_141;
static PyObject *__pyx_n_s_142;
static PyObject *__pyx_n_s_143;
static PyObject *__pyx_n_s_144;
static PyObject *__pyx_n_s_145;
static PyObject *__pyx_n_s_146;
static PyObject *__pyx_n_s_147;
static PyObject *__pyx_n_s_148;
static PyObject *__pyx_kp_s_15;
static PyObject *__pyx_n_s_152;
static PyObject *__pyx_n_s_155;
static PyObject *__pyx_n_s_158;
static PyObject *__pyx_kp_s_159;
static PyObject *__pyx_kp_s_16;
static PyObject *__pyx_n_s_160;
static PyObject *__pyx_n_s_167;
static PyObject *__pyx_kp_s_17;
static PyObject *__pyx_n_s_170;
static PyObject *__pyx_n_s_174;
static PyObject *__pyx_n_s_177;
static PyObject *__pyx_kp_b_18;
static PyObject *__pyx_n_s_180;
static PyObject *__pyx_n_s_183;
static PyObject *__pyx_n_s_187;
static PyObject *__pyx_n_s_190;
static PyObject *__pyx_n_s_193;
static PyObject *__pyx_n_s_196;
static PyObject *__pyx_n_s_199;
static PyObject *__pyx_kp_s_2;
static PyObject *__pyx_kp_s_20;
static PyObject *__pyx_n_s_202;
static PyObject *__pyx_n_s_205;
static PyObject *__pyx_n_s_208;
static PyObject *__pyx_kp_s_21;
static PyObject *__pyx_n_s_211;
static PyObject *__pyx_n_s_214;
static PyObject *__pyx_n_s_217;
static PyObject *__pyx_n_s_218;
static PyObject *__pyx_kp_s_22;
static PyObject *__pyx_n_s_221;
static PyObject *__pyx_n_s_222;
static PyObject *__pyx_n_s_225;
static PyObject *__pyx_n_s_226;
static PyObject *__pyx_n_s_229;
static PyObject *__pyx_kp_s_23;
static PyObject *__pyx_n_s_230;
static PyObject *__pyx_kp_s_231;
static PyObject *__pyx_kp_s_24;
static PyObject *__pyx_kp_s_25;
static PyObject *__pyx_kp_s_26;
static PyObject *__pyx_kp_s_27;
static PyObject *__pyx_kp_s_28;
static PyObject *__pyx_kp_s_29;
static PyObject *__pyx_kp_s_30;
static PyObject *__pyx_kp_s_31;
static PyObject *__pyx_kp_s_32;
static PyObject *__pyx_kp_s_34;
static PyObject *__pyx_kp_s_36;
static PyObject *__pyx_kp_s_37;
static PyObject *__pyx_kp_s_38;
static PyObject *__pyx_kp_s_39;
static PyObject *__pyx_kp_s_4;
static PyObject *__pyx_kp_s_40;
static PyObject *__pyx_kp_s_41;
static PyObject *__pyx_kp_s_42;
static PyObject *__pyx_kp_s_43;
static PyObject *__pyx_kp_s_44;
static PyObject *__pyx_kp_s_45;
static PyObject *__pyx_kp_s_46;
static PyObject *__pyx_kp_s_47;
static PyObject *__pyx_kp_s_48;
static PyObject *__pyx_kp_s_49;
static PyObject *__pyx_kp_s_5;
static PyObject *__pyx_kp_s_50;
static PyObject *__pyx_kp_s_51;
static PyObject *__pyx_kp_s_52;
static PyObject *__pyx_kp_s_53;
static PyObject *__pyx_kp_s_54;
static PyObject *__pyx_kp_s_55;
static PyObject *__pyx_kp_s_56;
static PyObject *__pyx_kp_s_57;
static PyObject *__pyx_kp_s_58;
static PyObject *__pyx_kp_s_59;
static PyObject *__pyx_kp_s_60;
static PyObject *__pyx_kp_s_61;
static PyObject *__pyx_kp_s_62;
static PyObject *__pyx_kp_s_63;
static PyObject *__pyx_kp_s_64;
static PyObject *__pyx_kp_s_65;
static PyObject *__pyx_kp_s_66;
static PyObject *__pyx_kp_s_67;
static PyObject *__pyx_kp_s_7;
static PyObject *__pyx_kp_s_70;
static PyObject *__pyx_kp_s_71;
static PyObject *__pyx_kp_s_73;
static PyObject *__pyx_n_s_74;
static PyObject *__pyx_kp_s_75;
static PyObject *__pyx_kp_s_76;
static PyObject *__pyx_kp_s_77;
static PyObject *__pyx_kp_s_78;
static PyObject *__pyx_kp_s_79;
static PyObject *__pyx_kp_s_80;
static PyObject *__pyx_kp_s_81;
static PyObject *__pyx_kp_s_82;
static PyObject *__pyx_kp_s_83;
static PyObject *__pyx_kp_s_84;
static PyObject *__pyx_n_s_9;
static PyObject *__pyx_kp_s_90;
static PyObject *__pyx_kp_s_91;
static PyObject *__pyx_kp_s_92;
static PyObject *__pyx_kp_s_93;
static PyObject *__pyx_kp_s_94;
static PyObject *__pyx_kp_s_95;
static PyObject *__pyx_kp_s_96;
static PyObject *__pyx_kp_s_97;
static PyObject *__pyx_kp_s_98;
static PyObject *__pyx_kp_s_99;
static PyObject *__pyx_n_s__ArgumentOutOfRange;
static PyObject *__pyx_n_s__ConnectionShutdown;
static PyObject *__pyx_n_s__DiskQuotaExceeded;
static PyObject *__pyx_n_s__Error;
static PyObject *__pyx_n_s__Exception;
static PyObject *__pyx_n_s__IOError;
static PyObject *__pyx_n_s__ImageBusy;
static PyObject *__pyx_n_s__ImageExists;
static PyObject *__pyx_n_s__ImageHasSnapshots;
static PyObject *__pyx_n_s__ImageNotFound;
static PyObject *__pyx_n_s__InvalidArgument;
static PyObject *__pyx_n_s__Iterable;
static PyObject *__pyx_n_s__KeyError;
static PyObject *__pyx_n_s__LogicError;
static PyObject *__pyx_n_s__MIRRORING;
static PyObject *__pyx_n_s__MemoryError;
static PyObject *__pyx_n_s__NoSpace;
static PyObject *__pyx_n_s__OSError;
static PyObject *__pyx_n_s__PermissionError;
static PyObject *__pyx_n_s__RBD;
static PyObject *__pyx_n_s__RBD_FEATURES_ALL;
static PyObject *__pyx_n_s__ReadOnlyImage;
static PyObject *__pyx_n_s__Timeout;
static PyObject *__pyx_n_s__TypeError;
static PyObject *__pyx_n_s__USER;
static PyObject *__pyx_n_s____class__;
static PyObject *__pyx_n_s____get_completion;
static PyObject *__pyx_n_s____import__;
static PyObject *__pyx_n_s____init__;
static PyObject *__pyx_n_s____main__;
static PyObject *__pyx_n_s____metaclass__;
static PyObject *__pyx_n_s____module__;
static PyObject *__pyx_n_s____qualname__;
static PyObject *__pyx_n_s____reduce__;
static PyObject *__pyx_n_s____source_string;
static PyObject *__pyx_n_s____str__;
static PyObject *__pyx_n_s____test__;
static PyObject *__pyx_n_s___c_ioctx;
static PyObject *__pyx_n_s___c_name;
static PyObject *__pyx_n_s___client_name;
static PyObject *__pyx_n_s___cluster_name;
static PyObject *__pyx_n_s___completion_v;
static PyObject *__pyx_n_s___delay;
static PyObject *__pyx_n_s___dest;
static PyObject *__pyx_n_s___force;
static PyObject *__pyx_n_s___image_id;
static PyObject *__pyx_n_s___ioctx;
static PyObject *__pyx_n_s___mirror_mode;
static PyObject *__pyx_n_s___name;
static PyObject *__pyx_n_s___order;
static PyObject *__pyx_n_s___p_ioctx;
static PyObject *__pyx_n_s___p_name;
static PyObject *__pyx_n_s___p_snapname;
static PyObject *__pyx_n_s___size;
static PyObject *__pyx_n_s___src;
static PyObject *__pyx_n_s___uuid;
static PyObject *__pyx_n_s___uuid_max_length;
static PyObject *__pyx_n_s__args;
static PyObject *__pyx_n_s__block_name_prefix;
static PyObject *__pyx_n_s__c_info;
static PyObject *__pyx_n_s__c_ioctx;
static PyObject *__pyx_n_s__c_name;
static PyObject *__pyx_n_s__c_names;
static PyObject *__pyx_n_s__client;
static PyObject *__pyx_n_s__client_name;
static PyObject *__pyx_n_s__clone;
static PyObject *__pyx_n_s__close;
static PyObject *__pyx_n_s__cluster_name;
static PyObject *__pyx_n_s__collections;
static PyObject *__pyx_n_s__completion_v;
static PyObject *__pyx_n_s__cookie;
static PyObject *__pyx_n_s__counts;
static PyObject *__pyx_n_s__create;
static PyObject *__pyx_n_s__cstr;
static PyObject *__pyx_n_s__data;
static PyObject *__pyx_n_s__data_pool;
static PyObject *__pyx_n_s__datetime;
static PyObject *__pyx_n_s__decode;
static PyObject *__pyx_n_s__decode_cstr;
static PyObject *__pyx_n_s__deferment_end_time;
static PyObject *__pyx_n_s__delay;
static PyObject *__pyx_n_s__deletion_time;
static PyObject *__pyx_n_s__description;
static PyObject *__pyx_n_s__dest;
static PyObject *__pyx_n_s__dest_ioctx;
static PyObject *__pyx_n_s__dest_name;
static PyObject *__pyx_n_s__dstname;
static PyObject *__pyx_n_s__enabled;
static PyObject *__pyx_n_s__encode;
static PyObject *__pyx_n_s__encoding;
static PyObject *__pyx_n_s__errno;
static PyObject *__pyx_n_s__exc_info;
static PyObject *__pyx_n_s__exclusive;
static PyObject *__pyx_n_s__extra;
static PyObject *__pyx_n_s__fadvise_flags;
static PyObject *__pyx_n_s__features;
static PyObject *__pyx_n_s__flags;
static PyObject *__pyx_n_s__force;
static PyObject *__pyx_n_s__format;
static PyObject *__pyx_n_s__from_snapshot;
static PyObject *__pyx_n_s__fromtimestamp;
static PyObject *__pyx_n_s__get_next_chunk;
static PyObject *__pyx_n_s__get_return_value;
static PyObject *__pyx_n_s__global_id;
static PyObject *__pyx_n_s__i;
static PyObject *__pyx_n_s__id;
static PyObject *__pyx_n_s__image;
static PyObject *__pyx_n_s__image_id;
static PyObject *__pyx_n_s__include_parent;
static PyObject *__pyx_n_s__info;
static PyObject *__pyx_n_s__ioctx;
static PyObject *__pyx_n_s__iterate_cb;
static PyObject *__pyx_n_s__key;
static PyObject *__pyx_n_s__last_update;
static PyObject *__pyx_n_s__length;
static PyObject *__pyx_n_s__list;
static PyObject *__pyx_n_s__lock_mode;
static PyObject *__pyx_n_s__lock_owner;
static PyObject *__pyx_n_s__lockers;
static PyObject *__pyx_n_s__major;
static PyObject *__pyx_n_s__map;
static PyObject *__pyx_n_s__maxlen;
static PyObject *__pyx_n_s__message;
static PyObject *__pyx_n_s__minor;
static PyObject *__pyx_n_s__mirror_mode;
static PyObject *__pyx_n_s__mirror_mode_get;
static PyObject *__pyx_n_s__mirror_mode_set;
static PyObject *__pyx_n_s__mirror_peer_add;
static PyObject *__pyx_n_s__mirror_peer_list;
static PyObject *__pyx_n_s__mirror_peer_remove;
static PyObject *__pyx_n_s__mode;
static PyObject *__pyx_n_s__msg;
static PyObject *__pyx_n_s__name;
static PyObject *__pyx_n_s__num_objs;
static PyObject *__pyx_n_s__obj_size;
static PyObject *__pyx_n_s__object;
static PyObject *__pyx_n_s__offset;
static PyObject *__pyx_n_s__old_format;
static PyObject *__pyx_n_s__oncomplete;
static PyObject *__pyx_n_s__oncomplete_;
static PyObject *__pyx_n_s__opt;
static PyObject *__pyx_n_s__opts;
static PyObject *__pyx_n_s__order;
static PyObject *__pyx_n_s__owner;
static PyObject *__pyx_n_s__p_ioctx;
static PyObject *__pyx_n_s__p_name;
static PyObject *__pyx_n_s__p_snapname;
static PyObject *__pyx_n_s__parent_name;
static PyObject *__pyx_n_s__parent_pool;
static PyObject *__pyx_n_s__primary;
static PyObject *__pyx_n_s__range;
static PyObject *__pyx_n_s__rbd;
static PyObject *__pyx_n_s__read_only;
static PyObject *__pyx_n_s__remove;
static PyObject *__pyx_n_s__rename;
static PyObject *__pyx_n_s__ret;
static PyObject *__pyx_n_s__return_value;
static PyObject *__pyx_n_s__self;
static PyObject *__pyx_n_s__send;
static PyObject *__pyx_n_s__size;
static PyObject *__pyx_n_s__snapshot;
static PyObject *__pyx_n_s__source;
static PyObject *__pyx_n_s__split;
static PyObject *__pyx_n_s__src;
static PyObject *__pyx_n_s__srcname;
static PyObject *__pyx_n_s__state;
static PyObject *__pyx_n_s__states;
static PyObject *__pyx_n_s__stripe_count;
static PyObject *__pyx_n_s__stripe_unit;
static PyObject *__pyx_n_s__super;
static PyObject *__pyx_n_s__sys;
static PyObject *__pyx_n_s__tag;
static PyObject *__pyx_n_s__throw;
static PyObject *__pyx_n_s__traceback;
static PyObject *__pyx_n_s__trash_get;
static PyObject *__pyx_n_s__trash_list;
static PyObject *__pyx_n_s__trash_move;
static PyObject *__pyx_n_s__trash_remove;
static PyObject *__pyx_n_s__trash_restore;
static PyObject *__pyx_n_s__type_;
static PyObject *__pyx_n_s__up;
static PyObject *__pyx_n_s__uuid;
static PyObject *__pyx_n_s__val;
static PyObject *__pyx_n_s__value;
static PyObject *__pyx_n_s__version;
static PyObject *__pyx_n_s__whole_object;
static PyObject *__pyx_n_s__zip;
static PyObject *__pyx_int_0;
static PyObject *__pyx_k_3;
static PyObject *__pyx_k_35;
static PyObject *__pyx_k_68;
static PyObject *__pyx_k_69;
static PyObject *__pyx_k_tuple_6;
static PyObject *__pyx_k_tuple_8;
static PyObject *__pyx_k_tuple_19;
static PyObject *__pyx_k_tuple_72;
static PyObject *__pyx_k_tuple_85;
static PyObject *__pyx_k_tuple_86;
static PyObject *__pyx_k_tuple_87;
static PyObject *__pyx_k_tuple_88;
static PyObject *__pyx_k_tuple_89;
static PyObject *__pyx_k_tuple_103;
static PyObject *__pyx_k_tuple_116;
static PyObject *__pyx_k_tuple_117;
static PyObject *__pyx_k_tuple_149;
static PyObject *__pyx_k_tuple_151;
static PyObject *__pyx_k_tuple_153;
static PyObject *__pyx_k_tuple_156;
static PyObject *__pyx_k_tuple_161;
static PyObject *__pyx_k_tuple_163;
static PyObject *__pyx_k_tuple_165;
static PyObject *__pyx_k_tuple_168;
static PyObject *__pyx_k_tuple_171;
static PyObject *__pyx_k_tuple_173;
static PyObject *__pyx_k_tuple_175;
static PyObject *__pyx_k_tuple_178;
static PyObject *__pyx_k_tuple_181;
static PyObject *__pyx_k_tuple_184;
static PyObject *__pyx_k_tuple_186;
static PyObject *__pyx_k_tuple_188;
static PyObject *__pyx_k_tuple_191;
static PyObject *__pyx_k_tuple_194;
static PyObject *__pyx_k_tuple_197;
static PyObject *__pyx_k_tuple_200;
static PyObject *__pyx_k_tuple_203;
static PyObject *__pyx_k_tuple_206;
static PyObject *__pyx_k_tuple_209;
static PyObject *__pyx_k_tuple_212;
static PyObject *__pyx_k_tuple_215;
static PyObject *__pyx_k_tuple_219;
static PyObject *__pyx_k_tuple_223;
static PyObject *__pyx_k_tuple_227;
static PyObject *__pyx_k_codeobj_104;
static PyObject *__pyx_k_codeobj_150;
static PyObject *__pyx_k_codeobj_154;
static PyObject *__pyx_k_codeobj_157;
static PyObject *__pyx_k_codeobj_162;
static PyObject *__pyx_k_codeobj_164;
static PyObject *__pyx_k_codeobj_166;
static PyObject *__pyx_k_codeobj_169;
static PyObject *__pyx_k_codeobj_172;
static PyObject *__pyx_k_codeobj_176;
static PyObject *__pyx_k_codeobj_179;
static PyObject *__pyx_k_codeobj_182;
static PyObject *__pyx_k_codeobj_185;
static PyObject *__pyx_k_codeobj_189;
static PyObject *__pyx_k_codeobj_192;
static PyObject *__pyx_k_codeobj_195;
static PyObject *__pyx_k_codeobj_198;
static PyObject *__pyx_k_codeobj_201;
static PyObject *__pyx_k_codeobj_204;
static PyObject *__pyx_k_codeobj_207;
static PyObject *__pyx_k_codeobj_210;
static PyObject *__pyx_k_codeobj_213;
static PyObject *__pyx_k_codeobj_216;
static PyObject *__pyx_k_codeobj_220;
static PyObject *__pyx_k_codeobj_224;
static PyObject *__pyx_k_codeobj_228;

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_7OSError_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_7OSError___init__[] = "OSError.__init__(self, message, errno=None)";
static PyMethodDef __pyx_mdef_3rbd_7OSError_1__init__ = {__Pyx_NAMESTR("__init__"), (PyCFunction)__pyx_pw_3rbd_7OSError_1__init__, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_7OSError___init__)};
static PyObject *__pyx_pw_3rbd_7OSError_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_message = 0;
  PyObject *__pyx_v_errno = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__message,&__pyx_n_s__errno,0};
    PyObject* values[3] = {0,0,0};

    /* "rbd.pyx":391
 * class OSError(Error):
 *     """ `OSError` class, derived from `Error` """
 *     def __init__(self, message, errno=None):             # <<<<<<<<<<<<<<
 *         super(OSError, self).__init__(message)
 *         self.errno = errno
 */
    values[2] = ((PyObject *)((PyObject *)Py_None));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__message)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__errno);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_self = values[0];
    __pyx_v_message = values[1];
    __pyx_v_errno = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.OSError.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_7OSError___init__(__pyx_self, __pyx_v_self, __pyx_v_message, __pyx_v_errno);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_3rbd_7OSError___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_message, PyObject *__pyx_v_errno) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "rbd.pyx":392
 *     """ `OSError` class, derived from `Error` """
 *     def __init__(self, message, errno=None):
 *         super(OSError, self).__init__(message)             # <<<<<<<<<<<<<<
 *         self.errno = errno
 * 
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_self);
  __Pyx_GIVEREF(__pyx_v_self);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_builtin_super, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s____init__); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_message);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_message);
  __Pyx_GIVEREF(__pyx_v_message);
  __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":393
 *     def __init__(self, message, errno=None):
 *         super(OSError, self).__init__(message)
 *         self.errno = errno             # <<<<<<<<<<<<<<
 * 
 *     def __str__(self):
 */
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s__errno, __pyx_v_errno) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.OSError.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_7OSError_3__str__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_3rbd_7OSError_2__str__[] = "OSError.__str__(self)";
static PyMethodDef __pyx_mdef_3rbd_7OSError_3__str__ = {__Pyx_NAMESTR("__str__"), (PyCFunction)__pyx_pw_3rbd_7OSError_3__str__, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_7OSError_2__str__)};
static PyObject *__pyx_pw_3rbd_7OSError_3__str__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__str__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_7OSError_2__str__(__pyx_self, ((PyObject *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":395
 *         self.errno = errno
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         msg = super(OSError, self).__str__()
 *         if self.errno is None:
 */

static PyObject *__pyx_pf_3rbd_7OSError_2__str__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_v_msg = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__str__", 0);

  /* "rbd.pyx":396
 * 
 *     def __str__(self):
 *         msg = super(OSError, self).__str__()             # <<<<<<<<<<<<<<
 *         if self.errno is None:
 *             return msg
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_self);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_self);
  __Pyx_GIVEREF(__pyx_v_self);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_builtin_super, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s____str__); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_msg = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":397
 *     def __str__(self):
 *         msg = super(OSError, self).__str__()
 *         if self.errno is None:             # <<<<<<<<<<<<<<
 *             return msg
 *         return '[errno {0}] {1}'.format(self.errno, msg)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s__errno); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = (__pyx_t_1 == Py_None);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {

    /* "rbd.pyx":398
 *         msg = super(OSError, self).__str__()
 *         if self.errno is None:
 *             return msg             # <<<<<<<<<<<<<<
 *         return '[errno {0}] {1}'.format(self.errno, msg)
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_msg);
    __pyx_r = __pyx_v_msg;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":399
 *         if self.errno is None:
 *             return msg
 *         return '[errno {0}] {1}'.format(self.errno, msg)             # <<<<<<<<<<<<<<
 * 
 *     def __reduce__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_kp_s_1), __pyx_n_s__format); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s__errno); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_msg);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_msg);
  __Pyx_GIVEREF(__pyx_v_msg);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.OSError.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_msg);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_7OSError_5__reduce__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_3rbd_7OSError_4__reduce__[] = "OSError.__reduce__(self)";
static PyMethodDef __pyx_mdef_3rbd_7OSError_5__reduce__ = {__Pyx_NAMESTR("__reduce__"), (PyCFunction)__pyx_pw_3rbd_7OSError_5__reduce__, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_7OSError_4__reduce__)};
static PyObject *__pyx_pw_3rbd_7OSError_5__reduce__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__reduce__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_7OSError_4__reduce__(__pyx_self, ((PyObject *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":401
 *         return '[errno {0}] {1}'.format(self.errno, msg)
 * 
 *     def __reduce__(self):             # <<<<<<<<<<<<<<
 *         return (self.__class__, (self.message, self.errno))
 * 
 */

static PyObject *__pyx_pf_3rbd_7OSError_4__reduce__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__reduce__", 0);

  /* "rbd.pyx":402
 * 
 *     def __reduce__(self):
 *         return (self.__class__, (self.message, self.errno))             # <<<<<<<<<<<<<<
 * 
 * class PermissionError(OSError):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s____class__); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s__message); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s__errno); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_t_4));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_r = ((PyObject *)__pyx_t_3);
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.OSError.__reduce__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":484
 * }
 * 
 * cdef make_ex(ret, msg):             # <<<<<<<<<<<<<<
 *     """
 *     Translate a librbd return code into an exception.
 */

static PyObject *__pyx_f_3rbd_make_ex(PyObject *__pyx_v_ret, PyObject *__pyx_v_msg) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("make_ex", 0);
  __Pyx_INCREF(__pyx_v_ret);

  /* "rbd.pyx":494
 *     :returns: a subclass of :class:`Error`
 *     """
 *     ret = abs(ret)             # <<<<<<<<<<<<<<
 *     if ret in errno_to_exception:
 *         return errno_to_exception[ret](msg, errno=ret)
 */
  __pyx_t_1 = PyNumber_Absolute(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_v_ret);
  __pyx_v_ret = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":495
 *     """
 *     ret = abs(ret)
 *     if ret in errno_to_exception:             # <<<<<<<<<<<<<<
 *         return errno_to_exception[ret](msg, errno=ret)
 *     else:
 */
  __pyx_t_2 = (__Pyx_PySequence_Contains(__pyx_v_ret, __pyx_v_3rbd_errno_to_exception, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_2) {

    /* "rbd.pyx":496
 *     ret = abs(ret)
 *     if ret in errno_to_exception:
 *         return errno_to_exception[ret](msg, errno=ret)             # <<<<<<<<<<<<<<
 *     else:
 *         return OSError(msg, errno=ret)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = PyObject_GetItem(__pyx_v_3rbd_errno_to_exception, __pyx_v_ret); if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 496; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 496; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_msg);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_msg);
    __Pyx_GIVEREF(__pyx_v_msg);
    __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 496; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__errno), __pyx_v_ret) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 496; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_5 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 496; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_5;
    __pyx_t_5 = 0;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "rbd.pyx":498
 *         return errno_to_exception[ret](msg, errno=ret)
 *     else:
 *         return OSError(msg, errno=ret)             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_msg);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_msg);
    __Pyx_GIVEREF(__pyx_v_msg);
    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__errno), __pyx_v_ret) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_1 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
  }
  __pyx_L3:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.make_ex", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ret);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":501
 * 
 * 
 * cdef rados_ioctx_t convert_ioctx(rados.Ioctx ioctx) except? NULL:             # <<<<<<<<<<<<<<
 *     return <rados_ioctx_t>ioctx.io
 * 
 */

static rados_ioctx_t __pyx_f_3rbd_convert_ioctx(struct __pyx_obj_5rados_Ioctx *__pyx_v_ioctx) {
  rados_ioctx_t __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("convert_ioctx", 0);

  /* "rbd.pyx":502
 * 
 * cdef rados_ioctx_t convert_ioctx(rados.Ioctx ioctx) except? NULL:
 *     return <rados_ioctx_t>ioctx.io             # <<<<<<<<<<<<<<
 * 
 * cdef int no_op_progress_callback(uint64_t offset, uint64_t total, void* ptr) nogil:
 */
  __pyx_r = ((rados_ioctx_t)__pyx_v_ioctx->io);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":504
 *     return <rados_ioctx_t>ioctx.io
 * 
 * cdef int no_op_progress_callback(uint64_t offset, uint64_t total, void* ptr) nogil:             # <<<<<<<<<<<<<<
 *     return 0
 * 
 */

static int __pyx_f_3rbd_no_op_progress_callback(CYTHON_UNUSED uint64_t __pyx_v_offset, CYTHON_UNUSED uint64_t __pyx_v_total, CYTHON_UNUSED void *__pyx_v_ptr) {
  int __pyx_r;

  /* "rbd.pyx":505
 * 
 * cdef int no_op_progress_callback(uint64_t offset, uint64_t total, void* ptr) nogil:
 *     return 0             # <<<<<<<<<<<<<<
 * 
 * def cstr(val, name, encoding="utf-8", opt=False):
 */
  __pyx_r = 0;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_1cstr(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_cstr[] = "cstr(val, name, encoding='utf-8', opt=False)\n\n    Create a byte string from a Python string\n\n    :param basestring val: Python string\n    :param str name: Name of the string parameter, for exceptions\n    :param str encoding: Encoding to use\n    :param bool opt: If True, None is allowed\n    :rtype: bytes\n    :raises: :class:`InvalidArgument`\n    ";
static PyMethodDef __pyx_mdef_3rbd_1cstr = {__Pyx_NAMESTR("cstr"), (PyCFunction)__pyx_pw_3rbd_1cstr, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_cstr)};
static PyObject *__pyx_pw_3rbd_1cstr(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_val = 0;
  PyObject *__pyx_v_name = 0;
  PyObject *__pyx_v_encoding = 0;
  PyObject *__pyx_v_opt = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("cstr (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__val,&__pyx_n_s__name,&__pyx_n_s__encoding,&__pyx_n_s__opt,0};
    PyObject* values[4] = {0,0,0,0};
    values[2] = ((PyObject *)__pyx_kp_s_2);
    values[3] = __pyx_k_3;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__val)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("cstr", 0, 2, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__encoding);
          if (value) { values[2] = value; kw_args--; }
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__opt);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cstr") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_val = values[0];
    __pyx_v_name = values[1];
    __pyx_v_encoding = values[2];
    __pyx_v_opt = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("cstr", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.cstr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_cstr(__pyx_self, __pyx_v_val, __pyx_v_name, __pyx_v_encoding, __pyx_v_opt);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":507
 *     return 0
 * 
 * def cstr(val, name, encoding="utf-8", opt=False):             # <<<<<<<<<<<<<<
 *     """
 *     Create a byte string from a Python string
 */

static PyObject *__pyx_pf_3rbd_cstr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_val, PyObject *__pyx_v_name, PyObject *__pyx_v_encoding, PyObject *__pyx_v_opt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("cstr", 0);

  /* "rbd.pyx":518
 *     :raises: :class:`InvalidArgument`
 *     """
 *     if opt and val is None:             # <<<<<<<<<<<<<<
 *         return None
 *     if isinstance(val, bytes):
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_opt); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 518; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {
    __pyx_t_2 = (__pyx_v_val == Py_None);
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "rbd.pyx":519
 *     """
 *     if opt and val is None:
 *         return None             # <<<<<<<<<<<<<<
 *     if isinstance(val, bytes):
 *         return val
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":520
 *     if opt and val is None:
 *         return None
 *     if isinstance(val, bytes):             # <<<<<<<<<<<<<<
 *         return val
 *     elif isinstance(val, unicode):
 */
  __pyx_t_3 = PyBytes_Check(__pyx_v_val); 
  if (__pyx_t_3) {

    /* "rbd.pyx":521
 *         return None
 *     if isinstance(val, bytes):
 *         return val             # <<<<<<<<<<<<<<
 *     elif isinstance(val, unicode):
 *         return val.encode(encoding)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_val);
    __pyx_r = __pyx_v_val;
    goto __pyx_L0;
    goto __pyx_L4;
  }

  /* "rbd.pyx":522
 *     if isinstance(val, bytes):
 *         return val
 *     elif isinstance(val, unicode):             # <<<<<<<<<<<<<<
 *         return val.encode(encoding)
 *     else:
 */
  __pyx_t_3 = PyUnicode_Check(__pyx_v_val); 
  if (__pyx_t_3) {

    /* "rbd.pyx":523
 *         return val
 *     elif isinstance(val, unicode):
 *         return val.encode(encoding)             # <<<<<<<<<<<<<<
 *     else:
 *         raise InvalidArgument('%s must be a string' % name)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s__encode); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_v_encoding);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_encoding);
    __Pyx_GIVEREF(__pyx_v_encoding);
    __pyx_t_6 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  /*else*/ {

    /* "rbd.pyx":525
 *         return val.encode(encoding)
 *     else:
 *         raise InvalidArgument('%s must be a string' % name)             # <<<<<<<<<<<<<<
 * 
 * def decode_cstr(val, encoding="utf-8"):
 */
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s__InvalidArgument); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_4), __pyx_v_name); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_t_5));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_L4:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("rbd.cstr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3decode_cstr(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_2decode_cstr[] = "decode_cstr(val, encoding='utf-8')\n\n    Decode a byte string into a Python string.\n\n    :param bytes val: byte string\n    :rtype: unicode or None\n    ";
static PyMethodDef __pyx_mdef_3rbd_3decode_cstr = {__Pyx_NAMESTR("decode_cstr"), (PyCFunction)__pyx_pw_3rbd_3decode_cstr, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_2decode_cstr)};
static PyObject *__pyx_pw_3rbd_3decode_cstr(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_val = 0;
  PyObject *__pyx_v_encoding = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("decode_cstr (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__val,&__pyx_n_s__encoding,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)__pyx_kp_s_2);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__val)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__encoding);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "decode_cstr") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_val = values[0];
    __pyx_v_encoding = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("decode_cstr", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.decode_cstr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_2decode_cstr(__pyx_self, __pyx_v_val, __pyx_v_encoding);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":527
 *         raise InvalidArgument('%s must be a string' % name)
 * 
 * def decode_cstr(val, encoding="utf-8"):             # <<<<<<<<<<<<<<
 *     """
 *     Decode a byte string into a Python string.
 */

static PyObject *__pyx_pf_3rbd_2decode_cstr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_val, PyObject *__pyx_v_encoding) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("decode_cstr", 0);

  /* "rbd.pyx":534
 *     :rtype: unicode or None
 *     """
 *     if val is None:             # <<<<<<<<<<<<<<
 *         return None
 * 
 */
  __pyx_t_1 = (__pyx_v_val == Py_None);
  if (__pyx_t_1) {

    /* "rbd.pyx":535
 *     """
 *     if val is None:
 *         return None             # <<<<<<<<<<<<<<
 * 
 *     return val.decode(encoding)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":537
 *         return None
 * 
 *     return val.decode(encoding)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s__decode); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_encoding);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_encoding);
  __Pyx_GIVEREF(__pyx_v_encoding);
  __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.decode_cstr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":540
 * 
 * 
 * cdef char* opt_str(s) except? NULL:             # <<<<<<<<<<<<<<
 *     if s is None:
 *         return NULL
 */

static char *__pyx_f_3rbd_opt_str(PyObject *__pyx_v_s) {
  char *__pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  char *__pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("opt_str", 0);

  /* "rbd.pyx":541
 * 
 * cdef char* opt_str(s) except? NULL:
 *     if s is None:             # <<<<<<<<<<<<<<
 *         return NULL
 *     return s
 */
  __pyx_t_1 = (__pyx_v_s == Py_None);
  if (__pyx_t_1) {

    /* "rbd.pyx":542
 * cdef char* opt_str(s) except? NULL:
 *     if s is None:
 *         return NULL             # <<<<<<<<<<<<<<
 *     return s
 * 
 */
    __pyx_r = NULL;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":543
 *     if s is None:
 *         return NULL
 *     return s             # <<<<<<<<<<<<<<
 * 
 * cdef void* realloc_chk(void* ptr, size_t size) except NULL:
 */
  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_s); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 543; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_t_2;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("rbd.opt_str", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":545
 *     return s
 * 
 * cdef void* realloc_chk(void* ptr, size_t size) except NULL:             # <<<<<<<<<<<<<<
 *     cdef void *ret = realloc(ptr, size)
 *     if ret == NULL:
 */

static void *__pyx_f_3rbd_realloc_chk(void *__pyx_v_ptr, size_t __pyx_v_size) {
  void *__pyx_v_ret;
  void *__pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("realloc_chk", 0);

  /* "rbd.pyx":546
 * 
 * cdef void* realloc_chk(void* ptr, size_t size) except NULL:
 *     cdef void *ret = realloc(ptr, size)             # <<<<<<<<<<<<<<
 *     if ret == NULL:
 *         raise MemoryError("realloc failed")
 */
  __pyx_v_ret = realloc(__pyx_v_ptr, __pyx_v_size);

  /* "rbd.pyx":547
 * cdef void* realloc_chk(void* ptr, size_t size) except NULL:
 *     cdef void *ret = realloc(ptr, size)
 *     if ret == NULL:             # <<<<<<<<<<<<<<
 *         raise MemoryError("realloc failed")
 *     return ret
 */
  __pyx_t_1 = (__pyx_v_ret == NULL);
  if (__pyx_t_1) {

    /* "rbd.pyx":548
 *     cdef void *ret = realloc(ptr, size)
 *     if ret == NULL:
 *         raise MemoryError("realloc failed")             # <<<<<<<<<<<<<<
 *     return ret
 * 
 */
    __pyx_t_2 = PyObject_Call(__pyx_builtin_MemoryError, ((PyObject *)__pyx_k_tuple_6), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":549
 *     if ret == NULL:
 *         raise MemoryError("realloc failed")
 *     return ret             # <<<<<<<<<<<<<<
 * 
 * cdef class Completion
 */
  __pyx_r = __pyx_v_ret;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.realloc_chk", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":553
 * cdef class Completion
 * 
 * cdef void __aio_complete_cb(rbd_completion_t completion, void *args) with gil:             # <<<<<<<<<<<<<<
 *     """
 *     Callback to oncomplete() for asynchronous operations
 */

static void __pyx_f_3rbd___aio_complete_cb(CYTHON_UNUSED rbd_completion_t __pyx_v_completion, void *__pyx_v_args) {
  struct __pyx_obj_3rbd_Completion *__pyx_v_cb = 0;
  __Pyx_RefNannyDeclarations
  #ifdef WITH_THREAD
  PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
  #endif
  __Pyx_RefNannySetupContext("__aio_complete_cb", 0);

  /* "rbd.pyx":557
 *     Callback to oncomplete() for asynchronous operations
 *     """
 *     cdef Completion cb = <Completion>args             # <<<<<<<<<<<<<<
 *     cb._complete()
 * 
 */
  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_3rbd_Completion *)__pyx_v_args)));
  __pyx_v_cb = ((struct __pyx_obj_3rbd_Completion *)__pyx_v_args);

  /* "rbd.pyx":558
 *     """
 *     cdef Completion cb = <Completion>args
 *     cb._complete()             # <<<<<<<<<<<<<<
 * 
 * 
 */
  ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_cb->__pyx_vtab)->_complete(__pyx_v_cb);

  __Pyx_XDECREF((PyObject *)__pyx_v_cb);
  __Pyx_RefNannyFinishContext();
  #ifdef WITH_THREAD
  PyGILState_Release(__pyx_gilstate_save);
  #endif
}

/* Python wrapper */
static int __pyx_pw_3rbd_10Completion_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3rbd_10Completion_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_image = 0;
  PyObject *__pyx_v_oncomplete = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__cinit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__image,&__pyx_n_s__oncomplete,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__image)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__oncomplete)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_image = values[0];
    __pyx_v_oncomplete = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Completion.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_10Completion___cinit__(((struct __pyx_obj_3rbd_Completion *)__pyx_v_self), __pyx_v_image, __pyx_v_oncomplete);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":572
 *         object exc_info
 * 
 *     def __cinit__(self, image, object oncomplete):             # <<<<<<<<<<<<<<
 *         self.oncomplete = oncomplete
 *         self.image = image
 */

static int __pyx_pf_3rbd_10Completion___cinit__(struct __pyx_obj_3rbd_Completion *__pyx_v_self, PyObject *__pyx_v_image, PyObject *__pyx_v_oncomplete) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__cinit__", 0);

  /* "rbd.pyx":573
 * 
 *     def __cinit__(self, image, object oncomplete):
 *         self.oncomplete = oncomplete             # <<<<<<<<<<<<<<
 *         self.image = image
 *         self.persisted = False
 */
  __Pyx_INCREF(__pyx_v_oncomplete);
  __Pyx_GIVEREF(__pyx_v_oncomplete);
  __Pyx_GOTREF(__pyx_v_self->oncomplete);
  __Pyx_DECREF(__pyx_v_self->oncomplete);
  __pyx_v_self->oncomplete = __pyx_v_oncomplete;

  /* "rbd.pyx":574
 *     def __cinit__(self, image, object oncomplete):
 *         self.oncomplete = oncomplete
 *         self.image = image             # <<<<<<<<<<<<<<
 *         self.persisted = False
 * 
 */
  __Pyx_INCREF(__pyx_v_image);
  __Pyx_GIVEREF(__pyx_v_image);
  __Pyx_GOTREF(__pyx_v_self->image);
  __Pyx_DECREF(__pyx_v_self->image);
  __pyx_v_self->image = __pyx_v_image;

  /* "rbd.pyx":575
 *         self.oncomplete = oncomplete
 *         self.image = image
 *         self.persisted = False             # <<<<<<<<<<<<<<
 * 
 *     def is_complete(self):
 */
  __pyx_v_self->persisted = 0;

  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_10Completion_3is_complete(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_10Completion_2is_complete[] = "Completion.is_complete(self)\n\n        Has an asynchronous operation completed?\n\n        This does not imply that the callback has finished.\n\n        :returns: True if the operation is completed\n        ";
static PyObject *__pyx_pw_3rbd_10Completion_3is_complete(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_complete (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_10Completion_2is_complete(((struct __pyx_obj_3rbd_Completion *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":577
 *         self.persisted = False
 * 
 *     def is_complete(self):             # <<<<<<<<<<<<<<
 *         """
 *         Has an asynchronous operation completed?
 */

static PyObject *__pyx_pf_3rbd_10Completion_2is_complete(struct __pyx_obj_3rbd_Completion *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("is_complete", 0);

  /* "rbd.pyx":585
 *         :returns: True if the operation is completed
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_aio_is_complete(self.rbd_comp)
 *         return ret == 1
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":586
 *         """
 *         with nogil:
 *             ret = rbd_aio_is_complete(self.rbd_comp)             # <<<<<<<<<<<<<<
 *         return ret == 1
 * 
 */
        __pyx_v_ret = rbd_aio_is_complete(__pyx_v_self->rbd_comp);
      }

      /* "rbd.pyx":585
 *         :returns: True if the operation is completed
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_aio_is_complete(self.rbd_comp)
 *         return ret == 1
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":587
 *         with nogil:
 *             ret = rbd_aio_is_complete(self.rbd_comp)
 *         return ret == 1             # <<<<<<<<<<<<<<
 * 
 *     def wait_for_complete_and_cb(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyBool_FromLong((__pyx_v_ret == 1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("rbd.Completion.is_complete", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_10Completion_5wait_for_complete_and_cb(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_10Completion_4wait_for_complete_and_cb[] = "Completion.wait_for_complete_and_cb(self)\n\n        Wait for an asynchronous operation to complete\n\n        This method waits for the callback to execute, if one was provided.\n        It will also re-raise any exceptions raised by the callback. You\n        should call this to \"reap\" asynchronous completions and ensure that\n        any exceptions in the callbacks are handled, as an exception internal\n        to this module may have occurred.\n        ";
static PyObject *__pyx_pw_3rbd_10Completion_5wait_for_complete_and_cb(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("wait_for_complete_and_cb (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_10Completion_4wait_for_complete_and_cb(((struct __pyx_obj_3rbd_Completion *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":589
 *         return ret == 1
 * 
 *     def wait_for_complete_and_cb(self):             # <<<<<<<<<<<<<<
 *         """
 *         Wait for an asynchronous operation to complete
 */

static PyObject *__pyx_pf_3rbd_10Completion_4wait_for_complete_and_cb(struct __pyx_obj_3rbd_Completion *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("wait_for_complete_and_cb", 0);

  /* "rbd.pyx":599
 *         to this module may have occurred.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             rbd_aio_wait_for_complete(self.rbd_comp)
 * 
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":600
 *         """
 *         with nogil:
 *             rbd_aio_wait_for_complete(self.rbd_comp)             # <<<<<<<<<<<<<<
 * 
 *         if self.exc_info:
 */
        rbd_aio_wait_for_complete(__pyx_v_self->rbd_comp);
      }

      /* "rbd.pyx":599
 *         to this module may have occurred.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             rbd_aio_wait_for_complete(self.rbd_comp)
 * 
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":602
 *             rbd_aio_wait_for_complete(self.rbd_comp)
 * 
 *         if self.exc_info:             # <<<<<<<<<<<<<<
 *             raise self.exc_info[0], self.exc_info[1], self.exc_info[2]
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_self->exc_info); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {

    /* "rbd.pyx":603
 * 
 *         if self.exc_info:
 *             raise self.exc_info[0], self.exc_info[1], self.exc_info[2]             # <<<<<<<<<<<<<<
 * 
 *     def get_return_value(self):
 */
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_self->exc_info, 0, sizeof(long), PyInt_FromLong, 0, 0, 1); if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_self->exc_info, 1, sizeof(long), PyInt_FromLong, 0, 0, 1); if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_self->exc_info, 2, sizeof(long), PyInt_FromLong, 0, 0, 1); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_Raise(__pyx_t_2, __pyx_t_3, __pyx_t_4, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Completion.wait_for_complete_and_cb", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_10Completion_7get_return_value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_10Completion_6get_return_value[] = "Completion.get_return_value(self)\n\n        Get the return value of an asychronous operation\n\n        The return value is set when the operation is complete.\n\n        :returns: int - return value of the operation\n        ";
static PyObject *__pyx_pw_3rbd_10Completion_7get_return_value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_return_value (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_10Completion_6get_return_value(((struct __pyx_obj_3rbd_Completion *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":605
 *             raise self.exc_info[0], self.exc_info[1], self.exc_info[2]
 * 
 *     def get_return_value(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the return value of an asychronous operation
 */

static PyObject *__pyx_pf_3rbd_10Completion_6get_return_value(struct __pyx_obj_3rbd_Completion *__pyx_v_self) {
  Py_ssize_t __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("get_return_value", 0);

  /* "rbd.pyx":613
 *         :returns: int - return value of the operation
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_aio_get_return_value(self.rbd_comp)
 *         return ret
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":614
 *         """
 *         with nogil:
 *             ret = rbd_aio_get_return_value(self.rbd_comp)             # <<<<<<<<<<<<<<
 *         return ret
 * 
 */
        __pyx_v_ret = rbd_aio_get_return_value(__pyx_v_self->rbd_comp);
      }

      /* "rbd.pyx":613
 *         :returns: int - return value of the operation
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_aio_get_return_value(self.rbd_comp)
 *         return ret
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":615
 *         with nogil:
 *             ret = rbd_aio_get_return_value(self.rbd_comp)
 *         return ret             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 615; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("rbd.Completion.get_return_value", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_3rbd_10Completion_9__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_3rbd_10Completion_9__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_3rbd_10Completion_8__dealloc__(((struct __pyx_obj_3rbd_Completion *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":617
 *         return ret
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         """
 *         Release a completion
 */

static void __pyx_pf_3rbd_10Completion_8__dealloc__(struct __pyx_obj_3rbd_Completion *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "rbd.pyx":623
 *         This is automatically called when the completion object is freed.
 *         """
 *         ref.Py_XDECREF(self.buf)             # <<<<<<<<<<<<<<
 *         self.buf = NULL
 *         if self.rbd_comp != NULL:
 */
  Py_XDECREF(__pyx_v_self->buf);

  /* "rbd.pyx":624
 *         """
 *         ref.Py_XDECREF(self.buf)
 *         self.buf = NULL             # <<<<<<<<<<<<<<
 *         if self.rbd_comp != NULL:
 *             with nogil:
 */
  __pyx_v_self->buf = NULL;

  /* "rbd.pyx":625
 *         ref.Py_XDECREF(self.buf)
 *         self.buf = NULL
 *         if self.rbd_comp != NULL:             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 rbd_aio_release(self.rbd_comp)
 */
  __pyx_t_1 = (__pyx_v_self->rbd_comp != NULL);
  if (__pyx_t_1) {

    /* "rbd.pyx":626
 *         self.buf = NULL
 *         if self.rbd_comp != NULL:
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 rbd_aio_release(self.rbd_comp)
 *                 self.rbd_comp = NULL
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":627
 *         if self.rbd_comp != NULL:
 *             with nogil:
 *                 rbd_aio_release(self.rbd_comp)             # <<<<<<<<<<<<<<
 *                 self.rbd_comp = NULL
 * 
 */
          rbd_aio_release(__pyx_v_self->rbd_comp);

          /* "rbd.pyx":628
 *             with nogil:
 *                 rbd_aio_release(self.rbd_comp)
 *                 self.rbd_comp = NULL             # <<<<<<<<<<<<<<
 * 
 *     cdef void _complete(self):
 */
          __pyx_v_self->rbd_comp = NULL;
        }

        /* "rbd.pyx":626
 *         self.buf = NULL
 *         if self.rbd_comp != NULL:
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 rbd_aio_release(self.rbd_comp)
 *                 self.rbd_comp = NULL
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }
    goto __pyx_L3;
  }
  __pyx_L3:;

  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":630
 *                 self.rbd_comp = NULL
 * 
 *     cdef void _complete(self):             # <<<<<<<<<<<<<<
 *         try:
 *             self.__unpersist()
 */

static void __pyx_f_3rbd_10Completion__complete(struct __pyx_obj_3rbd_Completion *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("_complete", 0);

  /* "rbd.pyx":631
 * 
 *     cdef void _complete(self):
 *         try:             # <<<<<<<<<<<<<<
 *             self.__unpersist()
 *             if self.oncomplete:
 */
  {
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "rbd.pyx":632
 *     cdef void _complete(self):
 *         try:
 *             self.__unpersist()             # <<<<<<<<<<<<<<
 *             if self.oncomplete:
 *                 self.oncomplete(self)
 */
      __pyx_t_4 = ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_self->__pyx_vtab)->__pyx___unpersist(__pyx_v_self); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "rbd.pyx":633
 *         try:
 *             self.__unpersist()
 *             if self.oncomplete:             # <<<<<<<<<<<<<<
 *                 self.oncomplete(self)
 *         # In the event that something raises an exception during the next 2
 */
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_self->oncomplete); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 633; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      if (__pyx_t_5) {

        /* "rbd.pyx":634
 *             self.__unpersist()
 *             if self.oncomplete:
 *                 self.oncomplete(self)             # <<<<<<<<<<<<<<
 *         # In the event that something raises an exception during the next 2
 *         # lines of code, we will not be able to catch it, and this may result
 */
        __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(((PyObject *)__pyx_v_self));
        PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_self));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
        __pyx_t_6 = PyObject_Call(__pyx_v_self->oncomplete, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        goto __pyx_L11;
      }
      __pyx_L11:;
    }
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L10_try_end;
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "rbd.pyx":641
 *         # should not be a problem because the callback thread from librbd
 *         # ought to have SIGINT blocked.
 *         except:             # <<<<<<<<<<<<<<
 *             self.exc_info = sys.exc_info()
 * 
 */
    /*except:*/ {
      __Pyx_AddTraceback("rbd.Completion._complete", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_4, &__pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GOTREF(__pyx_t_7);

      /* "rbd.pyx":642
 *         # ought to have SIGINT blocked.
 *         except:
 *             self.exc_info = sys.exc_info()             # <<<<<<<<<<<<<<
 * 
 *     cdef __persist(self):
 */
      __pyx_t_8 = __Pyx_GetModuleGlobalName(__pyx_n_s__sys); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s__exc_info); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_GIVEREF(__pyx_t_8);
      __Pyx_GOTREF(__pyx_v_self->exc_info);
      __Pyx_DECREF(__pyx_v_self->exc_info);
      __pyx_v_self->exc_info = __pyx_t_8;
      __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L4_exception_handled;
    }
    __pyx_L5_except_error:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L4_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    __pyx_L10_try_end:;
  }

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_WriteUnraisable("rbd.Completion._complete", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":644
 *             self.exc_info = sys.exc_info()
 * 
 *     cdef __persist(self):             # <<<<<<<<<<<<<<
 *         if self.oncomplete is not None and not self.persisted:
 *             # Increment our own reference count to make sure the completion
 */

static PyObject *__pyx_f_3rbd_10Completion___persist(struct __pyx_obj_3rbd_Completion *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("__persist", 0);

  /* "rbd.pyx":645
 * 
 *     cdef __persist(self):
 *         if self.oncomplete is not None and not self.persisted:             # <<<<<<<<<<<<<<
 *             # Increment our own reference count to make sure the completion
 *             # is not freed until the callback is called. The completion is
 */
  __pyx_t_1 = (__pyx_v_self->oncomplete != Py_None);
  if (__pyx_t_1) {
    __pyx_t_2 = (!__pyx_v_self->persisted);
    __pyx_t_3 = __pyx_t_2;
  } else {
    __pyx_t_3 = __pyx_t_1;
  }
  if (__pyx_t_3) {

    /* "rbd.pyx":649
 *             # is not freed until the callback is called. The completion is
 *             # allowed to be freed if there is no callback.
 *             ref.Py_INCREF(self)             # <<<<<<<<<<<<<<
 *             self.persisted = True
 * 
 */
    Py_INCREF(((PyObject *)__pyx_v_self));

    /* "rbd.pyx":650
 *             # allowed to be freed if there is no callback.
 *             ref.Py_INCREF(self)
 *             self.persisted = True             # <<<<<<<<<<<<<<
 * 
 *     cdef __unpersist(self):
 */
    __pyx_v_self->persisted = 1;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":652
 *             self.persisted = True
 * 
 *     cdef __unpersist(self):             # <<<<<<<<<<<<<<
 *         if self.persisted:
 *             ref.Py_DECREF(self)
 */

static PyObject *__pyx_f_3rbd_10Completion___unpersist(struct __pyx_obj_3rbd_Completion *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__unpersist", 0);

  /* "rbd.pyx":653
 * 
 *     cdef __unpersist(self):
 *         if self.persisted:             # <<<<<<<<<<<<<<
 *             ref.Py_DECREF(self)
 *             self.persisted = False
 */
  if (__pyx_v_self->persisted) {

    /* "rbd.pyx":654
 *     cdef __unpersist(self):
 *         if self.persisted:
 *             ref.Py_DECREF(self)             # <<<<<<<<<<<<<<
 *             self.persisted = False
 * 
 */
    Py_DECREF(((PyObject *)__pyx_v_self));

    /* "rbd.pyx":655
 *         if self.persisted:
 *             ref.Py_DECREF(self)
 *             self.persisted = False             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __pyx_v_self->persisted = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_1version(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_3rbd_3RBD_version[] = "RBD.version(self)\n\n        Get the version number of the ``librbd`` C library.\n\n        :returns: a tuple of ``(major, minor, extra)`` components of the\n                  librbd version\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_1version = {__Pyx_NAMESTR("version"), (PyCFunction)__pyx_pw_3rbd_3RBD_1version, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_version)};
static PyObject *__pyx_pw_3rbd_3RBD_1version(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("version (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_3RBD_version(__pyx_self, ((PyObject *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":662
 *     This class wraps librbd CRUD functions.
 *     """
 *     def version(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the version number of the ``librbd`` C library.
 */

static PyObject *__pyx_pf_3rbd_3RBD_version(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self) {
  int __pyx_v_major;
  int __pyx_v_minor;
  int __pyx_v_extra;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("version", 0);

  /* "rbd.pyx":669
 *                   librbd version
 *         """
 *         cdef int major = 0             # <<<<<<<<<<<<<<
 *         cdef int minor = 0
 *         cdef int extra = 0
 */
  __pyx_v_major = 0;

  /* "rbd.pyx":670
 *         """
 *         cdef int major = 0
 *         cdef int minor = 0             # <<<<<<<<<<<<<<
 *         cdef int extra = 0
 *         rbd_version(&major, &minor, &extra)
 */
  __pyx_v_minor = 0;

  /* "rbd.pyx":671
 *         cdef int major = 0
 *         cdef int minor = 0
 *         cdef int extra = 0             # <<<<<<<<<<<<<<
 *         rbd_version(&major, &minor, &extra)
 *         return (major, minor, extra)
 */
  __pyx_v_extra = 0;

  /* "rbd.pyx":672
 *         cdef int minor = 0
 *         cdef int extra = 0
 *         rbd_version(&major, &minor, &extra)             # <<<<<<<<<<<<<<
 *         return (major, minor, extra)
 * 
 */
  rbd_version((&__pyx_v_major), (&__pyx_v_minor), (&__pyx_v_extra));

  /* "rbd.pyx":673
 *         cdef int extra = 0
 *         rbd_version(&major, &minor, &extra)
 *         return (major, minor, extra)             # <<<<<<<<<<<<<<
 * 
 *     def create(self, ioctx, name, size, order=None, old_format=True,
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(__pyx_v_major); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyInt_FromLong(__pyx_v_minor); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyInt_FromLong(__pyx_v_extra); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_r = ((PyObject *)__pyx_t_4);
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.RBD.version", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":675
 *         return (major, minor, extra)
 * 
 *     def create(self, ioctx, name, size, order=None, old_format=True,             # <<<<<<<<<<<<<<
 *                features=None, stripe_unit=None, stripe_count=None,
 *                data_pool=None):
 */

static PyObject *__pyx_pf_3rbd_3RBD_40__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__defaults__", 0);
  __Pyx_XDECREF(__pyx_r);

  /* "rbd.pyx":677
 *     def create(self, ioctx, name, size, order=None, old_format=True,
 *                features=None, stripe_unit=None, stripe_count=None,
 *                data_pool=None):             # <<<<<<<<<<<<<<
 *         """
 *         Create an rbd image.
 */
  __pyx_t_1 = PyTuple_New(6); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)Py_None));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)Py_None));
  __Pyx_GIVEREF(((PyObject *)Py_None));
  __Pyx_INCREF(__Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_old_format);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_old_format);
  __Pyx_GIVEREF(__Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_old_format);
  __Pyx_INCREF(((PyObject *)Py_None));
  PyTuple_SET_ITEM(__pyx_t_1, 2, ((PyObject *)Py_None));
  __Pyx_GIVEREF(((PyObject *)Py_None));
  __Pyx_INCREF(((PyObject *)Py_None));
  PyTuple_SET_ITEM(__pyx_t_1, 3, ((PyObject *)Py_None));
  __Pyx_GIVEREF(((PyObject *)Py_None));
  __Pyx_INCREF(((PyObject *)Py_None));
  PyTuple_SET_ITEM(__pyx_t_1, 4, ((PyObject *)Py_None));
  __Pyx_GIVEREF(((PyObject *)Py_None));
  __Pyx_INCREF(((PyObject *)Py_None));
  PyTuple_SET_ITEM(__pyx_t_1, 5, ((PyObject *)Py_None));
  __Pyx_GIVEREF(((PyObject *)Py_None));

  /* "rbd.pyx":675
 *         return (major, minor, extra)
 * 
 *     def create(self, ioctx, name, size, order=None, old_format=True,             # <<<<<<<<<<<<<<
 *                features=None, stripe_unit=None, stripe_count=None,
 *                data_pool=None):
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_t_1));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(Py_None);
  PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None);
  __Pyx_GIVEREF(Py_None);
  __pyx_t_1 = 0;
  __pyx_r = ((PyObject *)__pyx_t_2);
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.RBD.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_3create(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_2create[] = "RBD.create(self, ioctx, name, size, order=None, old_format=True, features=None, stripe_unit=None, stripe_count=None, data_pool=None)\n\n        Create an rbd image.\n\n        :param ioctx: the context in which to create the image\n        :type ioctx: :class:`rados.Ioctx`\n        :param name: what the image is called\n        :type name: str\n        :param size: how big the image is in bytes\n        :type size: int\n        :param order: the image is split into (2**order) byte objects\n        :type order: int\n        :param old_format: whether to create an old-style image that\n                           is accessible by old clients, but can't\n                           use more advanced features like layering.\n        :type old_format: bool\n        :param features: bitmask of features to enable\n        :type features: int\n        :param stripe_unit: stripe unit in bytes (default None to let librbd decide)\n        :type stripe_unit: int\n        :param stripe_count: objects to stripe over before looping\n        :type stripe_count: int\n        :param data_pool: optional separate pool for data blocks\n        :type data_pool: str\n        :raises: :class:`ImageExists`\n        :raises: :class:`TypeError`\n        :raises: :class:`InvalidArgument`\n        :raises: :class:`FunctionNotSupported`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_3create = {__Pyx_NAMESTR("create"), (PyCFunction)__pyx_pw_3rbd_3RBD_3create, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_2create)};
static PyObject *__pyx_pw_3rbd_3RBD_3create(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_name = 0;
  PyObject *__pyx_v_size = 0;
  PyObject *__pyx_v_order = 0;
  PyObject *__pyx_v_old_format = 0;
  PyObject *__pyx_v_features = 0;
  PyObject *__pyx_v_stripe_unit = 0;
  PyObject *__pyx_v_stripe_count = 0;
  PyObject *__pyx_v_data_pool = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("create (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__name,&__pyx_n_s__size,&__pyx_n_s__order,&__pyx_n_s__old_format,&__pyx_n_s__features,&__pyx_n_s__stripe_unit,&__pyx_n_s__stripe_count,&__pyx_n_s__data_pool,0};
    PyObject* values[10] = {0,0,0,0,0,0,0,0,0,0};
    __pyx_defaults *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self);
    values[4] = ((PyObject *)((PyObject *)Py_None));
    values[5] = __pyx_dynamic_args->__pyx_arg_old_format;
    values[6] = ((PyObject *)((PyObject *)Py_None));
    values[7] = ((PyObject *)((PyObject *)Py_None));
    values[8] = ((PyObject *)((PyObject *)Py_None));
    values[9] = ((PyObject *)((PyObject *)Py_None));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("create", 0, 4, 10, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("create", 0, 4, 10, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__size)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("create", 0, 4, 10, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__order);
          if (value) { values[4] = value; kw_args--; }
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__old_format);
          if (value) { values[5] = value; kw_args--; }
        }
        case  6:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__features);
          if (value) { values[6] = value; kw_args--; }
        }
        case  7:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__stripe_unit);
          if (value) { values[7] = value; kw_args--; }
        }
        case  8:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__stripe_count);
          if (value) { values[8] = value; kw_args--; }
        }
        case  9:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__data_pool);
          if (value) { values[9] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "create") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_name = values[2];
    __pyx_v_size = values[3];
    __pyx_v_order = values[4];
    __pyx_v_old_format = values[5];
    __pyx_v_features = values[6];
    __pyx_v_stripe_unit = values[7];
    __pyx_v_stripe_count = values[8];
    __pyx_v_data_pool = values[9];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("create", 0, 4, 10, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.create", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_2create(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_name, __pyx_v_size, __pyx_v_order, __pyx_v_old_format, __pyx_v_features, __pyx_v_stripe_unit, __pyx_v_stripe_count, __pyx_v_data_pool);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_3rbd_3RBD_2create(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_name, PyObject *__pyx_v_size, PyObject *__pyx_v_order, PyObject *__pyx_v_old_format, PyObject *__pyx_v_features, PyObject *__pyx_v_stripe_unit, PyObject *__pyx_v_stripe_count, PyObject *__pyx_v_data_pool) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__name;
  uint64_t __pyx_v__size;
  int __pyx_v__order;
  rbd_image_options_t __pyx_v_opts;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  uint64_t __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  int __pyx_t_10;
  int __pyx_t_11;
  int __pyx_t_12;
  long __pyx_t_13;
  char const *__pyx_t_14;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("create", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":706
 *         :raises: :class:`FunctionNotSupported`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":708
 *         name = cstr(name, 'name')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_name = name
 *             uint64_t _size = size
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 708; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 708; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":709
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_name = name             # <<<<<<<<<<<<<<
 *             uint64_t _size = size
 *             int _order = 0
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 709; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_5;

  /* "rbd.pyx":710
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_name = name
 *             uint64_t _size = size             # <<<<<<<<<<<<<<
 *             int _order = 0
 *             rbd_image_options_t opts
 */
  __pyx_t_6 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_size); if (unlikely((__pyx_t_6 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 710; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__size = __pyx_t_6;

  /* "rbd.pyx":711
 *             char *_name = name
 *             uint64_t _size = size
 *             int _order = 0             # <<<<<<<<<<<<<<
 *             rbd_image_options_t opts
 *         if order is not None:
 */
  __pyx_v__order = 0;

  /* "rbd.pyx":713
 *             int _order = 0
 *             rbd_image_options_t opts
 *         if order is not None:             # <<<<<<<<<<<<<<
 *             _order = order
 *         if old_format:
 */
  __pyx_t_7 = (__pyx_v_order != Py_None);
  if (__pyx_t_7) {

    /* "rbd.pyx":714
 *             rbd_image_options_t opts
 *         if order is not None:
 *             _order = order             # <<<<<<<<<<<<<<
 *         if old_format:
 *             if (features or
 */
    __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_v_order); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v__order = __pyx_t_8;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":715
 *         if order is not None:
 *             _order = order
 *         if old_format:             # <<<<<<<<<<<<<<
 *             if (features or
 *                 ((stripe_unit is not None) and stripe_unit != 0) or
 */
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_old_format); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_7) {

    /* "rbd.pyx":716
 *             _order = order
 *         if old_format:
 *             if (features or             # <<<<<<<<<<<<<<
 *                 ((stripe_unit is not None) and stripe_unit != 0) or
 *                 ((stripe_count is not None) and stripe_count != 0) or
 */
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_features); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!__pyx_t_7) {

      /* "rbd.pyx":717
 *         if old_format:
 *             if (features or
 *                 ((stripe_unit is not None) and stripe_unit != 0) or             # <<<<<<<<<<<<<<
 *                 ((stripe_count is not None) and stripe_count != 0) or
 *                 data_pool):
 */
      __pyx_t_9 = (__pyx_v_stripe_unit != Py_None);
      if (__pyx_t_9) {
        __pyx_t_3 = PyObject_RichCompare(__pyx_v_stripe_unit, __pyx_int_0, Py_NE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_11 = __pyx_t_10;
      } else {
        __pyx_t_11 = __pyx_t_9;
      }
      if (!__pyx_t_11) {

        /* "rbd.pyx":718
 *             if (features or
 *                 ((stripe_unit is not None) and stripe_unit != 0) or
 *                 ((stripe_count is not None) and stripe_count != 0) or             # <<<<<<<<<<<<<<
 *                 data_pool):
 *                 raise InvalidArgument('format 1 images do not support feature '
 */
        __pyx_t_9 = (__pyx_v_stripe_count != Py_None);
        if (__pyx_t_9) {
          __pyx_t_3 = PyObject_RichCompare(__pyx_v_stripe_count, __pyx_int_0, Py_NE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_12 = __pyx_t_10;
        } else {
          __pyx_t_12 = __pyx_t_9;
        }
        if (!__pyx_t_12) {

          /* "rbd.pyx":719
 *                 ((stripe_unit is not None) and stripe_unit != 0) or
 *                 ((stripe_count is not None) and stripe_count != 0) or
 *                 data_pool):             # <<<<<<<<<<<<<<
 *                 raise InvalidArgument('format 1 images do not support feature '
 *                                       'masks, non-default striping, nor data '
 */
          __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_data_pool); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 719; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_t_10 = __pyx_t_9;
        } else {
          __pyx_t_10 = __pyx_t_12;
        }
        __pyx_t_12 = __pyx_t_10;
      } else {
        __pyx_t_12 = __pyx_t_11;
      }
      __pyx_t_11 = __pyx_t_12;
    } else {
      __pyx_t_11 = __pyx_t_7;
    }
    if (__pyx_t_11) {

      /* "rbd.pyx":720
 *                 ((stripe_count is not None) and stripe_count != 0) or
 *                 data_pool):
 *                 raise InvalidArgument('format 1 images do not support feature '             # <<<<<<<<<<<<<<
 *                                       'masks, non-default striping, nor data '
 *                                       'pool')
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__InvalidArgument); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_k_tuple_8), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "rbd.pyx":723
 *                                       'masks, non-default striping, nor data '
 *                                       'pool')
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_create(_ioctx, _name, _size, &_order)
 *         else:
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":724
 *                                       'pool')
 *             with nogil:
 *                 ret = rbd_create(_ioctx, _name, _size, &_order)             # <<<<<<<<<<<<<<
 *         else:
 *             rbd_image_options_create(&opts)
 */
          __pyx_v_ret = rbd_create(__pyx_v__ioctx, __pyx_v__name, __pyx_v__size, (&__pyx_v__order));
        }

        /* "rbd.pyx":723
 *                                       'masks, non-default striping, nor data '
 *                                       'pool')
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_create(_ioctx, _name, _size, &_order)
 *         else:
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }
    goto __pyx_L4;
  }
  /*else*/ {

    /* "rbd.pyx":726
 *                 ret = rbd_create(_ioctx, _name, _size, &_order)
 *         else:
 *             rbd_image_options_create(&opts)             # <<<<<<<<<<<<<<
 *             try:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FORMAT,
 */
    rbd_image_options_create((&__pyx_v_opts));

    /* "rbd.pyx":727
 *         else:
 *             rbd_image_options_create(&opts)
 *             try:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FORMAT,
 *                                              1 if old_format else 2)
 */
    /*try:*/ {

      /* "rbd.pyx":728
 *             rbd_image_options_create(&opts)
 *             try:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FORMAT,             # <<<<<<<<<<<<<<
 *                                              1 if old_format else 2)
 *                 if features is not None:
 */
      __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_9); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 728; __pyx_clineno = __LINE__; goto __pyx_L10;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 728; __pyx_clineno = __LINE__; goto __pyx_L10;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "rbd.pyx":729
 *             try:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FORMAT,
 *                                              1 if old_format else 2)             # <<<<<<<<<<<<<<
 *                 if features is not None:
 *                     rbd_image_options_set_uint64(opts,
 */
      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_v_old_format); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L10;}
      if (__pyx_t_11) {
        __pyx_t_13 = 1;
      } else {
        __pyx_t_13 = 2;
      }
      rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_8, __pyx_t_13);

      /* "rbd.pyx":730
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FORMAT,
 *                                              1 if old_format else 2)
 *                 if features is not None:             # <<<<<<<<<<<<<<
 *                     rbd_image_options_set_uint64(opts,
 *                                                  RBD_IMAGE_OPTION_FEATURES,
 */
      __pyx_t_11 = (__pyx_v_features != Py_None);
      if (__pyx_t_11) {

        /* "rbd.pyx":732
 *                 if features is not None:
 *                     rbd_image_options_set_uint64(opts,
 *                                                  RBD_IMAGE_OPTION_FEATURES,             # <<<<<<<<<<<<<<
 *                                                  features)
 *                 if order is not None:
 */
        __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_10); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 732; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 732; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "rbd.pyx":733
 *                     rbd_image_options_set_uint64(opts,
 *                                                  RBD_IMAGE_OPTION_FEATURES,
 *                                                  features)             # <<<<<<<<<<<<<<
 *                 if order is not None:
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 */
        __pyx_t_6 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_features); if (unlikely((__pyx_t_6 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L10;}
        rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_8, __pyx_t_6);
        goto __pyx_L12;
      }
      __pyx_L12:;

      /* "rbd.pyx":734
 *                                                  RBD_IMAGE_OPTION_FEATURES,
 *                                                  features)
 *                 if order is not None:             # <<<<<<<<<<<<<<
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 *                                                  _order)
 */
      __pyx_t_11 = (__pyx_v_order != Py_None);
      if (__pyx_t_11) {

        /* "rbd.pyx":735
 *                                                  features)
 *                 if order is not None:
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,             # <<<<<<<<<<<<<<
 *                                                  _order)
 *                 if stripe_unit is not None:
 */
        __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_11); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "rbd.pyx":736
 *                 if order is not None:
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 *                                                  _order)             # <<<<<<<<<<<<<<
 *                 if stripe_unit is not None:
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 */
        rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_8, __pyx_v__order);
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "rbd.pyx":737
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 *                                                  _order)
 *                 if stripe_unit is not None:             # <<<<<<<<<<<<<<
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 *                                                  stripe_unit)
 */
      __pyx_t_11 = (__pyx_v_stripe_unit != Py_None);
      if (__pyx_t_11) {

        /* "rbd.pyx":738
 *                                                  _order)
 *                 if stripe_unit is not None:
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,             # <<<<<<<<<<<<<<
 *                                                  stripe_unit)
 *                 if stripe_count is not None:
 */
        __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_12); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "rbd.pyx":739
 *                 if stripe_unit is not None:
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 *                                                  stripe_unit)             # <<<<<<<<<<<<<<
 *                 if stripe_count is not None:
 *                     rbd_image_options_set_uint64(opts,
 */
        __pyx_t_6 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_stripe_unit); if (unlikely((__pyx_t_6 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L10;}
        rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_8, __pyx_t_6);
        goto __pyx_L14;
      }
      __pyx_L14:;

      /* "rbd.pyx":740
 *                     rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 *                                                  stripe_unit)
 *                 if stripe_count is not None:             # <<<<<<<<<<<<<<
 *                     rbd_image_options_set_uint64(opts,
 *                                                  RBD_IMAGE_OPTION_STRIPE_COUNT,
 */
      __pyx_t_11 = (__pyx_v_stripe_count != Py_None);
      if (__pyx_t_11) {

        /* "rbd.pyx":742
 *                 if stripe_count is not None:
 *                     rbd_image_options_set_uint64(opts,
 *                                                  RBD_IMAGE_OPTION_STRIPE_COUNT,             # <<<<<<<<<<<<<<
 *                                                  stripe_count)
 *                 if data_pool is not None:
 */
        __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_13); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "rbd.pyx":743
 *                     rbd_image_options_set_uint64(opts,
 *                                                  RBD_IMAGE_OPTION_STRIPE_COUNT,
 *                                                  stripe_count)             # <<<<<<<<<<<<<<
 *                 if data_pool is not None:
 *                     rbd_image_options_set_string(opts,
 */
        __pyx_t_6 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_stripe_count); if (unlikely((__pyx_t_6 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L10;}
        rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_8, __pyx_t_6);
        goto __pyx_L15;
      }
      __pyx_L15:;

      /* "rbd.pyx":744
 *                                                  RBD_IMAGE_OPTION_STRIPE_COUNT,
 *                                                  stripe_count)
 *                 if data_pool is not None:             # <<<<<<<<<<<<<<
 *                     rbd_image_options_set_string(opts,
 *                                                  RBD_IMAGE_OPTION_DATA_POOL,
 */
      __pyx_t_11 = (__pyx_v_data_pool != Py_None);
      if (__pyx_t_11) {

        /* "rbd.pyx":746
 *                 if data_pool is not None:
 *                     rbd_image_options_set_string(opts,
 *                                                  RBD_IMAGE_OPTION_DATA_POOL,             # <<<<<<<<<<<<<<
 *                                                  data_pool)
 *                 with nogil:
 */
        __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_14); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L10;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "rbd.pyx":747
 *                     rbd_image_options_set_string(opts,
 *                                                  RBD_IMAGE_OPTION_DATA_POOL,
 *                                                  data_pool)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_create4(_ioctx, _name, _size, opts)
 */
        __pyx_t_14 = __Pyx_PyObject_AsString(__pyx_v_data_pool); if (unlikely((!__pyx_t_14) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 747; __pyx_clineno = __LINE__; goto __pyx_L10;}
        rbd_image_options_set_string(__pyx_v_opts, __pyx_t_8, __pyx_t_14);
        goto __pyx_L16;
      }
      __pyx_L16:;

      /* "rbd.pyx":748
 *                                                  RBD_IMAGE_OPTION_DATA_POOL,
 *                                                  data_pool)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_create4(_ioctx, _name, _size, opts)
 *             finally:
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":749
 *                                                  data_pool)
 *                 with nogil:
 *                     ret = rbd_create4(_ioctx, _name, _size, opts)             # <<<<<<<<<<<<<<
 *             finally:
 *                 rbd_image_options_destroy(opts)
 */
            __pyx_v_ret = rbd_create4(__pyx_v__ioctx, __pyx_v__name, __pyx_v__size, __pyx_v_opts);
          }

          /* "rbd.pyx":748
 *                                                  RBD_IMAGE_OPTION_DATA_POOL,
 *                                                  data_pool)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_create4(_ioctx, _name, _size, opts)
 *             finally:
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }
    }

    /* "rbd.pyx":751
 *                     ret = rbd_create4(_ioctx, _name, _size, opts)
 *             finally:
 *                 rbd_image_options_destroy(opts)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error creating image')
 */
    /*finally:*/ {
      int __pyx_why;
      PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
      int __pyx_exc_lineno;
      __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
      __pyx_why = 0; goto __pyx_L11;
      __pyx_L10: {
        __pyx_why = 4;
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
        __pyx_exc_lineno = __pyx_lineno;
        goto __pyx_L11;
      }
      __pyx_L11:;
      rbd_image_options_destroy(__pyx_v_opts);
      switch (__pyx_why) {
        case 4: {
          __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
          __pyx_lineno = __pyx_exc_lineno;
          __pyx_exc_type = 0;
          __pyx_exc_value = 0;
          __pyx_exc_tb = 0;
          goto __pyx_L1_error;
        }
      }
    }
  }
  __pyx_L4:;

  /* "rbd.pyx":752
 *             finally:
 *                 rbd_image_options_destroy(opts)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error creating image')
 * 
 */
  __pyx_t_11 = (__pyx_v_ret < 0);
  if (__pyx_t_11) {

    /* "rbd.pyx":753
 *                 rbd_image_options_destroy(opts)
 *         if ret < 0:
 *             raise make_ex(ret, 'error creating image')             # <<<<<<<<<<<<<<
 * 
 *     def clone(self, p_ioctx, p_name, p_snapname, c_ioctx, c_name,
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_kp_s_15)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L21;
  }
  __pyx_L21:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.create", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_5clone(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_4clone[] = "RBD.clone(self, p_ioctx, p_name, p_snapname, c_ioctx, c_name, features=None, order=None, stripe_unit=None, stripe_count=None, data_pool=None)\n\n        Clone a parent rbd snapshot into a COW sparse child.\n\n        :param p_ioctx: the parent context that represents the parent snap\n        :type ioctx: :class:`rados.Ioctx`\n        :param p_name: the parent image name\n        :type name: str\n        :param p_snapname: the parent image snapshot name\n        :type name: str\n        :param c_ioctx: the child context that represents the new clone\n        :type ioctx: :class:`rados.Ioctx`\n        :param c_name: the clone (child) name\n        :type name: str\n        :param features: bitmask of features to enable; if set, must include layering\n        :type features: int\n        :param order: the image is split into (2**order) byte objects\n        :type order: int\n        :param stripe_unit: stripe unit in bytes (default None to let librbd decide)\n        :type stripe_unit: int\n        :param stripe_count: objects to stripe over before looping\n        :type stripe_count: int\n        :param data_pool: optional separate pool for data blocks\n        :type data_pool: str\n        :raises: :class:`TypeError`\n        :raises: :class:`InvalidArgument`\n        :raises: :class:`ImageExists`\n        :raises: :class:`FunctionNotSupported`\n        :raises: :class:`ArgumentOutOfRange`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_5clone = {__Pyx_NAMESTR("clone"), (PyCFunction)__pyx_pw_3rbd_3RBD_5clone, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_4clone)};
static PyObject *__pyx_pw_3rbd_3RBD_5clone(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_p_ioctx = 0;
  PyObject *__pyx_v_p_name = 0;
  PyObject *__pyx_v_p_snapname = 0;
  PyObject *__pyx_v_c_ioctx = 0;
  PyObject *__pyx_v_c_name = 0;
  PyObject *__pyx_v_features = 0;
  PyObject *__pyx_v_order = 0;
  PyObject *__pyx_v_stripe_unit = 0;
  PyObject *__pyx_v_stripe_count = 0;
  PyObject *__pyx_v_data_pool = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("clone (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__p_ioctx,&__pyx_n_s__p_name,&__pyx_n_s__p_snapname,&__pyx_n_s__c_ioctx,&__pyx_n_s__c_name,&__pyx_n_s__features,&__pyx_n_s__order,&__pyx_n_s__stripe_unit,&__pyx_n_s__stripe_count,&__pyx_n_s__data_pool,0};
    PyObject* values[11] = {0,0,0,0,0,0,0,0,0,0,0};

    /* "rbd.pyx":756
 * 
 *     def clone(self, p_ioctx, p_name, p_snapname, c_ioctx, c_name,
 *               features=None, order=None, stripe_unit=None, stripe_count=None,             # <<<<<<<<<<<<<<
 *               data_pool=None):
 *         """
 */
    values[6] = ((PyObject *)((PyObject *)Py_None));
    values[7] = ((PyObject *)((PyObject *)Py_None));
    values[8] = ((PyObject *)((PyObject *)Py_None));
    values[9] = ((PyObject *)((PyObject *)Py_None));

    /* "rbd.pyx":757
 *     def clone(self, p_ioctx, p_name, p_snapname, c_ioctx, c_name,
 *               features=None, order=None, stripe_unit=None, stripe_count=None,
 *               data_pool=None):             # <<<<<<<<<<<<<<
 *         """
 *         Clone a parent rbd snapshot into a COW sparse child.
 */
    values[10] = ((PyObject *)((PyObject *)Py_None));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__p_ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("clone", 0, 6, 11, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__p_name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("clone", 0, 6, 11, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__p_snapname)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("clone", 0, 6, 11, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  4:
        if (likely((values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__c_ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("clone", 0, 6, 11, 4); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  5:
        if (likely((values[5] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__c_name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("clone", 0, 6, 11, 5); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  6:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__features);
          if (value) { values[6] = value; kw_args--; }
        }
        case  7:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__order);
          if (value) { values[7] = value; kw_args--; }
        }
        case  8:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__stripe_unit);
          if (value) { values[8] = value; kw_args--; }
        }
        case  9:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__stripe_count);
          if (value) { values[9] = value; kw_args--; }
        }
        case 10:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__data_pool);
          if (value) { values[10] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "clone") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_self = values[0];
    __pyx_v_p_ioctx = values[1];
    __pyx_v_p_name = values[2];
    __pyx_v_p_snapname = values[3];
    __pyx_v_c_ioctx = values[4];
    __pyx_v_c_name = values[5];
    __pyx_v_features = values[6];
    __pyx_v_order = values[7];
    __pyx_v_stripe_unit = values[8];
    __pyx_v_stripe_count = values[9];
    __pyx_v_data_pool = values[10];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("clone", 0, 6, 11, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.clone", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_4clone(__pyx_self, __pyx_v_self, __pyx_v_p_ioctx, __pyx_v_p_name, __pyx_v_p_snapname, __pyx_v_c_ioctx, __pyx_v_c_name, __pyx_v_features, __pyx_v_order, __pyx_v_stripe_unit, __pyx_v_stripe_count, __pyx_v_data_pool);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":755
 *             raise make_ex(ret, 'error creating image')
 * 
 *     def clone(self, p_ioctx, p_name, p_snapname, c_ioctx, c_name,             # <<<<<<<<<<<<<<
 *               features=None, order=None, stripe_unit=None, stripe_count=None,
 *               data_pool=None):
 */

static PyObject *__pyx_pf_3rbd_3RBD_4clone(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_p_ioctx, PyObject *__pyx_v_p_name, PyObject *__pyx_v_p_snapname, PyObject *__pyx_v_c_ioctx, PyObject *__pyx_v_c_name, PyObject *__pyx_v_features, PyObject *__pyx_v_order, PyObject *__pyx_v_stripe_unit, PyObject *__pyx_v_stripe_count, PyObject *__pyx_v_data_pool) {
  rados_ioctx_t __pyx_v__p_ioctx;
  rados_ioctx_t __pyx_v__c_ioctx;
  char *__pyx_v__p_name;
  char *__pyx_v__p_snapname;
  char *__pyx_v__c_name;
  rbd_image_options_t __pyx_v_opts;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  uint64_t __pyx_t_8;
  char const *__pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("clone", 0);
  __Pyx_INCREF(__pyx_v_p_name);
  __Pyx_INCREF(__pyx_v_p_snapname);
  __Pyx_INCREF(__pyx_v_c_name);

  /* "rbd.pyx":787
 *         :raises: :class:`ArgumentOutOfRange`
 *         """
 *         p_snapname = cstr(p_snapname, 'p_snapname')             # <<<<<<<<<<<<<<
 *         p_name = cstr(p_name, 'p_name')
 *         c_name = cstr(c_name, 'c_name')
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_p_snapname);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_p_snapname);
  __Pyx_GIVEREF(__pyx_v_p_snapname);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__p_snapname));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__p_snapname));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__p_snapname));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_p_snapname);
  __pyx_v_p_snapname = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":788
 *         """
 *         p_snapname = cstr(p_snapname, 'p_snapname')
 *         p_name = cstr(p_name, 'p_name')             # <<<<<<<<<<<<<<
 *         c_name = cstr(c_name, 'c_name')
 *         cdef:
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_p_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_p_name);
  __Pyx_GIVEREF(__pyx_v_p_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__p_name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__p_name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__p_name));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_p_name);
  __pyx_v_p_name = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":789
 *         p_snapname = cstr(p_snapname, 'p_snapname')
 *         p_name = cstr(p_name, 'p_name')
 *         c_name = cstr(c_name, 'c_name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _p_ioctx = convert_ioctx(p_ioctx)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_c_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_c_name);
  __Pyx_GIVEREF(__pyx_v_c_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__c_name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__c_name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__c_name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_c_name);
  __pyx_v_c_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":791
 *         c_name = cstr(c_name, 'c_name')
 *         cdef:
 *             rados_ioctx_t _p_ioctx = convert_ioctx(p_ioctx)             # <<<<<<<<<<<<<<
 *             rados_ioctx_t _c_ioctx = convert_ioctx(c_ioctx)
 *             char *_p_name = p_name
 */
  if (!(likely(((__pyx_v_p_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_p_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_p_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__p_ioctx = __pyx_t_4;

  /* "rbd.pyx":792
 *         cdef:
 *             rados_ioctx_t _p_ioctx = convert_ioctx(p_ioctx)
 *             rados_ioctx_t _c_ioctx = convert_ioctx(c_ioctx)             # <<<<<<<<<<<<<<
 *             char *_p_name = p_name
 *             char *_p_snapname = p_snapname
 */
  if (!(likely(((__pyx_v_c_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_c_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_c_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 792; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__c_ioctx = __pyx_t_4;

  /* "rbd.pyx":793
 *             rados_ioctx_t _p_ioctx = convert_ioctx(p_ioctx)
 *             rados_ioctx_t _c_ioctx = convert_ioctx(c_ioctx)
 *             char *_p_name = p_name             # <<<<<<<<<<<<<<
 *             char *_p_snapname = p_snapname
 *             char *_c_name = c_name
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_p_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 793; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__p_name = __pyx_t_5;

  /* "rbd.pyx":794
 *             rados_ioctx_t _c_ioctx = convert_ioctx(c_ioctx)
 *             char *_p_name = p_name
 *             char *_p_snapname = p_snapname             # <<<<<<<<<<<<<<
 *             char *_c_name = c_name
 *             rbd_image_options_t opts
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_p_snapname); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 794; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__p_snapname = __pyx_t_5;

  /* "rbd.pyx":795
 *             char *_p_name = p_name
 *             char *_p_snapname = p_snapname
 *             char *_c_name = c_name             # <<<<<<<<<<<<<<
 *             rbd_image_options_t opts
 * 
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_c_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 795; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__c_name = __pyx_t_5;

  /* "rbd.pyx":798
 *             rbd_image_options_t opts
 * 
 *         rbd_image_options_create(&opts)             # <<<<<<<<<<<<<<
 *         try:
 *             if features is not None:
 */
  rbd_image_options_create((&__pyx_v_opts));

  /* "rbd.pyx":799
 * 
 *         rbd_image_options_create(&opts)
 *         try:             # <<<<<<<<<<<<<<
 *             if features is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,
 */
  /*try:*/ {

    /* "rbd.pyx":800
 *         rbd_image_options_create(&opts)
 *         try:
 *             if features is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,
 *                                              features)
 */
    __pyx_t_6 = (__pyx_v_features != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":801
 *         try:
 *             if features is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,             # <<<<<<<<<<<<<<
 *                                              features)
 *             if order is not None:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_10); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 801; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 801; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":802
 *             if features is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,
 *                                              features)             # <<<<<<<<<<<<<<
 *             if order is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 */
      __pyx_t_8 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_features); if (unlikely((__pyx_t_8 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 802; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_7, __pyx_t_8);
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "rbd.pyx":803
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,
 *                                              features)
 *             if order is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 *                                              order)
 */
    __pyx_t_6 = (__pyx_v_order != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":804
 *                                              features)
 *             if order is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,             # <<<<<<<<<<<<<<
 *                                              order)
 *             if stripe_unit is not None:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_11); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":805
 *             if order is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 *                                              order)             # <<<<<<<<<<<<<<
 *             if stripe_unit is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 */
      __pyx_t_8 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_order); if (unlikely((__pyx_t_8 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 805; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_7, __pyx_t_8);
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "rbd.pyx":806
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 *                                              order)
 *             if stripe_unit is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 *                                              stripe_unit)
 */
    __pyx_t_6 = (__pyx_v_stripe_unit != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":807
 *                                              order)
 *             if stripe_unit is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,             # <<<<<<<<<<<<<<
 *                                              stripe_unit)
 *             if stripe_count is not None:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_12); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":808
 *             if stripe_unit is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 *                                              stripe_unit)             # <<<<<<<<<<<<<<
 *             if stripe_count is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,
 */
      __pyx_t_8 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_stripe_unit); if (unlikely((__pyx_t_8 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 808; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_7, __pyx_t_8);
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "rbd.pyx":809
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 *                                              stripe_unit)
 *             if stripe_count is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,
 *                                              stripe_count)
 */
    __pyx_t_6 = (__pyx_v_stripe_count != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":810
 *                                              stripe_unit)
 *             if stripe_count is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,             # <<<<<<<<<<<<<<
 *                                              stripe_count)
 *             if data_pool is not None:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_13); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 810; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 810; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":811
 *             if stripe_count is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,
 *                                              stripe_count)             # <<<<<<<<<<<<<<
 *             if data_pool is not None:
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 */
      __pyx_t_8 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_stripe_count); if (unlikely((__pyx_t_8 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_7, __pyx_t_8);
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "rbd.pyx":812
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,
 *                                              stripe_count)
 *             if data_pool is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 *                                              data_pool)
 */
    __pyx_t_6 = (__pyx_v_data_pool != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":813
 *                                              stripe_count)
 *             if data_pool is not None:
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,             # <<<<<<<<<<<<<<
 *                                              data_pool)
 *             with nogil:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_14); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 813; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 813; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":814
 *             if data_pool is not None:
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 *                                              data_pool)             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_clone3(_p_ioctx, _p_name, _p_snapname,
 */
      __pyx_t_9 = __Pyx_PyObject_AsString(__pyx_v_data_pool); if (unlikely((!__pyx_t_9) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_string(__pyx_v_opts, __pyx_t_7, __pyx_t_9);
      goto __pyx_L10;
    }
    __pyx_L10:;

    /* "rbd.pyx":815
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 *                                              data_pool)
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_clone3(_p_ioctx, _p_name, _p_snapname,
 *                                  _c_ioctx, _c_name, opts)
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":817
 *             with nogil:
 *                 ret = rbd_clone3(_p_ioctx, _p_name, _p_snapname,
 *                                  _c_ioctx, _c_name, opts)             # <<<<<<<<<<<<<<
 *         finally:
 *             rbd_image_options_destroy(opts)
 */
          __pyx_v_ret = rbd_clone3(__pyx_v__p_ioctx, __pyx_v__p_name, __pyx_v__p_snapname, __pyx_v__c_ioctx, __pyx_v__c_name, __pyx_v_opts);
        }

        /* "rbd.pyx":815
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 *                                              data_pool)
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_clone3(_p_ioctx, _p_name, _p_snapname,
 *                                  _c_ioctx, _c_name, opts)
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }
  }

  /* "rbd.pyx":819
 *                                  _c_ioctx, _c_name, opts)
 *         finally:
 *             rbd_image_options_destroy(opts)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error creating clone')
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    rbd_image_options_destroy(__pyx_v_opts);
    switch (__pyx_why) {
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  /* "rbd.pyx":820
 *         finally:
 *             rbd_image_options_destroy(opts)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error creating clone')
 * 
 */
  __pyx_t_6 = (__pyx_v_ret < 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":821
 *             rbd_image_options_destroy(opts)
 *         if ret < 0:
 *             raise make_ex(ret, 'error creating clone')             # <<<<<<<<<<<<<<
 * 
 *     def list(self, ioctx):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_16)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L15;
  }
  __pyx_L15:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.clone", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_p_name);
  __Pyx_XDECREF(__pyx_v_p_snapname);
  __Pyx_XDECREF(__pyx_v_c_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_7list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_6list[] = "RBD.list(self, ioctx)\n\n        List image names.\n\n        :param ioctx: determines which RADOS pool is read\n        :type ioctx: :class:`rados.Ioctx`\n        :returns: list -- a list of image names\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_7list = {__Pyx_NAMESTR("list"), (PyCFunction)__pyx_pw_3rbd_3RBD_7list, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_6list)};
static PyObject *__pyx_pw_3rbd_3RBD_7list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("list (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("list", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "list") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("list", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_6list(__pyx_self, __pyx_v_self, __pyx_v_ioctx);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":823
 *             raise make_ex(ret, 'error creating clone')
 * 
 *     def list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         List image names.
 */

static PyObject *__pyx_pf_3rbd_3RBD_6list(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx) {
  rados_ioctx_t __pyx_v__ioctx;
  size_t __pyx_v_size;
  char *__pyx_v_c_names;
  int __pyx_v_ret;
  PyObject *__pyx_v_name = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  rados_ioctx_t __pyx_t_1;
  void *__pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("list", 0);

  /* "rbd.pyx":832
 *         """
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             size_t size = 512
 *             char *c_names = NULL
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_1 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_1;

  /* "rbd.pyx":833
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             size_t size = 512             # <<<<<<<<<<<<<<
 *             char *c_names = NULL
 *         try:
 */
  __pyx_v_size = 512;

  /* "rbd.pyx":834
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             size_t size = 512
 *             char *c_names = NULL             # <<<<<<<<<<<<<<
 *         try:
 *             while True:
 */
  __pyx_v_c_names = NULL;

  /* "rbd.pyx":835
 *             size_t size = 512
 *             char *c_names = NULL
 *         try:             # <<<<<<<<<<<<<<
 *             while True:
 *                 c_names = <char *>realloc_chk(c_names, size)
 */
  /*try:*/ {

    /* "rbd.pyx":836
 *             char *c_names = NULL
 *         try:
 *             while True:             # <<<<<<<<<<<<<<
 *                 c_names = <char *>realloc_chk(c_names, size)
 *                 with nogil:
 */
    while (1) {
      if (!1) break;

      /* "rbd.pyx":837
 *         try:
 *             while True:
 *                 c_names = <char *>realloc_chk(c_names, size)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_list(_ioctx, c_names, &size)
 */
      __pyx_t_2 = __pyx_f_3rbd_realloc_chk(__pyx_v_c_names, __pyx_v_size); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 837; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_c_names = ((char *)__pyx_t_2);

      /* "rbd.pyx":838
 *             while True:
 *                 c_names = <char *>realloc_chk(c_names, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_list(_ioctx, c_names, &size)
 *                 if ret >= 0:
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":839
 *                 c_names = <char *>realloc_chk(c_names, size)
 *                 with nogil:
 *                     ret = rbd_list(_ioctx, c_names, &size)             # <<<<<<<<<<<<<<
 *                 if ret >= 0:
 *                     break
 */
            __pyx_v_ret = rbd_list(__pyx_v__ioctx, __pyx_v_c_names, (&__pyx_v_size));
          }

          /* "rbd.pyx":838
 *             while True:
 *                 c_names = <char *>realloc_chk(c_names, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_list(_ioctx, c_names, &size)
 *                 if ret >= 0:
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":840
 *                 with nogil:
 *                     ret = rbd_list(_ioctx, c_names, &size)
 *                 if ret >= 0:             # <<<<<<<<<<<<<<
 *                     break
 *                 elif ret != -errno.ERANGE:
 */
      __pyx_t_3 = (__pyx_v_ret >= 0);
      if (__pyx_t_3) {

        /* "rbd.pyx":841
 *                     ret = rbd_list(_ioctx, c_names, &size)
 *                 if ret >= 0:
 *                     break             # <<<<<<<<<<<<<<
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')
 */
        goto __pyx_L7_break;
        goto __pyx_L13;
      }

      /* "rbd.pyx":842
 *                 if ret >= 0:
 *                     break
 *                 elif ret != -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     raise make_ex(ret, 'error listing images')
 *             return [decode_cstr(name) for name in c_names[:ret].split(b'\0')
 */
      __pyx_t_3 = (__pyx_v_ret != (-ERANGE));
      if (__pyx_t_3) {

        /* "rbd.pyx":843
 *                     break
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')             # <<<<<<<<<<<<<<
 *             return [decode_cstr(name) for name in c_names[:ret].split(b'\0')
 *                     if name]
 */
        __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 843; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __pyx_f_3rbd_make_ex(__pyx_t_4, ((PyObject *)__pyx_kp_s_17)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 843; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 843; __pyx_clineno = __LINE__; goto __pyx_L4;}
        goto __pyx_L13;
      }
      __pyx_L13:;
    }
    __pyx_L7_break:;

    /* "rbd.pyx":844
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')
 *             return [decode_cstr(name) for name in c_names[:ret].split(b'\0')             # <<<<<<<<<<<<<<
 *                     if name]
 *         finally:
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_c_names + 0, __pyx_v_ret - 0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_t_4), __pyx_n_s__split); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_k_tuple_19), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (PyList_CheckExact(__pyx_t_4) || PyTuple_CheckExact(__pyx_t_4)) {
      __pyx_t_6 = __pyx_t_4; __Pyx_INCREF(__pyx_t_6); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_8 = Py_TYPE(__pyx_t_6)->tp_iternext;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    for (;;) {
      if (!__pyx_t_8 && PyList_CheckExact(__pyx_t_6)) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_6)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #endif
      } else if (!__pyx_t_8 && PyTuple_CheckExact(__pyx_t_6)) {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #endif
      } else {
        __pyx_t_4 = __pyx_t_8(__pyx_t_6);
        if (unlikely(!__pyx_t_4)) {
          if (PyErr_Occurred()) {
            if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      __Pyx_XDECREF(__pyx_v_name);
      __pyx_v_name = __pyx_t_4;
      __pyx_t_4 = 0;

      /* "rbd.pyx":845
 *                     raise make_ex(ret, 'error listing images')
 *             return [decode_cstr(name) for name in c_names[:ret].split(b'\0')
 *                     if name]             # <<<<<<<<<<<<<<
 *         finally:
 *             free(c_names)
 */
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_name); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 845; __pyx_clineno = __LINE__; goto __pyx_L4;}
      if (__pyx_t_3) {

        /* "rbd.pyx":844
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')
 *             return [decode_cstr(name) for name in c_names[:ret].split(b'\0')             # <<<<<<<<<<<<<<
 *                     if name]
 *         finally:
 */
        __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_INCREF(__pyx_v_name);
        PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_name);
        __Pyx_GIVEREF(__pyx_v_name);
        __pyx_t_10 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_5, (PyObject*)__pyx_t_10))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        goto __pyx_L16;
      }
      __pyx_L16:;
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_r = ((PyObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":847
 *                     if name]
 *         finally:
 *             free(c_names)             # <<<<<<<<<<<<<<
 * 
 *     def remove(self, ioctx, name):
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_c_names);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("rbd.RBD.list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_9remove(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_8remove[] = "RBD.remove(self, ioctx, name)\n\n        Delete an RBD image. This may take a long time, since it does\n        not return until every object that comprises the image has\n        been deleted. Note that all snapshots must be deleted before\n        the image can be removed. If there are snapshots left,\n        :class:`ImageHasSnapshots` is raised. If the image is still\n        open, or the watch from a crashed client has not expired,\n        :class:`ImageBusy` is raised.\n\n        :param ioctx: determines which RADOS pool the image is in\n        :type ioctx: :class:`rados.Ioctx`\n        :param name: the name of the image to remove\n        :type name: str\n        :raises: :class:`ImageNotFound`, :class:`ImageBusy`,\n                 :class:`ImageHasSnapshots`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_9remove = {__Pyx_NAMESTR("remove"), (PyCFunction)__pyx_pw_3rbd_3RBD_9remove, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_8remove)};
static PyObject *__pyx_pw_3rbd_3RBD_9remove(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("remove (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__name,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("remove", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 849; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("remove", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 849; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "remove") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 849; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_name = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("remove", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 849; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.remove", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_8remove(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_name);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":849
 *             free(c_names)
 * 
 *     def remove(self, ioctx, name):             # <<<<<<<<<<<<<<
 *         """
 *         Delete an RBD image. This may take a long time, since it does
 */

static PyObject *__pyx_pf_3rbd_3RBD_8remove(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_name) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("remove", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":866
 *                  :class:`ImageHasSnapshots`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 866; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 866; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 866; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":868
 *         name = cstr(name, 'name')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_name = name
 *         with nogil:
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 868; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 868; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":869
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_name = name             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_remove(_ioctx, _name)
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 869; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_5;

  /* "rbd.pyx":870
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_remove(_ioctx, _name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":871
 *             char *_name = name
 *         with nogil:
 *             ret = rbd_remove(_ioctx, _name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing image')
 */
        __pyx_v_ret = rbd_remove(__pyx_v__ioctx, __pyx_v__name);
      }

      /* "rbd.pyx":870
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_remove(_ioctx, _name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":872
 *         with nogil:
 *             ret = rbd_remove(_ioctx, _name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error removing image')
 * 
 */
  __pyx_t_6 = (__pyx_v_ret != 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":873
 *             ret = rbd_remove(_ioctx, _name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing image')             # <<<<<<<<<<<<<<
 * 
 *     def rename(self, ioctx, src, dest):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_20)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.remove", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_11rename(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_10rename[] = "RBD.rename(self, ioctx, src, dest)\n\n        Rename an RBD image.\n\n        :param ioctx: determines which RADOS pool the image is in\n        :type ioctx: :class:`rados.Ioctx`\n        :param src: the current name of the image\n        :type src: str\n        :param dest: the new name of the image\n        :type dest: str\n        :raises: :class:`ImageNotFound`, :class:`ImageExists`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_11rename = {__Pyx_NAMESTR("rename"), (PyCFunction)__pyx_pw_3rbd_3RBD_11rename, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_10rename)};
static PyObject *__pyx_pw_3rbd_3RBD_11rename(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_src = 0;
  PyObject *__pyx_v_dest = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("rename (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__src,&__pyx_n_s__dest,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("rename", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__src)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("rename", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__dest)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("rename", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "rename") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_src = values[2];
    __pyx_v_dest = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("rename", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.rename", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_10rename(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_src, __pyx_v_dest);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":875
 *             raise make_ex(ret, 'error removing image')
 * 
 *     def rename(self, ioctx, src, dest):             # <<<<<<<<<<<<<<
 *         """
 *         Rename an RBD image.
 */

static PyObject *__pyx_pf_3rbd_3RBD_10rename(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_src, PyObject *__pyx_v_dest) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__src;
  char *__pyx_v__dest;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("rename", 0);
  __Pyx_INCREF(__pyx_v_src);
  __Pyx_INCREF(__pyx_v_dest);

  /* "rbd.pyx":887
 *         :raises: :class:`ImageNotFound`, :class:`ImageExists`
 *         """
 *         src = cstr(src, 'src')             # <<<<<<<<<<<<<<
 *         dest = cstr(dest, 'dest')
 *         cdef:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 887; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 887; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_src);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_src);
  __Pyx_GIVEREF(__pyx_v_src);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__src));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__src));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__src));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 887; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_src);
  __pyx_v_src = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":888
 *         """
 *         src = cstr(src, 'src')
 *         dest = cstr(dest, 'dest')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 888; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 888; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_dest);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_dest);
  __Pyx_GIVEREF(__pyx_v_dest);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__dest));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__dest));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__dest));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 888; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_dest);
  __pyx_v_dest = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":890
 *         dest = cstr(dest, 'dest')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_src = src
 *             char *_dest = dest
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 890; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 890; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":891
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_src = src             # <<<<<<<<<<<<<<
 *             char *_dest = dest
 *         with nogil:
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_src); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__src = __pyx_t_5;

  /* "rbd.pyx":892
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_src = src
 *             char *_dest = dest             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_rename(_ioctx, _src, _dest)
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_dest); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 892; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__dest = __pyx_t_5;

  /* "rbd.pyx":893
 *             char *_src = src
 *             char *_dest = dest
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_rename(_ioctx, _src, _dest)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":894
 *             char *_dest = dest
 *         with nogil:
 *             ret = rbd_rename(_ioctx, _src, _dest)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error renaming image')
 */
        __pyx_v_ret = rbd_rename(__pyx_v__ioctx, __pyx_v__src, __pyx_v__dest);
      }

      /* "rbd.pyx":893
 *             char *_src = src
 *             char *_dest = dest
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_rename(_ioctx, _src, _dest)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":895
 *         with nogil:
 *             ret = rbd_rename(_ioctx, _src, _dest)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error renaming image')
 * 
 */
  __pyx_t_6 = (__pyx_v_ret != 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":896
 *             ret = rbd_rename(_ioctx, _src, _dest)
 *         if ret != 0:
 *             raise make_ex(ret, 'error renaming image')             # <<<<<<<<<<<<<<
 * 
 *     def trash_move(self, ioctx, name, delay=0):
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_1, ((PyObject *)__pyx_kp_s_21)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.rename", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_src);
  __Pyx_XDECREF(__pyx_v_dest);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_13trash_move(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_12trash_move[] = "RBD.trash_move(self, ioctx, name, delay=0)\n\n        Move an RBD image to the trash.\n        :param ioctx: determines which RADOS pool the image is in\n        :type ioctx: :class:`rados.Ioctx`\n        :param name: the name of the image to remove\n        :type name: str\n        :param delay: time delay in seconds before the image can be deleted\n                      from trash\n        :type delay: int\n        :raises: :class:`ImageNotFound`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_13trash_move = {__Pyx_NAMESTR("trash_move"), (PyCFunction)__pyx_pw_3rbd_3RBD_13trash_move, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_12trash_move)};
static PyObject *__pyx_pw_3rbd_3RBD_13trash_move(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_name = 0;
  PyObject *__pyx_v_delay = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("trash_move (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__name,&__pyx_n_s__delay,0};
    PyObject* values[4] = {0,0,0,0};
    values[3] = ((PyObject *)((PyObject *)__pyx_int_0));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_move", 0, 3, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 898; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_move", 0, 3, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 898; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__delay);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "trash_move") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 898; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_name = values[2];
    __pyx_v_delay = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("trash_move", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 898; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.trash_move", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_12trash_move(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_name, __pyx_v_delay);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":898
 *             raise make_ex(ret, 'error renaming image')
 * 
 *     def trash_move(self, ioctx, name, delay=0):             # <<<<<<<<<<<<<<
 *         """
 *         Move an RBD image to the trash.
 */

static PyObject *__pyx_pf_3rbd_3RBD_12trash_move(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_name, PyObject *__pyx_v_delay) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__name;
  uint64_t __pyx_v__delay;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  uint64_t __pyx_t_6;
  int __pyx_t_7;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("trash_move", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":910
 *         :raises: :class:`ImageNotFound`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":912
 *         name = cstr(name, 'name')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_name = name
 *             uint64_t _delay = delay
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":913
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_name = name             # <<<<<<<<<<<<<<
 *             uint64_t _delay = delay
 *         with nogil:
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 913; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_5;

  /* "rbd.pyx":914
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_name = name
 *             uint64_t _delay = delay             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_trash_move(_ioctx, _name, _delay)
 */
  __pyx_t_6 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_delay); if (unlikely((__pyx_t_6 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 914; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__delay = __pyx_t_6;

  /* "rbd.pyx":915
 *             char *_name = name
 *             uint64_t _delay = delay
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_trash_move(_ioctx, _name, _delay)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":916
 *             uint64_t _delay = delay
 *         with nogil:
 *             ret = rbd_trash_move(_ioctx, _name, _delay)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error moving image to trash')
 */
        __pyx_v_ret = rbd_trash_move(__pyx_v__ioctx, __pyx_v__name, __pyx_v__delay);
      }

      /* "rbd.pyx":915
 *             char *_name = name
 *             uint64_t _delay = delay
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_trash_move(_ioctx, _name, _delay)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":917
 *         with nogil:
 *             ret = rbd_trash_move(_ioctx, _name, _delay)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error moving image to trash')
 * 
 */
  __pyx_t_7 = (__pyx_v_ret != 0);
  if (__pyx_t_7) {

    /* "rbd.pyx":918
 *             ret = rbd_trash_move(_ioctx, _name, _delay)
 *         if ret != 0:
 *             raise make_ex(ret, 'error moving image to trash')             # <<<<<<<<<<<<<<
 * 
 *     def trash_remove(self, ioctx, image_id, force=False):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 918; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_22)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 918; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 918; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.trash_move", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":920
 *             raise make_ex(ret, 'error moving image to trash')
 * 
 *     def trash_remove(self, ioctx, image_id, force=False):             # <<<<<<<<<<<<<<
 *         """
 *         Delete an RBD image from trash. If image deferment time has not
 */

static PyObject *__pyx_pf_3rbd_3RBD_42__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__defaults__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_force);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_force);
  __Pyx_GIVEREF(__Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_force);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_t_1));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(Py_None);
  PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None);
  __Pyx_GIVEREF(Py_None);
  __pyx_t_1 = 0;
  __pyx_r = ((PyObject *)__pyx_t_2);
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.RBD.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_15trash_remove(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_14trash_remove[] = "RBD.trash_remove(self, ioctx, image_id, force=False)\n\n        Delete an RBD image from trash. If image deferment time has not\n        expired :class:`PermissionError` is raised.\n        :param ioctx: determines which RADOS pool the image is in\n        :type ioctx: :class:`rados.Ioctx`\n        :param image_id: the id of the image to remove\n        :type image_id: str\n        :param force: force remove even if deferment time has not expired\n        :type force: bool\n        :raises: :class:`ImageNotFound`, :class:`PermissionError`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_15trash_remove = {__Pyx_NAMESTR("trash_remove"), (PyCFunction)__pyx_pw_3rbd_3RBD_15trash_remove, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_14trash_remove)};
static PyObject *__pyx_pw_3rbd_3RBD_15trash_remove(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_image_id = 0;
  PyObject *__pyx_v_force = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("trash_remove (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__image_id,&__pyx_n_s__force,0};
    PyObject* values[4] = {0,0,0,0};
    __pyx_defaults1 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self);
    values[3] = __pyx_dynamic_args->__pyx_arg_force;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_remove", 0, 3, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__image_id)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_remove", 0, 3, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__force);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "trash_remove") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_image_id = values[2];
    __pyx_v_force = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("trash_remove", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.trash_remove", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_14trash_remove(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_image_id, __pyx_v_force);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_3rbd_3RBD_14trash_remove(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_image_id, PyObject *__pyx_v_force) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__image_id;
  int __pyx_v__force;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("trash_remove", 0);
  __Pyx_INCREF(__pyx_v_image_id);

  /* "rbd.pyx":932
 *         :raises: :class:`ImageNotFound`, :class:`PermissionError`
 *         """
 *         image_id = cstr(image_id, 'image_id')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 932; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 932; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_image_id);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_image_id);
  __Pyx_GIVEREF(__pyx_v_image_id);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__image_id));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__image_id));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__image_id));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 932; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_image_id);
  __pyx_v_image_id = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":934
 *         image_id = cstr(image_id, 'image_id')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_image_id = image_id
 *             int _force = force
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":935
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_image_id = image_id             # <<<<<<<<<<<<<<
 *             int _force = force
 *         with nogil:
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_image_id); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 935; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__image_id = __pyx_t_5;

  /* "rbd.pyx":936
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_image_id = image_id
 *             int _force = force             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_trash_remove(_ioctx, _image_id, _force)
 */
  __pyx_t_6 = __Pyx_PyInt_AsInt(__pyx_v_force); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__force = __pyx_t_6;

  /* "rbd.pyx":937
 *             char *_image_id = image_id
 *             int _force = force
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_trash_remove(_ioctx, _image_id, _force)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":938
 *             int _force = force
 *         with nogil:
 *             ret = rbd_trash_remove(_ioctx, _image_id, _force)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error deleting image from trash')
 */
        __pyx_v_ret = rbd_trash_remove(__pyx_v__ioctx, __pyx_v__image_id, __pyx_v__force);
      }

      /* "rbd.pyx":937
 *             char *_image_id = image_id
 *             int _force = force
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_trash_remove(_ioctx, _image_id, _force)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":939
 *         with nogil:
 *             ret = rbd_trash_remove(_ioctx, _image_id, _force)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error deleting image from trash')
 * 
 */
  __pyx_t_7 = (__pyx_v_ret != 0);
  if (__pyx_t_7) {

    /* "rbd.pyx":940
 *             ret = rbd_trash_remove(_ioctx, _image_id, _force)
 *         if ret != 0:
 *             raise make_ex(ret, 'error deleting image from trash')             # <<<<<<<<<<<<<<
 * 
 *     def trash_get(self, ioctx, image_id):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_23)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.trash_remove", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_image_id);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_17trash_get(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_16trash_get[] = "RBD.trash_get(self, ioctx, image_id)\n\n        Retrieve RBD image info from trash\n        :param ioctx: determines which RADOS pool the image is in\n        :type ioctx: :class:`rados.Ioctx`\n        :param image_id: the id of the image to restore\n        :type image_id: str\n        :returns: dict - contains the following keys:\n\n            * ``id`` (str) - image id\n\n            * ``name`` (str) - image name\n\n            * ``source`` (str) - source of deletion\n\n            * ``deletion_time`` (datetime) - time of deletion\n\n            * ``deferment_end_time`` (datetime) - time that an image is allowed\n              to be removed from trash\n\n        :raises: :class:`ImageNotFound`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_17trash_get = {__Pyx_NAMESTR("trash_get"), (PyCFunction)__pyx_pw_3rbd_3RBD_17trash_get, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_16trash_get)};
static PyObject *__pyx_pw_3rbd_3RBD_17trash_get(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_image_id = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("trash_get (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__image_id,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_get", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__image_id)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_get", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "trash_get") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_image_id = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("trash_get", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.trash_get", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_16trash_get(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_image_id);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":942
 *             raise make_ex(ret, 'error deleting image from trash')
 * 
 *     def trash_get(self, ioctx, image_id):             # <<<<<<<<<<<<<<
 *         """
 *         Retrieve RBD image info from trash
 */

static PyObject *__pyx_pf_3rbd_3RBD_16trash_get(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_image_id) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__image_id;
  rbd_trash_image_info_t __pyx_v_c_info;
  int __pyx_v_ret;
  PyObject *__pyx_v___source_string = NULL;
  PyObject *__pyx_v_info = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("trash_get", 0);
  __Pyx_INCREF(__pyx_v_image_id);

  /* "rbd.pyx":964
 *         :raises: :class:`ImageNotFound`
 *         """
 *         image_id = cstr(image_id, 'image_id')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 964; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 964; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_image_id);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_image_id);
  __Pyx_GIVEREF(__pyx_v_image_id);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__image_id));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__image_id));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__image_id));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 964; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_image_id);
  __pyx_v_image_id = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":966
 *         image_id = cstr(image_id, 'image_id')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_image_id = image_id
 *             rbd_trash_image_info_t c_info
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":967
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_image_id = image_id             # <<<<<<<<<<<<<<
 *             rbd_trash_image_info_t c_info
 *         with nogil:
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_image_id); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 967; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__image_id = __pyx_t_5;

  /* "rbd.pyx":969
 *             char *_image_id = image_id
 *             rbd_trash_image_info_t c_info
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_trash_get(_ioctx, _image_id, &c_info)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":970
 *             rbd_trash_image_info_t c_info
 *         with nogil:
 *             ret = rbd_trash_get(_ioctx, _image_id, &c_info)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error restoring image from trash')
 */
        __pyx_v_ret = rbd_trash_get(__pyx_v__ioctx, __pyx_v__image_id, (&__pyx_v_c_info));
      }

      /* "rbd.pyx":969
 *             char *_image_id = image_id
 *             rbd_trash_image_info_t c_info
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_trash_get(_ioctx, _image_id, &c_info)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":971
 *         with nogil:
 *             ret = rbd_trash_get(_ioctx, _image_id, &c_info)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error restoring image from trash')
 * 
 */
  __pyx_t_6 = (__pyx_v_ret != 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":972
 *             ret = rbd_trash_get(_ioctx, _image_id, &c_info)
 *         if ret != 0:
 *             raise make_ex(ret, 'error restoring image from trash')             # <<<<<<<<<<<<<<
 * 
 *         __source_string = ['USER', 'MIRRORING']
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 972; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_24)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 972; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 972; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":974
 *             raise make_ex(ret, 'error restoring image from trash')
 * 
 *         __source_string = ['USER', 'MIRRORING']             # <<<<<<<<<<<<<<
 *         info = {
 *             'id'          : decode_cstr(c_info.id),
 */
  __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 974; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__USER));
  PyList_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__USER));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__USER));
  __Pyx_INCREF(((PyObject *)__pyx_n_s__MIRRORING));
  PyList_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__MIRRORING));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__MIRRORING));
  __pyx_v___source_string = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "rbd.pyx":975
 * 
 *         __source_string = ['USER', 'MIRRORING']
 *         info = {             # <<<<<<<<<<<<<<
 *             'id'          : decode_cstr(c_info.id),
 *             'name'        : decode_cstr(c_info.name),
 */
  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 975; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));

  /* "rbd.pyx":976
 *         __source_string = ['USER', 'MIRRORING']
 *         info = {
 *             'id'          : decode_cstr(c_info.id),             # <<<<<<<<<<<<<<
 *             'name'        : decode_cstr(c_info.name),
 *             'source'      : __source_string[c_info.source],
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_c_info.id); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_7, 0, ((PyObject *)__pyx_t_1));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_7), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__id), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 975; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":977
 *         info = {
 *             'id'          : decode_cstr(c_info.id),
 *             'name'        : decode_cstr(c_info.name),             # <<<<<<<<<<<<<<
 *             'source'      : __source_string[c_info.source],
 *             'deletion_time' : datetime.fromtimestamp(c_info.deletion_time),
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = __Pyx_PyBytes_FromString(__pyx_v_c_info.name); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_7));
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_7));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_7));
  __pyx_t_7 = 0;
  __pyx_t_7 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__name), __pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 975; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "rbd.pyx":978
 *             'id'          : decode_cstr(c_info.id),
 *             'name'        : decode_cstr(c_info.name),
 *             'source'      : __source_string[c_info.source],             # <<<<<<<<<<<<<<
 *             'deletion_time' : datetime.fromtimestamp(c_info.deletion_time),
 *             'deferment_end_time' : datetime.fromtimestamp(c_info.deferment_end_time)
 */
  __pyx_t_7 = PyInt_FromLong(__pyx_v_c_info.source); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_3 = PyObject_GetItem(((PyObject *)__pyx_v___source_string), __pyx_t_7); if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 978; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__source), __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 975; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":979
 *             'name'        : decode_cstr(c_info.name),
 *             'source'      : __source_string[c_info.source],
 *             'deletion_time' : datetime.fromtimestamp(c_info.deletion_time),             # <<<<<<<<<<<<<<
 *             'deferment_end_time' : datetime.fromtimestamp(c_info.deferment_end_time)
 *             }
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__datetime); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 979; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s__fromtimestamp); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 979; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_to_py_time_t(__pyx_v_c_info.deletion_time); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 979; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 979; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_t_7, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 979; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__deletion_time), __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 975; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":980
 *             'source'      : __source_string[c_info.source],
 *             'deletion_time' : datetime.fromtimestamp(c_info.deletion_time),
 *             'deferment_end_time' : datetime.fromtimestamp(c_info.deferment_end_time)             # <<<<<<<<<<<<<<
 *             }
 *         rbd_trash_get_cleanup(&c_info)
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__datetime); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 980; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s__fromtimestamp); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 980; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_to_py_time_t(__pyx_v_c_info.deferment_end_time); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 980; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 980; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_7), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 980; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__deferment_end_time), __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 975; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_info = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "rbd.pyx":982
 *             'deferment_end_time' : datetime.fromtimestamp(c_info.deferment_end_time)
 *             }
 *         rbd_trash_get_cleanup(&c_info)             # <<<<<<<<<<<<<<
 *         return info
 * 
 */
  rbd_trash_get_cleanup((&__pyx_v_c_info));

  /* "rbd.pyx":983
 *             }
 *         rbd_trash_get_cleanup(&c_info)
 *         return info             # <<<<<<<<<<<<<<
 * 
 *     def trash_list(self, ioctx):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_info));
  __pyx_r = ((PyObject *)__pyx_v_info);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("rbd.RBD.trash_get", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v___source_string);
  __Pyx_XDECREF(__pyx_v_info);
  __Pyx_XDECREF(__pyx_v_image_id);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_19trash_list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_18trash_list[] = "RBD.trash_list(self, ioctx)\n\n        List all entries from trash.\n        :param ioctx: determines which RADOS pool the image is in\n        :type ioctx: :class:`rados.Ioctx`\n        :returns: :class:`TrashIterator`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_19trash_list = {__Pyx_NAMESTR("trash_list"), (PyCFunction)__pyx_pw_3rbd_3RBD_19trash_list, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_18trash_list)};
static PyObject *__pyx_pw_3rbd_3RBD_19trash_list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("trash_list (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_list", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "trash_list") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("trash_list", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.trash_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_18trash_list(__pyx_self, __pyx_v_self, __pyx_v_ioctx);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":985
 *         return info
 * 
 *     def trash_list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         List all entries from trash.
 */

static PyObject *__pyx_pf_3rbd_3RBD_18trash_list(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("trash_list", 0);

  /* "rbd.pyx":992
 *         :returns: :class:`TrashIterator`
 *         """
 *         return TrashIterator(ioctx)             # <<<<<<<<<<<<<<
 * 
 *     def trash_restore(self, ioctx, image_id, name):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_ioctx);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_ioctx);
  __Pyx_GIVEREF(__pyx_v_ioctx);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_3rbd_TrashIterator)), ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.RBD.trash_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_21trash_restore(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_20trash_restore[] = "RBD.trash_restore(self, ioctx, image_id, name)\n\n        Restore an RBD image from trash.\n        :param ioctx: determines which RADOS pool the image is in\n        :type ioctx: :class:`rados.Ioctx`\n        :param image_id: the id of the image to restore\n        :type image_id: str\n        :param name: the new name of the restored image\n        :type name: str\n        :raises: :class:`ImageNotFound`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_21trash_restore = {__Pyx_NAMESTR("trash_restore"), (PyCFunction)__pyx_pw_3rbd_3RBD_21trash_restore, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_20trash_restore)};
static PyObject *__pyx_pw_3rbd_3RBD_21trash_restore(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_image_id = 0;
  PyObject *__pyx_v_name = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("trash_restore (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__image_id,&__pyx_n_s__name,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_restore", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__image_id)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_restore", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("trash_restore", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "trash_restore") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_image_id = values[2];
    __pyx_v_name = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("trash_restore", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.trash_restore", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_20trash_restore(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_image_id, __pyx_v_name);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":994
 *         return TrashIterator(ioctx)
 * 
 *     def trash_restore(self, ioctx, image_id, name):             # <<<<<<<<<<<<<<
 *         """
 *         Restore an RBD image from trash.
 */

static PyObject *__pyx_pf_3rbd_3RBD_20trash_restore(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_image_id, PyObject *__pyx_v_name) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__image_id;
  char *__pyx_v__name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("trash_restore", 0);
  __Pyx_INCREF(__pyx_v_image_id);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":1005
 *         :raises: :class:`ImageNotFound`
 *         """
 *         image_id = cstr(image_id, 'image_id')             # <<<<<<<<<<<<<<
 *         name = cstr(name, 'name')
 *         cdef:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_image_id);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_image_id);
  __Pyx_GIVEREF(__pyx_v_image_id);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__image_id));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__image_id));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__image_id));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_image_id);
  __pyx_v_image_id = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1006
 *         """
 *         image_id = cstr(image_id, 'image_id')
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":1008
 *         name = cstr(name, 'name')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_image_id = image_id
 *             char *_name = name
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1008; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1008; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":1009
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_image_id = image_id             # <<<<<<<<<<<<<<
 *             char *_name = name
 *         with nogil:
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_image_id); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1009; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__image_id = __pyx_t_5;

  /* "rbd.pyx":1010
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_image_id = image_id
 *             char *_name = name             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_trash_restore(_ioctx, _image_id, _name)
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1010; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_5;

  /* "rbd.pyx":1011
 *             char *_image_id = image_id
 *             char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_trash_restore(_ioctx, _image_id, _name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1012
 *             char *_name = name
 *         with nogil:
 *             ret = rbd_trash_restore(_ioctx, _image_id, _name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error restoring image from trash')
 */
        __pyx_v_ret = rbd_trash_restore(__pyx_v__ioctx, __pyx_v__image_id, __pyx_v__name);
      }

      /* "rbd.pyx":1011
 *             char *_image_id = image_id
 *             char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_trash_restore(_ioctx, _image_id, _name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1013
 *         with nogil:
 *             ret = rbd_trash_restore(_ioctx, _image_id, _name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error restoring image from trash')
 * 
 */
  __pyx_t_6 = (__pyx_v_ret != 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":1014
 *             ret = rbd_trash_restore(_ioctx, _image_id, _name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error restoring image from trash')             # <<<<<<<<<<<<<<
 * 
 *     def mirror_mode_get(self, ioctx):
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_1, ((PyObject *)__pyx_kp_s_24)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.trash_restore", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_image_id);
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_23mirror_mode_get(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_22mirror_mode_get[] = "RBD.mirror_mode_get(self, ioctx)\n\n        Get pool mirror mode.\n\n        :param ioctx: determines which RADOS pool is read\n        :type ioctx: :class:`rados.Ioctx`\n        :returns: int - pool mirror mode\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_23mirror_mode_get = {__Pyx_NAMESTR("mirror_mode_get"), (PyCFunction)__pyx_pw_3rbd_3RBD_23mirror_mode_get, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_22mirror_mode_get)};
static PyObject *__pyx_pw_3rbd_3RBD_23mirror_mode_get(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_mode_get (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_mode_get", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1016; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mirror_mode_get") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1016; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("mirror_mode_get", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1016; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.mirror_mode_get", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_22mirror_mode_get(__pyx_self, __pyx_v_self, __pyx_v_ioctx);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1016
 *             raise make_ex(ret, 'error restoring image from trash')
 * 
 *     def mirror_mode_get(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Get pool mirror mode.
 */

static PyObject *__pyx_pf_3rbd_3RBD_22mirror_mode_get(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx) {
  rados_ioctx_t __pyx_v__ioctx;
  rbd_mirror_mode_t __pyx_v_mirror_mode;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  rados_ioctx_t __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_mode_get", 0);

  /* "rbd.pyx":1025
 *         """
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             rbd_mirror_mode_t mirror_mode
 *         with nogil:
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_1 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_1;

  /* "rbd.pyx":1027
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             rbd_mirror_mode_t mirror_mode
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_mode_get(_ioctx, &mirror_mode)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1028
 *             rbd_mirror_mode_t mirror_mode
 *         with nogil:
 *             ret = rbd_mirror_mode_get(_ioctx, &mirror_mode)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting mirror mode')
 */
        __pyx_v_ret = rbd_mirror_mode_get(__pyx_v__ioctx, (&__pyx_v_mirror_mode));
      }

      /* "rbd.pyx":1027
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             rbd_mirror_mode_t mirror_mode
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_mode_get(_ioctx, &mirror_mode)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1029
 *         with nogil:
 *             ret = rbd_mirror_mode_get(_ioctx, &mirror_mode)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting mirror mode')
 *         return mirror_mode
 */
  __pyx_t_2 = (__pyx_v_ret != 0);
  if (__pyx_t_2) {

    /* "rbd.pyx":1030
 *             ret = rbd_mirror_mode_get(_ioctx, &mirror_mode)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting mirror mode')             # <<<<<<<<<<<<<<
 *         return mirror_mode
 * 
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1030; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_25)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1030; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1030; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1031
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting mirror mode')
 *         return mirror_mode             # <<<<<<<<<<<<<<
 * 
 *     def mirror_mode_set(self, ioctx, mirror_mode):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyInt_FromLong(__pyx_v_mirror_mode); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1031; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.RBD.mirror_mode_get", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_25mirror_mode_set(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_24mirror_mode_set[] = "RBD.mirror_mode_set(self, ioctx, mirror_mode)\n\n        Set pool mirror mode.\n\n        :param ioctx: determines which RADOS pool is written\n        :type ioctx: :class:`rados.Ioctx`\n        :param mirror_mode: mirror mode to set\n        :type mirror_mode: int\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_25mirror_mode_set = {__Pyx_NAMESTR("mirror_mode_set"), (PyCFunction)__pyx_pw_3rbd_3RBD_25mirror_mode_set, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_24mirror_mode_set)};
static PyObject *__pyx_pw_3rbd_3RBD_25mirror_mode_set(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_mirror_mode = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_mode_set (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__mirror_mode,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_mode_set", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1033; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mirror_mode)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_mode_set", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1033; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mirror_mode_set") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1033; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_mirror_mode = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("mirror_mode_set", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1033; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.mirror_mode_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_24mirror_mode_set(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_mirror_mode);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1033
 *         return mirror_mode
 * 
 *     def mirror_mode_set(self, ioctx, mirror_mode):             # <<<<<<<<<<<<<<
 *         """
 *         Set pool mirror mode.
 */

static PyObject *__pyx_pf_3rbd_3RBD_24mirror_mode_set(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_mirror_mode) {
  rados_ioctx_t __pyx_v__ioctx;
  rbd_mirror_mode_t __pyx_v__mirror_mode;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  rados_ioctx_t __pyx_t_1;
  rbd_mirror_mode_t __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_mode_set", 0);

  /* "rbd.pyx":1043
 *         """
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             rbd_mirror_mode_t _mirror_mode = mirror_mode
 *         with nogil:
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_1 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_1;

  /* "rbd.pyx":1044
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             rbd_mirror_mode_t _mirror_mode = mirror_mode             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_mirror_mode_set(_ioctx, _mirror_mode)
 */
  __pyx_t_2 = ((rbd_mirror_mode_t)PyInt_AsLong(__pyx_v_mirror_mode)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1044; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__mirror_mode = __pyx_t_2;

  /* "rbd.pyx":1045
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             rbd_mirror_mode_t _mirror_mode = mirror_mode
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_mode_set(_ioctx, _mirror_mode)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1046
 *             rbd_mirror_mode_t _mirror_mode = mirror_mode
 *         with nogil:
 *             ret = rbd_mirror_mode_set(_ioctx, _mirror_mode)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting mirror mode')
 */
        __pyx_v_ret = rbd_mirror_mode_set(__pyx_v__ioctx, __pyx_v__mirror_mode);
      }

      /* "rbd.pyx":1045
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             rbd_mirror_mode_t _mirror_mode = mirror_mode
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_mode_set(_ioctx, _mirror_mode)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1047
 *         with nogil:
 *             ret = rbd_mirror_mode_set(_ioctx, _mirror_mode)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error setting mirror mode')
 * 
 */
  __pyx_t_3 = (__pyx_v_ret != 0);
  if (__pyx_t_3) {

    /* "rbd.pyx":1048
 *             ret = rbd_mirror_mode_set(_ioctx, _mirror_mode)
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting mirror mode')             # <<<<<<<<<<<<<<
 * 
 *     def mirror_peer_add(self, ioctx, cluster_name, client_name):
 */
    __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1048; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __pyx_f_3rbd_make_ex(__pyx_t_4, ((PyObject *)__pyx_kp_s_26)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1048; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1048; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.RBD.mirror_mode_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_27mirror_peer_add(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_26mirror_peer_add[] = "RBD.mirror_peer_add(self, ioctx, cluster_name, client_name)\n\n        Add mirror peer.\n\n        :param ioctx: determines which RADOS pool is used\n        :type ioctx: :class:`rados.Ioctx`\n        :param cluster_name: mirror peer cluster name\n        :type cluster_name: str\n        :param client_name: mirror peer client name\n        :type client_name: str\n        :returns: str - peer uuid\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_27mirror_peer_add = {__Pyx_NAMESTR("mirror_peer_add"), (PyCFunction)__pyx_pw_3rbd_3RBD_27mirror_peer_add, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_26mirror_peer_add)};
static PyObject *__pyx_pw_3rbd_3RBD_27mirror_peer_add(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_cluster_name = 0;
  PyObject *__pyx_v_client_name = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_peer_add (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__cluster_name,&__pyx_n_s__client_name,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_add", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__cluster_name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_add", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__client_name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_add", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mirror_peer_add") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_cluster_name = values[2];
    __pyx_v_client_name = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("mirror_peer_add", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_add", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_26mirror_peer_add(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_cluster_name, __pyx_v_client_name);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1050
 *             raise make_ex(ret, 'error setting mirror mode')
 * 
 *     def mirror_peer_add(self, ioctx, cluster_name, client_name):             # <<<<<<<<<<<<<<
 *         """
 *         Add mirror peer.
 */

static PyObject *__pyx_pf_3rbd_3RBD_26mirror_peer_add(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_cluster_name, PyObject *__pyx_v_client_name) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__uuid;
  size_t __pyx_v__uuid_max_length;
  char *__pyx_v__cluster_name;
  char *__pyx_v__client_name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  void *__pyx_t_6;
  int __pyx_t_7;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_peer_add", 0);
  __Pyx_INCREF(__pyx_v_cluster_name);
  __Pyx_INCREF(__pyx_v_client_name);

  /* "rbd.pyx":1062
 *         :returns: str - peer uuid
 *         """
 *         cluster_name = cstr(cluster_name, 'cluster_name')             # <<<<<<<<<<<<<<
 *         client_name = cstr(client_name, 'client_name')
 *         cdef:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1062; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1062; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_cluster_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_cluster_name);
  __Pyx_GIVEREF(__pyx_v_cluster_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__cluster_name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__cluster_name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__cluster_name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1062; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_cluster_name);
  __pyx_v_cluster_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1063
 *         """
 *         cluster_name = cstr(cluster_name, 'cluster_name')
 *         client_name = cstr(client_name, 'client_name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1063; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1063; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_client_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_client_name);
  __Pyx_GIVEREF(__pyx_v_client_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__client_name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__client_name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__client_name));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1063; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_client_name);
  __pyx_v_client_name = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":1065
 *         client_name = cstr(client_name, 'client_name')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_uuid = NULL
 *             size_t _uuid_max_length = 512
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1065; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1065; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":1066
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_uuid = NULL             # <<<<<<<<<<<<<<
 *             size_t _uuid_max_length = 512
 *             char *_cluster_name = cluster_name
 */
  __pyx_v__uuid = NULL;

  /* "rbd.pyx":1067
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_uuid = NULL
 *             size_t _uuid_max_length = 512             # <<<<<<<<<<<<<<
 *             char *_cluster_name = cluster_name
 *             char *_client_name = client_name
 */
  __pyx_v__uuid_max_length = 512;

  /* "rbd.pyx":1068
 *             char *_uuid = NULL
 *             size_t _uuid_max_length = 512
 *             char *_cluster_name = cluster_name             # <<<<<<<<<<<<<<
 *             char *_client_name = client_name
 *         try:
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_cluster_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1068; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__cluster_name = __pyx_t_5;

  /* "rbd.pyx":1069
 *             size_t _uuid_max_length = 512
 *             char *_cluster_name = cluster_name
 *             char *_client_name = client_name             # <<<<<<<<<<<<<<
 *         try:
 *             _uuid = <char *>realloc_chk(_uuid, _uuid_max_length)
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_client_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1069; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__client_name = __pyx_t_5;

  /* "rbd.pyx":1070
 *             char *_cluster_name = cluster_name
 *             char *_client_name = client_name
 *         try:             # <<<<<<<<<<<<<<
 *             _uuid = <char *>realloc_chk(_uuid, _uuid_max_length)
 *             ret = rbd_mirror_peer_add(_ioctx, _uuid, _uuid_max_length,
 */
  /*try:*/ {

    /* "rbd.pyx":1071
 *             char *_client_name = client_name
 *         try:
 *             _uuid = <char *>realloc_chk(_uuid, _uuid_max_length)             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_peer_add(_ioctx, _uuid, _uuid_max_length,
 *                                       _cluster_name, _client_name)
 */
    __pyx_t_6 = __pyx_f_3rbd_realloc_chk(__pyx_v__uuid, __pyx_v__uuid_max_length); if (unlikely(__pyx_t_6 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __pyx_v__uuid = ((char *)__pyx_t_6);

    /* "rbd.pyx":1073
 *             _uuid = <char *>realloc_chk(_uuid, _uuid_max_length)
 *             ret = rbd_mirror_peer_add(_ioctx, _uuid, _uuid_max_length,
 *                                       _cluster_name, _client_name)             # <<<<<<<<<<<<<<
 *             if ret != 0:
 *                 raise make_ex(ret, 'error adding mirror peer')
 */
    __pyx_v_ret = rbd_mirror_peer_add(__pyx_v__ioctx, __pyx_v__uuid, __pyx_v__uuid_max_length, __pyx_v__cluster_name, __pyx_v__client_name);

    /* "rbd.pyx":1074
 *             ret = rbd_mirror_peer_add(_ioctx, _uuid, _uuid_max_length,
 *                                       _cluster_name, _client_name)
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error adding mirror peer')
 *             return decode_cstr(_uuid)
 */
    __pyx_t_7 = (__pyx_v_ret != 0);
    if (__pyx_t_7) {

      /* "rbd.pyx":1075
 *                                       _cluster_name, _client_name)
 *             if ret != 0:
 *                 raise make_ex(ret, 'error adding mirror peer')             # <<<<<<<<<<<<<<
 *             return decode_cstr(_uuid)
 *         finally:
 */
      __pyx_t_1 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_1, ((PyObject *)__pyx_kp_s_27)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1075; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "rbd.pyx":1076
 *             if ret != 0:
 *                 raise make_ex(ret, 'error adding mirror peer')
 *             return decode_cstr(_uuid)             # <<<<<<<<<<<<<<
 *         finally:
 *             free(_uuid)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1076; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v__uuid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1076; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1076; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_1));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
    __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1076; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":1078
 *             return decode_cstr(_uuid)
 *         finally:
 *             free(_uuid)             # <<<<<<<<<<<<<<
 * 
 *     def mirror_peer_remove(self, ioctx, uuid):
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v__uuid);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_add", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_cluster_name);
  __Pyx_XDECREF(__pyx_v_client_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_29mirror_peer_remove(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_28mirror_peer_remove[] = "RBD.mirror_peer_remove(self, ioctx, uuid)\n\n        Remove mirror peer.\n\n        :param ioctx: determines which RADOS pool is used\n        :type ioctx: :class:`rados.Ioctx`\n        :param uuid: peer uuid\n        :type uuid: str\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_29mirror_peer_remove = {__Pyx_NAMESTR("mirror_peer_remove"), (PyCFunction)__pyx_pw_3rbd_3RBD_29mirror_peer_remove, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_28mirror_peer_remove)};
static PyObject *__pyx_pw_3rbd_3RBD_29mirror_peer_remove(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_uuid = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_peer_remove (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__uuid,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_remove", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1080; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__uuid)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_remove", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1080; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mirror_peer_remove") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1080; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_uuid = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("mirror_peer_remove", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1080; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_remove", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_28mirror_peer_remove(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_uuid);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1080
 *             free(_uuid)
 * 
 *     def mirror_peer_remove(self, ioctx, uuid):             # <<<<<<<<<<<<<<
 *         """
 *         Remove mirror peer.
 */

static PyObject *__pyx_pf_3rbd_3RBD_28mirror_peer_remove(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_uuid) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__uuid;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_peer_remove", 0);
  __Pyx_INCREF(__pyx_v_uuid);

  /* "rbd.pyx":1089
 *         :type uuid: str
 *         """
 *         uuid = cstr(uuid, 'uuid')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1089; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1089; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_uuid);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_uuid);
  __Pyx_GIVEREF(__pyx_v_uuid);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__uuid));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__uuid));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__uuid));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1089; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_uuid);
  __pyx_v_uuid = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1091
 *         uuid = cstr(uuid, 'uuid')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_uuid = uuid
 *         with nogil:
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1091; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1091; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":1092
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_uuid = uuid             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_mirror_peer_remove(_ioctx, _uuid)
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_uuid); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1092; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__uuid = __pyx_t_5;

  /* "rbd.pyx":1093
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_uuid = uuid
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_peer_remove(_ioctx, _uuid)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1094
 *             char *_uuid = uuid
 *         with nogil:
 *             ret = rbd_mirror_peer_remove(_ioctx, _uuid)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing mirror peer')
 */
        __pyx_v_ret = rbd_mirror_peer_remove(__pyx_v__ioctx, __pyx_v__uuid);
      }

      /* "rbd.pyx":1093
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_uuid = uuid
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_peer_remove(_ioctx, _uuid)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1095
 *         with nogil:
 *             ret = rbd_mirror_peer_remove(_ioctx, _uuid)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error removing mirror peer')
 * 
 */
  __pyx_t_6 = (__pyx_v_ret != 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":1096
 *             ret = rbd_mirror_peer_remove(_ioctx, _uuid)
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing mirror peer')             # <<<<<<<<<<<<<<
 * 
 *     def mirror_peer_list(self, ioctx):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_28)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_remove", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_uuid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_31mirror_peer_list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_30mirror_peer_list[] = "RBD.mirror_peer_list(self, ioctx)\n\n        Iterate over the peers of a pool.\n\n        :param ioctx: determines which RADOS pool is read\n        :type ioctx: :class:`rados.Ioctx`\n        :returns: :class:`MirrorPeerIterator`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_31mirror_peer_list = {__Pyx_NAMESTR("mirror_peer_list"), (PyCFunction)__pyx_pw_3rbd_3RBD_31mirror_peer_list, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_30mirror_peer_list)};
static PyObject *__pyx_pw_3rbd_3RBD_31mirror_peer_list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_peer_list (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_list", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mirror_peer_list") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("mirror_peer_list", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_30mirror_peer_list(__pyx_self, __pyx_v_self, __pyx_v_ioctx);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1098
 *             raise make_ex(ret, 'error removing mirror peer')
 * 
 *     def mirror_peer_list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Iterate over the peers of a pool.
 */

static PyObject *__pyx_pf_3rbd_3RBD_30mirror_peer_list(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_peer_list", 0);

  /* "rbd.pyx":1106
 *         :returns: :class:`MirrorPeerIterator`
 *         """
 *         return MirrorPeerIterator(ioctx)             # <<<<<<<<<<<<<<
 * 
 *     def mirror_peer_set_client(self, ioctx, uuid, client_name):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_ioctx);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_ioctx);
  __Pyx_GIVEREF(__pyx_v_ioctx);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_3rbd_MirrorPeerIterator)), ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_33mirror_peer_set_client(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_32mirror_peer_set_client[] = "RBD.mirror_peer_set_client(self, ioctx, uuid, client_name)\n\n        Set mirror peer client name\n\n        :param ioctx: determines which RADOS pool is written\n        :type ioctx: :class:`rados.Ioctx`\n        :param uuid: uuid of the mirror peer\n        :type uuid: str\n        :param client_name: client name of the mirror peer to set\n        :type client_name: str\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_33mirror_peer_set_client = {__Pyx_NAMESTR("mirror_peer_set_client"), (PyCFunction)__pyx_pw_3rbd_3RBD_33mirror_peer_set_client, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_32mirror_peer_set_client)};
static PyObject *__pyx_pw_3rbd_3RBD_33mirror_peer_set_client(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_uuid = 0;
  PyObject *__pyx_v_client_name = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_peer_set_client (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__uuid,&__pyx_n_s__client_name,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_set_client", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__uuid)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_set_client", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__client_name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_set_client", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mirror_peer_set_client") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_uuid = values[2];
    __pyx_v_client_name = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("mirror_peer_set_client", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_set_client", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_32mirror_peer_set_client(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_uuid, __pyx_v_client_name);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1108
 *         return MirrorPeerIterator(ioctx)
 * 
 *     def mirror_peer_set_client(self, ioctx, uuid, client_name):             # <<<<<<<<<<<<<<
 *         """
 *         Set mirror peer client name
 */

static PyObject *__pyx_pf_3rbd_3RBD_32mirror_peer_set_client(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_uuid, PyObject *__pyx_v_client_name) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__uuid;
  char *__pyx_v__client_name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_peer_set_client", 0);
  __Pyx_INCREF(__pyx_v_uuid);
  __Pyx_INCREF(__pyx_v_client_name);

  /* "rbd.pyx":1119
 *         :type client_name: str
 *         """
 *         uuid = cstr(uuid, 'uuid')             # <<<<<<<<<<<<<<
 *         client_name = cstr(client_name, 'client_name')
 *         cdef:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_uuid);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_uuid);
  __Pyx_GIVEREF(__pyx_v_uuid);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__uuid));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__uuid));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__uuid));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_uuid);
  __pyx_v_uuid = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1120
 *         """
 *         uuid = cstr(uuid, 'uuid')
 *         client_name = cstr(client_name, 'client_name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_client_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_client_name);
  __Pyx_GIVEREF(__pyx_v_client_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__client_name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__client_name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__client_name));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_client_name);
  __pyx_v_client_name = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":1122
 *         client_name = cstr(client_name, 'client_name')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_uuid = uuid
 *             char *_client_name = client_name
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":1123
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_uuid = uuid             # <<<<<<<<<<<<<<
 *             char *_client_name = client_name
 *         with nogil:
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_uuid); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__uuid = __pyx_t_5;

  /* "rbd.pyx":1124
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_uuid = uuid
 *             char *_client_name = client_name             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_mirror_peer_set_client(_ioctx, _uuid, _client_name)
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_client_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__client_name = __pyx_t_5;

  /* "rbd.pyx":1125
 *             char *_uuid = uuid
 *             char *_client_name = client_name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_peer_set_client(_ioctx, _uuid, _client_name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1126
 *             char *_client_name = client_name
 *         with nogil:
 *             ret = rbd_mirror_peer_set_client(_ioctx, _uuid, _client_name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting mirror peer client')
 */
        __pyx_v_ret = rbd_mirror_peer_set_client(__pyx_v__ioctx, __pyx_v__uuid, __pyx_v__client_name);
      }

      /* "rbd.pyx":1125
 *             char *_uuid = uuid
 *             char *_client_name = client_name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_peer_set_client(_ioctx, _uuid, _client_name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1127
 *         with nogil:
 *             ret = rbd_mirror_peer_set_client(_ioctx, _uuid, _client_name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error setting mirror peer client')
 * 
 */
  __pyx_t_6 = (__pyx_v_ret != 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":1128
 *             ret = rbd_mirror_peer_set_client(_ioctx, _uuid, _client_name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting mirror peer client')             # <<<<<<<<<<<<<<
 * 
 *     def mirror_peer_set_cluster(self, ioctx, uuid, cluster_name):
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_1, ((PyObject *)__pyx_kp_s_29)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_set_client", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_uuid);
  __Pyx_XDECREF(__pyx_v_client_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_35mirror_peer_set_cluster(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_34mirror_peer_set_cluster[] = "RBD.mirror_peer_set_cluster(self, ioctx, uuid, cluster_name)\n\n        Set mirror peer cluster name\n\n        :param ioctx: determines which RADOS pool is written\n        :type ioctx: :class:`rados.Ioctx`\n        :param uuid: uuid of the mirror peer\n        :type uuid: str\n        :param cluster_name: cluster name of the mirror peer to set\n        :type cluster_name: str\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_35mirror_peer_set_cluster = {__Pyx_NAMESTR("mirror_peer_set_cluster"), (PyCFunction)__pyx_pw_3rbd_3RBD_35mirror_peer_set_cluster, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_34mirror_peer_set_cluster)};
static PyObject *__pyx_pw_3rbd_3RBD_35mirror_peer_set_cluster(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_uuid = 0;
  PyObject *__pyx_v_cluster_name = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_peer_set_cluster (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,&__pyx_n_s__uuid,&__pyx_n_s__cluster_name,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_set_cluster", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__uuid)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_set_cluster", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__cluster_name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_peer_set_cluster", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mirror_peer_set_cluster") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
    __pyx_v_uuid = values[2];
    __pyx_v_cluster_name = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("mirror_peer_set_cluster", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_set_cluster", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_34mirror_peer_set_cluster(__pyx_self, __pyx_v_self, __pyx_v_ioctx, __pyx_v_uuid, __pyx_v_cluster_name);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1130
 *             raise make_ex(ret, 'error setting mirror peer client')
 * 
 *     def mirror_peer_set_cluster(self, ioctx, uuid, cluster_name):             # <<<<<<<<<<<<<<
 *         """
 *         Set mirror peer cluster name
 */

static PyObject *__pyx_pf_3rbd_3RBD_34mirror_peer_set_cluster(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_uuid, PyObject *__pyx_v_cluster_name) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__uuid;
  char *__pyx_v__cluster_name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_peer_set_cluster", 0);
  __Pyx_INCREF(__pyx_v_uuid);
  __Pyx_INCREF(__pyx_v_cluster_name);

  /* "rbd.pyx":1141
 *         :type cluster_name: str
 *         """
 *         uuid = cstr(uuid, 'uuid')             # <<<<<<<<<<<<<<
 *         cluster_name = cstr(cluster_name, 'cluster_name')
 *         cdef:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_uuid);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_uuid);
  __Pyx_GIVEREF(__pyx_v_uuid);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__uuid));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__uuid));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__uuid));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_uuid);
  __pyx_v_uuid = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1142
 *         """
 *         uuid = cstr(uuid, 'uuid')
 *         cluster_name = cstr(cluster_name, 'cluster_name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_cluster_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_cluster_name);
  __Pyx_GIVEREF(__pyx_v_cluster_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__cluster_name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__cluster_name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__cluster_name));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_cluster_name);
  __pyx_v_cluster_name = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":1144
 *         cluster_name = cstr(cluster_name, 'cluster_name')
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_uuid = uuid
 *             char *_cluster_name = cluster_name
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_4;

  /* "rbd.pyx":1145
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_uuid = uuid             # <<<<<<<<<<<<<<
 *             char *_cluster_name = cluster_name
 *         with nogil:
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_uuid); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__uuid = __pyx_t_5;

  /* "rbd.pyx":1146
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_uuid = uuid
 *             char *_cluster_name = cluster_name             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_mirror_peer_set_cluster(_ioctx, _uuid, _cluster_name)
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_cluster_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__cluster_name = __pyx_t_5;

  /* "rbd.pyx":1147
 *             char *_uuid = uuid
 *             char *_cluster_name = cluster_name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_peer_set_cluster(_ioctx, _uuid, _cluster_name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1148
 *             char *_cluster_name = cluster_name
 *         with nogil:
 *             ret = rbd_mirror_peer_set_cluster(_ioctx, _uuid, _cluster_name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting mirror peer cluster')
 */
        __pyx_v_ret = rbd_mirror_peer_set_cluster(__pyx_v__ioctx, __pyx_v__uuid, __pyx_v__cluster_name);
      }

      /* "rbd.pyx":1147
 *             char *_uuid = uuid
 *             char *_cluster_name = cluster_name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_peer_set_cluster(_ioctx, _uuid, _cluster_name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1149
 *         with nogil:
 *             ret = rbd_mirror_peer_set_cluster(_ioctx, _uuid, _cluster_name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error setting mirror peer cluster')
 * 
 */
  __pyx_t_6 = (__pyx_v_ret != 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":1150
 *             ret = rbd_mirror_peer_set_cluster(_ioctx, _uuid, _cluster_name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting mirror peer cluster')             # <<<<<<<<<<<<<<
 * 
 *     def mirror_image_status_list(self, ioctx):
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_1, ((PyObject *)__pyx_kp_s_30)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.RBD.mirror_peer_set_cluster", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_uuid);
  __Pyx_XDECREF(__pyx_v_cluster_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_37mirror_image_status_list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_36mirror_image_status_list[] = "RBD.mirror_image_status_list(self, ioctx)\n\n        Iterate over the mirror image statuses of a pool.\n\n        :param ioctx: determines which RADOS pool is read\n        :type ioctx: :class:`rados.Ioctx`\n        :returns: :class:`MirrorImageStatus`\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_37mirror_image_status_list = {__Pyx_NAMESTR("mirror_image_status_list"), (PyCFunction)__pyx_pw_3rbd_3RBD_37mirror_image_status_list, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_36mirror_image_status_list)};
static PyObject *__pyx_pw_3rbd_3RBD_37mirror_image_status_list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_image_status_list (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_image_status_list", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mirror_image_status_list") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("mirror_image_status_list", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.mirror_image_status_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_36mirror_image_status_list(__pyx_self, __pyx_v_self, __pyx_v_ioctx);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1152
 *             raise make_ex(ret, 'error setting mirror peer cluster')
 * 
 *     def mirror_image_status_list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Iterate over the mirror image statuses of a pool.
 */

static PyObject *__pyx_pf_3rbd_3RBD_36mirror_image_status_list(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_image_status_list", 0);

  /* "rbd.pyx":1160
 *         :returns: :class:`MirrorImageStatus`
 *         """
 *         return MirrorImageStatusIterator(ioctx)             # <<<<<<<<<<<<<<
 * 
 *     def mirror_image_status_summary(self, ioctx):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_ioctx);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_ioctx);
  __Pyx_GIVEREF(__pyx_v_ioctx);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_3rbd_MirrorImageStatusIterator)), ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.RBD.mirror_image_status_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_3RBD_39mirror_image_status_summary(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_3RBD_38mirror_image_status_summary[] = "RBD.mirror_image_status_summary(self, ioctx)\n\n        Get mirror image status summary of a pool.\n\n        :param ioctx: determines which RADOS pool is read\n        :type ioctx: :class:`rados.Ioctx`\n        :returns: list - a list of (state, count) tuples\n        ";
static PyMethodDef __pyx_mdef_3rbd_3RBD_39mirror_image_status_summary = {__Pyx_NAMESTR("mirror_image_status_summary"), (PyCFunction)__pyx_pw_3rbd_3RBD_39mirror_image_status_summary, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_3RBD_38mirror_image_status_summary)};
static PyObject *__pyx_pw_3rbd_3RBD_39mirror_image_status_summary(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_ioctx = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_image_status_summary (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__self,&__pyx_n_s__ioctx,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("mirror_image_status_summary", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1162; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mirror_image_status_summary") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1162; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_ioctx = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("mirror_image_status_summary", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1162; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.RBD.mirror_image_status_summary", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_3RBD_38mirror_image_status_summary(__pyx_self, __pyx_v_self, __pyx_v_ioctx);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1162
 *         return MirrorImageStatusIterator(ioctx)
 * 
 *     def mirror_image_status_summary(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Get mirror image status summary of a pool.
 */

static PyObject *__pyx_pf_3rbd_3RBD_38mirror_image_status_summary(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_ioctx) {
  rados_ioctx_t __pyx_v__ioctx;
  rbd_mirror_image_status_state_t *__pyx_v_states;
  int *__pyx_v_counts;
  size_t __pyx_v_maxlen;
  int __pyx_v_ret;
  size_t __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  rados_ioctx_t __pyx_t_1;
  void *__pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  size_t __pyx_t_6;
  size_t __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_image_status_summary", 0);

  /* "rbd.pyx":1171
 *         """
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             rbd_mirror_image_status_state_t *states = NULL
 *             int *counts = NULL
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_1 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_1;

  /* "rbd.pyx":1172
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             rbd_mirror_image_status_state_t *states = NULL             # <<<<<<<<<<<<<<
 *             int *counts = NULL
 *             size_t maxlen = 32
 */
  __pyx_v_states = NULL;

  /* "rbd.pyx":1173
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             rbd_mirror_image_status_state_t *states = NULL
 *             int *counts = NULL             # <<<<<<<<<<<<<<
 *             size_t maxlen = 32
 *         try:
 */
  __pyx_v_counts = NULL;

  /* "rbd.pyx":1174
 *             rbd_mirror_image_status_state_t *states = NULL
 *             int *counts = NULL
 *             size_t maxlen = 32             # <<<<<<<<<<<<<<
 *         try:
 *             states = <rbd_mirror_image_status_state_t *>realloc_chk(states,
 */
  __pyx_v_maxlen = 32;

  /* "rbd.pyx":1175
 *             int *counts = NULL
 *             size_t maxlen = 32
 *         try:             # <<<<<<<<<<<<<<
 *             states = <rbd_mirror_image_status_state_t *>realloc_chk(states,
 *                 sizeof(rbd_mirror_image_status_state_t) * maxlen)
 */
  /*try:*/ {

    /* "rbd.pyx":1177
 *         try:
 *             states = <rbd_mirror_image_status_state_t *>realloc_chk(states,
 *                 sizeof(rbd_mirror_image_status_state_t) * maxlen)             # <<<<<<<<<<<<<<
 *             counts = <int *>realloc_chk(counts, sizeof(int) * maxlen)
 *             with nogil:
 */
    __pyx_t_2 = __pyx_f_3rbd_realloc_chk(__pyx_v_states, ((sizeof(rbd_mirror_image_status_state_t)) * __pyx_v_maxlen)); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1176; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __pyx_v_states = ((rbd_mirror_image_status_state_t *)__pyx_t_2);

    /* "rbd.pyx":1178
 *             states = <rbd_mirror_image_status_state_t *>realloc_chk(states,
 *                 sizeof(rbd_mirror_image_status_state_t) * maxlen)
 *             counts = <int *>realloc_chk(counts, sizeof(int) * maxlen)             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_mirror_image_status_summary(_ioctx, states, counts,
 */
    __pyx_t_2 = __pyx_f_3rbd_realloc_chk(__pyx_v_counts, ((sizeof(int)) * __pyx_v_maxlen)); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1178; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __pyx_v_counts = ((int *)__pyx_t_2);

    /* "rbd.pyx":1179
 *                 sizeof(rbd_mirror_image_status_state_t) * maxlen)
 *             counts = <int *>realloc_chk(counts, sizeof(int) * maxlen)
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_mirror_image_status_summary(_ioctx, states, counts,
 *                                                       &maxlen)
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":1181
 *             with nogil:
 *                 ret = rbd_mirror_image_status_summary(_ioctx, states, counts,
 *                                                       &maxlen)             # <<<<<<<<<<<<<<
 *             if ret < 0:
 *                 raise make_ex(ret, 'error getting mirror image status summary')
 */
          __pyx_v_ret = rbd_mirror_image_status_summary(__pyx_v__ioctx, __pyx_v_states, __pyx_v_counts, (&__pyx_v_maxlen));
        }

        /* "rbd.pyx":1179
 *                 sizeof(rbd_mirror_image_status_state_t) * maxlen)
 *             counts = <int *>realloc_chk(counts, sizeof(int) * maxlen)
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_mirror_image_status_summary(_ioctx, states, counts,
 *                                                       &maxlen)
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }

    /* "rbd.pyx":1182
 *                 ret = rbd_mirror_image_status_summary(_ioctx, states, counts,
 *                                                       &maxlen)
 *             if ret < 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error getting mirror image status summary')
 *             return [(states[i], counts[i]) for i in range(maxlen)]
 */
    __pyx_t_3 = (__pyx_v_ret < 0);
    if (__pyx_t_3) {

      /* "rbd.pyx":1183
 *                                                       &maxlen)
 *             if ret < 0:
 *                 raise make_ex(ret, 'error getting mirror image status summary')             # <<<<<<<<<<<<<<
 *             return [(states[i], counts[i]) for i in range(maxlen)]
 *         finally:
 */
      __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __pyx_f_3rbd_make_ex(__pyx_t_4, ((PyObject *)__pyx_kp_s_31)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_Raise(__pyx_t_5, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1183; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "rbd.pyx":1184
 *             if ret < 0:
 *                 raise make_ex(ret, 'error getting mirror image status summary')
 *             return [(states[i], counts[i]) for i in range(maxlen)]             # <<<<<<<<<<<<<<
 *         finally:
 *             free(states)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __pyx_v_maxlen;
    for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_i = __pyx_t_7;
      __pyx_t_4 = PyInt_FromLong((__pyx_v_states[__pyx_v_i])); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_8 = PyInt_FromLong((__pyx_v_counts[__pyx_v_i])); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_8);
      __pyx_t_4 = 0;
      __pyx_t_8 = 0;
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_5, (PyObject*)__pyx_t_9))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    }
    __pyx_r = ((PyObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":1186
 *             return [(states[i], counts[i]) for i in range(maxlen)]
 *         finally:
 *             free(states)             # <<<<<<<<<<<<<<
 *             free(counts)
 * 
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_states);

    /* "rbd.pyx":1187
 *         finally:
 *             free(states)
 *             free(counts)             # <<<<<<<<<<<<<<
 * 
 * cdef class MirrorPeerIterator(object):
 */
    free(__pyx_v_counts);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("rbd.RBD.mirror_image_status_summary", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_3rbd_18MirrorPeerIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3rbd_18MirrorPeerIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ioctx = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__ioctx,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1208; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_ioctx = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1208; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.MirrorPeerIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_18MirrorPeerIterator___init__(((struct __pyx_obj_3rbd_MirrorPeerIterator *)__pyx_v_self), __pyx_v_ioctx);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1208
 *         int num_peers
 * 
 *     def __init__(self, ioctx):             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */

static int __pyx_pf_3rbd_18MirrorPeerIterator___init__(struct __pyx_obj_3rbd_MirrorPeerIterator *__pyx_v_self, PyObject *__pyx_v_ioctx) {
  rados_ioctx_t __pyx_v__ioctx;
  int __pyx_v_ret;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  rados_ioctx_t __pyx_t_1;
  void *__pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "rbd.pyx":1210
 *     def __init__(self, ioctx):
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *         self.peers = NULL
 *         self.num_peers = 10
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_1 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_1;

  /* "rbd.pyx":1211
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *         self.peers = NULL             # <<<<<<<<<<<<<<
 *         self.num_peers = 10
 *         while True:
 */
  __pyx_v_self->peers = NULL;

  /* "rbd.pyx":1212
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *         self.peers = NULL
 *         self.num_peers = 10             # <<<<<<<<<<<<<<
 *         while True:
 *             self.peers = <rbd_mirror_peer_t *>realloc_chk(
 */
  __pyx_v_self->num_peers = 10;

  /* "rbd.pyx":1213
 *         self.peers = NULL
 *         self.num_peers = 10
 *         while True:             # <<<<<<<<<<<<<<
 *             self.peers = <rbd_mirror_peer_t *>realloc_chk(
 *                 self.peers, self.num_peers * sizeof(rbd_mirror_peer_t))
 */
  while (1) {
    if (!1) break;

    /* "rbd.pyx":1215
 *         while True:
 *             self.peers = <rbd_mirror_peer_t *>realloc_chk(
 *                 self.peers, self.num_peers * sizeof(rbd_mirror_peer_t))             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_mirror_peer_list(_ioctx, self.peers, &self.num_peers)
 */
    __pyx_t_2 = __pyx_f_3rbd_realloc_chk(__pyx_v_self->peers, (__pyx_v_self->num_peers * (sizeof(rbd_mirror_peer_t)))); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "rbd.pyx":1214
 *         self.num_peers = 10
 *         while True:
 *             self.peers = <rbd_mirror_peer_t *>realloc_chk(             # <<<<<<<<<<<<<<
 *                 self.peers, self.num_peers * sizeof(rbd_mirror_peer_t))
 *             with nogil:
 */
    __pyx_v_self->peers = ((rbd_mirror_peer_t *)__pyx_t_2);

    /* "rbd.pyx":1216
 *             self.peers = <rbd_mirror_peer_t *>realloc_chk(
 *                 self.peers, self.num_peers * sizeof(rbd_mirror_peer_t))
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_mirror_peer_list(_ioctx, self.peers, &self.num_peers)
 *             if ret < 0:
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":1217
 *                 self.peers, self.num_peers * sizeof(rbd_mirror_peer_t))
 *             with nogil:
 *                 ret = rbd_mirror_peer_list(_ioctx, self.peers, &self.num_peers)             # <<<<<<<<<<<<<<
 *             if ret < 0:
 *                 if ret == -errno.ERANGE:
 */
          __pyx_v_ret = rbd_mirror_peer_list(__pyx_v__ioctx, __pyx_v_self->peers, (&__pyx_v_self->num_peers));
        }

        /* "rbd.pyx":1216
 *             self.peers = <rbd_mirror_peer_t *>realloc_chk(
 *                 self.peers, self.num_peers * sizeof(rbd_mirror_peer_t))
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_mirror_peer_list(_ioctx, self.peers, &self.num_peers)
 *             if ret < 0:
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }

    /* "rbd.pyx":1218
 *             with nogil:
 *                 ret = rbd_mirror_peer_list(_ioctx, self.peers, &self.num_peers)
 *             if ret < 0:             # <<<<<<<<<<<<<<
 *                 if ret == -errno.ERANGE:
 *                     continue
 */
    __pyx_t_3 = (__pyx_v_ret < 0);
    if (__pyx_t_3) {

      /* "rbd.pyx":1219
 *                 ret = rbd_mirror_peer_list(_ioctx, self.peers, &self.num_peers)
 *             if ret < 0:
 *                 if ret == -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     continue
 *                 self.num_peers = 0
 */
      __pyx_t_3 = (__pyx_v_ret == (-ERANGE));
      if (__pyx_t_3) {

        /* "rbd.pyx":1220
 *             if ret < 0:
 *                 if ret == -errno.ERANGE:
 *                     continue             # <<<<<<<<<<<<<<
 *                 self.num_peers = 0
 *                 raise make_ex(ret, 'error listing peers')
 */
        goto __pyx_L3_continue;
        goto __pyx_L11;
      }
      __pyx_L11:;

      /* "rbd.pyx":1221
 *                 if ret == -errno.ERANGE:
 *                     continue
 *                 self.num_peers = 0             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error listing peers')
 *             break
 */
      __pyx_v_self->num_peers = 0;

      /* "rbd.pyx":1222
 *                     continue
 *                 self.num_peers = 0
 *                 raise make_ex(ret, 'error listing peers')             # <<<<<<<<<<<<<<
 *             break
 * 
 */
      __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __pyx_f_3rbd_make_ex(__pyx_t_4, ((PyObject *)__pyx_kp_s_32)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_Raise(__pyx_t_5, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L10;
    }
    __pyx_L10:;

    /* "rbd.pyx":1223
 *                 self.num_peers = 0
 *                 raise make_ex(ret, 'error listing peers')
 *             break             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
    goto __pyx_L4_break;
    __pyx_L3_continue:;
  }
  __pyx_L4_break:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.MirrorPeerIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_3rbd_18MirrorPeerIterator_4generator(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_18MirrorPeerIterator_3__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_3rbd_18MirrorPeerIterator_3__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_18MirrorPeerIterator_2__iter__(((struct __pyx_obj_3rbd_MirrorPeerIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1225
 *             break
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         for i in range(self.num_peers):
 *             yield {
 */

static PyObject *__pyx_pf_3rbd_18MirrorPeerIterator_2__iter__(struct __pyx_obj_3rbd_MirrorPeerIterator *__pyx_v_self) {
  struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *)__pyx_tp_new_3rbd___pyx_scope_struct____iter__(__pyx_ptype_3rbd___pyx_scope_struct____iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = __Pyx_Generator_New((__pyx_generator_body_t) __pyx_gb_3rbd_18MirrorPeerIterator_4generator, (PyObject *) __pyx_cur_scope); if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("rbd.MirrorPeerIterator.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_3rbd_18MirrorPeerIterator_4generator(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *__pyx_cur_scope = ((struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("None", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L6_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1226
 * 
 *     def __iter__(self):
 *         for i in range(self.num_peers):             # <<<<<<<<<<<<<<
 *             yield {
 *                 'uuid'         : decode_cstr(self.peers[i].uuid),
 */
  __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->num_peers;
  for (__pyx_t_2 = 0; __pyx_t_2 < __pyx_t_1; __pyx_t_2+=1) {
    __pyx_cur_scope->__pyx_v_i = __pyx_t_2;

    /* "rbd.pyx":1227
 *     def __iter__(self):
 *         for i in range(self.num_peers):
 *             yield {             # <<<<<<<<<<<<<<
 *                 'uuid'         : decode_cstr(self.peers[i].uuid),
 *                 'cluster_name' : decode_cstr(self.peers[i].cluster_name),
 */
    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));

    /* "rbd.pyx":1228
 *         for i in range(self.num_peers):
 *             yield {
 *                 'uuid'         : decode_cstr(self.peers[i].uuid),             # <<<<<<<<<<<<<<
 *                 'cluster_name' : decode_cstr(self.peers[i].cluster_name),
 *                 'client_name'  : decode_cstr(self.peers[i].client_name),
 */
    __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->peers[__pyx_cur_scope->__pyx_v_i]).uuid); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_5));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__uuid), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "rbd.pyx":1229
 *             yield {
 *                 'uuid'         : decode_cstr(self.peers[i].uuid),
 *                 'cluster_name' : decode_cstr(self.peers[i].cluster_name),             # <<<<<<<<<<<<<<
 *                 'client_name'  : decode_cstr(self.peers[i].client_name),
 *                 }
 */
    __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->peers[__pyx_cur_scope->__pyx_v_i]).cluster_name); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_6));
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_t_6));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
    __pyx_t_6 = 0;
    __pyx_t_6 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__cluster_name), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "rbd.pyx":1230
 *                 'uuid'         : decode_cstr(self.peers[i].uuid),
 *                 'cluster_name' : decode_cstr(self.peers[i].cluster_name),
 *                 'client_name'  : decode_cstr(self.peers[i].client_name),             # <<<<<<<<<<<<<<
 *                 }
 * 
 */
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_4 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->peers[__pyx_cur_scope->__pyx_v_i]).client_name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__client_name), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = ((PyObject *)__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
    __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
    if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_generator->resume_label = -1;
  __Pyx_Generator_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return NULL;
}

/* Python wrapper */
static void __pyx_pw_3rbd_18MirrorPeerIterator_6__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_3rbd_18MirrorPeerIterator_6__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_3rbd_18MirrorPeerIterator_5__dealloc__(((struct __pyx_obj_3rbd_MirrorPeerIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":1233
 *                 }
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         if self.peers:
 *             rbd_mirror_peer_list_cleanup(self.peers, self.num_peers)
 */

static void __pyx_pf_3rbd_18MirrorPeerIterator_5__dealloc__(struct __pyx_obj_3rbd_MirrorPeerIterator *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "rbd.pyx":1234
 * 
 *     def __dealloc__(self):
 *         if self.peers:             # <<<<<<<<<<<<<<
 *             rbd_mirror_peer_list_cleanup(self.peers, self.num_peers)
 *             free(self.peers)
 */
  __pyx_t_1 = (__pyx_v_self->peers != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1235
 *     def __dealloc__(self):
 *         if self.peers:
 *             rbd_mirror_peer_list_cleanup(self.peers, self.num_peers)             # <<<<<<<<<<<<<<
 *             free(self.peers)
 * 
 */
    rbd_mirror_peer_list_cleanup(__pyx_v_self->peers, __pyx_v_self->num_peers);

    /* "rbd.pyx":1236
 *         if self.peers:
 *             rbd_mirror_peer_list_cleanup(self.peers, self.num_peers)
 *             free(self.peers)             # <<<<<<<<<<<<<<
 * 
 * cdef class MirrorImageStatusIterator(object):
 */
    free(__pyx_v_self->peers);
    goto __pyx_L3;
  }
  __pyx_L3:;

  __Pyx_RefNannyFinishContext();
}

/* Python wrapper */
static int __pyx_pw_3rbd_25MirrorImageStatusIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3rbd_25MirrorImageStatusIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ioctx = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__ioctx,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1267; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_ioctx = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1267; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.MirrorImageStatusIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_25MirrorImageStatusIterator___init__(((struct __pyx_obj_3rbd_MirrorImageStatusIterator *)__pyx_v_self), __pyx_v_ioctx);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1267
 *         size_t size
 * 
 *     def __init__(self, ioctx):             # <<<<<<<<<<<<<<
 *         self.ioctx = convert_ioctx(ioctx)
 *         self.max_read = 1024
 */

static int __pyx_pf_3rbd_25MirrorImageStatusIterator___init__(struct __pyx_obj_3rbd_MirrorImageStatusIterator *__pyx_v_self, PyObject *__pyx_v_ioctx) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  rados_ioctx_t __pyx_t_1;
  void *__pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "rbd.pyx":1268
 * 
 *     def __init__(self, ioctx):
 *         self.ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *         self.max_read = 1024
 *         self.last_read = strdup("")
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_1 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_self->ioctx = __pyx_t_1;

  /* "rbd.pyx":1269
 *     def __init__(self, ioctx):
 *         self.ioctx = convert_ioctx(ioctx)
 *         self.max_read = 1024             # <<<<<<<<<<<<<<
 *         self.last_read = strdup("")
 *         self.image_ids = <char **>realloc_chk(NULL,
 */
  __pyx_v_self->max_read = 1024;

  /* "rbd.pyx":1270
 *         self.ioctx = convert_ioctx(ioctx)
 *         self.max_read = 1024
 *         self.last_read = strdup("")             # <<<<<<<<<<<<<<
 *         self.image_ids = <char **>realloc_chk(NULL,
 *             sizeof(char *) * self.max_read)
 */
  __pyx_v_self->last_read = strdup(__pyx_k_33);

  /* "rbd.pyx":1272
 *         self.last_read = strdup("")
 *         self.image_ids = <char **>realloc_chk(NULL,
 *             sizeof(char *) * self.max_read)             # <<<<<<<<<<<<<<
 *         self.images = <rbd_mirror_image_status_t *>realloc_chk(NULL,
 *             sizeof(rbd_mirror_image_status_t) * self.max_read)
 */
  __pyx_t_2 = __pyx_f_3rbd_realloc_chk(NULL, ((sizeof(char *)) * __pyx_v_self->max_read)); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1271
 *         self.max_read = 1024
 *         self.last_read = strdup("")
 *         self.image_ids = <char **>realloc_chk(NULL,             # <<<<<<<<<<<<<<
 *             sizeof(char *) * self.max_read)
 *         self.images = <rbd_mirror_image_status_t *>realloc_chk(NULL,
 */
  __pyx_v_self->image_ids = ((char **)__pyx_t_2);

  /* "rbd.pyx":1274
 *             sizeof(char *) * self.max_read)
 *         self.images = <rbd_mirror_image_status_t *>realloc_chk(NULL,
 *             sizeof(rbd_mirror_image_status_t) * self.max_read)             # <<<<<<<<<<<<<<
 *         self.size = 0
 *         self.get_next_chunk()
 */
  __pyx_t_2 = __pyx_f_3rbd_realloc_chk(NULL, ((sizeof(rbd_mirror_image_status_t)) * __pyx_v_self->max_read)); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1273
 *         self.image_ids = <char **>realloc_chk(NULL,
 *             sizeof(char *) * self.max_read)
 *         self.images = <rbd_mirror_image_status_t *>realloc_chk(NULL,             # <<<<<<<<<<<<<<
 *             sizeof(rbd_mirror_image_status_t) * self.max_read)
 *         self.size = 0
 */
  __pyx_v_self->images = ((rbd_mirror_image_status_t *)__pyx_t_2);

  /* "rbd.pyx":1275
 *         self.images = <rbd_mirror_image_status_t *>realloc_chk(NULL,
 *             sizeof(rbd_mirror_image_status_t) * self.max_read)
 *         self.size = 0             # <<<<<<<<<<<<<<
 *         self.get_next_chunk()
 * 
 */
  __pyx_v_self->size = 0;

  /* "rbd.pyx":1276
 *             sizeof(rbd_mirror_image_status_t) * self.max_read)
 *         self.size = 0
 *         self.get_next_chunk()             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s__get_next_chunk); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1276; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1276; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.MirrorImageStatusIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_3rbd_25MirrorImageStatusIterator_4generator1(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_25MirrorImageStatusIterator_3__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_3rbd_25MirrorImageStatusIterator_3__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_25MirrorImageStatusIterator_2__iter__(((struct __pyx_obj_3rbd_MirrorImageStatusIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1278
 *         self.get_next_chunk()
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         while self.size > 0:
 *             for i in range(self.size):
 */

static PyObject *__pyx_pf_3rbd_25MirrorImageStatusIterator_2__iter__(struct __pyx_obj_3rbd_MirrorImageStatusIterator *__pyx_v_self) {
  struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *)__pyx_tp_new_3rbd___pyx_scope_struct_1___iter__(__pyx_ptype_3rbd___pyx_scope_struct_1___iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = __Pyx_Generator_New((__pyx_generator_body_t) __pyx_gb_3rbd_25MirrorImageStatusIterator_4generator1, (PyObject *) __pyx_cur_scope); if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("rbd.MirrorImageStatusIterator.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_3rbd_25MirrorImageStatusIterator_4generator1(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *__pyx_cur_scope = ((struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  size_t __pyx_t_2;
  size_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("None", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L8_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1279
 * 
 *     def __iter__(self):
 *         while self.size > 0:             # <<<<<<<<<<<<<<
 *             for i in range(self.size):
 *                 yield {
 */
  while (1) {
    __pyx_t_1 = (__pyx_cur_scope->__pyx_v_self->size > 0);
    if (!__pyx_t_1) break;

    /* "rbd.pyx":1280
 *     def __iter__(self):
 *         while self.size > 0:
 *             for i in range(self.size):             # <<<<<<<<<<<<<<
 *                 yield {
 *                     'name'        : decode_cstr(self.images[i].name),
 */
    __pyx_t_2 = __pyx_cur_scope->__pyx_v_self->size;
    for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
      __pyx_cur_scope->__pyx_v_i = __pyx_t_3;

      /* "rbd.pyx":1281
 *         while self.size > 0:
 *             for i in range(self.size):
 *                 yield {             # <<<<<<<<<<<<<<
 *                     'name'        : decode_cstr(self.images[i].name),
 *                     'info'        : {
 */
      __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_4));

      /* "rbd.pyx":1282
 *             for i in range(self.size):
 *                 yield {
 *                     'name'        : decode_cstr(self.images[i].name),             # <<<<<<<<<<<<<<
 *                     'info'        : {
 *                         'global_id' : decode_cstr(self.images[i].info.global_id),
 */
      __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->images[__pyx_cur_scope->__pyx_v_i]).name); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_6));
      __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, ((PyObject *)__pyx_t_6));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
      __pyx_t_6 = 0;
      __pyx_t_6 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_7), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
      if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__name), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "rbd.pyx":1283
 *                 yield {
 *                     'name'        : decode_cstr(self.images[i].name),
 *                     'info'        : {             # <<<<<<<<<<<<<<
 *                         'global_id' : decode_cstr(self.images[i].info.global_id),
 *                         'state'     : self.images[i].info.state,
 */
      __pyx_t_6 = PyDict_New(); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_6));

      /* "rbd.pyx":1284
 *                     'name'        : decode_cstr(self.images[i].name),
 *                     'info'        : {
 *                         'global_id' : decode_cstr(self.images[i].info.global_id),             # <<<<<<<<<<<<<<
 *                         'state'     : self.images[i].info.state,
 *                         },
 */
      __pyx_t_7 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_5 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->images[__pyx_cur_scope->__pyx_v_i]).info.global_id); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_5));
      __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, ((PyObject *)__pyx_t_5));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
      __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_Call(__pyx_t_7, ((PyObject *)__pyx_t_8), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
      if (PyDict_SetItem(__pyx_t_6, ((PyObject *)__pyx_n_s__global_id), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "rbd.pyx":1285
 *                     'info'        : {
 *                         'global_id' : decode_cstr(self.images[i].info.global_id),
 *                         'state'     : self.images[i].info.state,             # <<<<<<<<<<<<<<
 *                         },
 *                     'state'       : self.images[i].state,
 */
      __pyx_t_5 = PyInt_FromLong((__pyx_cur_scope->__pyx_v_self->images[__pyx_cur_scope->__pyx_v_i]).info.state); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      if (PyDict_SetItem(__pyx_t_6, ((PyObject *)__pyx_n_s__state), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__info), ((PyObject *)__pyx_t_6)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;

      /* "rbd.pyx":1287
 *                         'state'     : self.images[i].info.state,
 *                         },
 *                     'state'       : self.images[i].state,             # <<<<<<<<<<<<<<
 *                     'description' : decode_cstr(self.images[i].description),
 *                     'last_update' : datetime.fromtimestamp(self.images[i].last_update),
 */
      __pyx_t_6 = PyInt_FromLong((__pyx_cur_scope->__pyx_v_self->images[__pyx_cur_scope->__pyx_v_i]).state); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__state), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "rbd.pyx":1288
 *                         },
 *                     'state'       : self.images[i].state,
 *                     'description' : decode_cstr(self.images[i].description),             # <<<<<<<<<<<<<<
 *                     'last_update' : datetime.fromtimestamp(self.images[i].last_update),
 *                     'up'          : self.images[i].up,
 */
      __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->images[__pyx_cur_scope->__pyx_v_i]).description); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_5));
      __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, ((PyObject *)__pyx_t_5));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
      __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_8), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
      if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__description), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "rbd.pyx":1289
 *                     'state'       : self.images[i].state,
 *                     'description' : decode_cstr(self.images[i].description),
 *                     'last_update' : datetime.fromtimestamp(self.images[i].last_update),             # <<<<<<<<<<<<<<
 *                     'up'          : self.images[i].up,
 *                     }
 */
      __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__datetime); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s__fromtimestamp); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyInt_to_py_time_t((__pyx_cur_scope->__pyx_v_self->images[__pyx_cur_scope->__pyx_v_i]).last_update); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_Call(__pyx_t_8, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__last_update), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "rbd.pyx":1290
 *                     'description' : decode_cstr(self.images[i].description),
 *                     'last_update' : datetime.fromtimestamp(self.images[i].last_update),
 *                     'up'          : self.images[i].up,             # <<<<<<<<<<<<<<
 *                     }
 *             if self.size < self.max_read:
 */
      __pyx_t_5 = __Pyx_PyBool_FromLong((__pyx_cur_scope->__pyx_v_self->images[__pyx_cur_scope->__pyx_v_i]).up); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__up), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_r = ((PyObject *)__pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_3;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 1;
      return __pyx_r;
      __pyx_L8_resume_from_yield:;
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_0;
      __pyx_t_3 = __pyx_cur_scope->__pyx_t_1;
      if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }

    /* "rbd.pyx":1292
 *                     'up'          : self.images[i].up,
 *                     }
 *             if self.size < self.max_read:             # <<<<<<<<<<<<<<
 *                 break
 *             self.get_next_chunk()
 */
    __pyx_t_1 = (__pyx_cur_scope->__pyx_v_self->size < __pyx_cur_scope->__pyx_v_self->max_read);
    if (__pyx_t_1) {

      /* "rbd.pyx":1293
 *                     }
 *             if self.size < self.max_read:
 *                 break             # <<<<<<<<<<<<<<
 *             self.get_next_chunk()
 * 
 */
      goto __pyx_L5_break;
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "rbd.pyx":1294
 *             if self.size < self.max_read:
 *                 break
 *             self.get_next_chunk()             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s__get_next_chunk); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_L5_break:;
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_generator->resume_label = -1;
  __Pyx_Generator_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return NULL;
}

/* Python wrapper */
static void __pyx_pw_3rbd_25MirrorImageStatusIterator_6__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_3rbd_25MirrorImageStatusIterator_6__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_3rbd_25MirrorImageStatusIterator_5__dealloc__(((struct __pyx_obj_3rbd_MirrorImageStatusIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":1296
 *             self.get_next_chunk()
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         rbd_mirror_image_status_list_cleanup(self.image_ids, self.images,
 *                                              self.size)
 */

static void __pyx_pf_3rbd_25MirrorImageStatusIterator_5__dealloc__(struct __pyx_obj_3rbd_MirrorImageStatusIterator *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "rbd.pyx":1298
 *     def __dealloc__(self):
 *         rbd_mirror_image_status_list_cleanup(self.image_ids, self.images,
 *                                              self.size)             # <<<<<<<<<<<<<<
 *         if self.last_read:
 *             free(self.last_read)
 */
  rbd_mirror_image_status_list_cleanup(__pyx_v_self->image_ids, __pyx_v_self->images, __pyx_v_self->size);

  /* "rbd.pyx":1299
 *         rbd_mirror_image_status_list_cleanup(self.image_ids, self.images,
 *                                              self.size)
 *         if self.last_read:             # <<<<<<<<<<<<<<
 *             free(self.last_read)
 *         if self.image_ids:
 */
  __pyx_t_1 = (__pyx_v_self->last_read != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1300
 *                                              self.size)
 *         if self.last_read:
 *             free(self.last_read)             # <<<<<<<<<<<<<<
 *         if self.image_ids:
 *             free(self.image_ids)
 */
    free(__pyx_v_self->last_read);
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":1301
 *         if self.last_read:
 *             free(self.last_read)
 *         if self.image_ids:             # <<<<<<<<<<<<<<
 *             free(self.image_ids)
 *         if self.images:
 */
  __pyx_t_1 = (__pyx_v_self->image_ids != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1302
 *             free(self.last_read)
 *         if self.image_ids:
 *             free(self.image_ids)             # <<<<<<<<<<<<<<
 *         if self.images:
 *             free(self.images)
 */
    free(__pyx_v_self->image_ids);
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "rbd.pyx":1303
 *         if self.image_ids:
 *             free(self.image_ids)
 *         if self.images:             # <<<<<<<<<<<<<<
 *             free(self.images)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->images != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1304
 *             free(self.image_ids)
 *         if self.images:
 *             free(self.images)             # <<<<<<<<<<<<<<
 * 
 *     def get_next_chunk(self):
 */
    free(__pyx_v_self->images);
    goto __pyx_L5;
  }
  __pyx_L5:;

  __Pyx_RefNannyFinishContext();
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_25MirrorImageStatusIterator_8get_next_chunk(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_25MirrorImageStatusIterator_7get_next_chunk[] = "MirrorImageStatusIterator.get_next_chunk(self)";
static PyObject *__pyx_pw_3rbd_25MirrorImageStatusIterator_8get_next_chunk(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_next_chunk (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_25MirrorImageStatusIterator_7get_next_chunk(((struct __pyx_obj_3rbd_MirrorImageStatusIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1306
 *             free(self.images)
 * 
 *     def get_next_chunk(self):             # <<<<<<<<<<<<<<
 *         if self.size > 0:
 *             rbd_mirror_image_status_list_cleanup(self.image_ids, self.images,
 */

static PyObject *__pyx_pf_3rbd_25MirrorImageStatusIterator_7get_next_chunk(struct __pyx_obj_3rbd_MirrorImageStatusIterator *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_v_last_read = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  char const *__pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("get_next_chunk", 0);

  /* "rbd.pyx":1307
 * 
 *     def get_next_chunk(self):
 *         if self.size > 0:             # <<<<<<<<<<<<<<
 *             rbd_mirror_image_status_list_cleanup(self.image_ids, self.images,
 *                                                  self.size)
 */
  __pyx_t_1 = (__pyx_v_self->size > 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1309
 *         if self.size > 0:
 *             rbd_mirror_image_status_list_cleanup(self.image_ids, self.images,
 *                                                  self.size)             # <<<<<<<<<<<<<<
 *             self.size = 0
 *         with nogil:
 */
    rbd_mirror_image_status_list_cleanup(__pyx_v_self->image_ids, __pyx_v_self->images, __pyx_v_self->size);

    /* "rbd.pyx":1310
 *             rbd_mirror_image_status_list_cleanup(self.image_ids, self.images,
 *                                                  self.size)
 *             self.size = 0             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_mirror_image_status_list(self.ioctx, self.last_read,
 */
    __pyx_v_self->size = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":1311
 *                                                  self.size)
 *             self.size = 0
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_status_list(self.ioctx, self.last_read,
 *                                                self.max_read, self.image_ids,
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1314
 *             ret = rbd_mirror_image_status_list(self.ioctx, self.last_read,
 *                                                self.max_read, self.image_ids,
 *                                                self.images, &self.size)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error listing mirror images status')
 */
        __pyx_v_ret = rbd_mirror_image_status_list(__pyx_v_self->ioctx, __pyx_v_self->last_read, __pyx_v_self->max_read, __pyx_v_self->image_ids, __pyx_v_self->images, (&__pyx_v_self->size));
      }

      /* "rbd.pyx":1311
 *                                                  self.size)
 *             self.size = 0
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_status_list(self.ioctx, self.last_read,
 *                                                self.max_read, self.image_ids,
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1315
 *                                                self.max_read, self.image_ids,
 *                                                self.images, &self.size)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error listing mirror images status')
 *         if self.size > 0:
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1316
 *                                                self.images, &self.size)
 *         if ret < 0:
 *             raise make_ex(ret, 'error listing mirror images status')             # <<<<<<<<<<<<<<
 *         if self.size > 0:
 *             free(self.last_read)
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_kp_s_34)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "rbd.pyx":1317
 *         if ret < 0:
 *             raise make_ex(ret, 'error listing mirror images status')
 *         if self.size > 0:             # <<<<<<<<<<<<<<
 *             free(self.last_read)
 *             last_read = decode_cstr(self.image_ids[self.size - 1])
 */
  __pyx_t_1 = (__pyx_v_self->size > 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1318
 *             raise make_ex(ret, 'error listing mirror images status')
 *         if self.size > 0:
 *             free(self.last_read)             # <<<<<<<<<<<<<<
 *             last_read = decode_cstr(self.image_ids[self.size - 1])
 *             self.last_read = strdup(last_read)
 */
    free(__pyx_v_self->last_read);

    /* "rbd.pyx":1319
 *         if self.size > 0:
 *             free(self.last_read)
 *             last_read = decode_cstr(self.image_ids[self.size - 1])             # <<<<<<<<<<<<<<
 *             self.last_read = strdup(last_read)
 *         else:
 */
    __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyBytes_FromString((__pyx_v_self->image_ids[(__pyx_v_self->size - 1)])); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_t_2));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
    __pyx_t_2 = 0;
    __pyx_t_2 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_v_last_read = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "rbd.pyx":1320
 *             free(self.last_read)
 *             last_read = decode_cstr(self.image_ids[self.size - 1])
 *             self.last_read = strdup(last_read)             # <<<<<<<<<<<<<<
 *         else:
 *             free(self.last_read)
 */
    __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_last_read); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_self->last_read = strdup(__pyx_t_5);
    goto __pyx_L8;
  }
  /*else*/ {

    /* "rbd.pyx":1322
 *             self.last_read = strdup(last_read)
 *         else:
 *             free(self.last_read)             # <<<<<<<<<<<<<<
 *             self.last_read = strdup("")
 * 
 */
    free(__pyx_v_self->last_read);

    /* "rbd.pyx":1323
 *         else:
 *             free(self.last_read)
 *             self.last_read = strdup("")             # <<<<<<<<<<<<<<
 * 
 * cdef int diff_iterate_cb(uint64_t offset, size_t length, int write, void *cb) \
 */
    __pyx_v_self->last_read = strdup(__pyx_k_33);
  }
  __pyx_L8:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.MirrorImageStatusIterator.get_next_chunk", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_last_read);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1325
 *             self.last_read = strdup("")
 * 
 * cdef int diff_iterate_cb(uint64_t offset, size_t length, int write, void *cb) \             # <<<<<<<<<<<<<<
 *     except? -9000 with gil:
 *     # Make sure that if we wound up with an exception from a previous callback,
 */

static int __pyx_f_3rbd_diff_iterate_cb(uint64_t __pyx_v_offset, size_t __pyx_v_length, int __pyx_v_write, void *__pyx_v_cb) {
  PyObject *__pyx_v_ret = NULL;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  #ifdef WITH_THREAD
  PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
  #endif
  __Pyx_RefNannySetupContext("diff_iterate_cb", 0);

  /* "rbd.pyx":1330
 *     # we stop calling back (just in case librbd ever fails to bail out on the
 *     # first negative return, as older versions did)
 *     if exc.PyErr_Occurred():             # <<<<<<<<<<<<<<
 *         return -9000
 *     ret = (<object>cb)(offset, length, bool(write))
 */
  __pyx_t_1 = (PyErr_Occurred() != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1331
 *     # first negative return, as older versions did)
 *     if exc.PyErr_Occurred():
 *         return -9000             # <<<<<<<<<<<<<<
 *     ret = (<object>cb)(offset, length, bool(write))
 *     if ret is None:
 */
    __pyx_r = -9000;
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":1332
 *     if exc.PyErr_Occurred():
 *         return -9000
 *     ret = (<object>cb)(offset, length, bool(write))             # <<<<<<<<<<<<<<
 *     if ret is None:
 *         return 0
 */
  __pyx_t_2 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_offset); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_length); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyInt_FromLong(__pyx_v_write); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyBool_FromLong((!(!__pyx_t_1))); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(((PyObject *)__pyx_v_cb), ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  __pyx_v_ret = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "rbd.pyx":1333
 *         return -9000
 *     ret = (<object>cb)(offset, length, bool(write))
 *     if ret is None:             # <<<<<<<<<<<<<<
 *         return 0
 *     return ret
 */
  __pyx_t_1 = (__pyx_v_ret == Py_None);
  if (__pyx_t_1) {

    /* "rbd.pyx":1334
 *     ret = (<object>cb)(offset, length, bool(write))
 *     if ret is None:
 *         return 0             # <<<<<<<<<<<<<<
 *     return ret
 * 
 */
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "rbd.pyx":1335
 *     if ret is None:
 *         return 0
 *     return ret             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_6 = __Pyx_PyInt_AsInt(__pyx_v_ret); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_t_6;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.diff_iterate_cb", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -9000;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ret);
  __Pyx_RefNannyFinishContext();
  #ifdef WITH_THREAD
  PyGILState_Release(__pyx_gilstate_save);
  #endif
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_3rbd_5Image_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image___init__[] = "\n        Open the image at the given snapshot.\n        If a snapshot is specified, the image will be read-only, unless\n        :func:`Image.set_snap` is called later.\n\n        If read-only mode is used, metadata for the :class:`Image`\n        object (such as which snapshots exist) may become obsolete. See\n        the C api for more details.\n\n        To clean up from opening the image, :func:`Image.close` should\n        be called.  For ease of use, this is done automatically when\n        an :class:`Image` is used as a context manager (see :pep:`343`).\n\n        :param ioctx: determines which RADOS pool the image is in\n        :type ioctx: :class:`rados.Ioctx`\n        :param name: the name of the image\n        :type name: str\n        :param snapshot: which snapshot to read from\n        :type snaphshot: str\n        :param read_only: whether to open the image in read-only mode\n        :type read_only: bool\n        ";
#if CYTHON_COMPILING_IN_CPYTHON
struct wrapperbase __pyx_wrapperbase_3rbd_5Image___init__;
#endif
static int __pyx_pw_3rbd_5Image_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ioctx = 0;
  PyObject *__pyx_v_name = 0;
  PyObject *__pyx_v_snapshot = 0;
  PyObject *__pyx_v_read_only = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__ioctx,&__pyx_n_s__name,&__pyx_n_s__snapshot,&__pyx_n_s__read_only,0};
    PyObject* values[4] = {0,0,0,0};

    /* "rbd.pyx":1352
 *     cdef rados_ioctx_t _ioctx
 * 
 *     def __init__(self, ioctx, name, snapshot=None, read_only=False):             # <<<<<<<<<<<<<<
 *         """
 *         Open the image at the given snapshot.
 */
    values[2] = ((PyObject *)Py_None);
    values[3] = __pyx_k_35;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1352; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__snapshot);
          if (value) { values[2] = value; kw_args--; }
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__read_only);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1352; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_ioctx = values[0];
    __pyx_v_name = values[1];
    __pyx_v_snapshot = values[2];
    __pyx_v_read_only = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1352; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image___init__(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_ioctx, __pyx_v_name, __pyx_v_snapshot, __pyx_v_read_only);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_3rbd_5Image___init__(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_ioctx, PyObject *__pyx_v_name, PyObject *__pyx_v_snapshot, PyObject *__pyx_v_read_only) {
  rados_ioctx_t __pyx_v__ioctx;
  char *__pyx_v__name;
  char *__pyx_v__snapshot;
  int __pyx_v_ret;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  rados_ioctx_t __pyx_t_5;
  char *__pyx_t_6;
  int __pyx_t_7;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);
  __Pyx_INCREF(__pyx_v_name);
  __Pyx_INCREF(__pyx_v_snapshot);

  /* "rbd.pyx":1375
 *         :type read_only: bool
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         snapshot = cstr(snapshot, 'snapshot', opt=True)
 *         self.closed = True
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1376
 *         """
 *         name = cstr(name, 'name')
 *         snapshot = cstr(snapshot, 'snapshot', opt=True)             # <<<<<<<<<<<<<<
 *         self.closed = True
 *         self.name = name
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_snapshot);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_snapshot);
  __Pyx_GIVEREF(__pyx_v_snapshot);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__snapshot));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__snapshot));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__snapshot));
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_4 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__opt), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_snapshot);
  __pyx_v_snapshot = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "rbd.pyx":1377
 *         name = cstr(name, 'name')
 *         snapshot = cstr(snapshot, 'snapshot', opt=True)
 *         self.closed = True             # <<<<<<<<<<<<<<
 *         self.name = name
 *         # Keep around a reference to the ioctx, so it won't get deleted
 */
  __pyx_v_self->closed = 1;

  /* "rbd.pyx":1378
 *         snapshot = cstr(snapshot, 'snapshot', opt=True)
 *         self.closed = True
 *         self.name = name             # <<<<<<<<<<<<<<
 *         # Keep around a reference to the ioctx, so it won't get deleted
 *         self.ioctx = ioctx
 */
  __Pyx_INCREF(__pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_GOTREF(__pyx_v_self->name);
  __Pyx_DECREF(__pyx_v_self->name);
  __pyx_v_self->name = __pyx_v_name;

  /* "rbd.pyx":1380
 *         self.name = name
 *         # Keep around a reference to the ioctx, so it won't get deleted
 *         self.ioctx = ioctx             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 */
  __Pyx_INCREF(__pyx_v_ioctx);
  __Pyx_GIVEREF(__pyx_v_ioctx);
  __Pyx_GOTREF(__pyx_v_self->ioctx);
  __Pyx_DECREF(__pyx_v_self->ioctx);
  __pyx_v_self->ioctx = __pyx_v_ioctx;

  /* "rbd.pyx":1382
 *         self.ioctx = ioctx
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *             char *_name = name
 *             char *_snapshot = opt_str(snapshot)
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_5 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_5 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__ioctx = __pyx_t_5;

  /* "rbd.pyx":1383
 *         cdef:
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_name = name             # <<<<<<<<<<<<<<
 *             char *_snapshot = opt_str(snapshot)
 *         if read_only:
 */
  __pyx_t_6 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_6) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_6;

  /* "rbd.pyx":1384
 *             rados_ioctx_t _ioctx = convert_ioctx(ioctx)
 *             char *_name = name
 *             char *_snapshot = opt_str(snapshot)             # <<<<<<<<<<<<<<
 *         if read_only:
 *             with nogil:
 */
  __pyx_t_6 = __pyx_f_3rbd_opt_str(__pyx_v_snapshot); if (unlikely(__pyx_t_6 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__snapshot = __pyx_t_6;

  /* "rbd.pyx":1385
 *             char *_name = name
 *             char *_snapshot = opt_str(snapshot)
 *         if read_only:             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_open_read_only(_ioctx, _name, &self.image, _snapshot)
 */
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_read_only); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_7) {

    /* "rbd.pyx":1386
 *             char *_snapshot = opt_str(snapshot)
 *         if read_only:
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_open_read_only(_ioctx, _name, &self.image, _snapshot)
 *         else:
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":1387
 *         if read_only:
 *             with nogil:
 *                 ret = rbd_open_read_only(_ioctx, _name, &self.image, _snapshot)             # <<<<<<<<<<<<<<
 *         else:
 *             with nogil:
 */
          __pyx_v_ret = rbd_open_read_only(__pyx_v__ioctx, __pyx_v__name, (&__pyx_v_self->image), __pyx_v__snapshot);
        }

        /* "rbd.pyx":1386
 *             char *_snapshot = opt_str(snapshot)
 *         if read_only:
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_open_read_only(_ioctx, _name, &self.image, _snapshot)
 *         else:
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }
    goto __pyx_L3;
  }
  /*else*/ {

    /* "rbd.pyx":1389
 *                 ret = rbd_open_read_only(_ioctx, _name, &self.image, _snapshot)
 *         else:
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_open(_ioctx, _name, &self.image, _snapshot)
 *         if ret != 0:
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":1390
 *         else:
 *             with nogil:
 *                 ret = rbd_open(_ioctx, _name, &self.image, _snapshot)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error opening image %s at snapshot %s' % (name, snapshot))
 */
          __pyx_v_ret = rbd_open(__pyx_v__ioctx, __pyx_v__name, (&__pyx_v_self->image), __pyx_v__snapshot);
        }

        /* "rbd.pyx":1389
 *                 ret = rbd_open_read_only(_ioctx, _name, &self.image, _snapshot)
 *         else:
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_open(_ioctx, _name, &self.image, _snapshot)
 *         if ret != 0:
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }
  }
  __pyx_L3:;

  /* "rbd.pyx":1391
 *             with nogil:
 *                 ret = rbd_open(_ioctx, _name, &self.image, _snapshot)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error opening image %s at snapshot %s' % (name, snapshot))
 *         self.closed = False
 */
  __pyx_t_7 = (__pyx_v_ret != 0);
  if (__pyx_t_7) {

    /* "rbd.pyx":1392
 *                 ret = rbd_open(_ioctx, _name, &self.image, _snapshot)
 *         if ret != 0:
 *             raise make_ex(ret, 'error opening image %s at snapshot %s' % (name, snapshot))             # <<<<<<<<<<<<<<
 *         self.closed = False
 * 
 */
    __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_name);
    __Pyx_GIVEREF(__pyx_v_name);
    __Pyx_INCREF(__pyx_v_snapshot);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_snapshot);
    __Pyx_GIVEREF(__pyx_v_snapshot);
    __pyx_t_2 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_36), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = __pyx_f_3rbd_make_ex(__pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L10;
  }
  __pyx_L10:;

  /* "rbd.pyx":1393
 *         if ret != 0:
 *             raise make_ex(ret, 'error opening image %s at snapshot %s' % (name, snapshot))
 *         self.closed = False             # <<<<<<<<<<<<<<
 * 
 *     def __enter__(self):
 */
  __pyx_v_self->closed = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XDECREF(__pyx_v_snapshot);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_3__enter__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_2__enter__[] = "Image.__enter__(self)";
static PyObject *__pyx_pw_3rbd_5Image_3__enter__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__enter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_2__enter__(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1395
 *         self.closed = False
 * 
 *     def __enter__(self):             # <<<<<<<<<<<<<<
 *         return self
 * 
 */

static PyObject *__pyx_pf_3rbd_5Image_2__enter__(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__enter__", 0);

  /* "rbd.pyx":1396
 * 
 *     def __enter__(self):
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def __exit__(self, type_, value, traceback):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __pyx_r = ((PyObject *)__pyx_v_self);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_5__exit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_4__exit__[] = "Image.__exit__(self, type_, value, traceback)\n\n        Closes the image. See :func:`close`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_5__exit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_type_ = 0;
  CYTHON_UNUSED PyObject *__pyx_v_value = 0;
  CYTHON_UNUSED PyObject *__pyx_v_traceback = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__exit__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__type_,&__pyx_n_s__value,&__pyx_n_s__traceback,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__type_)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__value)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1398; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__traceback)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1398; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__exit__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1398; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_type_ = values[0];
    __pyx_v_value = values[1];
    __pyx_v_traceback = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1398; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.__exit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_4__exit__(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_type_, __pyx_v_value, __pyx_v_traceback);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1398
 *         return self
 * 
 *     def __exit__(self, type_, value, traceback):             # <<<<<<<<<<<<<<
 *         """
 *         Closes the image. See :func:`close`
 */

static PyObject *__pyx_pf_3rbd_5Image_4__exit__(struct __pyx_obj_3rbd_Image *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_type_, CYTHON_UNUSED PyObject *__pyx_v_value, CYTHON_UNUSED PyObject *__pyx_v_traceback) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__exit__", 0);

  /* "rbd.pyx":1402
 *         Closes the image. See :func:`close`
 *         """
 *         self.close()             # <<<<<<<<<<<<<<
 *         return False
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s__close); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":1403
 *         """
 *         self.close()
 *         return False             # <<<<<<<<<<<<<<
 * 
 *     def __get_completion(self, oncomplete):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.Image.__exit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_7__get_completion(PyObject *__pyx_v_self, PyObject *__pyx_v_oncomplete); /*proto*/
static char __pyx_doc_3rbd_5Image_6__get_completion[] = "Image.__get_completion(self, oncomplete)\n\n        Constructs a completion to use with asynchronous operations\n\n        :param oncomplete: callback for the completion\n\n        :raises: :class:`Error`\n        :returns: completion object\n        ";
static PyObject *__pyx_pw_3rbd_5Image_7__get_completion(PyObject *__pyx_v_self, PyObject *__pyx_v_oncomplete) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get_completion (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_6__get_completion(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_oncomplete));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1405
 *         return False
 * 
 *     def __get_completion(self, oncomplete):             # <<<<<<<<<<<<<<
 *         """
 *         Constructs a completion to use with asynchronous operations
 */

static PyObject *__pyx_pf_3rbd_5Image_6__get_completion(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_oncomplete) {
  struct __pyx_obj_3rbd_Completion *__pyx_v_completion_obj = NULL;
  rbd_completion_t __pyx_v_completion;
  PyObject *__pyx_v_p_completion_obj;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get_completion", 0);

  /* "rbd.pyx":1415
 *         """
 * 
 *         completion_obj = Completion(self, oncomplete)             # <<<<<<<<<<<<<<
 * 
 *         cdef:
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __Pyx_INCREF(__pyx_v_oncomplete);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_oncomplete);
  __Pyx_GIVEREF(__pyx_v_oncomplete);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_3rbd_Completion)), ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_v_completion_obj = ((struct __pyx_obj_3rbd_Completion *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "rbd.pyx":1419
 *         cdef:
 *             rbd_completion_t completion
 *             PyObject* p_completion_obj= <PyObject*>completion_obj             # <<<<<<<<<<<<<<
 * 
 *         with nogil:
 */
  __pyx_v_p_completion_obj = ((PyObject *)__pyx_v_completion_obj);

  /* "rbd.pyx":1421
 *             PyObject* p_completion_obj= <PyObject*>completion_obj
 * 
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_aio_create_completion(p_completion_obj, __aio_complete_cb,
 *                                             &completion)
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1423
 *         with nogil:
 *             ret = rbd_aio_create_completion(p_completion_obj, __aio_complete_cb,
 *                                             &completion)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, "error getting a completion")
 */
        __pyx_v_ret = rbd_aio_create_completion(__pyx_v_p_completion_obj, __pyx_f_3rbd___aio_complete_cb, (&__pyx_v_completion));
      }

      /* "rbd.pyx":1421
 *             PyObject* p_completion_obj= <PyObject*>completion_obj
 * 
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_aio_create_completion(p_completion_obj, __aio_complete_cb,
 *                                             &completion)
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1424
 *             ret = rbd_aio_create_completion(p_completion_obj, __aio_complete_cb,
 *                                             &completion)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, "error getting a completion")
 * 
 */
  __pyx_t_3 = (__pyx_v_ret < 0);
  if (__pyx_t_3) {

    /* "rbd.pyx":1425
 *                                             &completion)
 *         if ret < 0:
 *             raise make_ex(ret, "error getting a completion")             # <<<<<<<<<<<<<<
 * 
 *         completion_obj.rbd_comp = completion
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_kp_s_37)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1427
 *             raise make_ex(ret, "error getting a completion")
 * 
 *         completion_obj.rbd_comp = completion             # <<<<<<<<<<<<<<
 *         return completion_obj
 * 
 */
  __pyx_v_completion_obj->rbd_comp = __pyx_v_completion;

  /* "rbd.pyx":1428
 * 
 *         completion_obj.rbd_comp = completion
 *         return completion_obj             # <<<<<<<<<<<<<<
 * 
 *     def close(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_completion_obj));
  __pyx_r = ((PyObject *)__pyx_v_completion_obj);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.Image.__get_completion", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_completion_obj);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_9close(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_8close[] = "Image.close(self)\n\n        Release the resources used by this image object.\n\n        After this is called, this object should not be used.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_9close(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("close (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_8close(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1430
 *         return completion_obj
 * 
 *     def close(self):             # <<<<<<<<<<<<<<
 *         """
 *         Release the resources used by this image object.
 */

static PyObject *__pyx_pf_3rbd_5Image_8close(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("close", 0);

  /* "rbd.pyx":1436
 *         After this is called, this object should not be used.
 *         """
 *         if not self.closed:             # <<<<<<<<<<<<<<
 *             self.closed = True
 *             with nogil:
 */
  __pyx_t_1 = (!__pyx_v_self->closed);
  if (__pyx_t_1) {

    /* "rbd.pyx":1437
 *         """
 *         if not self.closed:
 *             self.closed = True             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_close(self.image)
 */
    __pyx_v_self->closed = 1;

    /* "rbd.pyx":1438
 *         if not self.closed:
 *             self.closed = True
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_close(self.image)
 *             if ret < 0:
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":1439
 *             self.closed = True
 *             with nogil:
 *                 ret = rbd_close(self.image)             # <<<<<<<<<<<<<<
 *             if ret < 0:
 *                 raise make_ex(ret, 'error while closing image %s' % (
 */
          __pyx_v_ret = rbd_close(__pyx_v_self->image);
        }

        /* "rbd.pyx":1438
 *         if not self.closed:
 *             self.closed = True
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_close(self.image)
 *             if ret < 0:
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }

    /* "rbd.pyx":1440
 *             with nogil:
 *                 ret = rbd_close(self.image)
 *             if ret < 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error while closing image %s' % (
 *                               self.name,))
 */
    __pyx_t_1 = (__pyx_v_ret < 0);
    if (__pyx_t_1) {

      /* "rbd.pyx":1441
 *                 ret = rbd_close(self.image)
 *             if ret < 0:
 *                 raise make_ex(ret, 'error while closing image %s' % (             # <<<<<<<<<<<<<<
 *                               self.name,))
 * 
 */
      __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);

      /* "rbd.pyx":1442
 *             if ret < 0:
 *                 raise make_ex(ret, 'error while closing image %s' % (
 *                               self.name,))             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_v_self->name);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
      __Pyx_GIVEREF(__pyx_v_self->name);
      __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_38), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_4));
      __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L7;
    }
    __pyx_L7:;
    goto __pyx_L3;
  }
  __pyx_L3:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.close", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static void __pyx_pw_3rbd_5Image_11__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_3rbd_5Image_11__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_3rbd_5Image_10__dealloc__(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":1444
 *                               self.name,))
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         self.close()
 * 
 */

static void __pyx_pf_3rbd_5Image_10__dealloc__(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "rbd.pyx":1445
 * 
 *     def __dealloc__(self):
 *         self.close()             # <<<<<<<<<<<<<<
 * 
 *     def __repr__(self):
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s__close); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.Image.__dealloc__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_13__repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_3rbd_5Image_13__repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_12__repr__(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1447
 *         self.close()
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         return "rbd.Image(ioctx, %r)" % self.name
 * 
 */

static PyObject *__pyx_pf_3rbd_5Image_12__repr__(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__repr__", 0);

  /* "rbd.pyx":1448
 * 
 *     def __repr__(self):
 *         return "rbd.Image(ioctx, %r)" % self.name             # <<<<<<<<<<<<<<
 * 
 *     def resize(self, size):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_39), __pyx_v_self->name); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_r = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("rbd.Image.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_15resize(PyObject *__pyx_v_self, PyObject *__pyx_v_size); /*proto*/
static char __pyx_doc_3rbd_5Image_14resize[] = "Image.resize(self, size)\n\n        Change the size of the image.\n\n        :param size: the new size of the image\n        :type size: int\n        ";
static PyObject *__pyx_pw_3rbd_5Image_15resize(PyObject *__pyx_v_self, PyObject *__pyx_v_size) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("resize (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_14resize(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_size));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1450
 *         return "rbd.Image(ioctx, %r)" % self.name
 * 
 *     def resize(self, size):             # <<<<<<<<<<<<<<
 *         """
 *         Change the size of the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_14resize(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_size) {
  uint64_t __pyx_v__size;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  uint64_t __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("resize", 0);

  /* "rbd.pyx":1457
 *         :type size: int
 *         """
 *         cdef uint64_t _size = size             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_resize(self.image, _size)
 */
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_size); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1457; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__size = __pyx_t_1;

  /* "rbd.pyx":1458
 *         """
 *         cdef uint64_t _size = size
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_resize(self.image, _size)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1459
 *         cdef uint64_t _size = size
 *         with nogil:
 *             ret = rbd_resize(self.image, _size)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error resizing image %s' % (self.name,))
 */
        __pyx_v_ret = rbd_resize(__pyx_v_self->image, __pyx_v__size);
      }

      /* "rbd.pyx":1458
 *         """
 *         cdef uint64_t _size = size
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_resize(self.image, _size)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1460
 *         with nogil:
 *             ret = rbd_resize(self.image, _size)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error resizing image %s' % (self.name,))
 * 
 */
  __pyx_t_2 = (__pyx_v_ret < 0);
  if (__pyx_t_2) {

    /* "rbd.pyx":1461
 *             ret = rbd_resize(self.image, _size)
 *         if ret < 0:
 *             raise make_ex(ret, 'error resizing image %s' % (self.name,))             # <<<<<<<<<<<<<<
 * 
 *     def stat(self):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_5 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_40), ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_5)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.Image.resize", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_17stat(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_16stat[] = "Image.stat(self)\n\n        Get information about the image. Currently parent pool and\n        parent name are always -1 and ''.\n\n        :returns: dict - contains the following keys:\n\n            * ``size`` (int) - the size of the image in bytes\n\n            * ``obj_size`` (int) - the size of each object that comprises the\n              image\n\n            * ``num_objs`` (int) - the number of objects in the image\n\n            * ``order`` (int) - log_2(object_size)\n\n            * ``block_name_prefix`` (str) - the prefix of the RADOS objects used\n              to store the image\n\n            * ``parent_pool`` (int) - deprecated\n\n            * ``parent_name``  (str) - deprecated\n\n            See also :meth:`format` and :meth:`features`.\n\n        ";
static PyObject *__pyx_pw_3rbd_5Image_17stat(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("stat (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_16stat(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1463
 *             raise make_ex(ret, 'error resizing image %s' % (self.name,))
 * 
 *     def stat(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get information about the image. Currently parent pool and
 */

static PyObject *__pyx_pf_3rbd_5Image_16stat(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  rbd_image_info_t __pyx_v_info;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("stat", 0);

  /* "rbd.pyx":1490
 *         """
 *         cdef rbd_image_info_t info
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_stat(self.image, &info, sizeof(info))
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1491
 *         cdef rbd_image_info_t info
 *         with nogil:
 *             ret = rbd_stat(self.image, &info, sizeof(info))             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting info for image %s' % (self.name,))
 */
        __pyx_v_ret = rbd_stat(__pyx_v_self->image, (&__pyx_v_info), (sizeof(__pyx_v_info)));
      }

      /* "rbd.pyx":1490
 *         """
 *         cdef rbd_image_info_t info
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_stat(self.image, &info, sizeof(info))
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1492
 *         with nogil:
 *             ret = rbd_stat(self.image, &info, sizeof(info))
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting info for image %s' % (self.name,))
 *         return {
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1493
 *             ret = rbd_stat(self.image, &info, sizeof(info))
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting info for image %s' % (self.name,))             # <<<<<<<<<<<<<<
 *         return {
 *             'size'              : info.size,
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_41), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1494
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting info for image %s' % (self.name,))
 *         return {             # <<<<<<<<<<<<<<
 *             'size'              : info.size,
 *             'obj_size'          : info.obj_size,
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));

  /* "rbd.pyx":1495
 *             raise make_ex(ret, 'error getting info for image %s' % (self.name,))
 *         return {
 *             'size'              : info.size,             # <<<<<<<<<<<<<<
 *             'obj_size'          : info.obj_size,
 *             'num_objs'          : info.num_objs,
 */
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_info.size); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__size), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "rbd.pyx":1496
 *         return {
 *             'size'              : info.size,
 *             'obj_size'          : info.obj_size,             # <<<<<<<<<<<<<<
 *             'num_objs'          : info.num_objs,
 *             'order'             : info.order,
 */
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_info.obj_size); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1496; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__obj_size), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "rbd.pyx":1497
 *             'size'              : info.size,
 *             'obj_size'          : info.obj_size,
 *             'num_objs'          : info.num_objs,             # <<<<<<<<<<<<<<
 *             'order'             : info.order,
 *             'block_name_prefix' : decode_cstr(info.block_name_prefix),
 */
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_info.num_objs); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1497; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__num_objs), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "rbd.pyx":1498
 *             'obj_size'          : info.obj_size,
 *             'num_objs'          : info.num_objs,
 *             'order'             : info.order,             # <<<<<<<<<<<<<<
 *             'block_name_prefix' : decode_cstr(info.block_name_prefix),
 *             'parent_pool'       : info.parent_pool,
 */
  __pyx_t_4 = PyInt_FromLong(__pyx_v_info.order); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__order), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "rbd.pyx":1499
 *             'num_objs'          : info.num_objs,
 *             'order'             : info.order,
 *             'block_name_prefix' : decode_cstr(info.block_name_prefix),             # <<<<<<<<<<<<<<
 *             'parent_pool'       : info.parent_pool,
 *             'parent_name'       : info.parent_name
 */
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_info.block_name_prefix); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_2));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1499; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__block_name_prefix), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":1500
 *             'order'             : info.order,
 *             'block_name_prefix' : decode_cstr(info.block_name_prefix),
 *             'parent_pool'       : info.parent_pool,             # <<<<<<<<<<<<<<
 *             'parent_name'       : info.parent_name
 *             }
 */
  __pyx_t_2 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_info.parent_pool); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__parent_pool), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":1501
 *             'block_name_prefix' : decode_cstr(info.block_name_prefix),
 *             'parent_pool'       : info.parent_pool,
 *             'parent_name'       : info.parent_name             # <<<<<<<<<<<<<<
 *             }
 * 
 */
  __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_info.parent_name); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__parent_name), ((PyObject *)__pyx_t_2)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = ((PyObject *)__pyx_t_3);
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.Image.stat", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_19id(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_18id[] = "Image.id(self)\n\n        Get the RBD v2 internal image id\n\n        :returns: str - image id\n        ";
static PyObject *__pyx_pw_3rbd_5Image_19id(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("id (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_18id(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1504
 *             }
 * 
 *     def id(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the RBD v2 internal image id
 */

static PyObject *__pyx_pf_3rbd_5Image_18id(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  size_t __pyx_v_size;
  char *__pyx_v_image_id;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  void *__pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("id", 0);

  /* "rbd.pyx":1511
 *         """
 *         cdef:
 *             int ret = -errno.ERANGE             # <<<<<<<<<<<<<<
 *             size_t size = 32
 *             char *image_id = NULL
 */
  __pyx_v_ret = (-ERANGE);

  /* "rbd.pyx":1512
 *         cdef:
 *             int ret = -errno.ERANGE
 *             size_t size = 32             # <<<<<<<<<<<<<<
 *             char *image_id = NULL
 *         try:
 */
  __pyx_v_size = 32;

  /* "rbd.pyx":1513
 *             int ret = -errno.ERANGE
 *             size_t size = 32
 *             char *image_id = NULL             # <<<<<<<<<<<<<<
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:
 */
  __pyx_v_image_id = NULL;

  /* "rbd.pyx":1514
 *             size_t size = 32
 *             char *image_id = NULL
 *         try:             # <<<<<<<<<<<<<<
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 image_id =  <char *>realloc_chk(image_id, size)
 */
  /*try:*/ {

    /* "rbd.pyx":1515
 *             char *image_id = NULL
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:             # <<<<<<<<<<<<<<
 *                 image_id =  <char *>realloc_chk(image_id, size)
 *                 with nogil:
 */
    while (1) {
      __pyx_t_1 = (__pyx_v_ret == (-ERANGE));
      if (__pyx_t_1) {
        __pyx_t_2 = (__pyx_v_size <= 4096);
        __pyx_t_3 = __pyx_t_2;
      } else {
        __pyx_t_3 = __pyx_t_1;
      }
      if (!__pyx_t_3) break;

      /* "rbd.pyx":1516
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 image_id =  <char *>realloc_chk(image_id, size)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_get_id(self.image, image_id, size)
 */
      __pyx_t_4 = __pyx_f_3rbd_realloc_chk(__pyx_v_image_id, __pyx_v_size); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_image_id = ((char *)__pyx_t_4);

      /* "rbd.pyx":1517
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 image_id =  <char *>realloc_chk(image_id, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_get_id(self.image, image_id, size)
 *                 if ret == -errno.ERANGE:
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":1518
 *                 image_id =  <char *>realloc_chk(image_id, size)
 *                 with nogil:
 *                     ret = rbd_get_id(self.image, image_id, size)             # <<<<<<<<<<<<<<
 *                 if ret == -errno.ERANGE:
 *                     size *= 2
 */
            __pyx_v_ret = rbd_get_id(__pyx_v_self->image, __pyx_v_image_id, __pyx_v_size);
          }

          /* "rbd.pyx":1517
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 image_id =  <char *>realloc_chk(image_id, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_get_id(self.image, image_id, size)
 *                 if ret == -errno.ERANGE:
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":1519
 *                 with nogil:
 *                     ret = rbd_get_id(self.image, image_id, size)
 *                 if ret == -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     size *= 2
 * 
 */
      __pyx_t_3 = (__pyx_v_ret == (-ERANGE));
      if (__pyx_t_3) {

        /* "rbd.pyx":1520
 *                     ret = rbd_get_id(self.image, image_id, size)
 *                 if ret == -errno.ERANGE:
 *                     size *= 2             # <<<<<<<<<<<<<<
 * 
 *             if ret != 0:
 */
        __pyx_v_size = (__pyx_v_size * 2);
        goto __pyx_L13;
      }
      __pyx_L13:;
    }

    /* "rbd.pyx":1522
 *                     size *= 2
 * 
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error getting id for image %s' % (self.name,))
 *             return decode_cstr(image_id)
 */
    __pyx_t_3 = (__pyx_v_ret != 0);
    if (__pyx_t_3) {

      /* "rbd.pyx":1523
 * 
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting id for image %s' % (self.name,))             # <<<<<<<<<<<<<<
 *             return decode_cstr(image_id)
 *         finally:
 */
      __pyx_t_5 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_v_self->name);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_self->name);
      __Pyx_GIVEREF(__pyx_v_self->name);
      __pyx_t_7 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_42), ((PyObject *)__pyx_t_6)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_7));
      __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      __pyx_t_6 = __pyx_f_3rbd_make_ex(__pyx_t_5, ((PyObject *)__pyx_t_7)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
      __Pyx_Raise(__pyx_t_6, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "rbd.pyx":1524
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting id for image %s' % (self.name,))
 *             return decode_cstr(image_id)             # <<<<<<<<<<<<<<
 *         finally:
 *             free(image_id)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1524; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyBytes_FromString(__pyx_v_image_id); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1524; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_7));
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1524; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_7));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_7));
    __pyx_t_7 = 0;
    __pyx_t_7 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1524; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_7;
    __pyx_t_7 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":1526
 *             return decode_cstr(image_id)
 *         finally:
 *             free(image_id)             # <<<<<<<<<<<<<<
 * 
 *     def block_name_prefix(self):
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_image_id);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("rbd.Image.id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_21block_name_prefix(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_20block_name_prefix[] = "Image.block_name_prefix(self)\n\n        Get the RBD block name prefix\n\n        :returns: str - block name prefix\n        ";
static PyObject *__pyx_pw_3rbd_5Image_21block_name_prefix(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("block_name_prefix (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_20block_name_prefix(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1528
 *             free(image_id)
 * 
 *     def block_name_prefix(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the RBD block name prefix
 */

static PyObject *__pyx_pf_3rbd_5Image_20block_name_prefix(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  size_t __pyx_v_size;
  char *__pyx_v_prefix;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  void *__pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("block_name_prefix", 0);

  /* "rbd.pyx":1535
 *         """
 *         cdef:
 *             int ret = -errno.ERANGE             # <<<<<<<<<<<<<<
 *             size_t size = 32
 *             char *prefix = NULL
 */
  __pyx_v_ret = (-ERANGE);

  /* "rbd.pyx":1536
 *         cdef:
 *             int ret = -errno.ERANGE
 *             size_t size = 32             # <<<<<<<<<<<<<<
 *             char *prefix = NULL
 *         try:
 */
  __pyx_v_size = 32;

  /* "rbd.pyx":1537
 *             int ret = -errno.ERANGE
 *             size_t size = 32
 *             char *prefix = NULL             # <<<<<<<<<<<<<<
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:
 */
  __pyx_v_prefix = NULL;

  /* "rbd.pyx":1538
 *             size_t size = 32
 *             char *prefix = NULL
 *         try:             # <<<<<<<<<<<<<<
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 prefix =  <char *>realloc_chk(prefix, size)
 */
  /*try:*/ {

    /* "rbd.pyx":1539
 *             char *prefix = NULL
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:             # <<<<<<<<<<<<<<
 *                 prefix =  <char *>realloc_chk(prefix, size)
 *                 with nogil:
 */
    while (1) {
      __pyx_t_1 = (__pyx_v_ret == (-ERANGE));
      if (__pyx_t_1) {
        __pyx_t_2 = (__pyx_v_size <= 4096);
        __pyx_t_3 = __pyx_t_2;
      } else {
        __pyx_t_3 = __pyx_t_1;
      }
      if (!__pyx_t_3) break;

      /* "rbd.pyx":1540
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 prefix =  <char *>realloc_chk(prefix, size)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_get_block_name_prefix(self.image, prefix, size)
 */
      __pyx_t_4 = __pyx_f_3rbd_realloc_chk(__pyx_v_prefix, __pyx_v_size); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1540; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_prefix = ((char *)__pyx_t_4);

      /* "rbd.pyx":1541
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 prefix =  <char *>realloc_chk(prefix, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_get_block_name_prefix(self.image, prefix, size)
 *                 if ret == -errno.ERANGE:
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":1542
 *                 prefix =  <char *>realloc_chk(prefix, size)
 *                 with nogil:
 *                     ret = rbd_get_block_name_prefix(self.image, prefix, size)             # <<<<<<<<<<<<<<
 *                 if ret == -errno.ERANGE:
 *                     size *= 2
 */
            __pyx_v_ret = rbd_get_block_name_prefix(__pyx_v_self->image, __pyx_v_prefix, __pyx_v_size);
          }

          /* "rbd.pyx":1541
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 prefix =  <char *>realloc_chk(prefix, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_get_block_name_prefix(self.image, prefix, size)
 *                 if ret == -errno.ERANGE:
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":1543
 *                 with nogil:
 *                     ret = rbd_get_block_name_prefix(self.image, prefix, size)
 *                 if ret == -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     size *= 2
 * 
 */
      __pyx_t_3 = (__pyx_v_ret == (-ERANGE));
      if (__pyx_t_3) {

        /* "rbd.pyx":1544
 *                     ret = rbd_get_block_name_prefix(self.image, prefix, size)
 *                 if ret == -errno.ERANGE:
 *                     size *= 2             # <<<<<<<<<<<<<<
 * 
 *             if ret != 0:
 */
        __pyx_v_size = (__pyx_v_size * 2);
        goto __pyx_L13;
      }
      __pyx_L13:;
    }

    /* "rbd.pyx":1546
 *                     size *= 2
 * 
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error getting block name prefix for image %s' % (self.name,))
 *             return decode_cstr(prefix)
 */
    __pyx_t_3 = (__pyx_v_ret != 0);
    if (__pyx_t_3) {

      /* "rbd.pyx":1547
 * 
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting block name prefix for image %s' % (self.name,))             # <<<<<<<<<<<<<<
 *             return decode_cstr(prefix)
 *         finally:
 */
      __pyx_t_5 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1547; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1547; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_v_self->name);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_self->name);
      __Pyx_GIVEREF(__pyx_v_self->name);
      __pyx_t_7 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_43), ((PyObject *)__pyx_t_6)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1547; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_7));
      __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      __pyx_t_6 = __pyx_f_3rbd_make_ex(__pyx_t_5, ((PyObject *)__pyx_t_7)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1547; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
      __Pyx_Raise(__pyx_t_6, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1547; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "rbd.pyx":1548
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting block name prefix for image %s' % (self.name,))
 *             return decode_cstr(prefix)             # <<<<<<<<<<<<<<
 *         finally:
 *             free(prefix)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1548; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyBytes_FromString(__pyx_v_prefix); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1548; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_7));
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1548; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_7));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_7));
    __pyx_t_7 = 0;
    __pyx_t_7 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1548; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_7;
    __pyx_t_7 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":1550
 *             return decode_cstr(prefix)
 *         finally:
 *             free(prefix)             # <<<<<<<<<<<<<<
 * 
 *     def parent_info(self):
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_prefix);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("rbd.Image.block_name_prefix", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_23parent_info(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_22parent_info[] = "Image.parent_info(self)\n\n        Get information about a cloned image's parent (if any)\n\n        :returns: tuple - ``(pool name, image name, snapshot name)`` components\n                  of the parent image\n        :raises: :class:`ImageNotFound` if the image doesn't have a parent\n        ";
static PyObject *__pyx_pw_3rbd_5Image_23parent_info(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("parent_info (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_22parent_info(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1552
 *             free(prefix)
 * 
 *     def parent_info(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get information about a cloned image's parent (if any)
 */

static PyObject *__pyx_pf_3rbd_5Image_22parent_info(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  size_t __pyx_v_size;
  char *__pyx_v_pool;
  char *__pyx_v_name;
  char *__pyx_v_snapname;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  void *__pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("parent_info", 0);

  /* "rbd.pyx":1561
 *         """
 *         cdef:
 *             int ret = -errno.ERANGE             # <<<<<<<<<<<<<<
 *             size_t size = 8
 *             char *pool = NULL
 */
  __pyx_v_ret = (-ERANGE);

  /* "rbd.pyx":1562
 *         cdef:
 *             int ret = -errno.ERANGE
 *             size_t size = 8             # <<<<<<<<<<<<<<
 *             char *pool = NULL
 *             char *name = NULL
 */
  __pyx_v_size = 8;

  /* "rbd.pyx":1563
 *             int ret = -errno.ERANGE
 *             size_t size = 8
 *             char *pool = NULL             # <<<<<<<<<<<<<<
 *             char *name = NULL
 *             char *snapname = NULL
 */
  __pyx_v_pool = NULL;

  /* "rbd.pyx":1564
 *             size_t size = 8
 *             char *pool = NULL
 *             char *name = NULL             # <<<<<<<<<<<<<<
 *             char *snapname = NULL
 *         try:
 */
  __pyx_v_name = NULL;

  /* "rbd.pyx":1565
 *             char *pool = NULL
 *             char *name = NULL
 *             char *snapname = NULL             # <<<<<<<<<<<<<<
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:
 */
  __pyx_v_snapname = NULL;

  /* "rbd.pyx":1566
 *             char *name = NULL
 *             char *snapname = NULL
 *         try:             # <<<<<<<<<<<<<<
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 pool = <char *>realloc_chk(pool, size)
 */
  /*try:*/ {

    /* "rbd.pyx":1567
 *             char *snapname = NULL
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:             # <<<<<<<<<<<<<<
 *                 pool = <char *>realloc_chk(pool, size)
 *                 name = <char *>realloc_chk(name, size)
 */
    while (1) {
      __pyx_t_1 = (__pyx_v_ret == (-ERANGE));
      if (__pyx_t_1) {
        __pyx_t_2 = (__pyx_v_size <= 4096);
        __pyx_t_3 = __pyx_t_2;
      } else {
        __pyx_t_3 = __pyx_t_1;
      }
      if (!__pyx_t_3) break;

      /* "rbd.pyx":1568
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 pool = <char *>realloc_chk(pool, size)             # <<<<<<<<<<<<<<
 *                 name = <char *>realloc_chk(name, size)
 *                 snapname = <char *>realloc_chk(snapname, size)
 */
      __pyx_t_4 = __pyx_f_3rbd_realloc_chk(__pyx_v_pool, __pyx_v_size); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1568; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_pool = ((char *)__pyx_t_4);

      /* "rbd.pyx":1569
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 pool = <char *>realloc_chk(pool, size)
 *                 name = <char *>realloc_chk(name, size)             # <<<<<<<<<<<<<<
 *                 snapname = <char *>realloc_chk(snapname, size)
 *                 with nogil:
 */
      __pyx_t_4 = __pyx_f_3rbd_realloc_chk(__pyx_v_name, __pyx_v_size); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1569; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_name = ((char *)__pyx_t_4);

      /* "rbd.pyx":1570
 *                 pool = <char *>realloc_chk(pool, size)
 *                 name = <char *>realloc_chk(name, size)
 *                 snapname = <char *>realloc_chk(snapname, size)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_get_parent_info2(self.image, pool, size, name,
 */
      __pyx_t_4 = __pyx_f_3rbd_realloc_chk(__pyx_v_snapname, __pyx_v_size); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1570; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_snapname = ((char *)__pyx_t_4);

      /* "rbd.pyx":1571
 *                 name = <char *>realloc_chk(name, size)
 *                 snapname = <char *>realloc_chk(snapname, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_get_parent_info2(self.image, pool, size, name,
 *                                                size, NULL, 0, snapname, size)
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":1573
 *                 with nogil:
 *                     ret = rbd_get_parent_info2(self.image, pool, size, name,
 *                                                size, NULL, 0, snapname, size)             # <<<<<<<<<<<<<<
 *                 if ret == -errno.ERANGE:
 *                     size *= 2
 */
            __pyx_v_ret = rbd_get_parent_info2(__pyx_v_self->image, __pyx_v_pool, __pyx_v_size, __pyx_v_name, __pyx_v_size, NULL, 0, __pyx_v_snapname, __pyx_v_size);
          }

          /* "rbd.pyx":1571
 *                 name = <char *>realloc_chk(name, size)
 *                 snapname = <char *>realloc_chk(snapname, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_get_parent_info2(self.image, pool, size, name,
 *                                                size, NULL, 0, snapname, size)
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":1574
 *                     ret = rbd_get_parent_info2(self.image, pool, size, name,
 *                                                size, NULL, 0, snapname, size)
 *                 if ret == -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     size *= 2
 * 
 */
      __pyx_t_3 = (__pyx_v_ret == (-ERANGE));
      if (__pyx_t_3) {

        /* "rbd.pyx":1575
 *                                                size, NULL, 0, snapname, size)
 *                 if ret == -errno.ERANGE:
 *                     size *= 2             # <<<<<<<<<<<<<<
 * 
 *             if ret != 0:
 */
        __pyx_v_size = (__pyx_v_size * 2);
        goto __pyx_L13;
      }
      __pyx_L13:;
    }

    /* "rbd.pyx":1577
 *                     size *= 2
 * 
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error getting parent info for image %s' % (self.name,))
 *             return (decode_cstr(pool), decode_cstr(name), decode_cstr(snapname))
 */
    __pyx_t_3 = (__pyx_v_ret != 0);
    if (__pyx_t_3) {

      /* "rbd.pyx":1578
 * 
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting parent info for image %s' % (self.name,))             # <<<<<<<<<<<<<<
 *             return (decode_cstr(pool), decode_cstr(name), decode_cstr(snapname))
 *         finally:
 */
      __pyx_t_5 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1578; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1578; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_v_self->name);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_self->name);
      __Pyx_GIVEREF(__pyx_v_self->name);
      __pyx_t_7 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_44), ((PyObject *)__pyx_t_6)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1578; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_7));
      __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      __pyx_t_6 = __pyx_f_3rbd_make_ex(__pyx_t_5, ((PyObject *)__pyx_t_7)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1578; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
      __Pyx_Raise(__pyx_t_6, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1578; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "rbd.pyx":1579
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting parent info for image %s' % (self.name,))
 *             return (decode_cstr(pool), decode_cstr(name), decode_cstr(snapname))             # <<<<<<<<<<<<<<
 *         finally:
 *             free(pool)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyBytes_FromString(__pyx_v_pool); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_7));
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_7));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_7));
    __pyx_t_7 = 0;
    __pyx_t_7 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_6));
    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_8, 0, ((PyObject *)__pyx_t_6));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
    __pyx_t_6 = 0;
    __pyx_t_6 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_8), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    __pyx_t_8 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_5 = __Pyx_PyBytes_FromString(__pyx_v_snapname); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_9, 0, ((PyObject *)__pyx_t_5));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_8, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_9, 2, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_7 = 0;
    __pyx_t_6 = 0;
    __pyx_t_5 = 0;
    __pyx_r = ((PyObject *)__pyx_t_9);
    __pyx_t_9 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":1581
 *             return (decode_cstr(pool), decode_cstr(name), decode_cstr(snapname))
 *         finally:
 *             free(pool)             # <<<<<<<<<<<<<<
 *             free(name)
 *             free(snapname)
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_pool);

    /* "rbd.pyx":1582
 *         finally:
 *             free(pool)
 *             free(name)             # <<<<<<<<<<<<<<
 *             free(snapname)
 * 
 */
    free(__pyx_v_name);

    /* "rbd.pyx":1583
 *             free(pool)
 *             free(name)
 *             free(snapname)             # <<<<<<<<<<<<<<
 * 
 *     def parent_id(self):
 */
    free(__pyx_v_snapname);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("rbd.Image.parent_info", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_25parent_id(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_24parent_id[] = "Image.parent_id(self)\n\n        Get image id of a cloned image's parent (if any)\n\n        :returns: str - the parent id\n        :raises: :class:`ImageNotFound` if the image doesn't have a parent\n        ";
static PyObject *__pyx_pw_3rbd_5Image_25parent_id(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("parent_id (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_24parent_id(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1585
 *             free(snapname)
 * 
 *     def parent_id(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get image id of a cloned image's parent (if any)
 */

static PyObject *__pyx_pf_3rbd_5Image_24parent_id(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  size_t __pyx_v_size;
  char *__pyx_v_parent_id;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  void *__pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("parent_id", 0);

  /* "rbd.pyx":1593
 *         """
 *         cdef:
 *             int ret = -errno.ERANGE             # <<<<<<<<<<<<<<
 *             size_t size = 32
 *             char *parent_id = NULL
 */
  __pyx_v_ret = (-ERANGE);

  /* "rbd.pyx":1594
 *         cdef:
 *             int ret = -errno.ERANGE
 *             size_t size = 32             # <<<<<<<<<<<<<<
 *             char *parent_id = NULL
 *         try:
 */
  __pyx_v_size = 32;

  /* "rbd.pyx":1595
 *             int ret = -errno.ERANGE
 *             size_t size = 32
 *             char *parent_id = NULL             # <<<<<<<<<<<<<<
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:
 */
  __pyx_v_parent_id = NULL;

  /* "rbd.pyx":1596
 *             size_t size = 32
 *             char *parent_id = NULL
 *         try:             # <<<<<<<<<<<<<<
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 parent_id = <char *>realloc_chk(parent_id, size)
 */
  /*try:*/ {

    /* "rbd.pyx":1597
 *             char *parent_id = NULL
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:             # <<<<<<<<<<<<<<
 *                 parent_id = <char *>realloc_chk(parent_id, size)
 *                 with nogil:
 */
    while (1) {
      __pyx_t_1 = (__pyx_v_ret == (-ERANGE));
      if (__pyx_t_1) {
        __pyx_t_2 = (__pyx_v_size <= 4096);
        __pyx_t_3 = __pyx_t_2;
      } else {
        __pyx_t_3 = __pyx_t_1;
      }
      if (!__pyx_t_3) break;

      /* "rbd.pyx":1598
 *         try:
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 parent_id = <char *>realloc_chk(parent_id, size)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_get_parent_info2(self.image, NULL, 0, NULL, 0,
 */
      __pyx_t_4 = __pyx_f_3rbd_realloc_chk(__pyx_v_parent_id, __pyx_v_size); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1598; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_parent_id = ((char *)__pyx_t_4);

      /* "rbd.pyx":1599
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 parent_id = <char *>realloc_chk(parent_id, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_get_parent_info2(self.image, NULL, 0, NULL, 0,
 *                                                parent_id, size, NULL, 0)
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":1601
 *                 with nogil:
 *                     ret = rbd_get_parent_info2(self.image, NULL, 0, NULL, 0,
 *                                                parent_id, size, NULL, 0)             # <<<<<<<<<<<<<<
 *                 if ret == -errno.ERANGE:
 *                     size *= 2
 */
            __pyx_v_ret = rbd_get_parent_info2(__pyx_v_self->image, NULL, 0, NULL, 0, __pyx_v_parent_id, __pyx_v_size, NULL, 0);
          }

          /* "rbd.pyx":1599
 *             while ret == -errno.ERANGE and size <= 4096:
 *                 parent_id = <char *>realloc_chk(parent_id, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_get_parent_info2(self.image, NULL, 0, NULL, 0,
 *                                                parent_id, size, NULL, 0)
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":1602
 *                     ret = rbd_get_parent_info2(self.image, NULL, 0, NULL, 0,
 *                                                parent_id, size, NULL, 0)
 *                 if ret == -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     size *= 2
 * 
 */
      __pyx_t_3 = (__pyx_v_ret == (-ERANGE));
      if (__pyx_t_3) {

        /* "rbd.pyx":1603
 *                                                parent_id, size, NULL, 0)
 *                 if ret == -errno.ERANGE:
 *                     size *= 2             # <<<<<<<<<<<<<<
 * 
 *             if ret != 0:
 */
        __pyx_v_size = (__pyx_v_size * 2);
        goto __pyx_L13;
      }
      __pyx_L13:;
    }

    /* "rbd.pyx":1605
 *                     size *= 2
 * 
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error getting parent id for image %s' % (self.name,))
 *             return decode_cstr(parent_id)
 */
    __pyx_t_3 = (__pyx_v_ret != 0);
    if (__pyx_t_3) {

      /* "rbd.pyx":1606
 * 
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting parent id for image %s' % (self.name,))             # <<<<<<<<<<<<<<
 *             return decode_cstr(parent_id)
 *         finally:
 */
      __pyx_t_5 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1606; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1606; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_v_self->name);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_self->name);
      __Pyx_GIVEREF(__pyx_v_self->name);
      __pyx_t_7 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_45), ((PyObject *)__pyx_t_6)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1606; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_7));
      __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      __pyx_t_6 = __pyx_f_3rbd_make_ex(__pyx_t_5, ((PyObject *)__pyx_t_7)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1606; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
      __Pyx_Raise(__pyx_t_6, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1606; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "rbd.pyx":1607
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting parent id for image %s' % (self.name,))
 *             return decode_cstr(parent_id)             # <<<<<<<<<<<<<<
 *         finally:
 *             free(parent_id)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyBytes_FromString(__pyx_v_parent_id); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_7));
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_7));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_7));
    __pyx_t_7 = 0;
    __pyx_t_7 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_7;
    __pyx_t_7 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":1609
 *             return decode_cstr(parent_id)
 *         finally:
 *             free(parent_id)             # <<<<<<<<<<<<<<
 * 
 *     def old_format(self):
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_parent_id);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("rbd.Image.parent_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_27old_format(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_26old_format[] = "Image.old_format(self)\n\n        Find out whether the image uses the old RBD format.\n\n        :returns: bool - whether the image uses the old RBD format\n        ";
static PyObject *__pyx_pw_3rbd_5Image_27old_format(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("old_format (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_26old_format(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1611
 *             free(parent_id)
 * 
 *     def old_format(self):             # <<<<<<<<<<<<<<
 *         """
 *         Find out whether the image uses the old RBD format.
 */

static PyObject *__pyx_pf_3rbd_5Image_26old_format(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  uint8_t __pyx_v_old;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("old_format", 0);

  /* "rbd.pyx":1618
 *         """
 *         cdef uint8_t old
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_old_format(self.image, &old)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1619
 *         cdef uint8_t old
 *         with nogil:
 *             ret = rbd_get_old_format(self.image, &old)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting old_format for image %s' % (self.name))
 */
        __pyx_v_ret = rbd_get_old_format(__pyx_v_self->image, (&__pyx_v_old));
      }

      /* "rbd.pyx":1618
 *         """
 *         cdef uint8_t old
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_old_format(self.image, &old)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1620
 *         with nogil:
 *             ret = rbd_get_old_format(self.image, &old)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting old_format for image %s' % (self.name))
 *         return old != 0
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1621
 *             ret = rbd_get_old_format(self.image, &old)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting old_format for image %s' % (self.name))             # <<<<<<<<<<<<<<
 *         return old != 0
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_46), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1622
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting old_format for image %s' % (self.name))
 *         return old != 0             # <<<<<<<<<<<<<<
 * 
 *     def size(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyBool_FromLong((__pyx_v_old != 0)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.old_format", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_29size(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_28size[] = "Image.size(self)\n\n        Get the size of the image. If open to a snapshot, returns the\n        size of that snapshot.\n\n        :returns: the size of the image in bytes\n        ";
static PyObject *__pyx_pw_3rbd_5Image_29size(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("size (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_28size(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1624
 *         return old != 0
 * 
 *     def size(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the size of the image. If open to a snapshot, returns the
 */

static PyObject *__pyx_pf_3rbd_5Image_28size(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  uint64_t __pyx_v_image_size;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("size", 0);

  /* "rbd.pyx":1632
 *         """
 *         cdef uint64_t image_size
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_size(self.image, &image_size)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1633
 *         cdef uint64_t image_size
 *         with nogil:
 *             ret = rbd_get_size(self.image, &image_size)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting size for image %s' % (self.name))
 */
        __pyx_v_ret = rbd_get_size(__pyx_v_self->image, (&__pyx_v_image_size));
      }

      /* "rbd.pyx":1632
 *         """
 *         cdef uint64_t image_size
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_size(self.image, &image_size)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1634
 *         with nogil:
 *             ret = rbd_get_size(self.image, &image_size)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting size for image %s' % (self.name))
 *         return image_size
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1635
 *             ret = rbd_get_size(self.image, &image_size)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting size for image %s' % (self.name))             # <<<<<<<<<<<<<<
 *         return image_size
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_47), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1636
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting size for image %s' % (self.name))
 *         return image_size             # <<<<<<<<<<<<<<
 * 
 *     def features(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_image_size); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.size", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_31features(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_30features[] = "Image.features(self)\n\n        Get the features bitmask of the image.\n\n        :returns: int - the features bitmask of the image\n        ";
static PyObject *__pyx_pw_3rbd_5Image_31features(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("features (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_30features(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1638
 *         return image_size
 * 
 *     def features(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the features bitmask of the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_30features(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  uint64_t __pyx_v_features;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("features", 0);

  /* "rbd.pyx":1645
 *         """
 *         cdef uint64_t features
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_features(self.image, &features)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1646
 *         cdef uint64_t features
 *         with nogil:
 *             ret = rbd_get_features(self.image, &features)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting features for image %s' % (self.name))
 */
        __pyx_v_ret = rbd_get_features(__pyx_v_self->image, (&__pyx_v_features));
      }

      /* "rbd.pyx":1645
 *         """
 *         cdef uint64_t features
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_features(self.image, &features)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1647
 *         with nogil:
 *             ret = rbd_get_features(self.image, &features)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting features for image %s' % (self.name))
 *         return features
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1648
 *             ret = rbd_get_features(self.image, &features)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting features for image %s' % (self.name))             # <<<<<<<<<<<<<<
 *         return features
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_48), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1649
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting features for image %s' % (self.name))
 *         return features             # <<<<<<<<<<<<<<
 * 
 *     def update_features(self, features, enabled):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_features); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.features", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_33update_features(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_32update_features[] = "Image.update_features(self, features, enabled)\n\n        Update the features bitmask of the image by enabling/disabling\n        a single feature.  The feature must support the ability to be\n        dynamically enabled/disabled.\n\n        :param features: feature bitmask to enable/disable\n        :type features: int\n        :param enabled: whether to enable/disable the feature\n        :type enabled: bool\n        :raises: :class:`InvalidArgument`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_33update_features(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_features = 0;
  PyObject *__pyx_v_enabled = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("update_features (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__features,&__pyx_n_s__enabled,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__features)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__enabled)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("update_features", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "update_features") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_features = values[0];
    __pyx_v_enabled = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("update_features", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.update_features", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_32update_features(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_features, __pyx_v_enabled);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1651
 *         return features
 * 
 *     def update_features(self, features, enabled):             # <<<<<<<<<<<<<<
 *         """
 *         Update the features bitmask of the image by enabling/disabling
 */

static PyObject *__pyx_pf_3rbd_5Image_32update_features(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_features, PyObject *__pyx_v_enabled) {
  uint64_t __pyx_v__features;
  uint8_t __pyx_v__enabled;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  uint64_t __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("update_features", 0);

  /* "rbd.pyx":1664
 *         """
 *         cdef:
 *             uint64_t _features = features             # <<<<<<<<<<<<<<
 *             uint8_t _enabled = bool(enabled)
 *         with nogil:
 */
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_features); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1664; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__features = __pyx_t_1;

  /* "rbd.pyx":1665
 *         cdef:
 *             uint64_t _features = features
 *             uint8_t _enabled = bool(enabled)             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_update_features(self.image, _features, _enabled)
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_enabled); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__enabled = (!(!__pyx_t_2));

  /* "rbd.pyx":1666
 *             uint64_t _features = features
 *             uint8_t _enabled = bool(enabled)
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_update_features(self.image, _features, _enabled)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1667
 *             uint8_t _enabled = bool(enabled)
 *         with nogil:
 *             ret = rbd_update_features(self.image, _features, _enabled)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error updating features for image %s' %
 */
        __pyx_v_ret = rbd_update_features(__pyx_v_self->image, __pyx_v__features, __pyx_v__enabled);
      }

      /* "rbd.pyx":1666
 *             uint64_t _features = features
 *             uint8_t _enabled = bool(enabled)
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_update_features(self.image, _features, _enabled)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1668
 *         with nogil:
 *             ret = rbd_update_features(self.image, _features, _enabled)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error updating features for image %s' %
 *                                (self.name))
 */
  __pyx_t_2 = (__pyx_v_ret != 0);
  if (__pyx_t_2) {

    /* "rbd.pyx":1669
 *             ret = rbd_update_features(self.image, _features, _enabled)
 *         if ret != 0:
 *             raise make_ex(ret, 'error updating features for image %s' %             # <<<<<<<<<<<<<<
 *                                (self.name))
 * 
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1669; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);

    /* "rbd.pyx":1670
 *         if ret != 0:
 *             raise make_ex(ret, 'error updating features for image %s' %
 *                                (self.name))             # <<<<<<<<<<<<<<
 * 
 *     def overlap(self):
 */
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_49), __pyx_v_self->name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1669; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_5 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1669; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1669; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.Image.update_features", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_35overlap(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_34overlap[] = "Image.overlap(self)\n\n        Get the number of overlapping bytes between the image and its parent\n        image. If open to a snapshot, returns the overlap between the snapshot\n        and the parent image.\n\n        :returns: int - the overlap in bytes\n        :raises: :class:`ImageNotFound` if the image doesn't have a parent\n        ";
static PyObject *__pyx_pw_3rbd_5Image_35overlap(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("overlap (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_34overlap(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1672
 *                                (self.name))
 * 
 *     def overlap(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the number of overlapping bytes between the image and its parent
 */

static PyObject *__pyx_pf_3rbd_5Image_34overlap(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  uint64_t __pyx_v_overlap;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("overlap", 0);

  /* "rbd.pyx":1682
 *         """
 *         cdef uint64_t overlap
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_overlap(self.image, &overlap)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1683
 *         cdef uint64_t overlap
 *         with nogil:
 *             ret = rbd_get_overlap(self.image, &overlap)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting overlap for image %s' % (self.name))
 */
        __pyx_v_ret = rbd_get_overlap(__pyx_v_self->image, (&__pyx_v_overlap));
      }

      /* "rbd.pyx":1682
 *         """
 *         cdef uint64_t overlap
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_overlap(self.image, &overlap)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1684
 *         with nogil:
 *             ret = rbd_get_overlap(self.image, &overlap)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting overlap for image %s' % (self.name))
 *         return overlap
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1685
 *             ret = rbd_get_overlap(self.image, &overlap)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting overlap for image %s' % (self.name))             # <<<<<<<<<<<<<<
 *         return overlap
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1685; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_50), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1685; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1685; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1685; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1686
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting overlap for image %s' % (self.name))
 *         return overlap             # <<<<<<<<<<<<<<
 * 
 *     def flags(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_overlap); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.overlap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_37flags(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_36flags[] = "Image.flags(self)\n\n        Get the flags bitmask of the image.\n\n        :returns: int - the flags bitmask of the image\n        ";
static PyObject *__pyx_pw_3rbd_5Image_37flags(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("flags (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_36flags(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1688
 *         return overlap
 * 
 *     def flags(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the flags bitmask of the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_36flags(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  uint64_t __pyx_v_flags;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("flags", 0);

  /* "rbd.pyx":1695
 *         """
 *         cdef uint64_t flags
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_flags(self.image, &flags)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1696
 *         cdef uint64_t flags
 *         with nogil:
 *             ret = rbd_get_flags(self.image, &flags)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting flags for image %s' % (self.name))
 */
        __pyx_v_ret = rbd_get_flags(__pyx_v_self->image, (&__pyx_v_flags));
      }

      /* "rbd.pyx":1695
 *         """
 *         cdef uint64_t flags
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_flags(self.image, &flags)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1697
 *         with nogil:
 *             ret = rbd_get_flags(self.image, &flags)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting flags for image %s' % (self.name))
 *         return flags
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1698
 *             ret = rbd_get_flags(self.image, &flags)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting flags for image %s' % (self.name))             # <<<<<<<<<<<<<<
 *         return flags
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_51), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1698; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1699
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting flags for image %s' % (self.name))
 *         return flags             # <<<<<<<<<<<<<<
 * 
 *     def is_exclusive_lock_owner(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_flags); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.flags", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_39is_exclusive_lock_owner(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_38is_exclusive_lock_owner[] = "Image.is_exclusive_lock_owner(self)\n\n        Get the status of the image exclusive lock.\n\n        :returns: bool - true if the image is exclusively locked\n        ";
static PyObject *__pyx_pw_3rbd_5Image_39is_exclusive_lock_owner(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_exclusive_lock_owner (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_38is_exclusive_lock_owner(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1701
 *         return flags
 * 
 *     def is_exclusive_lock_owner(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the status of the image exclusive lock.
 */

static PyObject *__pyx_pf_3rbd_5Image_38is_exclusive_lock_owner(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_owner;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("is_exclusive_lock_owner", 0);

  /* "rbd.pyx":1708
 *         """
 *         cdef int owner
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_is_exclusive_lock_owner(self.image, &owner)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1709
 *         cdef int owner
 *         with nogil:
 *             ret = rbd_is_exclusive_lock_owner(self.image, &owner)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting lock status for image %s' % (self.name))
 */
        __pyx_v_ret = rbd_is_exclusive_lock_owner(__pyx_v_self->image, (&__pyx_v_owner));
      }

      /* "rbd.pyx":1708
 *         """
 *         cdef int owner
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_is_exclusive_lock_owner(self.image, &owner)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1710
 *         with nogil:
 *             ret = rbd_is_exclusive_lock_owner(self.image, &owner)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting lock status for image %s' % (self.name))
 *         return owner == 1
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1711
 *             ret = rbd_is_exclusive_lock_owner(self.image, &owner)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting lock status for image %s' % (self.name))             # <<<<<<<<<<<<<<
 *         return owner == 1
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_52), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1712
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting lock status for image %s' % (self.name))
 *         return owner == 1             # <<<<<<<<<<<<<<
 * 
 *     def copy(self, dest_ioctx, dest_name, features=None, order=None,
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyBool_FromLong((__pyx_v_owner == 1)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.is_exclusive_lock_owner", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_41copy(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_40copy[] = "Image.copy(self, dest_ioctx, dest_name, features=None, order=None, stripe_unit=None, stripe_count=None, data_pool=None)\n\n        Copy the image to another location.\n\n        :param dest_ioctx: determines which pool to copy into\n        :type dest_ioctx: :class:`rados.Ioctx`\n        :param dest_name: the name of the copy\n        :type dest_name: str\n        :param features: bitmask of features to enable; if set, must include layering\n        :type features: int\n        :param order: the image is split into (2**order) byte objects\n        :type order: int\n        :param stripe_unit: stripe unit in bytes (default None to let librbd decide)\n        :type stripe_unit: int\n        :param stripe_count: objects to stripe over before looping\n        :type stripe_count: int\n        :param data_pool: optional separate pool for data blocks\n        :type data_pool: str\n        :raises: :class:`TypeError`\n        :raises: :class:`InvalidArgument`\n        :raises: :class:`ImageExists`\n        :raises: :class:`FunctionNotSupported`\n        :raises: :class:`ArgumentOutOfRange`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_41copy(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_dest_ioctx = 0;
  PyObject *__pyx_v_dest_name = 0;
  PyObject *__pyx_v_features = 0;
  PyObject *__pyx_v_order = 0;
  PyObject *__pyx_v_stripe_unit = 0;
  PyObject *__pyx_v_stripe_count = 0;
  PyObject *__pyx_v_data_pool = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("copy (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__dest_ioctx,&__pyx_n_s__dest_name,&__pyx_n_s__features,&__pyx_n_s__order,&__pyx_n_s__stripe_unit,&__pyx_n_s__stripe_count,&__pyx_n_s__data_pool,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};

    /* "rbd.pyx":1714
 *         return owner == 1
 * 
 *     def copy(self, dest_ioctx, dest_name, features=None, order=None,             # <<<<<<<<<<<<<<
 *              stripe_unit=None, stripe_count=None, data_pool=None):
 *         """
 */
    values[2] = ((PyObject *)Py_None);
    values[3] = ((PyObject *)Py_None);

    /* "rbd.pyx":1715
 * 
 *     def copy(self, dest_ioctx, dest_name, features=None, order=None,
 *              stripe_unit=None, stripe_count=None, data_pool=None):             # <<<<<<<<<<<<<<
 *         """
 *         Copy the image to another location.
 */
    values[4] = ((PyObject *)Py_None);
    values[5] = ((PyObject *)Py_None);
    values[6] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__dest_ioctx)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__dest_name)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("copy", 0, 2, 7, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1714; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__features);
          if (value) { values[2] = value; kw_args--; }
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__order);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__stripe_unit);
          if (value) { values[4] = value; kw_args--; }
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__stripe_count);
          if (value) { values[5] = value; kw_args--; }
        }
        case  6:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__data_pool);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "copy") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1714; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_dest_ioctx = values[0];
    __pyx_v_dest_name = values[1];
    __pyx_v_features = values[2];
    __pyx_v_order = values[3];
    __pyx_v_stripe_unit = values[4];
    __pyx_v_stripe_count = values[5];
    __pyx_v_data_pool = values[6];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("copy", 0, 2, 7, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1714; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.copy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_40copy(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_dest_ioctx, __pyx_v_dest_name, __pyx_v_features, __pyx_v_order, __pyx_v_stripe_unit, __pyx_v_stripe_count, __pyx_v_data_pool);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1714
 *         return owner == 1
 * 
 *     def copy(self, dest_ioctx, dest_name, features=None, order=None,             # <<<<<<<<<<<<<<
 *              stripe_unit=None, stripe_count=None, data_pool=None):
 *         """
 */

static PyObject *__pyx_pf_3rbd_5Image_40copy(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_dest_ioctx, PyObject *__pyx_v_dest_name, PyObject *__pyx_v_features, PyObject *__pyx_v_order, PyObject *__pyx_v_stripe_unit, PyObject *__pyx_v_stripe_count, PyObject *__pyx_v_data_pool) {
  rados_ioctx_t __pyx_v__dest_ioctx;
  char *__pyx_v__dest_name;
  rbd_image_options_t __pyx_v_opts;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rados_ioctx_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  uint64_t __pyx_t_8;
  char const *__pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("copy", 0);
  __Pyx_INCREF(__pyx_v_dest_name);

  /* "rbd.pyx":1739
 *         :raises: :class:`ArgumentOutOfRange`
 *         """
 *         dest_name = cstr(dest_name, 'dest_name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rados_ioctx_t _dest_ioctx = convert_ioctx(dest_ioctx)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_dest_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_dest_name);
  __Pyx_GIVEREF(__pyx_v_dest_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__dest_name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__dest_name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__dest_name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_dest_name);
  __pyx_v_dest_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1741
 *         dest_name = cstr(dest_name, 'dest_name')
 *         cdef:
 *             rados_ioctx_t _dest_ioctx = convert_ioctx(dest_ioctx)             # <<<<<<<<<<<<<<
 *             char *_dest_name = dest_name
 *             rbd_image_options_t opts
 */
  if (!(likely(((__pyx_v_dest_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_dest_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_dest_ioctx)); if (unlikely(__pyx_t_4 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__dest_ioctx = __pyx_t_4;

  /* "rbd.pyx":1742
 *         cdef:
 *             rados_ioctx_t _dest_ioctx = convert_ioctx(dest_ioctx)
 *             char *_dest_name = dest_name             # <<<<<<<<<<<<<<
 *             rbd_image_options_t opts
 * 
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_dest_name); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__dest_name = __pyx_t_5;

  /* "rbd.pyx":1745
 *             rbd_image_options_t opts
 * 
 *         rbd_image_options_create(&opts)             # <<<<<<<<<<<<<<
 *         try:
 *             if features is not None:
 */
  rbd_image_options_create((&__pyx_v_opts));

  /* "rbd.pyx":1746
 * 
 *         rbd_image_options_create(&opts)
 *         try:             # <<<<<<<<<<<<<<
 *             if features is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,
 */
  /*try:*/ {

    /* "rbd.pyx":1747
 *         rbd_image_options_create(&opts)
 *         try:
 *             if features is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,
 *                                              features)
 */
    __pyx_t_6 = (__pyx_v_features != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":1748
 *         try:
 *             if features is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,             # <<<<<<<<<<<<<<
 *                                              features)
 *             if order is not None:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_10); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1748; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1748; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":1749
 *             if features is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,
 *                                              features)             # <<<<<<<<<<<<<<
 *             if order is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 */
      __pyx_t_8 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_features); if (unlikely((__pyx_t_8 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1749; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_7, __pyx_t_8);
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "rbd.pyx":1750
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_FEATURES,
 *                                              features)
 *             if order is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 *                                              order)
 */
    __pyx_t_6 = (__pyx_v_order != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":1751
 *                                              features)
 *             if order is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,             # <<<<<<<<<<<<<<
 *                                              order)
 *             if stripe_unit is not None:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_11); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1751; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1751; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":1752
 *             if order is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 *                                              order)             # <<<<<<<<<<<<<<
 *             if stripe_unit is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 */
      __pyx_t_8 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_order); if (unlikely((__pyx_t_8 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1752; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_7, __pyx_t_8);
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "rbd.pyx":1753
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_ORDER,
 *                                              order)
 *             if stripe_unit is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 *                                              stripe_unit)
 */
    __pyx_t_6 = (__pyx_v_stripe_unit != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":1754
 *                                              order)
 *             if stripe_unit is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,             # <<<<<<<<<<<<<<
 *                                              stripe_unit)
 *             if stripe_count is not None:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_12); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1754; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1754; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":1755
 *             if stripe_unit is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 *                                              stripe_unit)             # <<<<<<<<<<<<<<
 *             if stripe_count is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,
 */
      __pyx_t_8 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_stripe_unit); if (unlikely((__pyx_t_8 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1755; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_7, __pyx_t_8);
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "rbd.pyx":1756
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_UNIT,
 *                                              stripe_unit)
 *             if stripe_count is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,
 *                                              stripe_count)
 */
    __pyx_t_6 = (__pyx_v_stripe_count != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":1757
 *                                              stripe_unit)
 *             if stripe_count is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,             # <<<<<<<<<<<<<<
 *                                              stripe_count)
 *             if data_pool is not None:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_13); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1757; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1757; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":1758
 *             if stripe_count is not None:
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,
 *                                              stripe_count)             # <<<<<<<<<<<<<<
 *             if data_pool is not None:
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 */
      __pyx_t_8 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_stripe_count); if (unlikely((__pyx_t_8 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1758; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_uint64(__pyx_v_opts, __pyx_t_7, __pyx_t_8);
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "rbd.pyx":1759
 *                 rbd_image_options_set_uint64(opts, RBD_IMAGE_OPTION_STRIPE_COUNT,
 *                                              stripe_count)
 *             if data_pool is not None:             # <<<<<<<<<<<<<<
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 *                                              data_pool)
 */
    __pyx_t_6 = (__pyx_v_data_pool != Py_None);
    if (__pyx_t_6) {

      /* "rbd.pyx":1760
 *                                              stripe_count)
 *             if data_pool is not None:
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,             # <<<<<<<<<<<<<<
 *                                              data_pool)
 *             with nogil:
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_14); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1760; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1760; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":1761
 *             if data_pool is not None:
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 *                                              data_pool)             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_copy3(self.image, _dest_ioctx, _dest_name, opts)
 */
      __pyx_t_9 = __Pyx_PyObject_AsString(__pyx_v_data_pool); if (unlikely((!__pyx_t_9) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1761; __pyx_clineno = __LINE__; goto __pyx_L4;}
      rbd_image_options_set_string(__pyx_v_opts, __pyx_t_7, __pyx_t_9);
      goto __pyx_L10;
    }
    __pyx_L10:;

    /* "rbd.pyx":1762
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 *                                              data_pool)
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_copy3(self.image, _dest_ioctx, _dest_name, opts)
 *         finally:
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":1763
 *                                              data_pool)
 *             with nogil:
 *                 ret = rbd_copy3(self.image, _dest_ioctx, _dest_name, opts)             # <<<<<<<<<<<<<<
 *         finally:
 *             rbd_image_options_destroy(opts)
 */
          __pyx_v_ret = rbd_copy3(__pyx_v_self->image, __pyx_v__dest_ioctx, __pyx_v__dest_name, __pyx_v_opts);
        }

        /* "rbd.pyx":1762
 *                 rbd_image_options_set_string(opts, RBD_IMAGE_OPTION_DATA_POOL,
 *                                              data_pool)
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_copy3(self.image, _dest_ioctx, _dest_name, opts)
 *         finally:
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }
  }

  /* "rbd.pyx":1765
 *                 ret = rbd_copy3(self.image, _dest_ioctx, _dest_name, opts)
 *         finally:
 *             rbd_image_options_destroy(opts)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error copying image %s to %s' % (self.name, dest_name))
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    rbd_image_options_destroy(__pyx_v_opts);
    switch (__pyx_why) {
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  /* "rbd.pyx":1766
 *         finally:
 *             rbd_image_options_destroy(opts)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error copying image %s to %s' % (self.name, dest_name))
 * 
 */
  __pyx_t_6 = (__pyx_v_ret < 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":1767
 *             rbd_image_options_destroy(opts)
 *         if ret < 0:
 *             raise make_ex(ret, 'error copying image %s to %s' % (self.name, dest_name))             # <<<<<<<<<<<<<<
 * 
 *     def list_snaps(self):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __Pyx_INCREF(__pyx_v_dest_name);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_dest_name);
    __Pyx_GIVEREF(__pyx_v_dest_name);
    __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_53), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L15;
  }
  __pyx_L15:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.copy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_dest_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_43list_snaps(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_42list_snaps[] = "Image.list_snaps(self)\n\n        Iterate over the snapshots of an image.\n\n        :returns: :class:`SnapIterator`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_43list_snaps(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("list_snaps (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_42list_snaps(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1769
 *             raise make_ex(ret, 'error copying image %s to %s' % (self.name, dest_name))
 * 
 *     def list_snaps(self):             # <<<<<<<<<<<<<<
 *         """
 *         Iterate over the snapshots of an image.
 */

static PyObject *__pyx_pf_3rbd_5Image_42list_snaps(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("list_snaps", 0);

  /* "rbd.pyx":1775
 *         :returns: :class:`SnapIterator`
 *         """
 *         return SnapIterator(self)             # <<<<<<<<<<<<<<
 * 
 *     def create_snap(self, name):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_3rbd_SnapIterator)), ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.Image.list_snaps", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_45create_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name); /*proto*/
static char __pyx_doc_3rbd_5Image_44create_snap[] = "Image.create_snap(self, name)\n\n        Create a snapshot of the image.\n\n        :param name: the name of the snapshot\n        :type name: str\n        :raises: :class:`ImageExists`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_45create_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("create_snap (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_44create_snap(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_name));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1777
 *         return SnapIterator(self)
 * 
 *     def create_snap(self, name):             # <<<<<<<<<<<<<<
 *         """
 *         Create a snapshot of the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_44create_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name) {
  char *__pyx_v__name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("create_snap", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":1785
 *         :raises: :class:`ImageExists`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef char *_name = name
 *         with nogil:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1786
 *         """
 *         name = cstr(name, 'name')
 *         cdef char *_name = name             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_create(self.image, _name)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1786; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_4;

  /* "rbd.pyx":1787
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_create(self.image, _name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1788
 *         cdef char *_name = name
 *         with nogil:
 *             ret = rbd_snap_create(self.image, _name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error creating snapshot %s from %s' % (name, self.name))
 */
        __pyx_v_ret = rbd_snap_create(__pyx_v_self->image, __pyx_v__name);
      }

      /* "rbd.pyx":1787
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_create(self.image, _name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1789
 *         with nogil:
 *             ret = rbd_snap_create(self.image, _name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error creating snapshot %s from %s' % (name, self.name))
 * 
 */
  __pyx_t_5 = (__pyx_v_ret != 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":1790
 *             ret = rbd_snap_create(self.image, _name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error creating snapshot %s from %s' % (name, self.name))             # <<<<<<<<<<<<<<
 * 
 *     def rename_snap(self, srcname, dstname):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
    __Pyx_GIVEREF(__pyx_v_name);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_54), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.create_snap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_47rename_snap(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_46rename_snap[] = "Image.rename_snap(self, srcname, dstname)\n\n        rename a snapshot of the image.\n\n        :param srcname: the src name of the snapshot\n        :type srcname: str\n        :param dstname: the dst name of the snapshot\n        :type dstname: str\n        :raises: :class:`ImageExists`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_47rename_snap(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_srcname = 0;
  PyObject *__pyx_v_dstname = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("rename_snap (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__srcname,&__pyx_n_s__dstname,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__srcname)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__dstname)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("rename_snap", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "rename_snap") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_srcname = values[0];
    __pyx_v_dstname = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("rename_snap", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1792; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.rename_snap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_46rename_snap(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_srcname, __pyx_v_dstname);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1792
 *             raise make_ex(ret, 'error creating snapshot %s from %s' % (name, self.name))
 * 
 *     def rename_snap(self, srcname, dstname):             # <<<<<<<<<<<<<<
 *         """
 *         rename a snapshot of the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_46rename_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_srcname, PyObject *__pyx_v_dstname) {
  char *__pyx_v__srcname;
  char *__pyx_v__dstname;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("rename_snap", 0);
  __Pyx_INCREF(__pyx_v_srcname);
  __Pyx_INCREF(__pyx_v_dstname);

  /* "rbd.pyx":1802
 *         :raises: :class:`ImageExists`
 *         """
 *         srcname = cstr(srcname, 'srcname')             # <<<<<<<<<<<<<<
 *         dstname = cstr(dstname, 'dstname')
 *         cdef:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1802; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1802; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_srcname);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_srcname);
  __Pyx_GIVEREF(__pyx_v_srcname);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__srcname));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__srcname));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__srcname));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1802; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_srcname);
  __pyx_v_srcname = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1803
 *         """
 *         srcname = cstr(srcname, 'srcname')
 *         dstname = cstr(dstname, 'dstname')             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *_srcname = srcname
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1803; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1803; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_dstname);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_dstname);
  __Pyx_GIVEREF(__pyx_v_dstname);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__dstname));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__dstname));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__dstname));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1803; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_dstname);
  __pyx_v_dstname = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":1805
 *         dstname = cstr(dstname, 'dstname')
 *         cdef:
 *             char *_srcname = srcname             # <<<<<<<<<<<<<<
 *             char *_dstname = dstname
 *         with nogil:
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_srcname); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1805; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__srcname = __pyx_t_4;

  /* "rbd.pyx":1806
 *         cdef:
 *             char *_srcname = srcname
 *             char *_dstname = dstname             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_rename(self.image, _srcname, _dstname)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_dstname); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1806; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__dstname = __pyx_t_4;

  /* "rbd.pyx":1807
 *             char *_srcname = srcname
 *             char *_dstname = dstname
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_rename(self.image, _srcname, _dstname)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1808
 *             char *_dstname = dstname
 *         with nogil:
 *             ret = rbd_snap_rename(self.image, _srcname, _dstname)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error renaming snapshot of %s from %s to %s' % (self.name, srcname, dstname))
 */
        __pyx_v_ret = rbd_snap_rename(__pyx_v_self->image, __pyx_v__srcname, __pyx_v__dstname);
      }

      /* "rbd.pyx":1807
 *             char *_srcname = srcname
 *             char *_dstname = dstname
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_rename(self.image, _srcname, _dstname)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1809
 *         with nogil:
 *             ret = rbd_snap_rename(self.image, _srcname, _dstname)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error renaming snapshot of %s from %s to %s' % (self.name, srcname, dstname))
 * 
 */
  __pyx_t_5 = (__pyx_v_ret != 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":1810
 *             ret = rbd_snap_rename(self.image, _srcname, _dstname)
 *         if ret != 0:
 *             raise make_ex(ret, 'error renaming snapshot of %s from %s to %s' % (self.name, srcname, dstname))             # <<<<<<<<<<<<<<
 * 
 *     def remove_snap(self, name):
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __Pyx_INCREF(__pyx_v_srcname);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_srcname);
    __Pyx_GIVEREF(__pyx_v_srcname);
    __Pyx_INCREF(__pyx_v_dstname);
    PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_dstname);
    __Pyx_GIVEREF(__pyx_v_dstname);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_55), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_1, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.rename_snap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_srcname);
  __Pyx_XDECREF(__pyx_v_dstname);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_49remove_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name); /*proto*/
static char __pyx_doc_3rbd_5Image_48remove_snap[] = "Image.remove_snap(self, name)\n\n        Delete a snapshot of the image.\n\n        :param name: the name of the snapshot\n        :type name: str\n        :raises: :class:`IOError`, :class:`ImageBusy`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_49remove_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("remove_snap (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_48remove_snap(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_name));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1812
 *             raise make_ex(ret, 'error renaming snapshot of %s from %s to %s' % (self.name, srcname, dstname))
 * 
 *     def remove_snap(self, name):             # <<<<<<<<<<<<<<
 *         """
 *         Delete a snapshot of the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_48remove_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name) {
  char *__pyx_v__name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("remove_snap", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":1820
 *         :raises: :class:`IOError`, :class:`ImageBusy`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef char *_name = name
 *         with nogil:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1821
 *         """
 *         name = cstr(name, 'name')
 *         cdef char *_name = name             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_remove(self.image, _name)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_4;

  /* "rbd.pyx":1822
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_remove(self.image, _name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1823
 *         cdef char *_name = name
 *         with nogil:
 *             ret = rbd_snap_remove(self.image, _name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing snapshot %s from %s' % (name, self.name))
 */
        __pyx_v_ret = rbd_snap_remove(__pyx_v_self->image, __pyx_v__name);
      }

      /* "rbd.pyx":1822
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_remove(self.image, _name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1824
 *         with nogil:
 *             ret = rbd_snap_remove(self.image, _name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error removing snapshot %s from %s' % (name, self.name))
 * 
 */
  __pyx_t_5 = (__pyx_v_ret != 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":1825
 *             ret = rbd_snap_remove(self.image, _name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing snapshot %s from %s' % (name, self.name))             # <<<<<<<<<<<<<<
 * 
 *     def remove_snap2(self, name, flags):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
    __Pyx_GIVEREF(__pyx_v_name);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_56), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.remove_snap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_51remove_snap2(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_50remove_snap2[] = "Image.remove_snap2(self, name, flags)\n\n        Delete a snapshot of the image.\n\n        :param name: the name of the snapshot\n        :param flags: the flags for removal\n        :type name: str\n        :raises: :class:`IOError`, :class:`ImageBusy`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_51remove_snap2(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_name = 0;
  PyObject *__pyx_v_flags = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("remove_snap2 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,&__pyx_n_s__flags,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__name)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__flags)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("remove_snap2", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1827; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "remove_snap2") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1827; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_name = values[0];
    __pyx_v_flags = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("remove_snap2", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1827; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.remove_snap2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_50remove_snap2(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_name, __pyx_v_flags);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1827
 *             raise make_ex(ret, 'error removing snapshot %s from %s' % (name, self.name))
 * 
 *     def remove_snap2(self, name, flags):             # <<<<<<<<<<<<<<
 *         """
 *         Delete a snapshot of the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_50remove_snap2(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name, PyObject *__pyx_v_flags) {
  char *__pyx_v__name;
  uint32_t __pyx_v__flags;
  librbd_progress_fn_t __pyx_v_prog_cb;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  uint32_t __pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("remove_snap2", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":1836
 *         :raises: :class:`IOError`, :class:`ImageBusy`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *_name = name
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1836; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1836; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1836; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1838
 *         name = cstr(name, 'name')
 *         cdef:
 *             char *_name = name             # <<<<<<<<<<<<<<
 *             uint32_t _flags = flags
 *             librbd_progress_fn_t prog_cb = &no_op_progress_callback
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_4;

  /* "rbd.pyx":1839
 *         cdef:
 *             char *_name = name
 *             uint32_t _flags = flags             # <<<<<<<<<<<<<<
 *             librbd_progress_fn_t prog_cb = &no_op_progress_callback
 *         with nogil:
 */
  __pyx_t_5 = __Pyx_PyInt_from_py_uint32_t(__pyx_v_flags); if (unlikely((__pyx_t_5 == (uint32_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1839; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__flags = __pyx_t_5;

  /* "rbd.pyx":1840
 *             char *_name = name
 *             uint32_t _flags = flags
 *             librbd_progress_fn_t prog_cb = &no_op_progress_callback             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_remove2(self.image, _name, _flags, prog_cb, NULL)
 */
  __pyx_v_prog_cb = (&__pyx_f_3rbd_no_op_progress_callback);

  /* "rbd.pyx":1841
 *             uint32_t _flags = flags
 *             librbd_progress_fn_t prog_cb = &no_op_progress_callback
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_remove2(self.image, _name, _flags, prog_cb, NULL)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1842
 *             librbd_progress_fn_t prog_cb = &no_op_progress_callback
 *         with nogil:
 *             ret = rbd_snap_remove2(self.image, _name, _flags, prog_cb, NULL)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing snapshot %s from %s with flags %llx' % (name, self.name, flags))
 */
        __pyx_v_ret = rbd_snap_remove2(__pyx_v_self->image, __pyx_v__name, __pyx_v__flags, __pyx_v_prog_cb, NULL);
      }

      /* "rbd.pyx":1841
 *             uint32_t _flags = flags
 *             librbd_progress_fn_t prog_cb = &no_op_progress_callback
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_remove2(self.image, _name, _flags, prog_cb, NULL)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1843
 *         with nogil:
 *             ret = rbd_snap_remove2(self.image, _name, _flags, prog_cb, NULL)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error removing snapshot %s from %s with flags %llx' % (name, self.name, flags))
 * 
 */
  __pyx_t_6 = (__pyx_v_ret != 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":1844
 *             ret = rbd_snap_remove2(self.image, _name, _flags, prog_cb, NULL)
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing snapshot %s from %s with flags %llx' % (name, self.name, flags))             # <<<<<<<<<<<<<<
 * 
 *     def rollback_to_snap(self, name):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1844; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1844; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
    __Pyx_GIVEREF(__pyx_v_name);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __Pyx_INCREF(__pyx_v_flags);
    PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_flags);
    __Pyx_GIVEREF(__pyx_v_flags);
    __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_57), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1844; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1844; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1844; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.remove_snap2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_53rollback_to_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name); /*proto*/
static char __pyx_doc_3rbd_5Image_52rollback_to_snap[] = "Image.rollback_to_snap(self, name)\n\n        Revert the image to its contents at a snapshot. This is a\n        potentially expensive operation, since it rolls back each\n        object individually.\n\n        :param name: the snapshot to rollback to\n        :type name: str\n        :raises: :class:`IOError`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_53rollback_to_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("rollback_to_snap (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_52rollback_to_snap(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_name));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1846
 *             raise make_ex(ret, 'error removing snapshot %s from %s with flags %llx' % (name, self.name, flags))
 * 
 *     def rollback_to_snap(self, name):             # <<<<<<<<<<<<<<
 *         """
 *         Revert the image to its contents at a snapshot. This is a
 */

static PyObject *__pyx_pf_3rbd_5Image_52rollback_to_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name) {
  char *__pyx_v__name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("rollback_to_snap", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":1856
 *         :raises: :class:`IOError`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef char *_name = name
 *         with nogil:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1857
 *         """
 *         name = cstr(name, 'name')
 *         cdef char *_name = name             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_rollback(self.image, _name)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1857; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_4;

  /* "rbd.pyx":1858
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_rollback(self.image, _name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1859
 *         cdef char *_name = name
 *         with nogil:
 *             ret = rbd_snap_rollback(self.image, _name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error rolling back image %s to snapshot %s' % (self.name, name))
 */
        __pyx_v_ret = rbd_snap_rollback(__pyx_v_self->image, __pyx_v__name);
      }

      /* "rbd.pyx":1858
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_rollback(self.image, _name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1860
 *         with nogil:
 *             ret = rbd_snap_rollback(self.image, _name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error rolling back image %s to snapshot %s' % (self.name, name))
 * 
 */
  __pyx_t_5 = (__pyx_v_ret != 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":1861
 *             ret = rbd_snap_rollback(self.image, _name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error rolling back image %s to snapshot %s' % (self.name, name))             # <<<<<<<<<<<<<<
 * 
 *     def protect_snap(self, name):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __Pyx_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_name);
    __Pyx_GIVEREF(__pyx_v_name);
    __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_58), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.rollback_to_snap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_55protect_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name); /*proto*/
static char __pyx_doc_3rbd_5Image_54protect_snap[] = "Image.protect_snap(self, name)\n\n        Mark a snapshot as protected. This means it can't be deleted\n        until it is unprotected.\n\n        :param name: the snapshot to protect\n        :type name: str\n        :raises: :class:`IOError`, :class:`ImageNotFound`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_55protect_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("protect_snap (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_54protect_snap(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_name));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1863
 *             raise make_ex(ret, 'error rolling back image %s to snapshot %s' % (self.name, name))
 * 
 *     def protect_snap(self, name):             # <<<<<<<<<<<<<<
 *         """
 *         Mark a snapshot as protected. This means it can't be deleted
 */

static PyObject *__pyx_pf_3rbd_5Image_54protect_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name) {
  char *__pyx_v__name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("protect_snap", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":1872
 *         :raises: :class:`IOError`, :class:`ImageNotFound`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef char *_name = name
 *         with nogil:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1873
 *         """
 *         name = cstr(name, 'name')
 *         cdef char *_name = name             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_protect(self.image, _name)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1873; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_4;

  /* "rbd.pyx":1874
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_protect(self.image, _name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1875
 *         cdef char *_name = name
 *         with nogil:
 *             ret = rbd_snap_protect(self.image, _name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error protecting snapshot %s@%s' % (self.name, name))
 */
        __pyx_v_ret = rbd_snap_protect(__pyx_v_self->image, __pyx_v__name);
      }

      /* "rbd.pyx":1874
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_protect(self.image, _name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1876
 *         with nogil:
 *             ret = rbd_snap_protect(self.image, _name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error protecting snapshot %s@%s' % (self.name, name))
 * 
 */
  __pyx_t_5 = (__pyx_v_ret != 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":1877
 *             ret = rbd_snap_protect(self.image, _name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error protecting snapshot %s@%s' % (self.name, name))             # <<<<<<<<<<<<<<
 * 
 *     def unprotect_snap(self, name):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1877; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1877; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __Pyx_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_name);
    __Pyx_GIVEREF(__pyx_v_name);
    __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_59), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1877; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1877; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1877; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.protect_snap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_57unprotect_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name); /*proto*/
static char __pyx_doc_3rbd_5Image_56unprotect_snap[] = "Image.unprotect_snap(self, name)\n\n        Mark a snapshot unprotected. This allows it to be deleted if\n        it was protected.\n\n        :param name: the snapshot to unprotect\n        :type name: str\n        :raises: :class:`IOError`, :class:`ImageNotFound`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_57unprotect_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("unprotect_snap (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_56unprotect_snap(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_name));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1879
 *             raise make_ex(ret, 'error protecting snapshot %s@%s' % (self.name, name))
 * 
 *     def unprotect_snap(self, name):             # <<<<<<<<<<<<<<
 *         """
 *         Mark a snapshot unprotected. This allows it to be deleted if
 */

static PyObject *__pyx_pf_3rbd_5Image_56unprotect_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name) {
  char *__pyx_v__name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("unprotect_snap", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":1888
 *         :raises: :class:`IOError`, :class:`ImageNotFound`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef char *_name = name
 *         with nogil:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1888; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1889
 *         """
 *         name = cstr(name, 'name')
 *         cdef char *_name = name             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_unprotect(self.image, _name)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1889; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_4;

  /* "rbd.pyx":1890
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_unprotect(self.image, _name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1891
 *         cdef char *_name = name
 *         with nogil:
 *             ret = rbd_snap_unprotect(self.image, _name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error unprotecting snapshot %s@%s' % (self.name, name))
 */
        __pyx_v_ret = rbd_snap_unprotect(__pyx_v_self->image, __pyx_v__name);
      }

      /* "rbd.pyx":1890
 *         name = cstr(name, 'name')
 *         cdef char *_name = name
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_unprotect(self.image, _name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1892
 *         with nogil:
 *             ret = rbd_snap_unprotect(self.image, _name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error unprotecting snapshot %s@%s' % (self.name, name))
 * 
 */
  __pyx_t_5 = (__pyx_v_ret != 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":1893
 *             ret = rbd_snap_unprotect(self.image, _name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error unprotecting snapshot %s@%s' % (self.name, name))             # <<<<<<<<<<<<<<
 * 
 *     def is_protected_snap(self, name):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __Pyx_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_name);
    __Pyx_GIVEREF(__pyx_v_name);
    __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_60), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.unprotect_snap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_59is_protected_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name); /*proto*/
static char __pyx_doc_3rbd_5Image_58is_protected_snap[] = "Image.is_protected_snap(self, name)\n\n        Find out whether a snapshot is protected from deletion.\n\n        :param name: the snapshot to check\n        :type name: str\n        :returns: bool - whether the snapshot is protected\n        :raises: :class:`IOError`, :class:`ImageNotFound`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_59is_protected_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_protected_snap (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_58is_protected_snap(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_name));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1895
 *             raise make_ex(ret, 'error unprotecting snapshot %s@%s' % (self.name, name))
 * 
 *     def is_protected_snap(self, name):             # <<<<<<<<<<<<<<
 *         """
 *         Find out whether a snapshot is protected from deletion.
 */

static PyObject *__pyx_pf_3rbd_5Image_58is_protected_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name) {
  char *__pyx_v__name;
  int __pyx_v_is_protected;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("is_protected_snap", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":1904
 *         :raises: :class:`IOError`, :class:`ImageNotFound`
 *         """
 *         name = cstr(name, 'name')             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *_name = name
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":1906
 *         name = cstr(name, 'name')
 *         cdef:
 *             char *_name = name             # <<<<<<<<<<<<<<
 *             int is_protected
 *         with nogil:
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_4;

  /* "rbd.pyx":1908
 *             char *_name = name
 *             int is_protected
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_is_protected(self.image, _name, &is_protected)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1909
 *             int is_protected
 *         with nogil:
 *             ret = rbd_snap_is_protected(self.image, _name, &is_protected)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error checking if snapshot %s@%s is protected' % (self.name, name))
 */
        __pyx_v_ret = rbd_snap_is_protected(__pyx_v_self->image, __pyx_v__name, (&__pyx_v_is_protected));
      }

      /* "rbd.pyx":1908
 *             char *_name = name
 *             int is_protected
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_is_protected(self.image, _name, &is_protected)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1910
 *         with nogil:
 *             ret = rbd_snap_is_protected(self.image, _name, &is_protected)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error checking if snapshot %s@%s is protected' % (self.name, name))
 *         return is_protected == 1
 */
  __pyx_t_5 = (__pyx_v_ret != 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":1911
 *             ret = rbd_snap_is_protected(self.image, _name, &is_protected)
 *         if ret != 0:
 *             raise make_ex(ret, 'error checking if snapshot %s@%s is protected' % (self.name, name))             # <<<<<<<<<<<<<<
 *         return is_protected == 1
 * 
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1911; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1911; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __Pyx_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_name);
    __Pyx_GIVEREF(__pyx_v_name);
    __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_61), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1911; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1911; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1911; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1912
 *         if ret != 0:
 *             raise make_ex(ret, 'error checking if snapshot %s@%s is protected' % (self.name, name))
 *         return is_protected == 1             # <<<<<<<<<<<<<<
 * 
 *     def get_snap_limit(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyBool_FromLong((__pyx_v_is_protected == 1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.is_protected_snap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_61get_snap_limit(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_60get_snap_limit[] = "Image.get_snap_limit(self)\n\n        Get the snapshot limit for an image.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_61get_snap_limit(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_snap_limit (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_60get_snap_limit(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1914
 *         return is_protected == 1
 * 
 *     def get_snap_limit(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the snapshot limit for an image.
 */

static PyObject *__pyx_pf_3rbd_5Image_60get_snap_limit(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  uint64_t __pyx_v_limit;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("get_snap_limit", 0);

  /* "rbd.pyx":1921
 *         cdef:
 *             uint64_t limit
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_get_limit(self.image, &limit)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1922
 *             uint64_t limit
 *         with nogil:
 *             ret = rbd_snap_get_limit(self.image, &limit)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting snapshot limit for %s' % self.name)
 */
        __pyx_v_ret = rbd_snap_get_limit(__pyx_v_self->image, (&__pyx_v_limit));
      }

      /* "rbd.pyx":1921
 *         cdef:
 *             uint64_t limit
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_get_limit(self.image, &limit)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1923
 *         with nogil:
 *             ret = rbd_snap_get_limit(self.image, &limit)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting snapshot limit for %s' % self.name)
 *         return limit
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1924
 *             ret = rbd_snap_get_limit(self.image, &limit)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting snapshot limit for %s' % self.name)             # <<<<<<<<<<<<<<
 *         return limit
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_62), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1925
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting snapshot limit for %s' % self.name)
 *         return limit             # <<<<<<<<<<<<<<
 * 
 *     def set_snap_limit(self, limit):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_limit); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1925; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.get_snap_limit", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_63set_snap_limit(PyObject *__pyx_v_self, PyObject *__pyx_v_limit); /*proto*/
static char __pyx_doc_3rbd_5Image_62set_snap_limit[] = "Image.set_snap_limit(self, limit)\n\n        Set the snapshot limit for an image.\n\n        :param limit: the new limit to set\n        ";
static PyObject *__pyx_pw_3rbd_5Image_63set_snap_limit(PyObject *__pyx_v_self, PyObject *__pyx_v_limit) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_snap_limit (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_62set_snap_limit(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_limit));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1927
 *         return limit
 * 
 *     def set_snap_limit(self, limit):             # <<<<<<<<<<<<<<
 *         """
 *         Set the snapshot limit for an image.
 */

static PyObject *__pyx_pf_3rbd_5Image_62set_snap_limit(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_limit) {
  uint64_t __pyx_v__limit;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  uint64_t __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("set_snap_limit", 0);

  /* "rbd.pyx":1935
 * 
 *         cdef:
 *             uint64_t _limit = limit             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_set_limit(self.image, _limit)
 */
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_limit); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1935; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__limit = __pyx_t_1;

  /* "rbd.pyx":1936
 *         cdef:
 *             uint64_t _limit = limit
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_set_limit(self.image, _limit)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1937
 *             uint64_t _limit = limit
 *         with nogil:
 *             ret = rbd_snap_set_limit(self.image, _limit)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting snapshot limit for %s' % self.name)
 */
        __pyx_v_ret = rbd_snap_set_limit(__pyx_v_self->image, __pyx_v__limit);
      }

      /* "rbd.pyx":1936
 *         cdef:
 *             uint64_t _limit = limit
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_set_limit(self.image, _limit)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1938
 *         with nogil:
 *             ret = rbd_snap_set_limit(self.image, _limit)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error setting snapshot limit for %s' % self.name)
 *         return ret
 */
  __pyx_t_2 = (__pyx_v_ret != 0);
  if (__pyx_t_2) {

    /* "rbd.pyx":1939
 *             ret = rbd_snap_set_limit(self.image, _limit)
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting snapshot limit for %s' % self.name)             # <<<<<<<<<<<<<<
 *         return ret
 * 
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_63), __pyx_v_self->name); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_5 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1940
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting snapshot limit for %s' % self.name)
 *         return ret             # <<<<<<<<<<<<<<
 * 
 *     def get_snap_timestamp(self, snap_id):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.Image.set_snap_limit", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_65get_snap_timestamp(PyObject *__pyx_v_self, PyObject *__pyx_v_snap_id); /*proto*/
static char __pyx_doc_3rbd_5Image_64get_snap_timestamp[] = "Image.get_snap_timestamp(self, snap_id)\n\n        Get the snapshot timestamp for an image.\n        :param snap_id: the snapshot id of a snap shot\n        ";
static PyObject *__pyx_pw_3rbd_5Image_65get_snap_timestamp(PyObject *__pyx_v_self, PyObject *__pyx_v_snap_id) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_snap_timestamp (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_64get_snap_timestamp(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_snap_id));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1942
 *         return ret
 * 
 *     def get_snap_timestamp(self, snap_id):             # <<<<<<<<<<<<<<
 *         """
 *         Get the snapshot timestamp for an image.
 */

static PyObject *__pyx_pf_3rbd_5Image_64get_snap_timestamp(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_snap_id) {
  struct timespec __pyx_v_timestamp;
  uint64_t __pyx_v__snap_id;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  uint64_t __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("get_snap_timestamp", 0);

  /* "rbd.pyx":1949
 *         cdef:
 *             timespec timestamp
 *             uint64_t _snap_id = snap_id             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_get_timestamp(self.image, _snap_id, &timestamp)
 */
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_snap_id); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__snap_id = __pyx_t_1;

  /* "rbd.pyx":1950
 *             timespec timestamp
 *             uint64_t _snap_id = snap_id
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_get_timestamp(self.image, _snap_id, &timestamp)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1951
 *             uint64_t _snap_id = snap_id
 *         with nogil:
 *             ret = rbd_snap_get_timestamp(self.image, _snap_id, &timestamp)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting snapshot timestamp for image: %s, snap_id: %d' % (self.name, snap_id))
 */
        __pyx_v_ret = rbd_snap_get_timestamp(__pyx_v_self->image, __pyx_v__snap_id, (&__pyx_v_timestamp));
      }

      /* "rbd.pyx":1950
 *             timespec timestamp
 *             uint64_t _snap_id = snap_id
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_get_timestamp(self.image, _snap_id, &timestamp)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1952
 *         with nogil:
 *             ret = rbd_snap_get_timestamp(self.image, _snap_id, &timestamp)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting snapshot timestamp for image: %s, snap_id: %d' % (self.name, snap_id))
 *         return datetime.fromtimestamp(timestamp.tv_sec)
 */
  __pyx_t_2 = (__pyx_v_ret != 0);
  if (__pyx_t_2) {

    /* "rbd.pyx":1953
 *             ret = rbd_snap_get_timestamp(self.image, _snap_id, &timestamp)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting snapshot timestamp for image: %s, snap_id: %d' % (self.name, snap_id))             # <<<<<<<<<<<<<<
 *         return datetime.fromtimestamp(timestamp.tv_sec)
 * 
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __Pyx_INCREF(__pyx_v_snap_id);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_snap_id);
    __Pyx_GIVEREF(__pyx_v_snap_id);
    __pyx_t_5 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_64), ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_5)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1954
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting snapshot timestamp for image: %s, snap_id: %d' % (self.name, snap_id))
 *         return datetime.fromtimestamp(timestamp.tv_sec)             # <<<<<<<<<<<<<<
 * 
 *     def remove_snap_limit(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__datetime); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s__fromtimestamp); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyInt_to_py_time_t(__pyx_v_timestamp.tv_sec); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.Image.get_snap_timestamp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_67remove_snap_limit(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_66remove_snap_limit[] = "Image.remove_snap_limit(self)\n\n        Remove the snapshot limit for an image, essentially setting\n        the limit to the maximum size allowed by the implementation.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_67remove_snap_limit(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("remove_snap_limit (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_66remove_snap_limit(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1956
 *         return datetime.fromtimestamp(timestamp.tv_sec)
 * 
 *     def remove_snap_limit(self):             # <<<<<<<<<<<<<<
 *         """
 *         Remove the snapshot limit for an image, essentially setting
 */

static PyObject *__pyx_pf_3rbd_5Image_66remove_snap_limit(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("remove_snap_limit", 0);

  /* "rbd.pyx":1961
 *         the limit to the maximum size allowed by the implementation.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_set_limit(self.image, UINT64_MAX)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1962
 *         """
 *         with nogil:
 *             ret = rbd_snap_set_limit(self.image, UINT64_MAX)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing snapshot limit for %s' % self.name)
 */
        __pyx_v_ret = rbd_snap_set_limit(__pyx_v_self->image, UINT64_MAX);
      }

      /* "rbd.pyx":1961
 *         the limit to the maximum size allowed by the implementation.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_set_limit(self.image, UINT64_MAX)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1963
 *         with nogil:
 *             ret = rbd_snap_set_limit(self.image, UINT64_MAX)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error removing snapshot limit for %s' % self.name)
 *         return ret
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":1964
 *             ret = rbd_snap_set_limit(self.image, UINT64_MAX)
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing snapshot limit for %s' % self.name)             # <<<<<<<<<<<<<<
 *         return ret
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1964; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_65), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1964; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1964; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1964; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":1965
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing snapshot limit for %s' % self.name)
 *         return ret             # <<<<<<<<<<<<<<
 * 
 *     def set_snap(self, name):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1965; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.remove_snap_limit", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_69set_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name); /*proto*/
static char __pyx_doc_3rbd_5Image_68set_snap[] = "Image.set_snap(self, name)\n\n        Set the snapshot to read from. Writes will raise ReadOnlyImage\n        while a snapshot is set. Pass None to unset the snapshot\n        (reads come from the current image) , and allow writing again.\n\n        :param name: the snapshot to read from, or None to unset the snapshot\n        :type name: str or None\n        ";
static PyObject *__pyx_pw_3rbd_5Image_69set_snap(PyObject *__pyx_v_self, PyObject *__pyx_v_name) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_snap (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_68set_snap(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_name));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1967
 *         return ret
 * 
 *     def set_snap(self, name):             # <<<<<<<<<<<<<<
 *         """
 *         Set the snapshot to read from. Writes will raise ReadOnlyImage
 */

static PyObject *__pyx_pf_3rbd_5Image_68set_snap(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_name) {
  char *__pyx_v__name;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("set_snap", 0);
  __Pyx_INCREF(__pyx_v_name);

  /* "rbd.pyx":1976
 *         :type name: str or None
 *         """
 *         name = cstr(name, 'name', opt=True)             # <<<<<<<<<<<<<<
 *         cdef char *_name = opt_str(name)
 *         with nogil:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_name);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_name);
  __Pyx_GIVEREF(__pyx_v_name);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__name));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__name));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__name));
  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __pyx_t_4 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__opt), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_v_name);
  __pyx_v_name = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "rbd.pyx":1977
 *         """
 *         name = cstr(name, 'name', opt=True)
 *         cdef char *_name = opt_str(name)             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_snap_set(self.image, _name)
 */
  __pyx_t_5 = __pyx_f_3rbd_opt_str(__pyx_v_name); if (unlikely(__pyx_t_5 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1977; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__name = __pyx_t_5;

  /* "rbd.pyx":1978
 *         name = cstr(name, 'name', opt=True)
 *         cdef char *_name = opt_str(name)
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_set(self.image, _name)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":1979
 *         cdef char *_name = opt_str(name)
 *         with nogil:
 *             ret = rbd_snap_set(self.image, _name)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting image %s to snapshot %s' % (self.name, name))
 */
        __pyx_v_ret = rbd_snap_set(__pyx_v_self->image, __pyx_v__name);
      }

      /* "rbd.pyx":1978
 *         name = cstr(name, 'name', opt=True)
 *         cdef char *_name = opt_str(name)
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_snap_set(self.image, _name)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":1980
 *         with nogil:
 *             ret = rbd_snap_set(self.image, _name)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error setting image %s to snapshot %s' % (self.name, name))
 * 
 */
  __pyx_t_6 = (__pyx_v_ret != 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":1981
 *             ret = rbd_snap_set(self.image, _name)
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting image %s to snapshot %s' % (self.name, name))             # <<<<<<<<<<<<<<
 * 
 *     def read(self, offset, length, fadvise_flags=0):
 */
    __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1981; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1981; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __Pyx_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_name);
    __Pyx_GIVEREF(__pyx_v_name);
    __pyx_t_2 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_66), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1981; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1981; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1981; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.set_snap", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_name);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_71read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_70read[] = "Image.read(self, offset, length, fadvise_flags=0)\n\n        Read data from the image. Raises :class:`InvalidArgument` if\n        part of the range specified is outside the image.\n\n        :param offset: the offset to start reading at\n        :type offset: int\n        :param length: how many bytes to read\n        :type length: int\n        :param fadvise_flags: fadvise flags for this read\n        :type fadvise_flags: int\n        :returns: str - the data read\n        :raises: :class:`InvalidArgument`, :class:`IOError`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_71read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_length = 0;
  PyObject *__pyx_v_fadvise_flags = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("read (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__offset,&__pyx_n_s__length,&__pyx_n_s__fadvise_flags,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)__pyx_int_0);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__offset)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__length)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("read", 0, 2, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fadvise_flags);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_offset = values[0];
    __pyx_v_length = values[1];
    __pyx_v_fadvise_flags = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("read", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_70read(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_offset, __pyx_v_length, __pyx_v_fadvise_flags);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":1983
 *             raise make_ex(ret, 'error setting image %s to snapshot %s' % (self.name, name))
 * 
 *     def read(self, offset, length, fadvise_flags=0):             # <<<<<<<<<<<<<<
 *         """
 *         Read data from the image. Raises :class:`InvalidArgument` if
 */

static PyObject *__pyx_pf_3rbd_5Image_70read(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length, PyObject *__pyx_v_fadvise_flags) {
  char *__pyx_v_ret_buf;
  uint64_t __pyx_v__offset;
  size_t __pyx_v__length;
  int __pyx_v__fadvise_flags;
  PyObject *__pyx_v_ret_s;
  Py_ssize_t __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  uint64_t __pyx_t_1;
  size_t __pyx_t_2;
  int __pyx_t_3;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5;
  char *__pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("read", 0);

  /* "rbd.pyx":2004
 *         cdef:
 *             char *ret_buf
 *             uint64_t _offset = offset             # <<<<<<<<<<<<<<
 *             size_t _length = length
 *             int _fadvise_flags = fadvise_flags
 */
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_offset); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2004; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__offset = __pyx_t_1;

  /* "rbd.pyx":2005
 *             char *ret_buf
 *             uint64_t _offset = offset
 *             size_t _length = length             # <<<<<<<<<<<<<<
 *             int _fadvise_flags = fadvise_flags
 *             PyObject* ret_s = NULL
 */
  __pyx_t_2 = __Pyx_PyInt_AsSize_t(__pyx_v_length); if (unlikely((__pyx_t_2 == (size_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__length = __pyx_t_2;

  /* "rbd.pyx":2006
 *             uint64_t _offset = offset
 *             size_t _length = length
 *             int _fadvise_flags = fadvise_flags             # <<<<<<<<<<<<<<
 *             PyObject* ret_s = NULL
 *         ret_s = PyBytes_FromStringAndSize(NULL, length)
 */
  __pyx_t_3 = __Pyx_PyInt_AsInt(__pyx_v_fadvise_flags); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__fadvise_flags = __pyx_t_3;

  /* "rbd.pyx":2007
 *             size_t _length = length
 *             int _fadvise_flags = fadvise_flags
 *             PyObject* ret_s = NULL             # <<<<<<<<<<<<<<
 *         ret_s = PyBytes_FromStringAndSize(NULL, length)
 *         try:
 */
  __pyx_v_ret_s = NULL;

  /* "rbd.pyx":2008
 *             int _fadvise_flags = fadvise_flags
 *             PyObject* ret_s = NULL
 *         ret_s = PyBytes_FromStringAndSize(NULL, length)             # <<<<<<<<<<<<<<
 *         try:
 *             ret_buf = PyBytes_AsString(ret_s)
 */
  __pyx_t_4 = __Pyx_PyIndex_AsSsize_t(__pyx_v_length); if (unlikely((__pyx_t_4 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2008; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_5 = PyBytes_FromStringAndSize(NULL, __pyx_t_4); if (unlikely(__pyx_t_5 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2008; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_ret_s = __pyx_t_5;

  /* "rbd.pyx":2009
 *             PyObject* ret_s = NULL
 *         ret_s = PyBytes_FromStringAndSize(NULL, length)
 *         try:             # <<<<<<<<<<<<<<
 *             ret_buf = PyBytes_AsString(ret_s)
 *             with nogil:
 */
  /*try:*/ {

    /* "rbd.pyx":2010
 *         ret_s = PyBytes_FromStringAndSize(NULL, length)
 *         try:
 *             ret_buf = PyBytes_AsString(ret_s)             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_read2(self.image, _offset, _length, ret_buf,
 */
    __pyx_t_6 = PyBytes_AsString(__pyx_v_ret_s); if (unlikely(__pyx_t_6 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2010; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __pyx_v_ret_buf = __pyx_t_6;

    /* "rbd.pyx":2011
 *         try:
 *             ret_buf = PyBytes_AsString(ret_s)
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_read2(self.image, _offset, _length, ret_buf,
 *                                 _fadvise_flags)
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":2013
 *             with nogil:
 *                 ret = rbd_read2(self.image, _offset, _length, ret_buf,
 *                                 _fadvise_flags)             # <<<<<<<<<<<<<<
 *             if ret < 0:
 *                 raise make_ex(ret, 'error reading %s %ld~%ld' % (self.name, offset, length))
 */
          __pyx_v_ret = rbd_read2(__pyx_v_self->image, __pyx_v__offset, __pyx_v__length, __pyx_v_ret_buf, __pyx_v__fadvise_flags);
        }

        /* "rbd.pyx":2011
 *         try:
 *             ret_buf = PyBytes_AsString(ret_s)
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_read2(self.image, _offset, _length, ret_buf,
 *                                 _fadvise_flags)
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }

    /* "rbd.pyx":2014
 *                 ret = rbd_read2(self.image, _offset, _length, ret_buf,
 *                                 _fadvise_flags)
 *             if ret < 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error reading %s %ld~%ld' % (self.name, offset, length))
 * 
 */
    __pyx_t_7 = (__pyx_v_ret < 0);
    if (__pyx_t_7) {

      /* "rbd.pyx":2015
 *                                 _fadvise_flags)
 *             if ret < 0:
 *                 raise make_ex(ret, 'error reading %s %ld~%ld' % (self.name, offset, length))             # <<<<<<<<<<<<<<
 * 
 *             if ret != <ssize_t>length:
 */
      __pyx_t_8 = PyInt_FromSsize_t(__pyx_v_ret); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2015; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2015; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_INCREF(__pyx_v_self->name);
      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_self->name);
      __Pyx_GIVEREF(__pyx_v_self->name);
      __Pyx_INCREF(__pyx_v_offset);
      PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_v_offset);
      __Pyx_GIVEREF(__pyx_v_offset);
      __Pyx_INCREF(__pyx_v_length);
      PyTuple_SET_ITEM(__pyx_t_9, 2, __pyx_v_length);
      __Pyx_GIVEREF(__pyx_v_length);
      __pyx_t_10 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_67), ((PyObject *)__pyx_t_9)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2015; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
      __pyx_t_9 = __pyx_f_3rbd_make_ex(__pyx_t_8, ((PyObject *)__pyx_t_10)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2015; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
      __Pyx_Raise(__pyx_t_9, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2015; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "rbd.pyx":2017
 *                 raise make_ex(ret, 'error reading %s %ld~%ld' % (self.name, offset, length))
 * 
 *             if ret != <ssize_t>length:             # <<<<<<<<<<<<<<
 *                 _PyBytes_Resize(&ret_s, ret)
 * 
 */
    __pyx_t_11 = PyInt_AsSsize_t(__pyx_v_length); if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2017; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __pyx_t_7 = (__pyx_v_ret != ((Py_ssize_t)__pyx_t_11));
    if (__pyx_t_7) {

      /* "rbd.pyx":2018
 * 
 *             if ret != <ssize_t>length:
 *                 _PyBytes_Resize(&ret_s, ret)             # <<<<<<<<<<<<<<
 * 
 *             return <object>ret_s
 */
      __pyx_t_3 = _PyBytes_Resize((&__pyx_v_ret_s), __pyx_v_ret); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2018; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L10;
    }
    __pyx_L10:;

    /* "rbd.pyx":2020
 *                 _PyBytes_Resize(&ret_s, ret)
 * 
 *             return <object>ret_s             # <<<<<<<<<<<<<<
 *         finally:
 *             # We DECREF unconditionally: the cast to object above will have
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_v_ret_s));
    __pyx_r = ((PyObject *)__pyx_v_ret_s);
    goto __pyx_L3;
  }

  /* "rbd.pyx":2026
 *             # including if _PyString_Resize fails (that will free the string
 *             # itself and set ret_s to NULL, hence XDECREF).
 *             ref.Py_XDECREF(ret_s)             # <<<<<<<<<<<<<<
 * 
 *     def diff_iterate(self, offset, length, from_snapshot, iterate_cb,
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    Py_XDECREF(__pyx_v_ret_s);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("rbd.Image.read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_73diff_iterate(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_72diff_iterate[] = "Image.diff_iterate(self, offset, length, from_snapshot, iterate_cb, include_parent=True, whole_object=False)\n\n        Iterate over the changed extents of an image.\n\n        This will call iterate_cb with three arguments:\n\n        (offset, length, exists)\n\n        where the changed extent starts at offset bytes, continues for\n        length bytes, and is full of data (if exists is True) or zeroes\n        (if exists is False).\n\n        If from_snapshot is None, it is interpreted as the beginning\n        of time and this generates all allocated extents.\n\n        The end version is whatever is currently selected (via set_snap)\n        for the image.\n\n        iterate_cb may raise an exception, which will abort the diff and will be\n        propagated to the caller.\n\n        Raises :class:`InvalidArgument` if from_snapshot is after\n        the currently set snapshot.\n\n        Raises :class:`ImageNotFound` if from_snapshot is not the name\n        of a snapshot of the image.\n\n        :param offset: start offset in bytes\n        :type offset: int\n        :param length: size of region to report on, in bytes\n        :type length: int\n        :param from_snapshot: starting snapshot name, or None\n        :type from_snapshot: str or None\n        :param iterate_cb: function to call for each extent\n        :type iterate_cb: function acception arguments for offset,\n                           length, and exists\n        :param include_parent: True if full history diff should include parent\n        :type include_parent: bool\n        :param whole_object: True if diff extents should cover whole object\n        :type whole_object: bool\n        :raises: :class:`InvalidArgument`, :class:`IOError`,\n                 :class:`ImageNotFound`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_73diff_iterate(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_length = 0;
  PyObject *__pyx_v_from_snapshot = 0;
  PyObject *__pyx_v_iterate_cb = 0;
  PyObject *__pyx_v_include_parent = 0;
  PyObject *__pyx_v_whole_object = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("diff_iterate (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__offset,&__pyx_n_s__length,&__pyx_n_s__from_snapshot,&__pyx_n_s__iterate_cb,&__pyx_n_s__include_parent,&__pyx_n_s__whole_object,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    values[4] = __pyx_k_68;
    values[5] = __pyx_k_69;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__offset)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__length)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("diff_iterate", 0, 4, 6, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__from_snapshot)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("diff_iterate", 0, 4, 6, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__iterate_cb)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("diff_iterate", 0, 4, 6, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__include_parent);
          if (value) { values[4] = value; kw_args--; }
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__whole_object);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "diff_iterate") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_offset = values[0];
    __pyx_v_length = values[1];
    __pyx_v_from_snapshot = values[2];
    __pyx_v_iterate_cb = values[3];
    __pyx_v_include_parent = values[4];
    __pyx_v_whole_object = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("diff_iterate", 0, 4, 6, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.diff_iterate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_72diff_iterate(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_offset, __pyx_v_length, __pyx_v_from_snapshot, __pyx_v_iterate_cb, __pyx_v_include_parent, __pyx_v_whole_object);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2028
 *             ref.Py_XDECREF(ret_s)
 * 
 *     def diff_iterate(self, offset, length, from_snapshot, iterate_cb,             # <<<<<<<<<<<<<<
 *                      include_parent = True, whole_object = False):
 *         """
 */

static PyObject *__pyx_pf_3rbd_5Image_72diff_iterate(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length, PyObject *__pyx_v_from_snapshot, PyObject *__pyx_v_iterate_cb, PyObject *__pyx_v_include_parent, PyObject *__pyx_v_whole_object) {
  char *__pyx_v__from_snapshot;
  uint64_t __pyx_v__offset;
  uint64_t __pyx_v__length;
  uint8_t __pyx_v__include_parent;
  uint8_t __pyx_v__whole_object;
  int __pyx_v_ret;
  PyObject *__pyx_v_msg = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  char *__pyx_t_5;
  uint64_t __pyx_t_6;
  uint8_t __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("diff_iterate", 0);
  __Pyx_INCREF(__pyx_v_from_snapshot);

  /* "rbd.pyx":2072
 *                  :class:`ImageNotFound`
 *         """
 *         from_snapshot = cstr(from_snapshot, 'from_snapshot', opt=True)             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *_from_snapshot = opt_str(from_snapshot)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2072; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2072; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_from_snapshot);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_from_snapshot);
  __Pyx_GIVEREF(__pyx_v_from_snapshot);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__from_snapshot));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__from_snapshot));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__from_snapshot));
  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2072; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __pyx_t_4 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2072; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__opt), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2072; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2072; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_v_from_snapshot);
  __pyx_v_from_snapshot = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "rbd.pyx":2074
 *         from_snapshot = cstr(from_snapshot, 'from_snapshot', opt=True)
 *         cdef:
 *             char *_from_snapshot = opt_str(from_snapshot)             # <<<<<<<<<<<<<<
 *             uint64_t _offset = offset, _length = length
 *             uint8_t _include_parent = include_parent
 */
  __pyx_t_5 = __pyx_f_3rbd_opt_str(__pyx_v_from_snapshot); if (unlikely(__pyx_t_5 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__from_snapshot = __pyx_t_5;

  /* "rbd.pyx":2075
 *         cdef:
 *             char *_from_snapshot = opt_str(from_snapshot)
 *             uint64_t _offset = offset, _length = length             # <<<<<<<<<<<<<<
 *             uint8_t _include_parent = include_parent
 *             uint8_t _whole_object = whole_object
 */
  __pyx_t_6 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_offset); if (unlikely((__pyx_t_6 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__offset = __pyx_t_6;
  __pyx_t_6 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_length); if (unlikely((__pyx_t_6 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__length = __pyx_t_6;

  /* "rbd.pyx":2076
 *             char *_from_snapshot = opt_str(from_snapshot)
 *             uint64_t _offset = offset, _length = length
 *             uint8_t _include_parent = include_parent             # <<<<<<<<<<<<<<
 *             uint8_t _whole_object = whole_object
 *         with nogil:
 */
  __pyx_t_7 = __Pyx_PyInt_from_py_uint8_t(__pyx_v_include_parent); if (unlikely((__pyx_t_7 == (uint8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2076; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__include_parent = __pyx_t_7;

  /* "rbd.pyx":2077
 *             uint64_t _offset = offset, _length = length
 *             uint8_t _include_parent = include_parent
 *             uint8_t _whole_object = whole_object             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_diff_iterate2(self.image, _from_snapshot, _offset,
 */
  __pyx_t_7 = __Pyx_PyInt_from_py_uint8_t(__pyx_v_whole_object); if (unlikely((__pyx_t_7 == (uint8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2077; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__whole_object = __pyx_t_7;

  /* "rbd.pyx":2078
 *             uint8_t _include_parent = include_parent
 *             uint8_t _whole_object = whole_object
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_diff_iterate2(self.image, _from_snapshot, _offset,
 *                                     _length, _include_parent, _whole_object,
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2081
 *             ret = rbd_diff_iterate2(self.image, _from_snapshot, _offset,
 *                                     _length, _include_parent, _whole_object,
 *                                     &diff_iterate_cb, <void *>iterate_cb)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             msg = 'error generating diff from snapshot %s' % from_snapshot
 */
        __pyx_t_8 = rbd_diff_iterate2(__pyx_v_self->image, __pyx_v__from_snapshot, __pyx_v__offset, __pyx_v__length, __pyx_v__include_parent, __pyx_v__whole_object, (&__pyx_f_3rbd_diff_iterate_cb), ((void *)__pyx_v_iterate_cb)); if (unlikely(__pyx_t_8 == -9000 && __Pyx_ErrOccurredWithGIL())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2079; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __pyx_v_ret = __pyx_t_8;
      }

      /* "rbd.pyx":2078
 *             uint8_t _include_parent = include_parent
 *             uint8_t _whole_object = whole_object
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_diff_iterate2(self.image, _from_snapshot, _offset,
 *                                     _length, _include_parent, _whole_object,
 */
      /*finally:*/ {
        int __pyx_why;
        __pyx_why = 0; goto __pyx_L5;
        __pyx_L4: __pyx_why = 4; goto __pyx_L5;
        __pyx_L5:;
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
        switch (__pyx_why) {
          case 4: goto __pyx_L1_error;
        }
      }
  }

  /* "rbd.pyx":2082
 *                                     _length, _include_parent, _whole_object,
 *                                     &diff_iterate_cb, <void *>iterate_cb)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             msg = 'error generating diff from snapshot %s' % from_snapshot
 *             raise make_ex(ret, msg)
 */
  __pyx_t_9 = (__pyx_v_ret < 0);
  if (__pyx_t_9) {

    /* "rbd.pyx":2083
 *                                     &diff_iterate_cb, <void *>iterate_cb)
 *         if ret < 0:
 *             msg = 'error generating diff from snapshot %s' % from_snapshot             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, msg)
 * 
 */
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_70), __pyx_v_from_snapshot); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2083; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_v_msg = ((PyObject *)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "rbd.pyx":2084
 *         if ret < 0:
 *             msg = 'error generating diff from snapshot %s' % from_snapshot
 *             raise make_ex(ret, msg)             # <<<<<<<<<<<<<<
 * 
 *     def write(self, data, offset, fadvise_flags=0):
 */
    __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2084; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_4, __pyx_v_msg); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2084; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2084; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L7;
  }
  __pyx_L7:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.diff_iterate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_msg);
  __Pyx_XDECREF(__pyx_v_from_snapshot);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_75write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_74write[] = "Image.write(self, data, offset, fadvise_flags=0)\n\n        Write data to the image. Raises :class:`InvalidArgument` if\n        part of the write would fall outside the image.\n\n        :param data: the data to be written\n        :type data: bytes\n        :param offset: where to start writing data\n        :type offset: int\n        :param fadvise_flags: fadvise flags for this write\n        :type fadvise_flags: int\n        :returns: int - the number of bytes written\n        :raises: :class:`IncompleteWriteError`, :class:`LogicError`,\n                 :class:`InvalidArgument`, :class:`IOError`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_75write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_fadvise_flags = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("write (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__data,&__pyx_n_s__offset,&__pyx_n_s__fadvise_flags,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)__pyx_int_0);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__offset)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("write", 0, 2, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2086; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fadvise_flags);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "write") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2086; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = values[0];
    __pyx_v_offset = values[1];
    __pyx_v_fadvise_flags = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("write", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2086; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_74write(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_data, __pyx_v_offset, __pyx_v_fadvise_flags);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2086
 *             raise make_ex(ret, msg)
 * 
 *     def write(self, data, offset, fadvise_flags=0):             # <<<<<<<<<<<<<<
 *         """
 *         Write data to the image. Raises :class:`InvalidArgument` if
 */

static PyObject *__pyx_pf_3rbd_5Image_74write(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_data, PyObject *__pyx_v_offset, PyObject *__pyx_v_fadvise_flags) {
  uint64_t __pyx_v__offset;
  uint64_t __pyx_v_length;
  char *__pyx_v__data;
  int __pyx_v__fadvise_flags;
  Py_ssize_t __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  uint64_t __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  char *__pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("write", 0);

  /* "rbd.pyx":2101
 *                  :class:`InvalidArgument`, :class:`IOError`
 *         """
 *         if not isinstance(data, bytes):             # <<<<<<<<<<<<<<
 *             raise TypeError('data must be a byte string')
 *         cdef:
 */
  __pyx_t_1 = PyBytes_Check(__pyx_v_data); 
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {

    /* "rbd.pyx":2102
 *         """
 *         if not isinstance(data, bytes):
 *             raise TypeError('data must be a byte string')             # <<<<<<<<<<<<<<
 *         cdef:
 *             uint64_t _offset = offset, length = len(data)
 */
    __pyx_t_3 = PyObject_Call(__pyx_builtin_TypeError, ((PyObject *)__pyx_k_tuple_72), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":2104
 *             raise TypeError('data must be a byte string')
 *         cdef:
 *             uint64_t _offset = offset, length = len(data)             # <<<<<<<<<<<<<<
 *             char *_data = data
 *             int _fadvise_flags = fadvise_flags
 */
  __pyx_t_4 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_offset); if (unlikely((__pyx_t_4 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__offset = __pyx_t_4;
  __pyx_t_5 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_length = __pyx_t_5;

  /* "rbd.pyx":2105
 *         cdef:
 *             uint64_t _offset = offset, length = len(data)
 *             char *_data = data             # <<<<<<<<<<<<<<
 *             int _fadvise_flags = fadvise_flags
 *         with nogil:
 */
  __pyx_t_6 = __Pyx_PyObject_AsString(__pyx_v_data); if (unlikely((!__pyx_t_6) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__data = __pyx_t_6;

  /* "rbd.pyx":2106
 *             uint64_t _offset = offset, length = len(data)
 *             char *_data = data
 *             int _fadvise_flags = fadvise_flags             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_write2(self.image, _offset, length, _data, _fadvise_flags)
 */
  __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_v_fadvise_flags); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__fadvise_flags = __pyx_t_7;

  /* "rbd.pyx":2107
 *             char *_data = data
 *             int _fadvise_flags = fadvise_flags
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_write2(self.image, _offset, length, _data, _fadvise_flags)
 * 
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2108
 *             int _fadvise_flags = fadvise_flags
 *         with nogil:
 *             ret = rbd_write2(self.image, _offset, length, _data, _fadvise_flags)             # <<<<<<<<<<<<<<
 * 
 *         if ret == <ssize_t>length:
 */
        __pyx_v_ret = rbd_write2(__pyx_v_self->image, __pyx_v__offset, __pyx_v_length, __pyx_v__data, __pyx_v__fadvise_flags);
      }

      /* "rbd.pyx":2107
 *             char *_data = data
 *             int _fadvise_flags = fadvise_flags
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_write2(self.image, _offset, length, _data, _fadvise_flags)
 * 
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2110
 *             ret = rbd_write2(self.image, _offset, length, _data, _fadvise_flags)
 * 
 *         if ret == <ssize_t>length:             # <<<<<<<<<<<<<<
 *             return ret
 *         elif ret < 0:
 */
  __pyx_t_2 = (__pyx_v_ret == ((Py_ssize_t)__pyx_v_length));
  if (__pyx_t_2) {

    /* "rbd.pyx":2111
 * 
 *         if ret == <ssize_t>length:
 *             return ret             # <<<<<<<<<<<<<<
 *         elif ret < 0:
 *             raise make_ex(ret, "error writing to %s" % (self.name,))
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
    goto __pyx_L7;
  }

  /* "rbd.pyx":2112
 *         if ret == <ssize_t>length:
 *             return ret
 *         elif ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, "error writing to %s" % (self.name,))
 *         elif ret < <ssize_t>length:
 */
  __pyx_t_2 = (__pyx_v_ret < 0);
  if (__pyx_t_2) {

    /* "rbd.pyx":2113
 *             return ret
 *         elif ret < 0:
 *             raise make_ex(ret, "error writing to %s" % (self.name,))             # <<<<<<<<<<<<<<
 *         elif ret < <ssize_t>length:
 *             raise IncompleteWriteError("Wrote only %ld out of %ld bytes" % (ret, length))
 */
    __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_9 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_73), ((PyObject *)__pyx_t_8)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_9));
    __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    __pyx_t_8 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_9)); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __Pyx_Raise(__pyx_t_8, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L7;
  }

  /* "rbd.pyx":2114
 *         elif ret < 0:
 *             raise make_ex(ret, "error writing to %s" % (self.name,))
 *         elif ret < <ssize_t>length:             # <<<<<<<<<<<<<<
 *             raise IncompleteWriteError("Wrote only %ld out of %ld bytes" % (ret, length))
 *         else:
 */
  __pyx_t_2 = (__pyx_v_ret < ((Py_ssize_t)__pyx_v_length));
  if (__pyx_t_2) {

    /* "rbd.pyx":2115
 *             raise make_ex(ret, "error writing to %s" % (self.name,))
 *         elif ret < <ssize_t>length:
 *             raise IncompleteWriteError("Wrote only %ld out of %ld bytes" % (ret, length))             # <<<<<<<<<<<<<<
 *         else:
 *             raise LogicError("logic error: rbd_write(%s) \
 */
    __pyx_t_8 = __Pyx_GetModuleGlobalName(__pyx_n_s_74); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = PyInt_FromSsize_t(__pyx_v_ret); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_3 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_length); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_9 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_75), ((PyObject *)__pyx_t_10)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    PyTuple_SET_ITEM(__pyx_t_10, 0, ((PyObject *)__pyx_t_3));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_8, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L7;
  }
  /*else*/ {

    /* "rbd.pyx":2117
 *             raise IncompleteWriteError("Wrote only %ld out of %ld bytes" % (ret, length))
 *         else:
 *             raise LogicError("logic error: rbd_write(%s) \             # <<<<<<<<<<<<<<
 * returned %d, but %d was the maximum number of bytes it could have \
 * written." % (self.name, ret, length))
 */
    __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__LogicError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);

    /* "rbd.pyx":2119
 *             raise LogicError("logic error: rbd_write(%s) \
 * returned %d, but %d was the maximum number of bytes it could have \
 * written." % (self.name, ret, length))             # <<<<<<<<<<<<<<
 * 
 *     def discard(self, offset, length):
 */
    __pyx_t_10 = PyInt_FromSsize_t(__pyx_v_ret); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_8 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_length); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_10);
    __Pyx_GIVEREF(__pyx_t_10);
    PyTuple_SET_ITEM(__pyx_t_9, 2, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_8);
    __pyx_t_10 = 0;
    __pyx_t_8 = 0;
    __pyx_t_8 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_76), ((PyObject *)__pyx_t_9)); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_8));
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_9, 0, ((PyObject *)__pyx_t_8));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_8));
    __pyx_t_8 = 0;
    __pyx_t_8 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __Pyx_Raise(__pyx_t_8, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_L7:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("rbd.Image.write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_77discard(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_76discard[] = "Image.discard(self, offset, length)\n\n        Trim the range from the image. It will be logically filled\n        with zeroes.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_77discard(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_length = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("discard (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__offset,&__pyx_n_s__length,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__offset)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__length)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("discard", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2121; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "discard") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2121; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_offset = values[0];
    __pyx_v_length = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("discard", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2121; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.discard", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_76discard(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_offset, __pyx_v_length);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2121
 * written." % (self.name, ret, length))
 * 
 *     def discard(self, offset, length):             # <<<<<<<<<<<<<<
 *         """
 *         Trim the range from the image. It will be logically filled
 */

static PyObject *__pyx_pf_3rbd_5Image_76discard(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length) {
  uint64_t __pyx_v__offset;
  uint64_t __pyx_v__length;
  int __pyx_v_ret;
  PyObject *__pyx_v_msg = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  uint64_t __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("discard", 0);

  /* "rbd.pyx":2126
 *         with zeroes.
 *         """
 *         cdef uint64_t _offset = offset, _length = length             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_discard(self.image, _offset, _length)
 */
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_offset); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__offset = __pyx_t_1;
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_length); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__length = __pyx_t_1;

  /* "rbd.pyx":2127
 *         """
 *         cdef uint64_t _offset = offset, _length = length
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_discard(self.image, _offset, _length)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2128
 *         cdef uint64_t _offset = offset, _length = length
 *         with nogil:
 *             ret = rbd_discard(self.image, _offset, _length)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             msg = 'error discarding region %d~%d' % (offset, length)
 */
        __pyx_v_ret = rbd_discard(__pyx_v_self->image, __pyx_v__offset, __pyx_v__length);
      }

      /* "rbd.pyx":2127
 *         """
 *         cdef uint64_t _offset = offset, _length = length
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_discard(self.image, _offset, _length)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2129
 *         with nogil:
 *             ret = rbd_discard(self.image, _offset, _length)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             msg = 'error discarding region %d~%d' % (offset, length)
 *             raise make_ex(ret, msg)
 */
  __pyx_t_2 = (__pyx_v_ret < 0);
  if (__pyx_t_2) {

    /* "rbd.pyx":2130
 *             ret = rbd_discard(self.image, _offset, _length)
 *         if ret < 0:
 *             msg = 'error discarding region %d~%d' % (offset, length)             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, msg)
 * 
 */
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_offset);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_offset);
    __Pyx_GIVEREF(__pyx_v_offset);
    __Pyx_INCREF(__pyx_v_length);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_length);
    __Pyx_GIVEREF(__pyx_v_length);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_77), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_v_msg = ((PyObject *)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "rbd.pyx":2131
 *         if ret < 0:
 *             msg = 'error discarding region %d~%d' % (offset, length)
 *             raise make_ex(ret, msg)             # <<<<<<<<<<<<<<
 * 
 *     def flush(self):
 */
    __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_4, __pyx_v_msg); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.discard", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_msg);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_79flush(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_78flush[] = "Image.flush(self)\n\n        Block until all writes are fully flushed if caching is enabled.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_79flush(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("flush (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_78flush(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2133
 *             raise make_ex(ret, msg)
 * 
 *     def flush(self):             # <<<<<<<<<<<<<<
 *         """
 *         Block until all writes are fully flushed if caching is enabled.
 */

static PyObject *__pyx_pf_3rbd_5Image_78flush(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("flush", 0);

  /* "rbd.pyx":2137
 *         Block until all writes are fully flushed if caching is enabled.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_flush(self.image)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2138
 *         """
 *         with nogil:
 *             ret = rbd_flush(self.image)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error flushing image')
 */
        __pyx_v_ret = rbd_flush(__pyx_v_self->image);
      }

      /* "rbd.pyx":2137
 *         Block until all writes are fully flushed if caching is enabled.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_flush(self.image)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2139
 *         with nogil:
 *             ret = rbd_flush(self.image)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error flushing image')
 * 
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2140
 *             ret = rbd_flush(self.image)
 *         if ret < 0:
 *             raise make_ex(ret, 'error flushing image')             # <<<<<<<<<<<<<<
 * 
 *     def invalidate_cache(self):
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_kp_s_78)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.flush", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_81invalidate_cache(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_80invalidate_cache[] = "Image.invalidate_cache(self)\n\n        Drop any cached data for the image.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_81invalidate_cache(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("invalidate_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_80invalidate_cache(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2142
 *             raise make_ex(ret, 'error flushing image')
 * 
 *     def invalidate_cache(self):             # <<<<<<<<<<<<<<
 *         """
 *         Drop any cached data for the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_80invalidate_cache(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("invalidate_cache", 0);

  /* "rbd.pyx":2146
 *         Drop any cached data for the image.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_invalidate_cache(self.image)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2147
 *         """
 *         with nogil:
 *             ret = rbd_invalidate_cache(self.image)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error invalidating cache')
 */
        __pyx_v_ret = rbd_invalidate_cache(__pyx_v_self->image);
      }

      /* "rbd.pyx":2146
 *         Drop any cached data for the image.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_invalidate_cache(self.image)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2148
 *         with nogil:
 *             ret = rbd_invalidate_cache(self.image)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error invalidating cache')
 * 
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2149
 *             ret = rbd_invalidate_cache(self.image)
 *         if ret < 0:
 *             raise make_ex(ret, 'error invalidating cache')             # <<<<<<<<<<<<<<
 * 
 *     def stripe_unit(self):
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_kp_s_79)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.invalidate_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_83stripe_unit(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_82stripe_unit[] = "Image.stripe_unit(self)\n\n        Return the stripe unit used for the image.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_83stripe_unit(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("stripe_unit (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_82stripe_unit(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2151
 *             raise make_ex(ret, 'error invalidating cache')
 * 
 *     def stripe_unit(self):             # <<<<<<<<<<<<<<
 *         """
 *         Return the stripe unit used for the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_82stripe_unit(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  uint64_t __pyx_v_stripe_unit;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("stripe_unit", 0);

  /* "rbd.pyx":2156
 *         """
 *         cdef uint64_t stripe_unit
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_stripe_unit(self.image, &stripe_unit)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2157
 *         cdef uint64_t stripe_unit
 *         with nogil:
 *             ret = rbd_get_stripe_unit(self.image, &stripe_unit)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting stripe unit for image %s' % (self.name))
 */
        __pyx_v_ret = rbd_get_stripe_unit(__pyx_v_self->image, (&__pyx_v_stripe_unit));
      }

      /* "rbd.pyx":2156
 *         """
 *         cdef uint64_t stripe_unit
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_stripe_unit(self.image, &stripe_unit)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2158
 *         with nogil:
 *             ret = rbd_get_stripe_unit(self.image, &stripe_unit)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting stripe unit for image %s' % (self.name))
 *         return stripe_unit
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2159
 *             ret = rbd_get_stripe_unit(self.image, &stripe_unit)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting stripe unit for image %s' % (self.name))             # <<<<<<<<<<<<<<
 *         return stripe_unit
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_80), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":2160
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting stripe unit for image %s' % (self.name))
 *         return stripe_unit             # <<<<<<<<<<<<<<
 * 
 *     def stripe_count(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_stripe_unit); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.stripe_unit", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_85stripe_count(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_84stripe_count[] = "Image.stripe_count(self)\n\n        Return the stripe count used for the image.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_85stripe_count(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("stripe_count (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_84stripe_count(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2162
 *         return stripe_unit
 * 
 *     def stripe_count(self):             # <<<<<<<<<<<<<<
 *         """
 *         Return the stripe count used for the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_84stripe_count(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  uint64_t __pyx_v_stripe_count;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("stripe_count", 0);

  /* "rbd.pyx":2167
 *         """
 *         cdef uint64_t stripe_count
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_stripe_count(self.image, &stripe_count)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2168
 *         cdef uint64_t stripe_count
 *         with nogil:
 *             ret = rbd_get_stripe_count(self.image, &stripe_count)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting stripe count for image %s' % (self.name))
 */
        __pyx_v_ret = rbd_get_stripe_count(__pyx_v_self->image, (&__pyx_v_stripe_count));
      }

      /* "rbd.pyx":2167
 *         """
 *         cdef uint64_t stripe_count
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_stripe_count(self.image, &stripe_count)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2169
 *         with nogil:
 *             ret = rbd_get_stripe_count(self.image, &stripe_count)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting stripe count for image %s' % (self.name))
 *         return stripe_count
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2170
 *             ret = rbd_get_stripe_count(self.image, &stripe_count)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting stripe count for image %s' % (self.name))             # <<<<<<<<<<<<<<
 *         return stripe_count
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_81), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":2171
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting stripe count for image %s' % (self.name))
 *         return stripe_count             # <<<<<<<<<<<<<<
 * 
 *     def create_timestamp(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t(__pyx_v_stripe_count); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.stripe_count", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_87create_timestamp(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_86create_timestamp[] = "Image.create_timestamp(self)\n\n        Return the create timestamp for the image.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_87create_timestamp(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("create_timestamp (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_86create_timestamp(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2173
 *         return stripe_count
 * 
 *     def create_timestamp(self):             # <<<<<<<<<<<<<<
 *         """
 *         Return the create timestamp for the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_86create_timestamp(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  struct timespec __pyx_v_timestamp;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("create_timestamp", 0);

  /* "rbd.pyx":2179
 *         cdef:
 *             timespec timestamp
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_create_timestamp(self.image, &timestamp)
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2180
 *             timespec timestamp
 *         with nogil:
 *             ret = rbd_get_create_timestamp(self.image, &timestamp)             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting create timestamp for image: %s' % (self.name))
 */
        __pyx_v_ret = rbd_get_create_timestamp(__pyx_v_self->image, (&__pyx_v_timestamp));
      }

      /* "rbd.pyx":2179
 *         cdef:
 *             timespec timestamp
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_get_create_timestamp(self.image, &timestamp)
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2181
 *         with nogil:
 *             ret = rbd_get_create_timestamp(self.image, &timestamp)
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting create timestamp for image: %s' % (self.name))
 *         return datetime.fromtimestamp(timestamp.tv_sec)
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2182
 *             ret = rbd_get_create_timestamp(self.image, &timestamp)
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting create timestamp for image: %s' % (self.name))             # <<<<<<<<<<<<<<
 *         return datetime.fromtimestamp(timestamp.tv_sec)
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_82), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":2183
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting create timestamp for image: %s' % (self.name))
 *         return datetime.fromtimestamp(timestamp.tv_sec)             # <<<<<<<<<<<<<<
 * 
 *     def flatten(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__datetime); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s__fromtimestamp); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyInt_to_py_time_t(__pyx_v_timestamp.tv_sec); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.create_timestamp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_89flatten(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_88flatten[] = "Image.flatten(self)\n\n        Flatten clone image (copy all blocks from parent to child)\n        ";
static PyObject *__pyx_pw_3rbd_5Image_89flatten(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("flatten (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_88flatten(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2185
 *         return datetime.fromtimestamp(timestamp.tv_sec)
 * 
 *     def flatten(self):             # <<<<<<<<<<<<<<
 *         """
 *         Flatten clone image (copy all blocks from parent to child)
 */

static PyObject *__pyx_pf_3rbd_5Image_88flatten(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("flatten", 0);

  /* "rbd.pyx":2189
 *         Flatten clone image (copy all blocks from parent to child)
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_flatten(self.image)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2190
 *         """
 *         with nogil:
 *             ret = rbd_flatten(self.image)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, "error flattening %s" % self.name)
 */
        __pyx_v_ret = rbd_flatten(__pyx_v_self->image);
      }

      /* "rbd.pyx":2189
 *         Flatten clone image (copy all blocks from parent to child)
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_flatten(self.image)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2191
 *         with nogil:
 *             ret = rbd_flatten(self.image)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, "error flattening %s" % self.name)
 * 
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2192
 *             ret = rbd_flatten(self.image)
 *         if ret < 0:
 *             raise make_ex(ret, "error flattening %s" % self.name)             # <<<<<<<<<<<<<<
 * 
 *     def rebuild_object_map(self):
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_83), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.flatten", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_91rebuild_object_map(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_90rebuild_object_map[] = "Image.rebuild_object_map(self)\n\n        Rebuild the object map for the image HEAD or currently set snapshot\n        ";
static PyObject *__pyx_pw_3rbd_5Image_91rebuild_object_map(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("rebuild_object_map (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_90rebuild_object_map(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2194
 *             raise make_ex(ret, "error flattening %s" % self.name)
 * 
 *     def rebuild_object_map(self):             # <<<<<<<<<<<<<<
 *         """
 *         Rebuild the object map for the image HEAD or currently set snapshot
 */

static PyObject *__pyx_pf_3rbd_5Image_90rebuild_object_map(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  librbd_progress_fn_t __pyx_v_prog_cb;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("rebuild_object_map", 0);

  /* "rbd.pyx":2198
 *         Rebuild the object map for the image HEAD or currently set snapshot
 *         """
 *         cdef librbd_progress_fn_t prog_cb = &no_op_progress_callback             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_rebuild_object_map(self.image, prog_cb, NULL)
 */
  __pyx_v_prog_cb = (&__pyx_f_3rbd_no_op_progress_callback);

  /* "rbd.pyx":2199
 *         """
 *         cdef librbd_progress_fn_t prog_cb = &no_op_progress_callback
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_rebuild_object_map(self.image, prog_cb, NULL)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2200
 *         cdef librbd_progress_fn_t prog_cb = &no_op_progress_callback
 *         with nogil:
 *             ret = rbd_rebuild_object_map(self.image, prog_cb, NULL)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, "error rebuilding object map %s" % self.name)
 */
        __pyx_v_ret = rbd_rebuild_object_map(__pyx_v_self->image, __pyx_v_prog_cb, NULL);
      }

      /* "rbd.pyx":2199
 *         """
 *         cdef librbd_progress_fn_t prog_cb = &no_op_progress_callback
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_rebuild_object_map(self.image, prog_cb, NULL)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2201
 *         with nogil:
 *             ret = rbd_rebuild_object_map(self.image, prog_cb, NULL)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, "error rebuilding object map %s" % self.name)
 * 
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2202
 *             ret = rbd_rebuild_object_map(self.image, prog_cb, NULL)
 *         if ret < 0:
 *             raise make_ex(ret, "error rebuilding object map %s" % self.name)             # <<<<<<<<<<<<<<
 * 
 *     def list_children(self):
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_84), __pyx_v_self->name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.rebuild_object_map", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_93list_children(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_92list_children[] = "Image.list_children(self)\n\n        List children of the currently set snapshot (set via set_snap()).\n\n        :returns: list - a list of (pool name, image name) tuples\n        ";
static PyObject *__pyx_pw_3rbd_5Image_93list_children(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("list_children (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_92list_children(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2204
 *             raise make_ex(ret, "error rebuilding object map %s" % self.name)
 * 
 *     def list_children(self):             # <<<<<<<<<<<<<<
 *         """
 *         List children of the currently set snapshot (set via set_snap()).
 */

static PyObject *__pyx_pf_3rbd_5Image_92list_children(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  size_t __pyx_v_pools_size;
  size_t __pyx_v_images_size;
  char *__pyx_v_c_pools;
  char *__pyx_v_c_images;
  Py_ssize_t __pyx_v_ret;
  PyObject *__pyx_v_pools = NULL;
  PyObject *__pyx_v_images = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  void *__pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("list_children", 0);

  /* "rbd.pyx":2211
 *         """
 *         cdef:
 *             size_t pools_size = 512, images_size = 512             # <<<<<<<<<<<<<<
 *             char *c_pools = NULL
 *             char *c_images = NULL
 */
  __pyx_v_pools_size = 512;
  __pyx_v_images_size = 512;

  /* "rbd.pyx":2212
 *         cdef:
 *             size_t pools_size = 512, images_size = 512
 *             char *c_pools = NULL             # <<<<<<<<<<<<<<
 *             char *c_images = NULL
 *         try:
 */
  __pyx_v_c_pools = NULL;

  /* "rbd.pyx":2213
 *             size_t pools_size = 512, images_size = 512
 *             char *c_pools = NULL
 *             char *c_images = NULL             # <<<<<<<<<<<<<<
 *         try:
 *             while True:
 */
  __pyx_v_c_images = NULL;

  /* "rbd.pyx":2214
 *             char *c_pools = NULL
 *             char *c_images = NULL
 *         try:             # <<<<<<<<<<<<<<
 *             while True:
 *                 c_pools = <char *>realloc_chk(c_pools, pools_size)
 */
  /*try:*/ {

    /* "rbd.pyx":2215
 *             char *c_images = NULL
 *         try:
 *             while True:             # <<<<<<<<<<<<<<
 *                 c_pools = <char *>realloc_chk(c_pools, pools_size)
 *                 c_images = <char *>realloc_chk(c_images, images_size)
 */
    while (1) {
      if (!1) break;

      /* "rbd.pyx":2216
 *         try:
 *             while True:
 *                 c_pools = <char *>realloc_chk(c_pools, pools_size)             # <<<<<<<<<<<<<<
 *                 c_images = <char *>realloc_chk(c_images, images_size)
 *                 with nogil:
 */
      __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_c_pools, __pyx_v_pools_size); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2216; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_c_pools = ((char *)__pyx_t_1);

      /* "rbd.pyx":2217
 *             while True:
 *                 c_pools = <char *>realloc_chk(c_pools, pools_size)
 *                 c_images = <char *>realloc_chk(c_images, images_size)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_list_children(self.image, c_pools, &pools_size,
 */
      __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_c_images, __pyx_v_images_size); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2217; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_c_images = ((char *)__pyx_t_1);

      /* "rbd.pyx":2218
 *                 c_pools = <char *>realloc_chk(c_pools, pools_size)
 *                 c_images = <char *>realloc_chk(c_images, images_size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_list_children(self.image, c_pools, &pools_size,
 *                                             c_images, &images_size)
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":2220
 *                 with nogil:
 *                     ret = rbd_list_children(self.image, c_pools, &pools_size,
 *                                             c_images, &images_size)             # <<<<<<<<<<<<<<
 *                 if ret >= 0:
 *                     break
 */
            __pyx_v_ret = rbd_list_children(__pyx_v_self->image, __pyx_v_c_pools, (&__pyx_v_pools_size), __pyx_v_c_images, (&__pyx_v_images_size));
          }

          /* "rbd.pyx":2218
 *                 c_pools = <char *>realloc_chk(c_pools, pools_size)
 *                 c_images = <char *>realloc_chk(c_images, images_size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_list_children(self.image, c_pools, &pools_size,
 *                                             c_images, &images_size)
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":2221
 *                     ret = rbd_list_children(self.image, c_pools, &pools_size,
 *                                             c_images, &images_size)
 *                 if ret >= 0:             # <<<<<<<<<<<<<<
 *                     break
 *                 elif ret != -errno.ERANGE:
 */
      __pyx_t_2 = (__pyx_v_ret >= 0);
      if (__pyx_t_2) {

        /* "rbd.pyx":2222
 *                                             c_images, &images_size)
 *                 if ret >= 0:
 *                     break             # <<<<<<<<<<<<<<
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')
 */
        goto __pyx_L7_break;
        goto __pyx_L13;
      }

      /* "rbd.pyx":2223
 *                 if ret >= 0:
 *                     break
 *                 elif ret != -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     raise make_ex(ret, 'error listing images')
 *             if ret == 0:
 */
      __pyx_t_2 = (__pyx_v_ret != (-ERANGE));
      if (__pyx_t_2) {

        /* "rbd.pyx":2224
 *                     break
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')             # <<<<<<<<<<<<<<
 *             if ret == 0:
 *                 return []
 */
        __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2224; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_17)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2224; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_Raise(__pyx_t_4, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2224; __pyx_clineno = __LINE__; goto __pyx_L4;}
        goto __pyx_L13;
      }
      __pyx_L13:;
    }
    __pyx_L7_break:;

    /* "rbd.pyx":2225
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')
 *             if ret == 0:             # <<<<<<<<<<<<<<
 *                 return []
 *             pools = map(decode_cstr, c_pools[:pools_size - 1].split(b'\0'))
 */
    __pyx_t_2 = (__pyx_v_ret == 0);
    if (__pyx_t_2) {

      /* "rbd.pyx":2226
 *                     raise make_ex(ret, 'error listing images')
 *             if ret == 0:
 *                 return []             # <<<<<<<<<<<<<<
 *             pools = map(decode_cstr, c_pools[:pools_size - 1].split(b'\0'))
 *             images = map(decode_cstr, c_images[:images_size - 1].split(b'\0'))
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2226; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_r = ((PyObject *)__pyx_t_4);
      __pyx_t_4 = 0;
      goto __pyx_L3;
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "rbd.pyx":2227
 *             if ret == 0:
 *                 return []
 *             pools = map(decode_cstr, c_pools[:pools_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             images = map(decode_cstr, c_images[:images_size - 1].split(b'\0'))
 *             return list(zip(pools, images))
 */
    __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2227; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_c_pools + 0, (__pyx_v_pools_size - 1) - 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2227; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_t_3), __pyx_n_s__split); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2227; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_k_tuple_85), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2227; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2227; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_4 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_map, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2227; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_v_pools = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "rbd.pyx":2228
 *                 return []
 *             pools = map(decode_cstr, c_pools[:pools_size - 1].split(b'\0'))
 *             images = map(decode_cstr, c_images[:images_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             return list(zip(pools, images))
 *         finally:
 */
    __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2228; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_c_images + 0, (__pyx_v_images_size - 1) - 0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2228; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_t_5), __pyx_n_s__split); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2228; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_k_tuple_86), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2228; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2228; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_3 = 0;
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_builtin_map, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2228; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_v_images = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "rbd.pyx":2229
 *             pools = map(decode_cstr, c_pools[:pools_size - 1].split(b'\0'))
 *             images = map(decode_cstr, c_images[:images_size - 1].split(b'\0'))
 *             return list(zip(pools, images))             # <<<<<<<<<<<<<<
 *         finally:
 *             free(c_pools)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2229; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_v_pools);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_pools);
    __Pyx_GIVEREF(__pyx_v_pools);
    __Pyx_INCREF(__pyx_v_images);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_images);
    __Pyx_GIVEREF(__pyx_v_images);
    __pyx_t_4 = PyObject_Call(__pyx_builtin_zip, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2229; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2229; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)(&PyList_Type))), ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2229; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":2231
 *             return list(zip(pools, images))
 *         finally:
 *             free(c_pools)             # <<<<<<<<<<<<<<
 *             free(c_images)
 * 
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_c_pools);

    /* "rbd.pyx":2232
 *         finally:
 *             free(c_pools)
 *             free(c_images)             # <<<<<<<<<<<<<<
 * 
 *     def list_lockers(self):
 */
    free(__pyx_v_c_images);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.Image.list_children", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_pools);
  __Pyx_XDECREF(__pyx_v_images);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_95list_lockers(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_94list_lockers[] = "Image.list_lockers(self)\n\n        List clients that have locked the image and information\n        about the lock.\n\n        :returns: dict - contains the following keys:\n\n                  * ``tag`` - the tag associated with the lock (every\n                    additional locker must use the same tag)\n                  * ``exclusive`` - boolean indicating whether the\n                     lock is exclusive or shared\n                  * ``lockers`` - a list of (client, cookie, address)\n                    tuples\n        ";
static PyObject *__pyx_pw_3rbd_5Image_95list_lockers(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("list_lockers (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_94list_lockers(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2234
 *             free(c_images)
 * 
 *     def list_lockers(self):             # <<<<<<<<<<<<<<
 *         """
 *         List clients that have locked the image and information
 */

static PyObject *__pyx_pf_3rbd_5Image_94list_lockers(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  size_t __pyx_v_clients_size;
  size_t __pyx_v_cookies_size;
  size_t __pyx_v_addrs_size;
  size_t __pyx_v_tag_size;
  int __pyx_v_exclusive;
  char *__pyx_v_c_clients;
  char *__pyx_v_c_cookies;
  char *__pyx_v_c_addrs;
  char *__pyx_v_c_tag;
  Py_ssize_t __pyx_v_ret;
  PyObject *__pyx_v_clients = NULL;
  PyObject *__pyx_v_cookies = NULL;
  PyObject *__pyx_v_addrs = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  void *__pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("list_lockers", 0);

  /* "rbd.pyx":2249
 *         """
 *         cdef:
 *             size_t clients_size = 512, cookies_size = 512             # <<<<<<<<<<<<<<
 *             size_t addrs_size = 512, tag_size = 512
 *             int exclusive = 0
 */
  __pyx_v_clients_size = 512;
  __pyx_v_cookies_size = 512;

  /* "rbd.pyx":2250
 *         cdef:
 *             size_t clients_size = 512, cookies_size = 512
 *             size_t addrs_size = 512, tag_size = 512             # <<<<<<<<<<<<<<
 *             int exclusive = 0
 *             char *c_clients = NULL
 */
  __pyx_v_addrs_size = 512;
  __pyx_v_tag_size = 512;

  /* "rbd.pyx":2251
 *             size_t clients_size = 512, cookies_size = 512
 *             size_t addrs_size = 512, tag_size = 512
 *             int exclusive = 0             # <<<<<<<<<<<<<<
 *             char *c_clients = NULL
 *             char *c_cookies = NULL
 */
  __pyx_v_exclusive = 0;

  /* "rbd.pyx":2252
 *             size_t addrs_size = 512, tag_size = 512
 *             int exclusive = 0
 *             char *c_clients = NULL             # <<<<<<<<<<<<<<
 *             char *c_cookies = NULL
 *             char *c_addrs = NULL
 */
  __pyx_v_c_clients = NULL;

  /* "rbd.pyx":2253
 *             int exclusive = 0
 *             char *c_clients = NULL
 *             char *c_cookies = NULL             # <<<<<<<<<<<<<<
 *             char *c_addrs = NULL
 *             char *c_tag = NULL
 */
  __pyx_v_c_cookies = NULL;

  /* "rbd.pyx":2254
 *             char *c_clients = NULL
 *             char *c_cookies = NULL
 *             char *c_addrs = NULL             # <<<<<<<<<<<<<<
 *             char *c_tag = NULL
 * 
 */
  __pyx_v_c_addrs = NULL;

  /* "rbd.pyx":2255
 *             char *c_cookies = NULL
 *             char *c_addrs = NULL
 *             char *c_tag = NULL             # <<<<<<<<<<<<<<
 * 
 *         try:
 */
  __pyx_v_c_tag = NULL;

  /* "rbd.pyx":2257
 *             char *c_tag = NULL
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             while True:
 *                 c_clients = <char *>realloc_chk(c_clients, clients_size)
 */
  /*try:*/ {

    /* "rbd.pyx":2258
 * 
 *         try:
 *             while True:             # <<<<<<<<<<<<<<
 *                 c_clients = <char *>realloc_chk(c_clients, clients_size)
 *                 c_cookies = <char *>realloc_chk(c_cookies, cookies_size)
 */
    while (1) {
      if (!1) break;

      /* "rbd.pyx":2259
 *         try:
 *             while True:
 *                 c_clients = <char *>realloc_chk(c_clients, clients_size)             # <<<<<<<<<<<<<<
 *                 c_cookies = <char *>realloc_chk(c_cookies, cookies_size)
 *                 c_addrs = <char *>realloc_chk(c_addrs, addrs_size)
 */
      __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_c_clients, __pyx_v_clients_size); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2259; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_c_clients = ((char *)__pyx_t_1);

      /* "rbd.pyx":2260
 *             while True:
 *                 c_clients = <char *>realloc_chk(c_clients, clients_size)
 *                 c_cookies = <char *>realloc_chk(c_cookies, cookies_size)             # <<<<<<<<<<<<<<
 *                 c_addrs = <char *>realloc_chk(c_addrs, addrs_size)
 *                 c_tag = <char *>realloc_chk(c_tag, tag_size)
 */
      __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_c_cookies, __pyx_v_cookies_size); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2260; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_c_cookies = ((char *)__pyx_t_1);

      /* "rbd.pyx":2261
 *                 c_clients = <char *>realloc_chk(c_clients, clients_size)
 *                 c_cookies = <char *>realloc_chk(c_cookies, cookies_size)
 *                 c_addrs = <char *>realloc_chk(c_addrs, addrs_size)             # <<<<<<<<<<<<<<
 *                 c_tag = <char *>realloc_chk(c_tag, tag_size)
 *                 with nogil:
 */
      __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_c_addrs, __pyx_v_addrs_size); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2261; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_c_addrs = ((char *)__pyx_t_1);

      /* "rbd.pyx":2262
 *                 c_cookies = <char *>realloc_chk(c_cookies, cookies_size)
 *                 c_addrs = <char *>realloc_chk(c_addrs, addrs_size)
 *                 c_tag = <char *>realloc_chk(c_tag, tag_size)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_list_lockers(self.image, &exclusive,
 */
      __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_c_tag, __pyx_v_tag_size); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2262; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_c_tag = ((char *)__pyx_t_1);

      /* "rbd.pyx":2263
 *                 c_addrs = <char *>realloc_chk(c_addrs, addrs_size)
 *                 c_tag = <char *>realloc_chk(c_tag, tag_size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_list_lockers(self.image, &exclusive,
 *                                            c_tag, &tag_size,
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":2268
 *                                            c_clients, &clients_size,
 *                                            c_cookies, &cookies_size,
 *                                            c_addrs, &addrs_size)             # <<<<<<<<<<<<<<
 *                 if ret >= 0:
 *                     break
 */
            __pyx_v_ret = rbd_list_lockers(__pyx_v_self->image, (&__pyx_v_exclusive), __pyx_v_c_tag, (&__pyx_v_tag_size), __pyx_v_c_clients, (&__pyx_v_clients_size), __pyx_v_c_cookies, (&__pyx_v_cookies_size), __pyx_v_c_addrs, (&__pyx_v_addrs_size));
          }

          /* "rbd.pyx":2263
 *                 c_addrs = <char *>realloc_chk(c_addrs, addrs_size)
 *                 c_tag = <char *>realloc_chk(c_tag, tag_size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_list_lockers(self.image, &exclusive,
 *                                            c_tag, &tag_size,
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":2269
 *                                            c_cookies, &cookies_size,
 *                                            c_addrs, &addrs_size)
 *                 if ret >= 0:             # <<<<<<<<<<<<<<
 *                     break
 *                 elif ret != -errno.ERANGE:
 */
      __pyx_t_2 = (__pyx_v_ret >= 0);
      if (__pyx_t_2) {

        /* "rbd.pyx":2270
 *                                            c_addrs, &addrs_size)
 *                 if ret >= 0:
 *                     break             # <<<<<<<<<<<<<<
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')
 */
        goto __pyx_L7_break;
        goto __pyx_L13;
      }

      /* "rbd.pyx":2271
 *                 if ret >= 0:
 *                     break
 *                 elif ret != -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     raise make_ex(ret, 'error listing images')
 *             if ret == 0:
 */
      __pyx_t_2 = (__pyx_v_ret != (-ERANGE));
      if (__pyx_t_2) {

        /* "rbd.pyx":2272
 *                     break
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')             # <<<<<<<<<<<<<<
 *             if ret == 0:
 *                 return []
 */
        __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2272; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_17)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2272; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_Raise(__pyx_t_4, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2272; __pyx_clineno = __LINE__; goto __pyx_L4;}
        goto __pyx_L13;
      }
      __pyx_L13:;
    }
    __pyx_L7_break:;

    /* "rbd.pyx":2273
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')
 *             if ret == 0:             # <<<<<<<<<<<<<<
 *                 return []
 *             clients = map(decode_cstr, c_clients[:clients_size - 1].split(b'\0'))
 */
    __pyx_t_2 = (__pyx_v_ret == 0);
    if (__pyx_t_2) {

      /* "rbd.pyx":2274
 *                     raise make_ex(ret, 'error listing images')
 *             if ret == 0:
 *                 return []             # <<<<<<<<<<<<<<
 *             clients = map(decode_cstr, c_clients[:clients_size - 1].split(b'\0'))
 *             cookies = map(decode_cstr, c_cookies[:cookies_size - 1].split(b'\0'))
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2274; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_r = ((PyObject *)__pyx_t_4);
      __pyx_t_4 = 0;
      goto __pyx_L3;
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "rbd.pyx":2275
 *             if ret == 0:
 *                 return []
 *             clients = map(decode_cstr, c_clients[:clients_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             cookies = map(decode_cstr, c_cookies[:cookies_size - 1].split(b'\0'))
 *             addrs = map(decode_cstr, c_addrs[:addrs_size - 1].split(b'\0'))
 */
    __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2275; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_c_clients + 0, (__pyx_v_clients_size - 1) - 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2275; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_t_3), __pyx_n_s__split); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2275; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_k_tuple_87), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2275; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2275; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_4 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_map, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2275; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_v_clients = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "rbd.pyx":2276
 *                 return []
 *             clients = map(decode_cstr, c_clients[:clients_size - 1].split(b'\0'))
 *             cookies = map(decode_cstr, c_cookies[:cookies_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             addrs = map(decode_cstr, c_addrs[:addrs_size - 1].split(b'\0'))
 *             return {
 */
    __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2276; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_c_cookies + 0, (__pyx_v_cookies_size - 1) - 0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2276; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_t_5), __pyx_n_s__split); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2276; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_k_tuple_88), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2276; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2276; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_3 = 0;
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_builtin_map, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2276; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_v_cookies = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "rbd.pyx":2277
 *             clients = map(decode_cstr, c_clients[:clients_size - 1].split(b'\0'))
 *             cookies = map(decode_cstr, c_cookies[:cookies_size - 1].split(b'\0'))
 *             addrs = map(decode_cstr, c_addrs[:addrs_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             return {
 *                 'tag'       : decode_cstr(c_tag),
 */
    __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_c_addrs + 0, (__pyx_v_addrs_size - 1) - 0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_t_4), __pyx_n_s__split); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_k_tuple_89), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_5 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_builtin_map, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_v_addrs = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "rbd.pyx":2278
 *             cookies = map(decode_cstr, c_cookies[:cookies_size - 1].split(b'\0'))
 *             addrs = map(decode_cstr, c_addrs[:addrs_size - 1].split(b'\0'))
 *             return {             # <<<<<<<<<<<<<<
 *                 'tag'       : decode_cstr(c_tag),
 *                 'exclusive' : exclusive == 1,
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2278; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));

    /* "rbd.pyx":2279
 *             addrs = map(decode_cstr, c_addrs[:addrs_size - 1].split(b'\0'))
 *             return {
 *                 'tag'       : decode_cstr(c_tag),             # <<<<<<<<<<<<<<
 *                 'exclusive' : exclusive == 1,
 *                 'lockers'   : list(zip(clients, cookies, addrs)),
 */
    __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2279; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyBytes_FromString(__pyx_v_c_tag); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2279; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2279; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_5));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2279; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__tag), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2278; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "rbd.pyx":2280
 *             return {
 *                 'tag'       : decode_cstr(c_tag),
 *                 'exclusive' : exclusive == 1,             # <<<<<<<<<<<<<<
 *                 'lockers'   : list(zip(clients, cookies, addrs)),
 *                 }
 */
    __pyx_t_5 = __Pyx_PyBool_FromLong((__pyx_v_exclusive == 1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2280; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__exclusive), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2278; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "rbd.pyx":2281
 *                 'tag'       : decode_cstr(c_tag),
 *                 'exclusive' : exclusive == 1,
 *                 'lockers'   : list(zip(clients, cookies, addrs)),             # <<<<<<<<<<<<<<
 *                 }
 *         finally:
 */
    __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2281; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_v_clients);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_clients);
    __Pyx_GIVEREF(__pyx_v_clients);
    __Pyx_INCREF(__pyx_v_cookies);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_cookies);
    __Pyx_GIVEREF(__pyx_v_cookies);
    __Pyx_INCREF(__pyx_v_addrs);
    PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_v_addrs);
    __Pyx_GIVEREF(__pyx_v_addrs);
    __pyx_t_6 = PyObject_Call(__pyx_builtin_zip, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2281; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2281; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = PyObject_Call(((PyObject *)((PyObject*)(&PyList_Type))), ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2281; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__lockers), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2278; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_r = ((PyObject *)__pyx_t_4);
    __pyx_t_4 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":2284
 *                 }
 *         finally:
 *             free(c_clients)             # <<<<<<<<<<<<<<
 *             free(c_cookies)
 *             free(c_addrs)
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_c_clients);

    /* "rbd.pyx":2285
 *         finally:
 *             free(c_clients)
 *             free(c_cookies)             # <<<<<<<<<<<<<<
 *             free(c_addrs)
 *             free(c_tag)
 */
    free(__pyx_v_c_cookies);

    /* "rbd.pyx":2286
 *             free(c_clients)
 *             free(c_cookies)
 *             free(c_addrs)             # <<<<<<<<<<<<<<
 *             free(c_tag)
 * 
 */
    free(__pyx_v_c_addrs);

    /* "rbd.pyx":2287
 *             free(c_cookies)
 *             free(c_addrs)
 *             free(c_tag)             # <<<<<<<<<<<<<<
 * 
 *     def lock_acquire(self, lock_mode):
 */
    free(__pyx_v_c_tag);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("rbd.Image.list_lockers", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_clients);
  __Pyx_XDECREF(__pyx_v_cookies);
  __Pyx_XDECREF(__pyx_v_addrs);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_97lock_acquire(PyObject *__pyx_v_self, PyObject *__pyx_v_lock_mode); /*proto*/
static char __pyx_doc_3rbd_5Image_96lock_acquire[] = "Image.lock_acquire(self, lock_mode)\n\n        Acquire a managed lock on the image.\n\n        :param lock_mode: lock mode to set\n        :type lock_mode: int\n        :raises: :class:`ImageBusy` if the lock could not be acquired\n        ";
static PyObject *__pyx_pw_3rbd_5Image_97lock_acquire(PyObject *__pyx_v_self, PyObject *__pyx_v_lock_mode) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lock_acquire (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_96lock_acquire(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_lock_mode));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2289
 *             free(c_tag)
 * 
 *     def lock_acquire(self, lock_mode):             # <<<<<<<<<<<<<<
 *         """
 *         Acquire a managed lock on the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_96lock_acquire(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_lock_mode) {
  rbd_lock_mode_t __pyx_v__lock_mode;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  rbd_lock_mode_t __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lock_acquire", 0);

  /* "rbd.pyx":2298
 *         """
 *         cdef:
 *             rbd_lock_mode_t _lock_mode = lock_mode             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_lock_acquire(self.image, _lock_mode)
 */
  __pyx_t_1 = ((rbd_lock_mode_t)PyInt_AsLong(__pyx_v_lock_mode)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2298; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__lock_mode = __pyx_t_1;

  /* "rbd.pyx":2299
 *         cdef:
 *             rbd_lock_mode_t _lock_mode = lock_mode
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_acquire(self.image, _lock_mode)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2300
 *             rbd_lock_mode_t _lock_mode = lock_mode
 *         with nogil:
 *             ret = rbd_lock_acquire(self.image, _lock_mode)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error acquiring lock on image')
 */
        __pyx_v_ret = rbd_lock_acquire(__pyx_v_self->image, __pyx_v__lock_mode);
      }

      /* "rbd.pyx":2299
 *         cdef:
 *             rbd_lock_mode_t _lock_mode = lock_mode
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_acquire(self.image, _lock_mode)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2301
 *         with nogil:
 *             ret = rbd_lock_acquire(self.image, _lock_mode)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error acquiring lock on image')
 * 
 */
  __pyx_t_2 = (__pyx_v_ret < 0);
  if (__pyx_t_2) {

    /* "rbd.pyx":2302
 *             ret = rbd_lock_acquire(self.image, _lock_mode)
 *         if ret < 0:
 *             raise make_ex(ret, 'error acquiring lock on image')             # <<<<<<<<<<<<<<
 * 
 *     def lock_release(self):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2302; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_90)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2302; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2302; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.lock_acquire", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_99lock_release(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_98lock_release[] = "Image.lock_release(self)\n\n        Release a managed lock on the image that was previously acquired.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_99lock_release(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lock_release (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_98lock_release(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2304
 *             raise make_ex(ret, 'error acquiring lock on image')
 * 
 *     def lock_release(self):             # <<<<<<<<<<<<<<
 *         """
 *         Release a managed lock on the image that was previously acquired.
 */

static PyObject *__pyx_pf_3rbd_5Image_98lock_release(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lock_release", 0);

  /* "rbd.pyx":2308
 *         Release a managed lock on the image that was previously acquired.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_release(self.image)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2309
 *         """
 *         with nogil:
 *             ret = rbd_lock_release(self.image)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error releasing lock on image')
 */
        __pyx_v_ret = rbd_lock_release(__pyx_v_self->image);
      }

      /* "rbd.pyx":2308
 *         Release a managed lock on the image that was previously acquired.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_release(self.image)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2310
 *         with nogil:
 *             ret = rbd_lock_release(self.image)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error releasing lock on image')
 * 
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2311
 *             ret = rbd_lock_release(self.image)
 *         if ret < 0:
 *             raise make_ex(ret, 'error releasing lock on image')             # <<<<<<<<<<<<<<
 * 
 *     def lock_get_owners(self):
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_kp_s_91)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.lock_release", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_101lock_get_owners(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_100lock_get_owners[] = "Image.lock_get_owners(self)\n\n        Iterate over the lock owners of an image.\n\n        :returns: :class:`LockOwnerIterator`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_101lock_get_owners(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lock_get_owners (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_100lock_get_owners(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2313
 *             raise make_ex(ret, 'error releasing lock on image')
 * 
 *     def lock_get_owners(self):             # <<<<<<<<<<<<<<
 *         """
 *         Iterate over the lock owners of an image.
 */

static PyObject *__pyx_pf_3rbd_5Image_100lock_get_owners(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lock_get_owners", 0);

  /* "rbd.pyx":2319
 *         :returns: :class:`LockOwnerIterator`
 *         """
 *         return LockOwnerIterator(self)             # <<<<<<<<<<<<<<
 * 
 *     def lock_break(self, lock_mode, lock_owner):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_3rbd_LockOwnerIterator)), ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.Image.lock_get_owners", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_103lock_break(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_102lock_break[] = "Image.lock_break(self, lock_mode, lock_owner)\n\n        Break the image lock held by a another client.\n\n        :param lock_owner: the owner of the lock to break\n        :type lock_owner: str\n        ";
static PyObject *__pyx_pw_3rbd_5Image_103lock_break(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_lock_mode = 0;
  PyObject *__pyx_v_lock_owner = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lock_break (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__lock_mode,&__pyx_n_s__lock_owner,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__lock_mode)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__lock_owner)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("lock_break", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2321; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "lock_break") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2321; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_lock_mode = values[0];
    __pyx_v_lock_owner = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("lock_break", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2321; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.lock_break", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_102lock_break(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_lock_mode, __pyx_v_lock_owner);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2321
 *         return LockOwnerIterator(self)
 * 
 *     def lock_break(self, lock_mode, lock_owner):             # <<<<<<<<<<<<<<
 *         """
 *         Break the image lock held by a another client.
 */

static PyObject *__pyx_pf_3rbd_5Image_102lock_break(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_lock_mode, PyObject *__pyx_v_lock_owner) {
  rbd_lock_mode_t __pyx_v__lock_mode;
  char *__pyx_v__lock_owner;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  rbd_lock_mode_t __pyx_t_4;
  char *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lock_break", 0);
  __Pyx_INCREF(__pyx_v_lock_owner);

  /* "rbd.pyx":2328
 *         :type lock_owner: str
 *         """
 *         lock_owner = cstr(lock_owner, 'lock_owner')             # <<<<<<<<<<<<<<
 *         cdef:
 *             rbd_lock_mode_t _lock_mode = lock_mode
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_lock_owner);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_lock_owner);
  __Pyx_GIVEREF(__pyx_v_lock_owner);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__lock_owner));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__lock_owner));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__lock_owner));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_lock_owner);
  __pyx_v_lock_owner = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":2330
 *         lock_owner = cstr(lock_owner, 'lock_owner')
 *         cdef:
 *             rbd_lock_mode_t _lock_mode = lock_mode             # <<<<<<<<<<<<<<
 *             char *_lock_owner = lock_owner
 *         with nogil:
 */
  __pyx_t_4 = ((rbd_lock_mode_t)PyInt_AsLong(__pyx_v_lock_mode)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__lock_mode = __pyx_t_4;

  /* "rbd.pyx":2331
 *         cdef:
 *             rbd_lock_mode_t _lock_mode = lock_mode
 *             char *_lock_owner = lock_owner             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_lock_break(self.image, _lock_mode, _lock_owner)
 */
  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_lock_owner); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__lock_owner = __pyx_t_5;

  /* "rbd.pyx":2332
 *             rbd_lock_mode_t _lock_mode = lock_mode
 *             char *_lock_owner = lock_owner
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_break(self.image, _lock_mode, _lock_owner)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2333
 *             char *_lock_owner = lock_owner
 *         with nogil:
 *             ret = rbd_lock_break(self.image, _lock_mode, _lock_owner)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error breaking lock on image')
 */
        __pyx_v_ret = rbd_lock_break(__pyx_v_self->image, __pyx_v__lock_mode, __pyx_v__lock_owner);
      }

      /* "rbd.pyx":2332
 *             rbd_lock_mode_t _lock_mode = lock_mode
 *             char *_lock_owner = lock_owner
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_break(self.image, _lock_mode, _lock_owner)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2334
 *         with nogil:
 *             ret = rbd_lock_break(self.image, _lock_mode, _lock_owner)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error breaking lock on image')
 * 
 */
  __pyx_t_6 = (__pyx_v_ret < 0);
  if (__pyx_t_6) {

    /* "rbd.pyx":2335
 *             ret = rbd_lock_break(self.image, _lock_mode, _lock_owner)
 *         if ret < 0:
 *             raise make_ex(ret, 'error breaking lock on image')             # <<<<<<<<<<<<<<
 * 
 *     def lock_exclusive(self, cookie):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_92)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.lock_break", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_lock_owner);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_105lock_exclusive(PyObject *__pyx_v_self, PyObject *__pyx_v_cookie); /*proto*/
static char __pyx_doc_3rbd_5Image_104lock_exclusive[] = "Image.lock_exclusive(self, cookie)\n\n        Take an exclusive lock on the image.\n\n        :raises: :class:`ImageBusy` if a different client or cookie locked it\n                 :class:`ImageExists` if the same client and cookie locked it\n        ";
static PyObject *__pyx_pw_3rbd_5Image_105lock_exclusive(PyObject *__pyx_v_self, PyObject *__pyx_v_cookie) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lock_exclusive (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_104lock_exclusive(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_cookie));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2337
 *             raise make_ex(ret, 'error breaking lock on image')
 * 
 *     def lock_exclusive(self, cookie):             # <<<<<<<<<<<<<<
 *         """
 *         Take an exclusive lock on the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_104lock_exclusive(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_cookie) {
  char *__pyx_v__cookie;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lock_exclusive", 0);
  __Pyx_INCREF(__pyx_v_cookie);

  /* "rbd.pyx":2344
 *                  :class:`ImageExists` if the same client and cookie locked it
 *         """
 *         cookie = cstr(cookie, 'cookie')             # <<<<<<<<<<<<<<
 *         cdef char *_cookie = cookie
 *         with nogil:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_cookie);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_cookie);
  __Pyx_GIVEREF(__pyx_v_cookie);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__cookie));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__cookie));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__cookie));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_cookie);
  __pyx_v_cookie = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":2345
 *         """
 *         cookie = cstr(cookie, 'cookie')
 *         cdef char *_cookie = cookie             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_lock_exclusive(self.image, _cookie)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_cookie); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__cookie = __pyx_t_4;

  /* "rbd.pyx":2346
 *         cookie = cstr(cookie, 'cookie')
 *         cdef char *_cookie = cookie
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_exclusive(self.image, _cookie)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2347
 *         cdef char *_cookie = cookie
 *         with nogil:
 *             ret = rbd_lock_exclusive(self.image, _cookie)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error acquiring exclusive lock on image')
 */
        __pyx_v_ret = rbd_lock_exclusive(__pyx_v_self->image, __pyx_v__cookie);
      }

      /* "rbd.pyx":2346
 *         cookie = cstr(cookie, 'cookie')
 *         cdef char *_cookie = cookie
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_exclusive(self.image, _cookie)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2348
 *         with nogil:
 *             ret = rbd_lock_exclusive(self.image, _cookie)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error acquiring exclusive lock on image')
 * 
 */
  __pyx_t_5 = (__pyx_v_ret < 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":2349
 *             ret = rbd_lock_exclusive(self.image, _cookie)
 *         if ret < 0:
 *             raise make_ex(ret, 'error acquiring exclusive lock on image')             # <<<<<<<<<<<<<<
 * 
 *     def lock_shared(self, cookie, tag):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_93)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.lock_exclusive", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_cookie);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_107lock_shared(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_106lock_shared[] = "Image.lock_shared(self, cookie, tag)\n\n        Take a shared lock on the image. The tag must match\n        that of the existing lockers, if any.\n\n        :raises: :class:`ImageBusy` if a different client or cookie locked it\n                 :class:`ImageExists` if the same client and cookie locked it\n        ";
static PyObject *__pyx_pw_3rbd_5Image_107lock_shared(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_cookie = 0;
  PyObject *__pyx_v_tag = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lock_shared (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__cookie,&__pyx_n_s__tag,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__cookie)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__tag)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("lock_shared", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2351; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "lock_shared") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2351; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_cookie = values[0];
    __pyx_v_tag = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("lock_shared", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2351; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.lock_shared", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_106lock_shared(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_cookie, __pyx_v_tag);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2351
 *             raise make_ex(ret, 'error acquiring exclusive lock on image')
 * 
 *     def lock_shared(self, cookie, tag):             # <<<<<<<<<<<<<<
 *         """
 *         Take a shared lock on the image. The tag must match
 */

static PyObject *__pyx_pf_3rbd_5Image_106lock_shared(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_cookie, PyObject *__pyx_v_tag) {
  char *__pyx_v__cookie;
  char *__pyx_v__tag;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lock_shared", 0);
  __Pyx_INCREF(__pyx_v_cookie);
  __Pyx_INCREF(__pyx_v_tag);

  /* "rbd.pyx":2359
 *                  :class:`ImageExists` if the same client and cookie locked it
 *         """
 *         cookie = cstr(cookie, 'cookie')             # <<<<<<<<<<<<<<
 *         tag = cstr(tag, 'tag')
 *         cdef:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_cookie);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_cookie);
  __Pyx_GIVEREF(__pyx_v_cookie);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__cookie));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__cookie));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__cookie));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_cookie);
  __pyx_v_cookie = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":2360
 *         """
 *         cookie = cstr(cookie, 'cookie')
 *         tag = cstr(tag, 'tag')             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *_cookie = cookie
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_tag);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_tag);
  __Pyx_GIVEREF(__pyx_v_tag);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__tag));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__tag));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__tag));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_tag);
  __pyx_v_tag = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":2362
 *         tag = cstr(tag, 'tag')
 *         cdef:
 *             char *_cookie = cookie             # <<<<<<<<<<<<<<
 *             char *_tag = tag
 *         with nogil:
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_cookie); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__cookie = __pyx_t_4;

  /* "rbd.pyx":2363
 *         cdef:
 *             char *_cookie = cookie
 *             char *_tag = tag             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_lock_shared(self.image, _cookie, _tag)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_tag); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2363; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__tag = __pyx_t_4;

  /* "rbd.pyx":2364
 *             char *_cookie = cookie
 *             char *_tag = tag
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_shared(self.image, _cookie, _tag)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2365
 *             char *_tag = tag
 *         with nogil:
 *             ret = rbd_lock_shared(self.image, _cookie, _tag)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error acquiring shared lock on image')
 */
        __pyx_v_ret = rbd_lock_shared(__pyx_v_self->image, __pyx_v__cookie, __pyx_v__tag);
      }

      /* "rbd.pyx":2364
 *             char *_cookie = cookie
 *             char *_tag = tag
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_lock_shared(self.image, _cookie, _tag)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2366
 *         with nogil:
 *             ret = rbd_lock_shared(self.image, _cookie, _tag)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error acquiring shared lock on image')
 * 
 */
  __pyx_t_5 = (__pyx_v_ret < 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":2367
 *             ret = rbd_lock_shared(self.image, _cookie, _tag)
 *         if ret < 0:
 *             raise make_ex(ret, 'error acquiring shared lock on image')             # <<<<<<<<<<<<<<
 * 
 *     def unlock(self, cookie):
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_1, ((PyObject *)__pyx_kp_s_94)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.lock_shared", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_cookie);
  __Pyx_XDECREF(__pyx_v_tag);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_109unlock(PyObject *__pyx_v_self, PyObject *__pyx_v_cookie); /*proto*/
static char __pyx_doc_3rbd_5Image_108unlock[] = "Image.unlock(self, cookie)\n\n        Release a lock on the image that was locked by this rados client.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_109unlock(PyObject *__pyx_v_self, PyObject *__pyx_v_cookie) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("unlock (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_108unlock(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_cookie));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2369
 *             raise make_ex(ret, 'error acquiring shared lock on image')
 * 
 *     def unlock(self, cookie):             # <<<<<<<<<<<<<<
 *         """
 *         Release a lock on the image that was locked by this rados client.
 */

static PyObject *__pyx_pf_3rbd_5Image_108unlock(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_cookie) {
  char *__pyx_v__cookie;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("unlock", 0);
  __Pyx_INCREF(__pyx_v_cookie);

  /* "rbd.pyx":2373
 *         Release a lock on the image that was locked by this rados client.
 *         """
 *         cookie = cstr(cookie, 'cookie')             # <<<<<<<<<<<<<<
 *         cdef char *_cookie = cookie
 *         with nogil:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_cookie);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_cookie);
  __Pyx_GIVEREF(__pyx_v_cookie);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__cookie));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__cookie));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__cookie));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_cookie);
  __pyx_v_cookie = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":2374
 *         """
 *         cookie = cstr(cookie, 'cookie')
 *         cdef char *_cookie = cookie             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_unlock(self.image, _cookie)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_cookie); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__cookie = __pyx_t_4;

  /* "rbd.pyx":2375
 *         cookie = cstr(cookie, 'cookie')
 *         cdef char *_cookie = cookie
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_unlock(self.image, _cookie)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2376
 *         cdef char *_cookie = cookie
 *         with nogil:
 *             ret = rbd_unlock(self.image, _cookie)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error unlocking image')
 */
        __pyx_v_ret = rbd_unlock(__pyx_v_self->image, __pyx_v__cookie);
      }

      /* "rbd.pyx":2375
 *         cookie = cstr(cookie, 'cookie')
 *         cdef char *_cookie = cookie
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_unlock(self.image, _cookie)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2377
 *         with nogil:
 *             ret = rbd_unlock(self.image, _cookie)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error unlocking image')
 * 
 */
  __pyx_t_5 = (__pyx_v_ret < 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":2378
 *             ret = rbd_unlock(self.image, _cookie)
 *         if ret < 0:
 *             raise make_ex(ret, 'error unlocking image')             # <<<<<<<<<<<<<<
 * 
 *     def break_lock(self, client, cookie):
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_95)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.unlock", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_cookie);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_111break_lock(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_110break_lock[] = "Image.break_lock(self, client, cookie)\n\n        Release a lock held by another rados client.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_111break_lock(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_client = 0;
  PyObject *__pyx_v_cookie = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("break_lock (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__client,&__pyx_n_s__cookie,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__client)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__cookie)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("break_lock", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2380; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "break_lock") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2380; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_client = values[0];
    __pyx_v_cookie = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("break_lock", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2380; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.break_lock", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_110break_lock(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_client, __pyx_v_cookie);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2380
 *             raise make_ex(ret, 'error unlocking image')
 * 
 *     def break_lock(self, client, cookie):             # <<<<<<<<<<<<<<
 *         """
 *         Release a lock held by another rados client.
 */

static PyObject *__pyx_pf_3rbd_5Image_110break_lock(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_client, PyObject *__pyx_v_cookie) {
  char *__pyx_v__client;
  char *__pyx_v__cookie;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("break_lock", 0);
  __Pyx_INCREF(__pyx_v_client);
  __Pyx_INCREF(__pyx_v_cookie);

  /* "rbd.pyx":2384
 *         Release a lock held by another rados client.
 *         """
 *         client = cstr(client, 'client')             # <<<<<<<<<<<<<<
 *         cookie = cstr(cookie, 'cookie')
 *         cdef:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_client);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_client);
  __Pyx_GIVEREF(__pyx_v_client);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__client));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__client));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__client));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_client);
  __pyx_v_client = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":2385
 *         """
 *         client = cstr(client, 'client')
 *         cookie = cstr(cookie, 'cookie')             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *_client = client
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_cookie);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_cookie);
  __Pyx_GIVEREF(__pyx_v_cookie);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__cookie));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__cookie));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__cookie));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_cookie);
  __pyx_v_cookie = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":2387
 *         cookie = cstr(cookie, 'cookie')
 *         cdef:
 *             char *_client = client             # <<<<<<<<<<<<<<
 *             char *_cookie = cookie
 *         with nogil:
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_client); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__client = __pyx_t_4;

  /* "rbd.pyx":2388
 *         cdef:
 *             char *_client = client
 *             char *_cookie = cookie             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_break_lock(self.image, _client, _cookie)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_cookie); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2388; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__cookie = __pyx_t_4;

  /* "rbd.pyx":2389
 *             char *_client = client
 *             char *_cookie = cookie
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_break_lock(self.image, _client, _cookie)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2390
 *             char *_cookie = cookie
 *         with nogil:
 *             ret = rbd_break_lock(self.image, _client, _cookie)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error unlocking image')
 */
        __pyx_v_ret = rbd_break_lock(__pyx_v_self->image, __pyx_v__client, __pyx_v__cookie);
      }

      /* "rbd.pyx":2389
 *             char *_client = client
 *             char *_cookie = cookie
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_break_lock(self.image, _client, _cookie)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2391
 *         with nogil:
 *             ret = rbd_break_lock(self.image, _client, _cookie)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error unlocking image')
 * 
 */
  __pyx_t_5 = (__pyx_v_ret < 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":2392
 *             ret = rbd_break_lock(self.image, _client, _cookie)
 *         if ret < 0:
 *             raise make_ex(ret, 'error unlocking image')             # <<<<<<<<<<<<<<
 * 
 *     def mirror_image_enable(self):
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_1, ((PyObject *)__pyx_kp_s_95)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.break_lock", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_client);
  __Pyx_XDECREF(__pyx_v_cookie);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_113mirror_image_enable(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_112mirror_image_enable[] = "Image.mirror_image_enable(self)\n\n        Enable mirroring for the image.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_113mirror_image_enable(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_image_enable (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_112mirror_image_enable(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2394
 *             raise make_ex(ret, 'error unlocking image')
 * 
 *     def mirror_image_enable(self):             # <<<<<<<<<<<<<<
 *         """
 *         Enable mirroring for the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_112mirror_image_enable(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_image_enable", 0);

  /* "rbd.pyx":2398
 *         Enable mirroring for the image.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_enable(self.image)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2399
 *         """
 *         with nogil:
 *             ret = rbd_mirror_image_enable(self.image)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error enabling mirroring for image %s'
 */
        __pyx_v_ret = rbd_mirror_image_enable(__pyx_v_self->image);
      }

      /* "rbd.pyx":2398
 *         Enable mirroring for the image.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_enable(self.image)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2400
 *         with nogil:
 *             ret = rbd_mirror_image_enable(self.image)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error enabling mirroring for image %s'
 *                           % (self.name,))
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2401
 *             ret = rbd_mirror_image_enable(self.image)
 *         if ret < 0:
 *             raise make_ex(ret, 'error enabling mirroring for image %s'             # <<<<<<<<<<<<<<
 *                           % (self.name,))
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);

    /* "rbd.pyx":2402
 *         if ret < 0:
 *             raise make_ex(ret, 'error enabling mirroring for image %s'
 *                           % (self.name,))             # <<<<<<<<<<<<<<
 * 
 *     def mirror_image_disable(self, force):
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_96), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.mirror_image_enable", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_115mirror_image_disable(PyObject *__pyx_v_self, PyObject *__pyx_v_force); /*proto*/
static char __pyx_doc_3rbd_5Image_114mirror_image_disable[] = "Image.mirror_image_disable(self, force)\n\n        Disable mirroring for the image.\n\n        :param force: force disabling\n        :type force: bool\n        ";
static PyObject *__pyx_pw_3rbd_5Image_115mirror_image_disable(PyObject *__pyx_v_self, PyObject *__pyx_v_force) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_image_disable (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_114mirror_image_disable(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_force));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2404
 *                           % (self.name,))
 * 
 *     def mirror_image_disable(self, force):             # <<<<<<<<<<<<<<
 *         """
 *         Disable mirroring for the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_114mirror_image_disable(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_force) {
  int __pyx_v_c_force;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_image_disable", 0);

  /* "rbd.pyx":2411
 *         :type force: bool
 *         """
 *         cdef bint c_force = force             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_mirror_image_disable(self.image, c_force)
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_force); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2411; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_c_force = __pyx_t_1;

  /* "rbd.pyx":2412
 *         """
 *         cdef bint c_force = force
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_disable(self.image, c_force)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2413
 *         cdef bint c_force = force
 *         with nogil:
 *             ret = rbd_mirror_image_disable(self.image, c_force)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error disabling mirroring for image %s' %
 */
        __pyx_v_ret = rbd_mirror_image_disable(__pyx_v_self->image, __pyx_v_c_force);
      }

      /* "rbd.pyx":2412
 *         """
 *         cdef bint c_force = force
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_disable(self.image, c_force)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2414
 *         with nogil:
 *             ret = rbd_mirror_image_disable(self.image, c_force)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error disabling mirroring for image %s' %
 *                           (self.name,))
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2415
 *             ret = rbd_mirror_image_disable(self.image, c_force)
 *         if ret < 0:
 *             raise make_ex(ret, 'error disabling mirroring for image %s' %             # <<<<<<<<<<<<<<
 *                           (self.name,))
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);

    /* "rbd.pyx":2416
 *         if ret < 0:
 *             raise make_ex(ret, 'error disabling mirroring for image %s' %
 *                           (self.name,))             # <<<<<<<<<<<<<<
 * 
 *     def mirror_image_promote(self, force):
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_97), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.mirror_image_disable", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_117mirror_image_promote(PyObject *__pyx_v_self, PyObject *__pyx_v_force); /*proto*/
static char __pyx_doc_3rbd_5Image_116mirror_image_promote[] = "Image.mirror_image_promote(self, force)\n\n        Promote the image to primary for mirroring.\n\n        :param force: force promoting\n        :type force: bool\n        ";
static PyObject *__pyx_pw_3rbd_5Image_117mirror_image_promote(PyObject *__pyx_v_self, PyObject *__pyx_v_force) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_image_promote (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_116mirror_image_promote(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_force));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2418
 *                           (self.name,))
 * 
 *     def mirror_image_promote(self, force):             # <<<<<<<<<<<<<<
 *         """
 *         Promote the image to primary for mirroring.
 */

static PyObject *__pyx_pf_3rbd_5Image_116mirror_image_promote(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_force) {
  int __pyx_v_c_force;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_image_promote", 0);

  /* "rbd.pyx":2425
 *         :type force: bool
 *         """
 *         cdef bint c_force = force             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_mirror_image_promote(self.image, c_force)
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_force); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_c_force = __pyx_t_1;

  /* "rbd.pyx":2426
 *         """
 *         cdef bint c_force = force
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_promote(self.image, c_force)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2427
 *         cdef bint c_force = force
 *         with nogil:
 *             ret = rbd_mirror_image_promote(self.image, c_force)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error promoting image %s to primary' %
 */
        __pyx_v_ret = rbd_mirror_image_promote(__pyx_v_self->image, __pyx_v_c_force);
      }

      /* "rbd.pyx":2426
 *         """
 *         cdef bint c_force = force
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_promote(self.image, c_force)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2428
 *         with nogil:
 *             ret = rbd_mirror_image_promote(self.image, c_force)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error promoting image %s to primary' %
 *                           (self.name,))
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2429
 *             ret = rbd_mirror_image_promote(self.image, c_force)
 *         if ret < 0:
 *             raise make_ex(ret, 'error promoting image %s to primary' %             # <<<<<<<<<<<<<<
 *                           (self.name,))
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2429; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);

    /* "rbd.pyx":2430
 *         if ret < 0:
 *             raise make_ex(ret, 'error promoting image %s to primary' %
 *                           (self.name,))             # <<<<<<<<<<<<<<
 * 
 *     def mirror_image_demote(self):
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2430; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_98), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2429; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2429; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2429; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.mirror_image_promote", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_119mirror_image_demote(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_118mirror_image_demote[] = "Image.mirror_image_demote(self)\n\n        Demote the image to secondary for mirroring.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_119mirror_image_demote(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_image_demote (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_118mirror_image_demote(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2432
 *                           (self.name,))
 * 
 *     def mirror_image_demote(self):             # <<<<<<<<<<<<<<
 *         """
 *         Demote the image to secondary for mirroring.
 */

static PyObject *__pyx_pf_3rbd_5Image_118mirror_image_demote(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_image_demote", 0);

  /* "rbd.pyx":2436
 *         Demote the image to secondary for mirroring.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_demote(self.image)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2437
 *         """
 *         with nogil:
 *             ret = rbd_mirror_image_demote(self.image)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error demoting image %s to secondary' %
 */
        __pyx_v_ret = rbd_mirror_image_demote(__pyx_v_self->image);
      }

      /* "rbd.pyx":2436
 *         Demote the image to secondary for mirroring.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_demote(self.image)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2438
 *         with nogil:
 *             ret = rbd_mirror_image_demote(self.image)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error demoting image %s to secondary' %
 *                           (self.name,))
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2439
 *             ret = rbd_mirror_image_demote(self.image)
 *         if ret < 0:
 *             raise make_ex(ret, 'error demoting image %s to secondary' %             # <<<<<<<<<<<<<<
 *                           (self.name,))
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);

    /* "rbd.pyx":2440
 *         if ret < 0:
 *             raise make_ex(ret, 'error demoting image %s to secondary' %
 *                           (self.name,))             # <<<<<<<<<<<<<<
 * 
 *     def mirror_image_resync(self):
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_99), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.mirror_image_demote", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_121mirror_image_resync(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_120mirror_image_resync[] = "Image.mirror_image_resync(self)\n\n        Flag the image to resync.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_121mirror_image_resync(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_image_resync (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_120mirror_image_resync(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2442
 *                           (self.name,))
 * 
 *     def mirror_image_resync(self):             # <<<<<<<<<<<<<<
 *         """
 *         Flag the image to resync.
 */

static PyObject *__pyx_pf_3rbd_5Image_120mirror_image_resync(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_image_resync", 0);

  /* "rbd.pyx":2446
 *         Flag the image to resync.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_resync(self.image)
 *         if ret < 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2447
 *         """
 *         with nogil:
 *             ret = rbd_mirror_image_resync(self.image)             # <<<<<<<<<<<<<<
 *         if ret < 0:
 *             raise make_ex(ret, 'error to resync image %s' % (self.name,))
 */
        __pyx_v_ret = rbd_mirror_image_resync(__pyx_v_self->image);
      }

      /* "rbd.pyx":2446
 *         Flag the image to resync.
 *         """
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_resync(self.image)
 *         if ret < 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2448
 *         with nogil:
 *             ret = rbd_mirror_image_resync(self.image)
 *         if ret < 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error to resync image %s' % (self.name,))
 * 
 */
  __pyx_t_1 = (__pyx_v_ret < 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2449
 *             ret = rbd_mirror_image_resync(self.image)
 *         if ret < 0:
 *             raise make_ex(ret, 'error to resync image %s' % (self.name,))             # <<<<<<<<<<<<<<
 * 
 *     def mirror_image_get_info(self):
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_100), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("rbd.Image.mirror_image_resync", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_123mirror_image_get_info(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_122mirror_image_get_info[] = "Image.mirror_image_get_info(self)\n\n        Get mirror info for the image.\n\n        :returns: dict - contains the following keys:\n\n            * ``global_id`` (str) - image global id\n\n            * ``state`` (int) - mirror state\n\n            * ``primary`` (bool) - is image primary\n        ";
static PyObject *__pyx_pw_3rbd_5Image_123mirror_image_get_info(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_image_get_info (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_122mirror_image_get_info(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2451
 *             raise make_ex(ret, 'error to resync image %s' % (self.name,))
 * 
 *     def mirror_image_get_info(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get mirror info for the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_122mirror_image_get_info(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  rbd_mirror_image_info_t __pyx_v_c_info;
  int __pyx_v_ret;
  PyObject *__pyx_v_info = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_image_get_info", 0);

  /* "rbd.pyx":2464
 *         """
 *         cdef rbd_mirror_image_info_t c_info
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_get_info(self.image, &c_info, sizeof(c_info))
 *         if ret != 0:
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2465
 *         cdef rbd_mirror_image_info_t c_info
 *         with nogil:
 *             ret = rbd_mirror_image_get_info(self.image, &c_info, sizeof(c_info))             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting mirror info for image %s' %
 */
        __pyx_v_ret = rbd_mirror_image_get_info(__pyx_v_self->image, (&__pyx_v_c_info), (sizeof(__pyx_v_c_info)));
      }

      /* "rbd.pyx":2464
 *         """
 *         cdef rbd_mirror_image_info_t c_info
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_get_info(self.image, &c_info, sizeof(c_info))
 *         if ret != 0:
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2466
 *         with nogil:
 *             ret = rbd_mirror_image_get_info(self.image, &c_info, sizeof(c_info))
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting mirror info for image %s' %
 *                           (self.name,))
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2467
 *             ret = rbd_mirror_image_get_info(self.image, &c_info, sizeof(c_info))
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting mirror info for image %s' %             # <<<<<<<<<<<<<<
 *                           (self.name,))
 *         info = {
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);

    /* "rbd.pyx":2468
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting mirror info for image %s' %
 *                           (self.name,))             # <<<<<<<<<<<<<<
 *         info = {
 *             'global_id' : decode_cstr(c_info.global_id),
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_101), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":2469
 *             raise make_ex(ret, 'error getting mirror info for image %s' %
 *                           (self.name,))
 *         info = {             # <<<<<<<<<<<<<<
 *             'global_id' : decode_cstr(c_info.global_id),
 *             'state'     : int(c_info.state),
 */
  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));

  /* "rbd.pyx":2470
 *                           (self.name,))
 *         info = {
 *             'global_id' : decode_cstr(c_info.global_id),             # <<<<<<<<<<<<<<
 *             'state'     : int(c_info.state),
 *             'primary'   : c_info.primary,
 */
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_c_info.global_id); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_2));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__global_id), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":2471
 *         info = {
 *             'global_id' : decode_cstr(c_info.global_id),
 *             'state'     : int(c_info.state),             # <<<<<<<<<<<<<<
 *             'primary'   : c_info.primary,
 *             }
 */
  __pyx_t_2 = PyInt_FromLong(__pyx_v_c_info.state); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__state), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":2472
 *             'global_id' : decode_cstr(c_info.global_id),
 *             'state'     : int(c_info.state),
 *             'primary'   : c_info.primary,             # <<<<<<<<<<<<<<
 *             }
 *         free(c_info.global_id)
 */
  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_c_info.primary); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__primary), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_info = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "rbd.pyx":2474
 *             'primary'   : c_info.primary,
 *             }
 *         free(c_info.global_id)             # <<<<<<<<<<<<<<
 *         return info
 * 
 */
  free(__pyx_v_c_info.global_id);

  /* "rbd.pyx":2475
 *             }
 *         free(c_info.global_id)
 *         return info             # <<<<<<<<<<<<<<
 * 
 *     def mirror_image_get_status(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_info));
  __pyx_r = ((PyObject *)__pyx_v_info);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.Image.mirror_image_get_info", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_info);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_125mirror_image_get_status(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_124mirror_image_get_status[] = "Image.mirror_image_get_status(self)\n\n        Get mirror status for the image.\n\n        :returns: dict - contains the following keys:\n\n            * ``name`` (str) - mirror image name\n\n            * `info` (dict) - mirror image info\n\n            * ``state`` (int) - status mirror state\n\n            * ``description`` (str) - status description\n\n            * ``last_update`` (datetime) - last status update time\n\n            * ``up`` (bool) - is mirroring agent up\n        ";
static PyObject *__pyx_pw_3rbd_5Image_125mirror_image_get_status(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("mirror_image_get_status (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_124mirror_image_get_status(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2477
 *         return info
 * 
 *     def mirror_image_get_status(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get mirror status for the image.
 */

static PyObject *__pyx_pf_3rbd_5Image_124mirror_image_get_status(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  rbd_mirror_image_status_t __pyx_v_c_status;
  int __pyx_v_ret;
  PyObject *__pyx_v_status = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("mirror_image_get_status", 0);

  /* "rbd.pyx":2496
 *         """
 *         cdef rbd_mirror_image_status_t c_status
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_get_status(self.image, &c_status,
 *                                               sizeof(c_status))
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2498
 *         with nogil:
 *             ret = rbd_mirror_image_get_status(self.image, &c_status,
 *                                               sizeof(c_status))             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting mirror status for image %s' %
 */
        __pyx_v_ret = rbd_mirror_image_get_status(__pyx_v_self->image, (&__pyx_v_c_status), (sizeof(__pyx_v_c_status)));
      }

      /* "rbd.pyx":2496
 *         """
 *         cdef rbd_mirror_image_status_t c_status
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_mirror_image_get_status(self.image, &c_status,
 *                                               sizeof(c_status))
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2499
 *             ret = rbd_mirror_image_get_status(self.image, &c_status,
 *                                               sizeof(c_status))
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error getting mirror status for image %s' %
 *                           (self.name,))
 */
  __pyx_t_1 = (__pyx_v_ret != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2500
 *                                               sizeof(c_status))
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting mirror status for image %s' %             # <<<<<<<<<<<<<<
 *                           (self.name,))
 *         status = {
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);

    /* "rbd.pyx":2501
 *         if ret != 0:
 *             raise make_ex(ret, 'error getting mirror status for image %s' %
 *                           (self.name,))             # <<<<<<<<<<<<<<
 *         status = {
 *             'name'      : decode_cstr(c_status.name),
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_102), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":2502
 *             raise make_ex(ret, 'error getting mirror status for image %s' %
 *                           (self.name,))
 *         status = {             # <<<<<<<<<<<<<<
 *             'name'      : decode_cstr(c_status.name),
 *             'info'      : {
 */
  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));

  /* "rbd.pyx":2503
 *                           (self.name,))
 *         status = {
 *             'name'      : decode_cstr(c_status.name),             # <<<<<<<<<<<<<<
 *             'info'      : {
 *                 'global_id' : decode_cstr(c_status.info.global_id),
 */
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2503; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_c_status.name); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2503; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2503; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_2));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2503; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__name), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":2504
 *         status = {
 *             'name'      : decode_cstr(c_status.name),
 *             'info'      : {             # <<<<<<<<<<<<<<
 *                 'global_id' : decode_cstr(c_status.info.global_id),
 *                 'state'     : int(c_status.info.state),
 */
  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2504; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));

  /* "rbd.pyx":2505
 *             'name'      : decode_cstr(c_status.name),
 *             'info'      : {
 *                 'global_id' : decode_cstr(c_status.info.global_id),             # <<<<<<<<<<<<<<
 *                 'state'     : int(c_status.info.state),
 *                 'primary'   : c_status.info.primary,
 */
  __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_c_status.info.global_id); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_4));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__global_id), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2504; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "rbd.pyx":2506
 *             'info'      : {
 *                 'global_id' : decode_cstr(c_status.info.global_id),
 *                 'state'     : int(c_status.info.state),             # <<<<<<<<<<<<<<
 *                 'primary'   : c_status.info.primary,
 *                 },
 */
  __pyx_t_4 = PyInt_FromLong(__pyx_v_c_status.info.state); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2506; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2506; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2506; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__state), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2504; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "rbd.pyx":2507
 *                 'global_id' : decode_cstr(c_status.info.global_id),
 *                 'state'     : int(c_status.info.state),
 *                 'primary'   : c_status.info.primary,             # <<<<<<<<<<<<<<
 *                 },
 *             'state'       : c_status.state,
 */
  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_c_status.info.primary); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__primary), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2504; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__info), ((PyObject *)__pyx_t_2)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;

  /* "rbd.pyx":2509
 *                 'primary'   : c_status.info.primary,
 *                 },
 *             'state'       : c_status.state,             # <<<<<<<<<<<<<<
 *             'description' : decode_cstr(c_status.description),
 *             'last_update' : datetime.fromtimestamp(c_status.last_update),
 */
  __pyx_t_2 = PyInt_FromLong(__pyx_v_c_status.state); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__state), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":2510
 *                 },
 *             'state'       : c_status.state,
 *             'description' : decode_cstr(c_status.description),             # <<<<<<<<<<<<<<
 *             'last_update' : datetime.fromtimestamp(c_status.last_update),
 *             'up'          : c_status.up,
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2510; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_c_status.description); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2510; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2510; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_4));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2510; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__description), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "rbd.pyx":2511
 *             'state'       : c_status.state,
 *             'description' : decode_cstr(c_status.description),
 *             'last_update' : datetime.fromtimestamp(c_status.last_update),             # <<<<<<<<<<<<<<
 *             'up'          : c_status.up,
 *             }
 */
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__datetime); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s__fromtimestamp); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyInt_to_py_time_t(__pyx_v_c_status.last_update); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__last_update), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "rbd.pyx":2512
 *             'description' : decode_cstr(c_status.description),
 *             'last_update' : datetime.fromtimestamp(c_status.last_update),
 *             'up'          : c_status.up,             # <<<<<<<<<<<<<<
 *             }
 *         free(c_status.name)
 */
  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_c_status.up); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2512; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__up), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_status = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "rbd.pyx":2514
 *             'up'          : c_status.up,
 *             }
 *         free(c_status.name)             # <<<<<<<<<<<<<<
 *         free(c_status.info.global_id)
 *         free(c_status.description)
 */
  free(__pyx_v_c_status.name);

  /* "rbd.pyx":2515
 *             }
 *         free(c_status.name)
 *         free(c_status.info.global_id)             # <<<<<<<<<<<<<<
 *         free(c_status.description)
 *         return status
 */
  free(__pyx_v_c_status.info.global_id);

  /* "rbd.pyx":2516
 *         free(c_status.name)
 *         free(c_status.info.global_id)
 *         free(c_status.description)             # <<<<<<<<<<<<<<
 *         return status
 * 
 */
  free(__pyx_v_c_status.description);

  /* "rbd.pyx":2517
 *         free(c_status.info.global_id)
 *         free(c_status.description)
 *         return status             # <<<<<<<<<<<<<<
 * 
 *     def aio_read(self, offset, length, oncomplete, fadvise_flags=0):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_status));
  __pyx_r = ((PyObject *)__pyx_v_status);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("rbd.Image.mirror_image_get_status", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_status);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_127aio_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_126aio_read[] = "Image.aio_read(self, offset, length, oncomplete, fadvise_flags=0)\n\n        Asynchronously read data from the image\n\n        Raises :class:`InvalidArgument` if part of the range specified is\n        outside the image.\n\n        oncomplete will be called with the returned read value as\n        well as the completion:\n\n        oncomplete(completion, data_read)\n\n        :param offset: the offset to start reading at\n        :type offset: int\n        :param length: how many bytes to read\n        :type length: int\n        :param oncomplete: what to do when the read is complete\n        :type oncomplete: completion\n        :param fadvise_flags: fadvise flags for this read\n        :type fadvise_flags: int\n        :returns: :class:`Completion` - the completion object\n        :raises: :class:`InvalidArgument`, :class:`IOError`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_127aio_read(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_length = 0;
  PyObject *__pyx_v_oncomplete = 0;
  PyObject *__pyx_v_fadvise_flags = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("aio_read (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__offset,&__pyx_n_s__length,&__pyx_n_s__oncomplete,&__pyx_n_s__fadvise_flags,0};
    PyObject* values[4] = {0,0,0,0};
    values[3] = ((PyObject *)__pyx_int_0);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__offset)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__length)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("aio_read", 0, 3, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2519; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__oncomplete)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("aio_read", 0, 3, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2519; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fadvise_flags);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "aio_read") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2519; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_offset = values[0];
    __pyx_v_length = values[1];
    __pyx_v_oncomplete = values[2];
    __pyx_v_fadvise_flags = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("aio_read", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2519; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.aio_read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_126aio_read(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_offset, __pyx_v_length, __pyx_v_oncomplete, __pyx_v_fadvise_flags);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_8aio_read_1oncomplete_(PyObject *__pyx_self, PyObject *__pyx_v_completion_v); /*proto*/
static PyMethodDef __pyx_mdef_3rbd_5Image_8aio_read_1oncomplete_ = {__Pyx_NAMESTR("oncomplete_"), (PyCFunction)__pyx_pw_3rbd_5Image_8aio_read_1oncomplete_, METH_O, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pw_3rbd_5Image_8aio_read_1oncomplete_(PyObject *__pyx_self, PyObject *__pyx_v_completion_v) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("oncomplete_ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_8aio_read_oncomplete_(__pyx_self, ((PyObject *)__pyx_v_completion_v));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2550
 *             Completion completion
 * 
 *         def oncomplete_(completion_v):             # <<<<<<<<<<<<<<
 *             cdef Completion _completion_v = completion_v
 *             return_value = _completion_v.get_return_value()
 */

static PyObject *__pyx_pf_3rbd_5Image_8aio_read_oncomplete_(PyObject *__pyx_self, PyObject *__pyx_v_completion_v) {
  struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *__pyx_cur_scope;
  struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *__pyx_outer_scope;
  struct __pyx_obj_3rbd_Completion *__pyx_v__completion_v = 0;
  PyObject *__pyx_v_return_value = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  int __pyx_t_5;
  Py_ssize_t __pyx_t_6;
  int __pyx_t_7;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("oncomplete_", 0);
  __pyx_outer_scope = (struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *) __Pyx_CyFunction_GetClosure(__pyx_self);
  __pyx_cur_scope = __pyx_outer_scope;

  /* "rbd.pyx":2551
 * 
 *         def oncomplete_(completion_v):
 *             cdef Completion _completion_v = completion_v             # <<<<<<<<<<<<<<
 *             return_value = _completion_v.get_return_value()
 *             if return_value > 0 and return_value != length:
 */
  if (!(likely(((__pyx_v_completion_v) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_completion_v, __pyx_ptype_3rbd_Completion))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2551; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_INCREF(__pyx_v_completion_v);
  __pyx_v__completion_v = ((struct __pyx_obj_3rbd_Completion *)__pyx_v_completion_v);

  /* "rbd.pyx":2552
 *         def oncomplete_(completion_v):
 *             cdef Completion _completion_v = completion_v
 *             return_value = _completion_v.get_return_value()             # <<<<<<<<<<<<<<
 *             if return_value > 0 and return_value != length:
 *                 _PyBytes_Resize(&_completion_v.buf, return_value)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v__completion_v), __pyx_n_s__get_return_value); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2552; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2552; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_return_value = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "rbd.pyx":2553
 *             cdef Completion _completion_v = completion_v
 *             return_value = _completion_v.get_return_value()
 *             if return_value > 0 and return_value != length:             # <<<<<<<<<<<<<<
 *                 _PyBytes_Resize(&_completion_v.buf, return_value)
 *             return oncomplete(_completion_v, <object>_completion_v.buf if return_value >= 0 else None)
 */
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_return_value, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2553; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2553; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {
    if (unlikely(!__pyx_cur_scope->__pyx_v_length)) { __Pyx_RaiseClosureNameError("length"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2553; __pyx_clineno = __LINE__; goto __pyx_L1_error;} }
    __pyx_t_2 = PyObject_RichCompare(__pyx_v_return_value, __pyx_cur_scope->__pyx_v_length, Py_NE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2553; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2553; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_3;
  }
  if (__pyx_t_5) {

    /* "rbd.pyx":2554
 *             return_value = _completion_v.get_return_value()
 *             if return_value > 0 and return_value != length:
 *                 _PyBytes_Resize(&_completion_v.buf, return_value)             # <<<<<<<<<<<<<<
 *             return oncomplete(_completion_v, <object>_completion_v.buf if return_value >= 0 else None)
 * 
 */
    __pyx_t_6 = __Pyx_PyIndex_AsSsize_t(__pyx_v_return_value); if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_7 = _PyBytes_Resize((&__pyx_v__completion_v->buf), __pyx_t_6); if (unlikely(__pyx_t_7 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "rbd.pyx":2555
 *             if return_value > 0 and return_value != length:
 *                 _PyBytes_Resize(&_completion_v.buf, return_value)
 *             return oncomplete(_completion_v, <object>_completion_v.buf if return_value >= 0 else None)             # <<<<<<<<<<<<<<
 * 
 *         completion = self.__get_completion(oncomplete_)
 */
  __Pyx_XDECREF(__pyx_r);
  if (unlikely(!__pyx_cur_scope->__pyx_v_oncomplete)) { __Pyx_RaiseClosureNameError("oncomplete"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2555; __pyx_clineno = __LINE__; goto __pyx_L1_error;} }
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_return_value, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_5) {
    __Pyx_INCREF(((PyObject *)__pyx_v__completion_v->buf));
    __pyx_t_2 = ((PyObject *)__pyx_v__completion_v->buf);
  } else {
    __Pyx_INCREF(Py_None);
    __pyx_t_2 = Py_None;
  }
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v__completion_v));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v__completion_v));
  __Pyx_GIVEREF(((PyObject *)__pyx_v__completion_v));
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_cur_scope->__pyx_v_oncomplete, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.Image.aio_read.oncomplete_", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v__completion_v);
  __Pyx_XDECREF(__pyx_v_return_value);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2519
 *         return status
 * 
 *     def aio_read(self, offset, length, oncomplete, fadvise_flags=0):             # <<<<<<<<<<<<<<
 *         """
 *         Asynchronously read data from the image
 */

static PyObject *__pyx_pf_3rbd_5Image_126aio_read(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length, PyObject *__pyx_v_oncomplete, PyObject *__pyx_v_fadvise_flags) {
  struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *__pyx_cur_scope;
  char *__pyx_v_ret_buf;
  uint64_t __pyx_v__offset;
  size_t __pyx_v__length;
  int __pyx_v__fadvise_flags;
  struct __pyx_obj_3rbd_Completion *__pyx_v_completion = 0;
  PyObject *__pyx_v_oncomplete_ = 0;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  uint64_t __pyx_t_1;
  size_t __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *__pyx_t_8;
  char *__pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  PyObject *__pyx_t_14 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("aio_read", 0);
  __pyx_cur_scope = (struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *)__pyx_tp_new_3rbd___pyx_scope_struct_2_aio_read(__pyx_ptype_3rbd___pyx_scope_struct_2_aio_read, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_length = __pyx_v_length;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_length);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_length);
  __pyx_cur_scope->__pyx_v_oncomplete = __pyx_v_oncomplete;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_oncomplete);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_oncomplete);

  /* "rbd.pyx":2545
 *         cdef:
 *             char *ret_buf
 *             uint64_t _offset = offset             # <<<<<<<<<<<<<<
 *             size_t _length = length
 *             int _fadvise_flags = fadvise_flags
 */
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_offset); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__offset = __pyx_t_1;

  /* "rbd.pyx":2546
 *             char *ret_buf
 *             uint64_t _offset = offset
 *             size_t _length = length             # <<<<<<<<<<<<<<
 *             int _fadvise_flags = fadvise_flags
 *             Completion completion
 */
  __pyx_t_2 = __Pyx_PyInt_AsSize_t(__pyx_cur_scope->__pyx_v_length); if (unlikely((__pyx_t_2 == (size_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2546; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__length = __pyx_t_2;

  /* "rbd.pyx":2547
 *             uint64_t _offset = offset
 *             size_t _length = length
 *             int _fadvise_flags = fadvise_flags             # <<<<<<<<<<<<<<
 *             Completion completion
 * 
 */
  __pyx_t_3 = __Pyx_PyInt_AsInt(__pyx_v_fadvise_flags); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__fadvise_flags = __pyx_t_3;

  /* "rbd.pyx":2550
 *             Completion completion
 * 
 *         def oncomplete_(completion_v):             # <<<<<<<<<<<<<<
 *             cdef Completion _completion_v = completion_v
 *             return_value = _completion_v.get_return_value()
 */
  __pyx_t_4 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_5Image_8aio_read_1oncomplete_, 0, __pyx_n_s_106, ((PyObject*)__pyx_cur_scope), __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_104)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2550; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v_oncomplete_ = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "rbd.pyx":2557
 *             return oncomplete(_completion_v, <object>_completion_v.buf if return_value >= 0 else None)
 * 
 *         completion = self.__get_completion(oncomplete_)             # <<<<<<<<<<<<<<
 *         completion.buf = PyBytes_FromStringAndSize(NULL, length)
 *         ret_buf = PyBytes_AsString(completion.buf)
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s____get_completion); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_v_oncomplete_);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_oncomplete_);
  __Pyx_GIVEREF(__pyx_v_oncomplete_);
  __pyx_t_6 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_3rbd_Completion))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_completion = ((struct __pyx_obj_3rbd_Completion *)__pyx_t_6);
  __pyx_t_6 = 0;

  /* "rbd.pyx":2558
 * 
 *         completion = self.__get_completion(oncomplete_)
 *         completion.buf = PyBytes_FromStringAndSize(NULL, length)             # <<<<<<<<<<<<<<
 *         ret_buf = PyBytes_AsString(completion.buf)
 *         try:
 */
  __pyx_t_7 = __Pyx_PyIndex_AsSsize_t(__pyx_cur_scope->__pyx_v_length); if (unlikely((__pyx_t_7 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_8 = PyBytes_FromStringAndSize(NULL, __pyx_t_7); if (unlikely(__pyx_t_8 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_completion->buf = __pyx_t_8;

  /* "rbd.pyx":2559
 *         completion = self.__get_completion(oncomplete_)
 *         completion.buf = PyBytes_FromStringAndSize(NULL, length)
 *         ret_buf = PyBytes_AsString(completion.buf)             # <<<<<<<<<<<<<<
 *         try:
 *             completion.__persist()
 */
  __pyx_t_9 = PyBytes_AsString(__pyx_v_completion->buf); if (unlikely(__pyx_t_9 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_ret_buf = __pyx_t_9;

  /* "rbd.pyx":2560
 *         completion.buf = PyBytes_FromStringAndSize(NULL, length)
 *         ret_buf = PyBytes_AsString(completion.buf)
 *         try:             # <<<<<<<<<<<<<<
 *             completion.__persist()
 *             with nogil:
 */
  {
    __Pyx_ExceptionSave(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
    __Pyx_XGOTREF(__pyx_t_10);
    __Pyx_XGOTREF(__pyx_t_11);
    __Pyx_XGOTREF(__pyx_t_12);
    /*try:*/ {

      /* "rbd.pyx":2561
 *         ret_buf = PyBytes_AsString(completion.buf)
 *         try:
 *             completion.__persist()             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_aio_read2(self.image, _offset, _length, ret_buf,
 */
      __pyx_t_6 = ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_completion->__pyx_vtab)->__pyx___persist(__pyx_v_completion); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2561; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "rbd.pyx":2562
 *         try:
 *             completion.__persist()
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_aio_read2(self.image, _offset, _length, ret_buf,
 *                                     completion.rbd_comp, _fadvise_flags)
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":2564
 *             with nogil:
 *                 ret = rbd_aio_read2(self.image, _offset, _length, ret_buf,
 *                                     completion.rbd_comp, _fadvise_flags)             # <<<<<<<<<<<<<<
 *             if ret < 0:
 *                 raise make_ex(ret, 'error reading %s %ld~%ld' %
 */
            __pyx_v_ret = rbd_aio_read2(__pyx_v_self->image, __pyx_v__offset, __pyx_v__length, __pyx_v_ret_buf, __pyx_v_completion->rbd_comp, __pyx_v__fadvise_flags);
          }

          /* "rbd.pyx":2562
 *         try:
 *             completion.__persist()
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_aio_read2(self.image, _offset, _length, ret_buf,
 *                                     completion.rbd_comp, _fadvise_flags)
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":2565
 *                 ret = rbd_aio_read2(self.image, _offset, _length, ret_buf,
 *                                     completion.rbd_comp, _fadvise_flags)
 *             if ret < 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error reading %s %ld~%ld' %
 *                               (self.name, offset, length))
 */
      __pyx_t_13 = (__pyx_v_ret < 0);
      if (__pyx_t_13) {

        /* "rbd.pyx":2566
 *                                     completion.rbd_comp, _fadvise_flags)
 *             if ret < 0:
 *                 raise make_ex(ret, 'error reading %s %ld~%ld' %             # <<<<<<<<<<<<<<
 *                               (self.name, offset, length))
 *         except:
 */
        __pyx_t_6 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2566; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_6);

        /* "rbd.pyx":2567
 *             if ret < 0:
 *                 raise make_ex(ret, 'error reading %s %ld~%ld' %
 *                               (self.name, offset, length))             # <<<<<<<<<<<<<<
 *         except:
 *             completion.__unpersist()
 */
        __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2567; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_v_self->name);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_self->name);
        __Pyx_GIVEREF(__pyx_v_self->name);
        __Pyx_INCREF(__pyx_v_offset);
        PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_offset);
        __Pyx_GIVEREF(__pyx_v_offset);
        __Pyx_INCREF(__pyx_cur_scope->__pyx_v_length);
        PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_cur_scope->__pyx_v_length);
        __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_length);
        __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_67), ((PyObject *)__pyx_t_5)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2566; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_4));
        __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
        __pyx_t_5 = __pyx_f_3rbd_make_ex(__pyx_t_6, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2566; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2566; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        goto __pyx_L16;
      }
      __pyx_L16:;
    }
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
    goto __pyx_L10_try_end;
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "rbd.pyx":2568
 *                 raise make_ex(ret, 'error reading %s %ld~%ld' %
 *                               (self.name, offset, length))
 *         except:             # <<<<<<<<<<<<<<
 *             completion.__unpersist()
 *             raise
 */
    /*except:*/ {
      __Pyx_AddTraceback("rbd.Image.aio_read", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_4, &__pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2568; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GOTREF(__pyx_t_6);

      /* "rbd.pyx":2569
 *                               (self.name, offset, length))
 *         except:
 *             completion.__unpersist()             # <<<<<<<<<<<<<<
 *             raise
 * 
 */
      __pyx_t_14 = ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_completion->__pyx_vtab)->__pyx___unpersist(__pyx_v_completion); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2569; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_14);
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;

      /* "rbd.pyx":2570
 *         except:
 *             completion.__unpersist()
 *             raise             # <<<<<<<<<<<<<<
 * 
 *         return completion
 */
      __Pyx_GIVEREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_6);
      __Pyx_ErrRestore(__pyx_t_5, __pyx_t_4, __pyx_t_6);
      __pyx_t_5 = 0; __pyx_t_4 = 0; __pyx_t_6 = 0; 
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2570; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L4_exception_handled;
    }
    __pyx_L5_except_error:;
    __Pyx_XGIVEREF(__pyx_t_10);
    __Pyx_XGIVEREF(__pyx_t_11);
    __Pyx_XGIVEREF(__pyx_t_12);
    __Pyx_ExceptionReset(__pyx_t_10, __pyx_t_11, __pyx_t_12);
    goto __pyx_L1_error;
    __pyx_L4_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_10);
    __Pyx_XGIVEREF(__pyx_t_11);
    __Pyx_XGIVEREF(__pyx_t_12);
    __Pyx_ExceptionReset(__pyx_t_10, __pyx_t_11, __pyx_t_12);
    __pyx_L10_try_end:;
  }

  /* "rbd.pyx":2572
 *             raise
 * 
 *         return completion             # <<<<<<<<<<<<<<
 * 
 *     def aio_write(self, data, offset, oncomplete, fadvise_flags=0):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_completion));
  __pyx_r = ((PyObject *)__pyx_v_completion);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_AddTraceback("rbd.Image.aio_read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_completion);
  __Pyx_XDECREF(__pyx_v_oncomplete_);
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_129aio_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_128aio_write[] = "Image.aio_write(self, data, offset, oncomplete, fadvise_flags=0)\n\n        Asynchronously write data to the image\n\n        Raises :class:`InvalidArgument` if part of the write would fall outside\n        the image.\n\n        oncomplete will be called with the completion:\n\n        oncomplete(completion)\n\n        :param data: the data to be written\n        :type data: bytes\n        :param offset: the offset to start writing at\n        :type offset: int\n        :param oncomplete: what to do when the write is complete\n        :type oncomplete: completion\n        :param fadvise_flags: fadvise flags for this write\n        :type fadvise_flags: int\n        :returns: :class:`Completion` - the completion object\n        :raises: :class:`InvalidArgument`, :class:`IOError`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_129aio_write(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_oncomplete = 0;
  PyObject *__pyx_v_fadvise_flags = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("aio_write (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__data,&__pyx_n_s__offset,&__pyx_n_s__oncomplete,&__pyx_n_s__fadvise_flags,0};
    PyObject* values[4] = {0,0,0,0};
    values[3] = ((PyObject *)__pyx_int_0);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__data)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__offset)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("aio_write", 0, 3, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2574; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__oncomplete)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("aio_write", 0, 3, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2574; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fadvise_flags);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "aio_write") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2574; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = values[0];
    __pyx_v_offset = values[1];
    __pyx_v_oncomplete = values[2];
    __pyx_v_fadvise_flags = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("aio_write", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2574; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.aio_write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_128aio_write(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_data, __pyx_v_offset, __pyx_v_oncomplete, __pyx_v_fadvise_flags);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2574
 *         return completion
 * 
 *     def aio_write(self, data, offset, oncomplete, fadvise_flags=0):             # <<<<<<<<<<<<<<
 *         """
 *         Asynchronously write data to the image
 */

static PyObject *__pyx_pf_3rbd_5Image_128aio_write(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_data, PyObject *__pyx_v_offset, PyObject *__pyx_v_oncomplete, PyObject *__pyx_v_fadvise_flags) {
  uint64_t __pyx_v__offset;
  char *__pyx_v__data;
  size_t __pyx_v__length;
  int __pyx_v__fadvise_flags;
  struct __pyx_obj_3rbd_Completion *__pyx_v_completion = 0;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  uint64_t __pyx_t_1;
  char *__pyx_t_2;
  Py_ssize_t __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("aio_write", 0);

  /* "rbd.pyx":2598
 * 
 *         cdef:
 *             uint64_t _offset = offset             # <<<<<<<<<<<<<<
 *             char *_data = data
 *             size_t _length = len(data)
 */
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_offset); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2598; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__offset = __pyx_t_1;

  /* "rbd.pyx":2599
 *         cdef:
 *             uint64_t _offset = offset
 *             char *_data = data             # <<<<<<<<<<<<<<
 *             size_t _length = len(data)
 *             int _fadvise_flags = fadvise_flags
 */
  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_data); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__data = __pyx_t_2;

  /* "rbd.pyx":2600
 *             uint64_t _offset = offset
 *             char *_data = data
 *             size_t _length = len(data)             # <<<<<<<<<<<<<<
 *             int _fadvise_flags = fadvise_flags
 *             Completion completion
 */
  __pyx_t_3 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2600; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__length = __pyx_t_3;

  /* "rbd.pyx":2601
 *             char *_data = data
 *             size_t _length = len(data)
 *             int _fadvise_flags = fadvise_flags             # <<<<<<<<<<<<<<
 *             Completion completion
 * 
 */
  __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_v_fadvise_flags); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2601; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__fadvise_flags = __pyx_t_4;

  /* "rbd.pyx":2604
 *             Completion completion
 * 
 *         completion = self.__get_completion(oncomplete)             # <<<<<<<<<<<<<<
 *         try:
 *             completion.__persist()
 */
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s____get_completion); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_INCREF(__pyx_v_oncomplete);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_oncomplete);
  __Pyx_GIVEREF(__pyx_v_oncomplete);
  __pyx_t_7 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_3rbd_Completion))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_completion = ((struct __pyx_obj_3rbd_Completion *)__pyx_t_7);
  __pyx_t_7 = 0;

  /* "rbd.pyx":2605
 * 
 *         completion = self.__get_completion(oncomplete)
 *         try:             # <<<<<<<<<<<<<<
 *             completion.__persist()
 *             with nogil:
 */
  {
    __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
    __Pyx_XGOTREF(__pyx_t_8);
    __Pyx_XGOTREF(__pyx_t_9);
    __Pyx_XGOTREF(__pyx_t_10);
    /*try:*/ {

      /* "rbd.pyx":2606
 *         completion = self.__get_completion(oncomplete)
 *         try:
 *             completion.__persist()             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_aio_write2(self.image, _offset, _length, _data,
 */
      __pyx_t_7 = ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_completion->__pyx_vtab)->__pyx___persist(__pyx_v_completion); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2606; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "rbd.pyx":2607
 *         try:
 *             completion.__persist()
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_aio_write2(self.image, _offset, _length, _data,
 *                                      completion.rbd_comp, _fadvise_flags)
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":2609
 *             with nogil:
 *                 ret = rbd_aio_write2(self.image, _offset, _length, _data,
 *                                      completion.rbd_comp, _fadvise_flags)             # <<<<<<<<<<<<<<
 *             if ret < 0:
 *                 raise make_ex(ret, 'error writing %s %ld~%ld' %
 */
            __pyx_v_ret = rbd_aio_write2(__pyx_v_self->image, __pyx_v__offset, __pyx_v__length, __pyx_v__data, __pyx_v_completion->rbd_comp, __pyx_v__fadvise_flags);
          }

          /* "rbd.pyx":2607
 *         try:
 *             completion.__persist()
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_aio_write2(self.image, _offset, _length, _data,
 *                                      completion.rbd_comp, _fadvise_flags)
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":2610
 *                 ret = rbd_aio_write2(self.image, _offset, _length, _data,
 *                                      completion.rbd_comp, _fadvise_flags)
 *             if ret < 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error writing %s %ld~%ld' %
 *                               (self.name, offset, _length))
 */
      __pyx_t_11 = (__pyx_v_ret < 0);
      if (__pyx_t_11) {

        /* "rbd.pyx":2611
 *                                      completion.rbd_comp, _fadvise_flags)
 *             if ret < 0:
 *                 raise make_ex(ret, 'error writing %s %ld~%ld' %             # <<<<<<<<<<<<<<
 *                               (self.name, offset, _length))
 *         except:
 */
        __pyx_t_7 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2611; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_7);

        /* "rbd.pyx":2612
 *             if ret < 0:
 *                 raise make_ex(ret, 'error writing %s %ld~%ld' %
 *                               (self.name, offset, _length))             # <<<<<<<<<<<<<<
 *         except:
 *             completion.__unpersist()
 */
        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v__length); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2612; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2612; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_v_self->name);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_self->name);
        __Pyx_GIVEREF(__pyx_v_self->name);
        __Pyx_INCREF(__pyx_v_offset);
        PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_offset);
        __Pyx_GIVEREF(__pyx_v_offset);
        PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_6);
        __pyx_t_6 = 0;
        __pyx_t_6 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_107), ((PyObject *)__pyx_t_5)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2611; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_6));
        __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
        __pyx_t_5 = __pyx_f_3rbd_make_ex(__pyx_t_7, ((PyObject *)__pyx_t_6)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2611; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2611; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        goto __pyx_L16;
      }
      __pyx_L16:;
    }
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    goto __pyx_L10_try_end;
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "rbd.pyx":2613
 *                 raise make_ex(ret, 'error writing %s %ld~%ld' %
 *                               (self.name, offset, _length))
 *         except:             # <<<<<<<<<<<<<<
 *             completion.__unpersist()
 *             raise
 */
    /*except:*/ {
      __Pyx_AddTraceback("rbd.Image.aio_write", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2613; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GOTREF(__pyx_t_7);

      /* "rbd.pyx":2614
 *                               (self.name, offset, _length))
 *         except:
 *             completion.__unpersist()             # <<<<<<<<<<<<<<
 *             raise
 * 
 */
      __pyx_t_12 = ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_completion->__pyx_vtab)->__pyx___unpersist(__pyx_v_completion); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2614; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

      /* "rbd.pyx":2615
 *         except:
 *             completion.__unpersist()
 *             raise             # <<<<<<<<<<<<<<
 * 
 *         return completion
 */
      __Pyx_GIVEREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_7);
      __Pyx_ErrRestore(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      __pyx_t_5 = 0; __pyx_t_6 = 0; __pyx_t_7 = 0; 
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2615; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L4_exception_handled;
    }
    __pyx_L5_except_error:;
    __Pyx_XGIVEREF(__pyx_t_8);
    __Pyx_XGIVEREF(__pyx_t_9);
    __Pyx_XGIVEREF(__pyx_t_10);
    __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
    goto __pyx_L1_error;
    __pyx_L4_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_8);
    __Pyx_XGIVEREF(__pyx_t_9);
    __Pyx_XGIVEREF(__pyx_t_10);
    __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
    __pyx_L10_try_end:;
  }

  /* "rbd.pyx":2617
 *             raise
 * 
 *         return completion             # <<<<<<<<<<<<<<
 * 
 *     def aio_discard(self, offset, length, oncomplete):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_completion));
  __pyx_r = ((PyObject *)__pyx_v_completion);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("rbd.Image.aio_write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_completion);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_131aio_discard(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_130aio_discard[] = "Image.aio_discard(self, offset, length, oncomplete)\n\n        Asynchronously trim the range from the image. It will be logically\n        filled with zeroes.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_131aio_discard(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_offset = 0;
  PyObject *__pyx_v_length = 0;
  PyObject *__pyx_v_oncomplete = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("aio_discard (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__offset,&__pyx_n_s__length,&__pyx_n_s__oncomplete,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__offset)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__length)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("aio_discard", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2619; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__oncomplete)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("aio_discard", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2619; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "aio_discard") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2619; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_offset = values[0];
    __pyx_v_length = values[1];
    __pyx_v_oncomplete = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("aio_discard", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2619; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.aio_discard", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_130aio_discard(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_offset, __pyx_v_length, __pyx_v_oncomplete);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2619
 *         return completion
 * 
 *     def aio_discard(self, offset, length, oncomplete):             # <<<<<<<<<<<<<<
 *         """
 *         Asynchronously trim the range from the image. It will be logically
 */

static PyObject *__pyx_pf_3rbd_5Image_130aio_discard(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_offset, PyObject *__pyx_v_length, PyObject *__pyx_v_oncomplete) {
  uint64_t __pyx_v__offset;
  size_t __pyx_v__length;
  struct __pyx_obj_3rbd_Completion *__pyx_v_completion = 0;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  uint64_t __pyx_t_1;
  size_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("aio_discard", 0);

  /* "rbd.pyx":2626
 * 
 *         cdef:
 *             uint64_t _offset = offset             # <<<<<<<<<<<<<<
 *             size_t _length = length
 *             Completion completion
 */
  __pyx_t_1 = __Pyx_PyInt_from_py_uint64_t(__pyx_v_offset); if (unlikely((__pyx_t_1 == (uint64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__offset = __pyx_t_1;

  /* "rbd.pyx":2627
 *         cdef:
 *             uint64_t _offset = offset
 *             size_t _length = length             # <<<<<<<<<<<<<<
 *             Completion completion
 * 
 */
  __pyx_t_2 = __Pyx_PyInt_AsSize_t(__pyx_v_length); if (unlikely((__pyx_t_2 == (size_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2627; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__length = __pyx_t_2;

  /* "rbd.pyx":2630
 *             Completion completion
 * 
 *         completion = self.__get_completion(oncomplete)             # <<<<<<<<<<<<<<
 *         try:
 *             completion.__persist()
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s____get_completion); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_v_oncomplete);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_oncomplete);
  __Pyx_GIVEREF(__pyx_v_oncomplete);
  __pyx_t_5 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_3rbd_Completion))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_completion = ((struct __pyx_obj_3rbd_Completion *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "rbd.pyx":2631
 * 
 *         completion = self.__get_completion(oncomplete)
 *         try:             # <<<<<<<<<<<<<<
 *             completion.__persist()
 *             with nogil:
 */
  {
    __Pyx_ExceptionSave(&__pyx_t_6, &__pyx_t_7, &__pyx_t_8);
    __Pyx_XGOTREF(__pyx_t_6);
    __Pyx_XGOTREF(__pyx_t_7);
    __Pyx_XGOTREF(__pyx_t_8);
    /*try:*/ {

      /* "rbd.pyx":2632
 *         completion = self.__get_completion(oncomplete)
 *         try:
 *             completion.__persist()             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_aio_discard(self.image, _offset, _length,
 */
      __pyx_t_5 = ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_completion->__pyx_vtab)->__pyx___persist(__pyx_v_completion); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2632; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "rbd.pyx":2633
 *         try:
 *             completion.__persist()
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_aio_discard(self.image, _offset, _length,
 *                                      completion.rbd_comp)
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":2635
 *             with nogil:
 *                 ret = rbd_aio_discard(self.image, _offset, _length,
 *                                      completion.rbd_comp)             # <<<<<<<<<<<<<<
 *             if ret < 0:
 *                 raise make_ex(ret, 'error discarding %s %ld~%ld' %
 */
            __pyx_v_ret = rbd_aio_discard(__pyx_v_self->image, __pyx_v__offset, __pyx_v__length, __pyx_v_completion->rbd_comp);
          }

          /* "rbd.pyx":2633
 *         try:
 *             completion.__persist()
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_aio_discard(self.image, _offset, _length,
 *                                      completion.rbd_comp)
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":2636
 *                 ret = rbd_aio_discard(self.image, _offset, _length,
 *                                      completion.rbd_comp)
 *             if ret < 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error discarding %s %ld~%ld' %
 *                               (self.name, offset, _length))
 */
      __pyx_t_9 = (__pyx_v_ret < 0);
      if (__pyx_t_9) {

        /* "rbd.pyx":2637
 *                                      completion.rbd_comp)
 *             if ret < 0:
 *                 raise make_ex(ret, 'error discarding %s %ld~%ld' %             # <<<<<<<<<<<<<<
 *                               (self.name, offset, _length))
 *         except:
 */
        __pyx_t_5 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2637; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_5);

        /* "rbd.pyx":2638
 *             if ret < 0:
 *                 raise make_ex(ret, 'error discarding %s %ld~%ld' %
 *                               (self.name, offset, _length))             # <<<<<<<<<<<<<<
 *         except:
 *             completion.__unpersist()
 */
        __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_v__length); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2638; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2638; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_v_self->name);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_self->name);
        __Pyx_GIVEREF(__pyx_v_self->name);
        __Pyx_INCREF(__pyx_v_offset);
        PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_offset);
        __Pyx_GIVEREF(__pyx_v_offset);
        PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        __pyx_t_4 = 0;
        __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_108), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2637; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_4));
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_5, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2637; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        __Pyx_Raise(__pyx_t_3, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2637; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        goto __pyx_L16;
      }
      __pyx_L16:;
    }
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    goto __pyx_L10_try_end;
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "rbd.pyx":2639
 *                 raise make_ex(ret, 'error discarding %s %ld~%ld' %
 *                               (self.name, offset, _length))
 *         except:             # <<<<<<<<<<<<<<
 *             completion.__unpersist()
 *             raise
 */
    /*except:*/ {
      __Pyx_AddTraceback("rbd.Image.aio_discard", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_4, &__pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2639; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GOTREF(__pyx_t_5);

      /* "rbd.pyx":2640
 *                               (self.name, offset, _length))
 *         except:
 *             completion.__unpersist()             # <<<<<<<<<<<<<<
 *             raise
 * 
 */
      __pyx_t_10 = ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_completion->__pyx_vtab)->__pyx___unpersist(__pyx_v_completion); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2640; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "rbd.pyx":2641
 *         except:
 *             completion.__unpersist()
 *             raise             # <<<<<<<<<<<<<<
 * 
 *         return completion
 */
      __Pyx_GIVEREF(__pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_5);
      __Pyx_ErrRestore(__pyx_t_3, __pyx_t_4, __pyx_t_5);
      __pyx_t_3 = 0; __pyx_t_4 = 0; __pyx_t_5 = 0; 
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2641; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      goto __pyx_L4_exception_handled;
    }
    __pyx_L5_except_error:;
    __Pyx_XGIVEREF(__pyx_t_6);
    __Pyx_XGIVEREF(__pyx_t_7);
    __Pyx_XGIVEREF(__pyx_t_8);
    __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_7, __pyx_t_8);
    goto __pyx_L1_error;
    __pyx_L4_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_6);
    __Pyx_XGIVEREF(__pyx_t_7);
    __Pyx_XGIVEREF(__pyx_t_8);
    __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_7, __pyx_t_8);
    __pyx_L10_try_end:;
  }

  /* "rbd.pyx":2643
 *             raise
 * 
 *         return completion             # <<<<<<<<<<<<<<
 * 
 *     def aio_flush(self, oncomplete):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_completion));
  __pyx_r = ((PyObject *)__pyx_v_completion);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("rbd.Image.aio_discard", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_completion);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_133aio_flush(PyObject *__pyx_v_self, PyObject *__pyx_v_oncomplete); /*proto*/
static char __pyx_doc_3rbd_5Image_132aio_flush[] = "Image.aio_flush(self, oncomplete)\n\n        Asyncronously wait until all writes are fully flushed if caching is\n        enabled.\n        ";
static PyObject *__pyx_pw_3rbd_5Image_133aio_flush(PyObject *__pyx_v_self, PyObject *__pyx_v_oncomplete) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("aio_flush (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_132aio_flush(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_oncomplete));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2645
 *         return completion
 * 
 *     def aio_flush(self, oncomplete):             # <<<<<<<<<<<<<<
 *         """
 *         Asyncronously wait until all writes are fully flushed if caching is
 */

static PyObject *__pyx_pf_3rbd_5Image_132aio_flush(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_oncomplete) {
  struct __pyx_obj_3rbd_Completion *__pyx_v_completion = 0;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("aio_flush", 0);

  /* "rbd.pyx":2651
 *         """
 * 
 *         cdef Completion completion = self.__get_completion(oncomplete)             # <<<<<<<<<<<<<<
 *         try:
 *             completion.__persist()
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s____get_completion); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_oncomplete);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_oncomplete);
  __Pyx_GIVEREF(__pyx_v_oncomplete);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_3rbd_Completion))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_completion = ((struct __pyx_obj_3rbd_Completion *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "rbd.pyx":2652
 * 
 *         cdef Completion completion = self.__get_completion(oncomplete)
 *         try:             # <<<<<<<<<<<<<<
 *             completion.__persist()
 *             with nogil:
 */
  {
    __Pyx_ExceptionSave(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
    __Pyx_XGOTREF(__pyx_t_4);
    __Pyx_XGOTREF(__pyx_t_5);
    __Pyx_XGOTREF(__pyx_t_6);
    /*try:*/ {

      /* "rbd.pyx":2653
 *         cdef Completion completion = self.__get_completion(oncomplete)
 *         try:
 *             completion.__persist()             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_aio_flush(self.image, completion.rbd_comp)
 */
      __pyx_t_3 = ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_completion->__pyx_vtab)->__pyx___persist(__pyx_v_completion); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2653; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "rbd.pyx":2654
 *         try:
 *             completion.__persist()
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_aio_flush(self.image, completion.rbd_comp)
 *             if ret < 0:
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":2655
 *             completion.__persist()
 *             with nogil:
 *                 ret = rbd_aio_flush(self.image, completion.rbd_comp)             # <<<<<<<<<<<<<<
 *             if ret < 0:
 *                 raise make_ex(ret, 'error flushing')
 */
            __pyx_v_ret = rbd_aio_flush(__pyx_v_self->image, __pyx_v_completion->rbd_comp);
          }

          /* "rbd.pyx":2654
 *         try:
 *             completion.__persist()
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_aio_flush(self.image, completion.rbd_comp)
 *             if ret < 0:
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":2656
 *             with nogil:
 *                 ret = rbd_aio_flush(self.image, completion.rbd_comp)
 *             if ret < 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error flushing')
 *         except:
 */
      __pyx_t_7 = (__pyx_v_ret < 0);
      if (__pyx_t_7) {

        /* "rbd.pyx":2657
 *                 ret = rbd_aio_flush(self.image, completion.rbd_comp)
 *             if ret < 0:
 *                 raise make_ex(ret, 'error flushing')             # <<<<<<<<<<<<<<
 *         except:
 *             completion.__unpersist()
 */
        __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2657; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_kp_s_109)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2657; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_Raise(__pyx_t_2, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2657; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        goto __pyx_L16;
      }
      __pyx_L16:;
    }
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L10_try_end;
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "rbd.pyx":2658
 *             if ret < 0:
 *                 raise make_ex(ret, 'error flushing')
 *         except:             # <<<<<<<<<<<<<<
 *             completion.__unpersist()
 *             raise
 */
    /*except:*/ {
      __Pyx_AddTraceback("rbd.Image.aio_flush", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_2, &__pyx_t_3, &__pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2658; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GOTREF(__pyx_t_1);

      /* "rbd.pyx":2659
 *                 raise make_ex(ret, 'error flushing')
 *         except:
 *             completion.__unpersist()             # <<<<<<<<<<<<<<
 *             raise
 * 
 */
      __pyx_t_8 = ((struct __pyx_vtabstruct_3rbd_Completion *)__pyx_v_completion->__pyx_vtab)->__pyx___unpersist(__pyx_v_completion); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2659; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

      /* "rbd.pyx":2660
 *         except:
 *             completion.__unpersist()
 *             raise             # <<<<<<<<<<<<<<
 * 
 *         return completion
 */
      __Pyx_GIVEREF(__pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_1);
      __Pyx_ErrRestore(__pyx_t_2, __pyx_t_3, __pyx_t_1);
      __pyx_t_2 = 0; __pyx_t_3 = 0; __pyx_t_1 = 0; 
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2660; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L4_exception_handled;
    }
    __pyx_L5_except_error:;
    __Pyx_XGIVEREF(__pyx_t_4);
    __Pyx_XGIVEREF(__pyx_t_5);
    __Pyx_XGIVEREF(__pyx_t_6);
    __Pyx_ExceptionReset(__pyx_t_4, __pyx_t_5, __pyx_t_6);
    goto __pyx_L1_error;
    __pyx_L4_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_4);
    __Pyx_XGIVEREF(__pyx_t_5);
    __Pyx_XGIVEREF(__pyx_t_6);
    __Pyx_ExceptionReset(__pyx_t_4, __pyx_t_5, __pyx_t_6);
    __pyx_L10_try_end:;
  }

  /* "rbd.pyx":2662
 *             raise
 * 
 *         return completion             # <<<<<<<<<<<<<<
 * 
 *     def metadata_get(self, key):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_completion));
  __pyx_r = ((PyObject *)__pyx_v_completion);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("rbd.Image.aio_flush", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_completion);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_135metadata_get(PyObject *__pyx_v_self, PyObject *__pyx_v_key); /*proto*/
static char __pyx_doc_3rbd_5Image_134metadata_get[] = "Image.metadata_get(self, key)\n\n        Get image metadata for the given key.\n\n        :param key: metadata key\n        :type key: str\n        :returns: str - image id\n        ";
static PyObject *__pyx_pw_3rbd_5Image_135metadata_get(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("metadata_get (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_134metadata_get(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_key));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2664
 *         return completion
 * 
 *     def metadata_get(self, key):             # <<<<<<<<<<<<<<
 *         """
 *         Get image metadata for the given key.
 */

static PyObject *__pyx_pf_3rbd_5Image_134metadata_get(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_key) {
  char *__pyx_v__key;
  size_t __pyx_v_size;
  char *__pyx_v_value;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  void *__pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("metadata_get", 0);
  __Pyx_INCREF(__pyx_v_key);

  /* "rbd.pyx":2672
 *         :returns: str - image id
 *         """
 *         key = cstr(key, 'key')             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *_key = key
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_key);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_key);
  __Pyx_GIVEREF(__pyx_v_key);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__key));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__key));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__key));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_key);
  __pyx_v_key = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":2674
 *         key = cstr(key, 'key')
 *         cdef:
 *             char *_key = key             # <<<<<<<<<<<<<<
 *             size_t size = 4096
 *             char *value = NULL
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_key); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__key = __pyx_t_4;

  /* "rbd.pyx":2675
 *         cdef:
 *             char *_key = key
 *             size_t size = 4096             # <<<<<<<<<<<<<<
 *             char *value = NULL
 *             int ret
 */
  __pyx_v_size = 4096;

  /* "rbd.pyx":2676
 *             char *_key = key
 *             size_t size = 4096
 *             char *value = NULL             # <<<<<<<<<<<<<<
 *             int ret
 *         try:
 */
  __pyx_v_value = NULL;

  /* "rbd.pyx":2678
 *             char *value = NULL
 *             int ret
 *         try:             # <<<<<<<<<<<<<<
 *             while True:
 *                 value = <char *>realloc_chk(value, size)
 */
  /*try:*/ {

    /* "rbd.pyx":2679
 *             int ret
 *         try:
 *             while True:             # <<<<<<<<<<<<<<
 *                 value = <char *>realloc_chk(value, size)
 *                 with nogil:
 */
    while (1) {
      if (!1) break;

      /* "rbd.pyx":2680
 *         try:
 *             while True:
 *                 value = <char *>realloc_chk(value, size)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_metadata_get(self.image, _key, value, &size)
 */
      __pyx_t_5 = __pyx_f_3rbd_realloc_chk(__pyx_v_value, __pyx_v_size); if (unlikely(__pyx_t_5 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2680; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_value = ((char *)__pyx_t_5);

      /* "rbd.pyx":2681
 *             while True:
 *                 value = <char *>realloc_chk(value, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_metadata_get(self.image, _key, value, &size)
 *                 if ret != -errno.ERANGE:
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":2682
 *                 value = <char *>realloc_chk(value, size)
 *                 with nogil:
 *                     ret = rbd_metadata_get(self.image, _key, value, &size)             # <<<<<<<<<<<<<<
 *                 if ret != -errno.ERANGE:
 *                     break
 */
            __pyx_v_ret = rbd_metadata_get(__pyx_v_self->image, __pyx_v__key, __pyx_v_value, (&__pyx_v_size));
          }

          /* "rbd.pyx":2681
 *             while True:
 *                 value = <char *>realloc_chk(value, size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_metadata_get(self.image, _key, value, &size)
 *                 if ret != -errno.ERANGE:
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":2683
 *                 with nogil:
 *                     ret = rbd_metadata_get(self.image, _key, value, &size)
 *                 if ret != -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     break
 *             if ret == -errno.ENOENT:
 */
      __pyx_t_6 = (__pyx_v_ret != (-ERANGE));
      if (__pyx_t_6) {

        /* "rbd.pyx":2684
 *                     ret = rbd_metadata_get(self.image, _key, value, &size)
 *                 if ret != -errno.ERANGE:
 *                     break             # <<<<<<<<<<<<<<
 *             if ret == -errno.ENOENT:
 *                 raise KeyError('no metadata %s for image %s' % (key, self.name))
 */
        goto __pyx_L7_break;
        goto __pyx_L13;
      }
      __pyx_L13:;
    }
    __pyx_L7_break:;

    /* "rbd.pyx":2685
 *                 if ret != -errno.ERANGE:
 *                     break
 *             if ret == -errno.ENOENT:             # <<<<<<<<<<<<<<
 *                 raise KeyError('no metadata %s for image %s' % (key, self.name))
 *             if ret != 0:
 */
    __pyx_t_6 = (__pyx_v_ret == (-ENOENT));
    if (__pyx_t_6) {

      /* "rbd.pyx":2686
 *                     break
 *             if ret == -errno.ENOENT:
 *                 raise KeyError('no metadata %s for image %s' % (key, self.name))             # <<<<<<<<<<<<<<
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting metadata %s for image %s' %
 */
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2686; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_v_key);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_key);
      __Pyx_GIVEREF(__pyx_v_key);
      __Pyx_INCREF(__pyx_v_self->name);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_self->name);
      __Pyx_GIVEREF(__pyx_v_self->name);
      __pyx_t_2 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_110), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2686; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_2));
      __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2686; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_2));
      __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
      __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_Call(__pyx_builtin_KeyError, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2686; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2686; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "rbd.pyx":2687
 *             if ret == -errno.ENOENT:
 *                 raise KeyError('no metadata %s for image %s' % (key, self.name))
 *             if ret != 0:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error getting metadata %s for image %s' %
 *                               (key, self.name,))
 */
    __pyx_t_6 = (__pyx_v_ret != 0);
    if (__pyx_t_6) {

      /* "rbd.pyx":2688
 *                 raise KeyError('no metadata %s for image %s' % (key, self.name))
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting metadata %s for image %s' %             # <<<<<<<<<<<<<<
 *                               (key, self.name,))
 *             return decode_cstr(value)
 */
      __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2688; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_2);

      /* "rbd.pyx":2689
 *             if ret != 0:
 *                 raise make_ex(ret, 'error getting metadata %s for image %s' %
 *                               (key, self.name,))             # <<<<<<<<<<<<<<
 *             return decode_cstr(value)
 *         finally:
 */
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2689; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_v_key);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_key);
      __Pyx_GIVEREF(__pyx_v_key);
      __Pyx_INCREF(__pyx_v_self->name);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_self->name);
      __Pyx_GIVEREF(__pyx_v_self->name);
      __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_111), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2688; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2688; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2688; __pyx_clineno = __LINE__; goto __pyx_L4;}
      goto __pyx_L15;
    }
    __pyx_L15:;

    /* "rbd.pyx":2690
 *                 raise make_ex(ret, 'error getting metadata %s for image %s' %
 *                               (key, self.name,))
 *             return decode_cstr(value)             # <<<<<<<<<<<<<<
 *         finally:
 *             free(value)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2690; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_value); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2690; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2690; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_t_1));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
    __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2690; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }

  /* "rbd.pyx":2692
 *             return decode_cstr(value)
 *         finally:
 *             free(value)             # <<<<<<<<<<<<<<
 * 
 *     def metadata_set(self, key, value):
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L3: __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 3; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_value);
    switch (__pyx_why) {
      case 3: goto __pyx_L0;
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.metadata_get", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_key);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_137metadata_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3rbd_5Image_136metadata_set[] = "Image.metadata_set(self, key, value)\n\n        Set image metadata for the given key.\n\n        :param key: metadata key\n        :type key: str\n        :param value: metadata value\n        :type value: str\n        ";
static PyObject *__pyx_pw_3rbd_5Image_137metadata_set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_key = 0;
  PyObject *__pyx_v_value = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("metadata_set (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__key,&__pyx_n_s__value,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__key)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__value)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("metadata_set", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2694; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "metadata_set") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2694; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_key = values[0];
    __pyx_v_value = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("metadata_set", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2694; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.Image.metadata_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_5Image_136metadata_set(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), __pyx_v_key, __pyx_v_value);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2694
 *             free(value)
 * 
 *     def metadata_set(self, key, value):             # <<<<<<<<<<<<<<
 *         """
 *         Set image metadata for the given key.
 */

static PyObject *__pyx_pf_3rbd_5Image_136metadata_set(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_key, PyObject *__pyx_v_value) {
  char *__pyx_v__key;
  char *__pyx_v__value;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("metadata_set", 0);
  __Pyx_INCREF(__pyx_v_key);
  __Pyx_INCREF(__pyx_v_value);

  /* "rbd.pyx":2703
 *         :type value: str
 *         """
 *         key = cstr(key, 'key')             # <<<<<<<<<<<<<<
 *         value = cstr(value, 'value')
 *         cdef:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2703; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2703; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_key);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_key);
  __Pyx_GIVEREF(__pyx_v_key);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__key));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__key));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__key));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2703; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_key);
  __pyx_v_key = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":2704
 *         """
 *         key = cstr(key, 'key')
 *         value = cstr(value, 'value')             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *_key = key
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_value);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_value);
  __Pyx_GIVEREF(__pyx_v_value);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__value));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__value));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__value));
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_value);
  __pyx_v_value = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":2706
 *         value = cstr(value, 'value')
 *         cdef:
 *             char *_key = key             # <<<<<<<<<<<<<<
 *             char *_value = value
 *         with nogil:
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_key); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__key = __pyx_t_4;

  /* "rbd.pyx":2707
 *         cdef:
 *             char *_key = key
 *             char *_value = value             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_metadata_set(self.image, _key, _value)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_value); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__value = __pyx_t_4;

  /* "rbd.pyx":2708
 *             char *_key = key
 *             char *_value = value
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_metadata_set(self.image, _key, _value)
 * 
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2709
 *             char *_value = value
 *         with nogil:
 *             ret = rbd_metadata_set(self.image, _key, _value)             # <<<<<<<<<<<<<<
 * 
 *         if ret != 0:
 */
        __pyx_v_ret = rbd_metadata_set(__pyx_v_self->image, __pyx_v__key, __pyx_v__value);
      }

      /* "rbd.pyx":2708
 *             char *_key = key
 *             char *_value = value
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_metadata_set(self.image, _key, _value)
 * 
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2711
 *             ret = rbd_metadata_set(self.image, _key, _value)
 * 
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error setting metadata %s for image %s' %
 *                           (key, self.name,))
 */
  __pyx_t_5 = (__pyx_v_ret != 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":2712
 * 
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting metadata %s for image %s' %             # <<<<<<<<<<<<<<
 *                           (key, self.name,))
 * 
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);

    /* "rbd.pyx":2713
 *         if ret != 0:
 *             raise make_ex(ret, 'error setting metadata %s for image %s' %
 *                           (key, self.name,))             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_key);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_key);
    __Pyx_GIVEREF(__pyx_v_key);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_112), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_f_3rbd_make_ex(__pyx_t_1, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.metadata_set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_key);
  __Pyx_XDECREF(__pyx_v_value);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_139metadata_remove(PyObject *__pyx_v_self, PyObject *__pyx_v_key); /*proto*/
static char __pyx_doc_3rbd_5Image_138metadata_remove[] = "Image.metadata_remove(self, key)\n\n        Remove image metadata for the given key.\n\n        :param key: metadata key\n        :type key: str\n        ";
static PyObject *__pyx_pw_3rbd_5Image_139metadata_remove(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("metadata_remove (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_138metadata_remove(((struct __pyx_obj_3rbd_Image *)__pyx_v_self), ((PyObject *)__pyx_v_key));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2716
 * 
 * 
 *     def metadata_remove(self, key):             # <<<<<<<<<<<<<<
 *         """
 *         Remove image metadata for the given key.
 */

static PyObject *__pyx_pf_3rbd_5Image_138metadata_remove(struct __pyx_obj_3rbd_Image *__pyx_v_self, PyObject *__pyx_v_key) {
  char *__pyx_v__key;
  int __pyx_v_ret;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  char *__pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("metadata_remove", 0);
  __Pyx_INCREF(__pyx_v_key);

  /* "rbd.pyx":2723
 *         :type key: str
 *         """
 *         key = cstr(key, 'key')             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *_key = key
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s__cstr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_key);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_key);
  __Pyx_GIVEREF(__pyx_v_key);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__key));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_n_s__key));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__key));
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_key);
  __pyx_v_key = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "rbd.pyx":2725
 *         key = cstr(key, 'key')
 *         cdef:
 *             char *_key = key             # <<<<<<<<<<<<<<
 *         with nogil:
 *             ret = rbd_metadata_remove(self.image, _key)
 */
  __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_key); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2725; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v__key = __pyx_t_4;

  /* "rbd.pyx":2726
 *         cdef:
 *             char *_key = key
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_metadata_remove(self.image, _key)
 * 
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      #endif
      /*try:*/ {

        /* "rbd.pyx":2727
 *             char *_key = key
 *         with nogil:
 *             ret = rbd_metadata_remove(self.image, _key)             # <<<<<<<<<<<<<<
 * 
 *         if ret == -errno.ENOENT:
 */
        __pyx_v_ret = rbd_metadata_remove(__pyx_v_self->image, __pyx_v__key);
      }

      /* "rbd.pyx":2726
 *         cdef:
 *             char *_key = key
 *         with nogil:             # <<<<<<<<<<<<<<
 *             ret = rbd_metadata_remove(self.image, _key)
 * 
 */
      /*finally:*/ {
        #ifdef WITH_THREAD
        Py_BLOCK_THREADS
        #endif
      }
  }

  /* "rbd.pyx":2729
 *             ret = rbd_metadata_remove(self.image, _key)
 * 
 *         if ret == -errno.ENOENT:             # <<<<<<<<<<<<<<
 *             raise KeyError('no metadata %s for image %s' % (key, self.name))
 *         if ret != 0:
 */
  __pyx_t_5 = (__pyx_v_ret == (-ENOENT));
  if (__pyx_t_5) {

    /* "rbd.pyx":2730
 * 
 *         if ret == -errno.ENOENT:
 *             raise KeyError('no metadata %s for image %s' % (key, self.name))             # <<<<<<<<<<<<<<
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing metadata %s for image %s' %
 */
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_key);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_key);
    __Pyx_GIVEREF(__pyx_v_key);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_2 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_110), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_2));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
    __pyx_t_2 = 0;
    __pyx_t_2 = PyObject_Call(__pyx_builtin_KeyError, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "rbd.pyx":2731
 *         if ret == -errno.ENOENT:
 *             raise KeyError('no metadata %s for image %s' % (key, self.name))
 *         if ret != 0:             # <<<<<<<<<<<<<<
 *             raise make_ex(ret, 'error removing metadata %s for image %s' %
 *                           (key, self.name,))
 */
  __pyx_t_5 = (__pyx_v_ret != 0);
  if (__pyx_t_5) {

    /* "rbd.pyx":2732
 *             raise KeyError('no metadata %s for image %s' % (key, self.name))
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing metadata %s for image %s' %             # <<<<<<<<<<<<<<
 *                           (key, self.name,))
 * 
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);

    /* "rbd.pyx":2733
 *         if ret != 0:
 *             raise make_ex(ret, 'error removing metadata %s for image %s' %
 *                           (key, self.name,))             # <<<<<<<<<<<<<<
 * 
 *     def metadata_list(self):
 */
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_key);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_key);
    __Pyx_GIVEREF(__pyx_v_key);
    __Pyx_INCREF(__pyx_v_self->name);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_self->name);
    __Pyx_GIVEREF(__pyx_v_self->name);
    __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_113), ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_f_3rbd_make_ex(__pyx_t_2, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L7;
  }
  __pyx_L7:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.Image.metadata_remove", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_key);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_5Image_141metadata_list(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_5Image_140metadata_list[] = "Image.metadata_list(self)\n\n        List image metadata.\n\n        :returns: :class:`MetadataIterator`\n        ";
static PyObject *__pyx_pw_3rbd_5Image_141metadata_list(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("metadata_list (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_5Image_140metadata_list(((struct __pyx_obj_3rbd_Image *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2735
 *                           (key, self.name,))
 * 
 *     def metadata_list(self):             # <<<<<<<<<<<<<<
 *         """
 *         List image metadata.
 */

static PyObject *__pyx_pf_3rbd_5Image_140metadata_list(struct __pyx_obj_3rbd_Image *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("metadata_list", 0);

  /* "rbd.pyx":2741
 *         :returns: :class:`MetadataIterator`
 *         """
 *         return MetadataIterator(self)             # <<<<<<<<<<<<<<
 * 
 * cdef class LockOwnerIterator(object):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_3rbd_MetadataIterator)), ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("rbd.Image.metadata_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_3rbd_17LockOwnerIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3rbd_17LockOwnerIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_3rbd_Image *__pyx_v_image = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__image,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__image)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2762; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_image = ((struct __pyx_obj_3rbd_Image *)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2762; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.LockOwnerIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_image), __pyx_ptype_3rbd_Image, 1, "image", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2762; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_3rbd_17LockOwnerIterator___init__(((struct __pyx_obj_3rbd_LockOwnerIterator *)__pyx_v_self), __pyx_v_image);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2762
 *         object image
 * 
 *     def __init__(self, Image image):             # <<<<<<<<<<<<<<
 *         self.image = image
 *         self.lock_owners = NULL
 */

static int __pyx_pf_3rbd_17LockOwnerIterator___init__(struct __pyx_obj_3rbd_LockOwnerIterator *__pyx_v_self, struct __pyx_obj_3rbd_Image *__pyx_v_image) {
  int __pyx_v_ret;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  void *__pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "rbd.pyx":2763
 * 
 *     def __init__(self, Image image):
 *         self.image = image             # <<<<<<<<<<<<<<
 *         self.lock_owners = NULL
 *         self.num_lock_owners = 8
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_image));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_image));
  __Pyx_GOTREF(__pyx_v_self->image);
  __Pyx_DECREF(__pyx_v_self->image);
  __pyx_v_self->image = ((PyObject *)__pyx_v_image);

  /* "rbd.pyx":2764
 *     def __init__(self, Image image):
 *         self.image = image
 *         self.lock_owners = NULL             # <<<<<<<<<<<<<<
 *         self.num_lock_owners = 8
 *         while True:
 */
  __pyx_v_self->lock_owners = NULL;

  /* "rbd.pyx":2765
 *         self.image = image
 *         self.lock_owners = NULL
 *         self.num_lock_owners = 8             # <<<<<<<<<<<<<<
 *         while True:
 *             self.lock_owners = <char**>realloc_chk(self.lock_owners,
 */
  __pyx_v_self->num_lock_owners = 8;

  /* "rbd.pyx":2766
 *         self.lock_owners = NULL
 *         self.num_lock_owners = 8
 *         while True:             # <<<<<<<<<<<<<<
 *             self.lock_owners = <char**>realloc_chk(self.lock_owners,
 *                                                    self.num_lock_owners *
 */
  while (1) {
    if (!1) break;

    /* "rbd.pyx":2769
 *             self.lock_owners = <char**>realloc_chk(self.lock_owners,
 *                                                    self.num_lock_owners *
 *                                                    sizeof(char*))             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_lock_get_owners(image.image, &self.lock_mode,
 */
    __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_self->lock_owners, (__pyx_v_self->num_lock_owners * (sizeof(char *)))); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "rbd.pyx":2767
 *         self.num_lock_owners = 8
 *         while True:
 *             self.lock_owners = <char**>realloc_chk(self.lock_owners,             # <<<<<<<<<<<<<<
 *                                                    self.num_lock_owners *
 *                                                    sizeof(char*))
 */
    __pyx_v_self->lock_owners = ((char **)__pyx_t_1);

    /* "rbd.pyx":2770
 *                                                    self.num_lock_owners *
 *                                                    sizeof(char*))
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_lock_get_owners(image.image, &self.lock_mode,
 *                                           self.lock_owners,
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":2773
 *                 ret = rbd_lock_get_owners(image.image, &self.lock_mode,
 *                                           self.lock_owners,
 *                                           &self.num_lock_owners)             # <<<<<<<<<<<<<<
 *             if ret >= 0:
 *                 break
 */
          __pyx_v_ret = rbd_lock_get_owners(__pyx_v_image->image, (&__pyx_v_self->lock_mode), __pyx_v_self->lock_owners, (&__pyx_v_self->num_lock_owners));
        }

        /* "rbd.pyx":2770
 *                                                    self.num_lock_owners *
 *                                                    sizeof(char*))
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_lock_get_owners(image.image, &self.lock_mode,
 *                                           self.lock_owners,
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }

    /* "rbd.pyx":2774
 *                                           self.lock_owners,
 *                                           &self.num_lock_owners)
 *             if ret >= 0:             # <<<<<<<<<<<<<<
 *                 break
 *             elif ret != -errno.ERANGE:
 */
    __pyx_t_2 = (__pyx_v_ret >= 0);
    if (__pyx_t_2) {

      /* "rbd.pyx":2775
 *                                           &self.num_lock_owners)
 *             if ret >= 0:
 *                 break             # <<<<<<<<<<<<<<
 *             elif ret != -errno.ERANGE:
 *                 raise make_ex(ret, 'error listing lock owners for image %s' % (image.name,))
 */
      goto __pyx_L4_break;
      goto __pyx_L10;
    }

    /* "rbd.pyx":2776
 *             if ret >= 0:
 *                 break
 *             elif ret != -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error listing lock owners for image %s' % (image.name,))
 * 
 */
    __pyx_t_2 = (__pyx_v_ret != (-ERANGE));
    if (__pyx_t_2) {

      /* "rbd.pyx":2777
 *                 break
 *             elif ret != -errno.ERANGE:
 *                 raise make_ex(ret, 'error listing lock owners for image %s' % (image.name,))             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
      __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_v_image->name);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_image->name);
      __Pyx_GIVEREF(__pyx_v_image->name);
      __pyx_t_5 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_114), ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_5));
      __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
      __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_5)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
      __Pyx_Raise(__pyx_t_4, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L10;
    }
    __pyx_L10:;
  }
  __pyx_L4_break:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.LockOwnerIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_3rbd_17LockOwnerIterator_4generator2(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_17LockOwnerIterator_3__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_3rbd_17LockOwnerIterator_3__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_17LockOwnerIterator_2__iter__(((struct __pyx_obj_3rbd_LockOwnerIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2779
 *                 raise make_ex(ret, 'error listing lock owners for image %s' % (image.name,))
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         for i in range(self.num_lock_owners):
 *             yield {
 */

static PyObject *__pyx_pf_3rbd_17LockOwnerIterator_2__iter__(struct __pyx_obj_3rbd_LockOwnerIterator *__pyx_v_self) {
  struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *)__pyx_tp_new_3rbd___pyx_scope_struct_3___iter__(__pyx_ptype_3rbd___pyx_scope_struct_3___iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = __Pyx_Generator_New((__pyx_generator_body_t) __pyx_gb_3rbd_17LockOwnerIterator_4generator2, (PyObject *) __pyx_cur_scope); if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("rbd.LockOwnerIterator.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_3rbd_17LockOwnerIterator_4generator2(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *__pyx_cur_scope = ((struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  size_t __pyx_t_1;
  size_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("None", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L6_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":2780
 * 
 *     def __iter__(self):
 *         for i in range(self.num_lock_owners):             # <<<<<<<<<<<<<<
 *             yield {
 *                 'mode'  : int(self.lock_mode),
 */
  __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->num_lock_owners;
  for (__pyx_t_2 = 0; __pyx_t_2 < __pyx_t_1; __pyx_t_2+=1) {
    __pyx_cur_scope->__pyx_v_i = __pyx_t_2;

    /* "rbd.pyx":2781
 *     def __iter__(self):
 *         for i in range(self.num_lock_owners):
 *             yield {             # <<<<<<<<<<<<<<
 *                 'mode'  : int(self.lock_mode),
 *                 'owner' : decode_cstr(self.lock_owners[i]),
 */
    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));

    /* "rbd.pyx":2782
 *         for i in range(self.num_lock_owners):
 *             yield {
 *                 'mode'  : int(self.lock_mode),             # <<<<<<<<<<<<<<
 *                 'owner' : decode_cstr(self.lock_owners[i]),
 *                 }
 */
    __pyx_t_4 = PyInt_FromLong(__pyx_cur_scope->__pyx_v_self->lock_mode); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__mode), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "rbd.pyx":2783
 *             yield {
 *                 'mode'  : int(self.lock_mode),
 *                 'owner' : decode_cstr(self.lock_owners[i]),             # <<<<<<<<<<<<<<
 *                 }
 * 
 */
    __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->lock_owners[__pyx_cur_scope->__pyx_v_i])); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_5));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__owner), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_r = ((PyObject *)__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
    __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
    if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_generator->resume_label = -1;
  __Pyx_Generator_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return NULL;
}

/* Python wrapper */
static void __pyx_pw_3rbd_17LockOwnerIterator_6__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_3rbd_17LockOwnerIterator_6__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_3rbd_17LockOwnerIterator_5__dealloc__(((struct __pyx_obj_3rbd_LockOwnerIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":2786
 *                 }
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         if self.lock_owners:
 *             rbd_lock_get_owners_cleanup(self.lock_owners, self.num_lock_owners)
 */

static void __pyx_pf_3rbd_17LockOwnerIterator_5__dealloc__(struct __pyx_obj_3rbd_LockOwnerIterator *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "rbd.pyx":2787
 * 
 *     def __dealloc__(self):
 *         if self.lock_owners:             # <<<<<<<<<<<<<<
 *             rbd_lock_get_owners_cleanup(self.lock_owners, self.num_lock_owners)
 *             free(self.lock_owners)
 */
  __pyx_t_1 = (__pyx_v_self->lock_owners != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2788
 *     def __dealloc__(self):
 *         if self.lock_owners:
 *             rbd_lock_get_owners_cleanup(self.lock_owners, self.num_lock_owners)             # <<<<<<<<<<<<<<
 *             free(self.lock_owners)
 * 
 */
    rbd_lock_get_owners_cleanup(__pyx_v_self->lock_owners, __pyx_v_self->num_lock_owners);

    /* "rbd.pyx":2789
 *         if self.lock_owners:
 *             rbd_lock_get_owners_cleanup(self.lock_owners, self.num_lock_owners)
 *             free(self.lock_owners)             # <<<<<<<<<<<<<<
 * 
 * cdef class MetadataIterator(object):
 */
    free(__pyx_v_self->lock_owners);
    goto __pyx_L3;
  }
  __pyx_L3:;

  __Pyx_RefNannyFinishContext();
}

/* Python wrapper */
static int __pyx_pw_3rbd_16MetadataIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3rbd_16MetadataIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_3rbd_Image *__pyx_v_image = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__image,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__image)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2808; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_image = ((struct __pyx_obj_3rbd_Image *)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2808; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.MetadataIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_image), __pyx_ptype_3rbd_Image, 1, "image", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2808; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_3rbd_16MetadataIterator___init__(((struct __pyx_obj_3rbd_MetadataIterator *)__pyx_v_self), __pyx_v_image);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2808
 *         object next_chunk
 * 
 *     def __init__(self, Image image):             # <<<<<<<<<<<<<<
 *         self.image_name = image.name
 *         self.image = image.image
 */

static int __pyx_pf_3rbd_16MetadataIterator___init__(struct __pyx_obj_3rbd_MetadataIterator *__pyx_v_self, struct __pyx_obj_3rbd_Image *__pyx_v_image) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  rbd_image_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "rbd.pyx":2809
 * 
 *     def __init__(self, Image image):
 *         self.image_name = image.name             # <<<<<<<<<<<<<<
 *         self.image = image.image
 *         self.last_read = strdup("")
 */
  __pyx_t_1 = __pyx_v_image->name;
  __Pyx_INCREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->image_name);
  __Pyx_DECREF(__pyx_v_self->image_name);
  __pyx_v_self->image_name = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "rbd.pyx":2810
 *     def __init__(self, Image image):
 *         self.image_name = image.name
 *         self.image = image.image             # <<<<<<<<<<<<<<
 *         self.last_read = strdup("")
 *         self.max_read = 32
 */
  __pyx_t_2 = __pyx_v_image->image;
  __pyx_v_self->image = __pyx_t_2;

  /* "rbd.pyx":2811
 *         self.image_name = image.name
 *         self.image = image.image
 *         self.last_read = strdup("")             # <<<<<<<<<<<<<<
 *         self.max_read = 32
 *         self.get_next_chunk()
 */
  __pyx_v_self->last_read = strdup(__pyx_k_33);

  /* "rbd.pyx":2812
 *         self.image = image.image
 *         self.last_read = strdup("")
 *         self.max_read = 32             # <<<<<<<<<<<<<<
 *         self.get_next_chunk()
 * 
 */
  __pyx_v_self->max_read = 32;

  /* "rbd.pyx":2813
 *         self.last_read = strdup("")
 *         self.max_read = 32
 *         self.get_next_chunk()             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s__get_next_chunk); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("rbd.MetadataIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_3rbd_16MetadataIterator_4generator3(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_16MetadataIterator_3__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_3rbd_16MetadataIterator_3__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_16MetadataIterator_2__iter__(((struct __pyx_obj_3rbd_MetadataIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2815
 *         self.get_next_chunk()
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         while len(self.next_chunk) > 0:
 *             for pair in self.next_chunk:
 */

static PyObject *__pyx_pf_3rbd_16MetadataIterator_2__iter__(struct __pyx_obj_3rbd_MetadataIterator *__pyx_v_self) {
  struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *)__pyx_tp_new_3rbd___pyx_scope_struct_4___iter__(__pyx_ptype_3rbd___pyx_scope_struct_4___iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = __Pyx_Generator_New((__pyx_generator_body_t) __pyx_gb_3rbd_16MetadataIterator_4generator3, (PyObject *) __pyx_cur_scope); if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("rbd.MetadataIterator.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_3rbd_16MetadataIterator_4generator3(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *__pyx_cur_scope = ((struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  int __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("None", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L8_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":2816
 * 
 *     def __iter__(self):
 *         while len(self.next_chunk) > 0:             # <<<<<<<<<<<<<<
 *             for pair in self.next_chunk:
 *                 yield pair
 */
  while (1) {
    __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->next_chunk;
    __Pyx_INCREF(__pyx_t_1);
    __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = (__pyx_t_2 > 0);
    if (!__pyx_t_3) break;

    /* "rbd.pyx":2817
 *     def __iter__(self):
 *         while len(self.next_chunk) > 0:
 *             for pair in self.next_chunk:             # <<<<<<<<<<<<<<
 *                 yield pair
 *             if len(self.next_chunk) < self.max_read:
 */
    if (PyList_CheckExact(__pyx_cur_scope->__pyx_v_self->next_chunk) || PyTuple_CheckExact(__pyx_cur_scope->__pyx_v_self->next_chunk)) {
      __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->next_chunk; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
      __pyx_t_4 = NULL;
    } else {
      __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_cur_scope->__pyx_v_self->next_chunk); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = Py_TYPE(__pyx_t_1)->tp_iternext;
    }
    for (;;) {
      if (!__pyx_t_4 && PyList_CheckExact(__pyx_t_1)) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else if (!__pyx_t_4 && PyTuple_CheckExact(__pyx_t_1)) {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        __pyx_t_5 = __pyx_t_4(__pyx_t_1);
        if (unlikely(!__pyx_t_5)) {
          if (PyErr_Occurred()) {
            if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_5);
      }
      __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_pair);
      __Pyx_XDECREF(__pyx_cur_scope->__pyx_v_pair);
      __Pyx_GIVEREF(__pyx_t_5);
      __pyx_cur_scope->__pyx_v_pair = __pyx_t_5;
      __pyx_t_5 = 0;

      /* "rbd.pyx":2818
 *         while len(self.next_chunk) > 0:
 *             for pair in self.next_chunk:
 *                 yield pair             # <<<<<<<<<<<<<<
 *             if len(self.next_chunk) < self.max_read:
 *                 break
 */
      __Pyx_INCREF(__pyx_cur_scope->__pyx_v_pair);
      __pyx_r = __pyx_cur_scope->__pyx_v_pair;
      __Pyx_XGIVEREF(__pyx_t_1);
      __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
      __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
      __pyx_cur_scope->__pyx_t_2 = __pyx_t_4;
      __Pyx_XGIVEREF(__pyx_r);
      __Pyx_RefNannyFinishContext();
      /* return from generator, yielding value */
      __pyx_generator->resume_label = 1;
      return __pyx_r;
      __pyx_L8_resume_from_yield:;
      __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
      __pyx_cur_scope->__pyx_t_0 = 0;
      __Pyx_XGOTREF(__pyx_t_1);
      __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
      __pyx_t_4 = __pyx_cur_scope->__pyx_t_2;
      if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2818; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "rbd.pyx":2819
 *             for pair in self.next_chunk:
 *                 yield pair
 *             if len(self.next_chunk) < self.max_read:             # <<<<<<<<<<<<<<
 *                 break
 *             self.get_next_chunk()
 */
    __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->next_chunk;
    __Pyx_INCREF(__pyx_t_1);
    __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = (__pyx_t_2 < __pyx_cur_scope->__pyx_v_self->max_read);
    if (__pyx_t_3) {

      /* "rbd.pyx":2820
 *                 yield pair
 *             if len(self.next_chunk) < self.max_read:
 *                 break             # <<<<<<<<<<<<<<
 *             self.get_next_chunk()
 * 
 */
      goto __pyx_L5_break;
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "rbd.pyx":2821
 *             if len(self.next_chunk) < self.max_read:
 *                 break
 *             self.get_next_chunk()             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s__get_next_chunk); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_L5_break:;
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_generator->resume_label = -1;
  __Pyx_Generator_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return NULL;
}

/* Python wrapper */
static void __pyx_pw_3rbd_16MetadataIterator_6__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_3rbd_16MetadataIterator_6__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_3rbd_16MetadataIterator_5__dealloc__(((struct __pyx_obj_3rbd_MetadataIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":2823
 *             self.get_next_chunk()
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         if self.last_read:
 *             free(self.last_read)
 */

static void __pyx_pf_3rbd_16MetadataIterator_5__dealloc__(struct __pyx_obj_3rbd_MetadataIterator *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "rbd.pyx":2824
 * 
 *     def __dealloc__(self):
 *         if self.last_read:             # <<<<<<<<<<<<<<
 *             free(self.last_read)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->last_read != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2825
 *     def __dealloc__(self):
 *         if self.last_read:
 *             free(self.last_read)             # <<<<<<<<<<<<<<
 * 
 *     def get_next_chunk(self):
 */
    free(__pyx_v_self->last_read);
    goto __pyx_L3;
  }
  __pyx_L3:;

  __Pyx_RefNannyFinishContext();
}

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_16MetadataIterator_8get_next_chunk(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_3rbd_16MetadataIterator_7get_next_chunk[] = "MetadataIterator.get_next_chunk(self)";
static PyObject *__pyx_pw_3rbd_16MetadataIterator_8get_next_chunk(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_next_chunk (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_16MetadataIterator_7get_next_chunk(((struct __pyx_obj_3rbd_MetadataIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2827
 *             free(self.last_read)
 * 
 *     def get_next_chunk(self):             # <<<<<<<<<<<<<<
 *         cdef:
 *             char *c_keys = NULL
 */

static PyObject *__pyx_pf_3rbd_16MetadataIterator_7get_next_chunk(struct __pyx_obj_3rbd_MetadataIterator *__pyx_v_self) {
  char *__pyx_v_c_keys;
  size_t __pyx_v_keys_size;
  char *__pyx_v_c_vals;
  size_t __pyx_v_vals_size;
  int __pyx_v_ret;
  PyObject *__pyx_v_keys = NULL;
  PyObject *__pyx_v_vals = NULL;
  PyObject *__pyx_v_key = NULL;
  PyObject *__pyx_v_val = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  void *__pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  char const *__pyx_t_10;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("get_next_chunk", 0);

  /* "rbd.pyx":2829
 *     def get_next_chunk(self):
 *         cdef:
 *             char *c_keys = NULL             # <<<<<<<<<<<<<<
 *             size_t keys_size = 4096
 *             char *c_vals = NULL
 */
  __pyx_v_c_keys = NULL;

  /* "rbd.pyx":2830
 *         cdef:
 *             char *c_keys = NULL
 *             size_t keys_size = 4096             # <<<<<<<<<<<<<<
 *             char *c_vals = NULL
 *             size_t vals_size = 4096
 */
  __pyx_v_keys_size = 4096;

  /* "rbd.pyx":2831
 *             char *c_keys = NULL
 *             size_t keys_size = 4096
 *             char *c_vals = NULL             # <<<<<<<<<<<<<<
 *             size_t vals_size = 4096
 *         try:
 */
  __pyx_v_c_vals = NULL;

  /* "rbd.pyx":2832
 *             size_t keys_size = 4096
 *             char *c_vals = NULL
 *             size_t vals_size = 4096             # <<<<<<<<<<<<<<
 *         try:
 *             while True:
 */
  __pyx_v_vals_size = 4096;

  /* "rbd.pyx":2833
 *             char *c_vals = NULL
 *             size_t vals_size = 4096
 *         try:             # <<<<<<<<<<<<<<
 *             while True:
 *                 c_keys = <char *>realloc_chk(c_keys, keys_size)
 */
  /*try:*/ {

    /* "rbd.pyx":2834
 *             size_t vals_size = 4096
 *         try:
 *             while True:             # <<<<<<<<<<<<<<
 *                 c_keys = <char *>realloc_chk(c_keys, keys_size)
 *                 c_vals = <char *>realloc_chk(c_vals, vals_size)
 */
    while (1) {
      if (!1) break;

      /* "rbd.pyx":2835
 *         try:
 *             while True:
 *                 c_keys = <char *>realloc_chk(c_keys, keys_size)             # <<<<<<<<<<<<<<
 *                 c_vals = <char *>realloc_chk(c_vals, vals_size)
 *                 with nogil:
 */
      __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_c_keys, __pyx_v_keys_size); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2835; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_c_keys = ((char *)__pyx_t_1);

      /* "rbd.pyx":2836
 *             while True:
 *                 c_keys = <char *>realloc_chk(c_keys, keys_size)
 *                 c_vals = <char *>realloc_chk(c_vals, vals_size)             # <<<<<<<<<<<<<<
 *                 with nogil:
 *                     ret = rbd_metadata_list(self.image, self.last_read,
 */
      __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_c_vals, __pyx_v_vals_size); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2836; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __pyx_v_c_vals = ((char *)__pyx_t_1);

      /* "rbd.pyx":2837
 *                 c_keys = <char *>realloc_chk(c_keys, keys_size)
 *                 c_vals = <char *>realloc_chk(c_vals, vals_size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_metadata_list(self.image, self.last_read,
 *                                             self.max_read, c_keys, &keys_size,
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          #endif
          /*try:*/ {

            /* "rbd.pyx":2840
 *                     ret = rbd_metadata_list(self.image, self.last_read,
 *                                             self.max_read, c_keys, &keys_size,
 *                                             c_vals, &vals_size)             # <<<<<<<<<<<<<<
 *                 if ret >= 0:
 *                     break
 */
            __pyx_v_ret = rbd_metadata_list(__pyx_v_self->image, __pyx_v_self->last_read, __pyx_v_self->max_read, __pyx_v_c_keys, (&__pyx_v_keys_size), __pyx_v_c_vals, (&__pyx_v_vals_size));
          }

          /* "rbd.pyx":2837
 *                 c_keys = <char *>realloc_chk(c_keys, keys_size)
 *                 c_vals = <char *>realloc_chk(c_vals, vals_size)
 *                 with nogil:             # <<<<<<<<<<<<<<
 *                     ret = rbd_metadata_list(self.image, self.last_read,
 *                                             self.max_read, c_keys, &keys_size,
 */
          /*finally:*/ {
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
          }
      }

      /* "rbd.pyx":2841
 *                                             self.max_read, c_keys, &keys_size,
 *                                             c_vals, &vals_size)
 *                 if ret >= 0:             # <<<<<<<<<<<<<<
 *                     break
 *                 elif ret != -errno.ERANGE:
 */
      __pyx_t_2 = (__pyx_v_ret >= 0);
      if (__pyx_t_2) {

        /* "rbd.pyx":2842
 *                                             c_vals, &vals_size)
 *                 if ret >= 0:
 *                     break             # <<<<<<<<<<<<<<
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing metadata for image %s' %
 */
        goto __pyx_L7_break;
        goto __pyx_L13;
      }

      /* "rbd.pyx":2843
 *                 if ret >= 0:
 *                     break
 *                 elif ret != -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                     raise make_ex(ret, 'error listing metadata for image %s' %
 *                                   (self.image_name,))
 */
      __pyx_t_2 = (__pyx_v_ret != (-ERANGE));
      if (__pyx_t_2) {

        /* "rbd.pyx":2844
 *                     break
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing metadata for image %s' %             # <<<<<<<<<<<<<<
 *                                   (self.image_name,))
 *             keys = [decode_cstr(key) for key in
 */
        __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_3);

        /* "rbd.pyx":2845
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing metadata for image %s' %
 *                                   (self.image_name,))             # <<<<<<<<<<<<<<
 *             keys = [decode_cstr(key) for key in
 *                         c_keys[:keys_size].split(b'\0') if key]
 */
        __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2845; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_v_self->image_name);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_self->image_name);
        __Pyx_GIVEREF(__pyx_v_self->image_name);
        __pyx_t_5 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_115), ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_5));
        __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_5)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
        __Pyx_Raise(__pyx_t_4, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2844; __pyx_clineno = __LINE__; goto __pyx_L4;}
        goto __pyx_L13;
      }
      __pyx_L13:;
    }
    __pyx_L7_break:;

    /* "rbd.pyx":2846
 *                     raise make_ex(ret, 'error listing metadata for image %s' %
 *                                   (self.image_name,))
 *             keys = [decode_cstr(key) for key in             # <<<<<<<<<<<<<<
 *                         c_keys[:keys_size].split(b'\0') if key]
 *             vals = [decode_cstr(val) for val in
 */
    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2846; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);

    /* "rbd.pyx":2847
 *                                   (self.image_name,))
 *             keys = [decode_cstr(key) for key in
 *                         c_keys[:keys_size].split(b'\0') if key]             # <<<<<<<<<<<<<<
 *             vals = [decode_cstr(val) for val in
 *                         c_vals[:vals_size].split(b'\0') if val]
 */
    __pyx_t_5 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_c_keys + 0, __pyx_v_keys_size - 0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_t_5), __pyx_n_s__split); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_k_tuple_116), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (PyList_CheckExact(__pyx_t_5) || PyTuple_CheckExact(__pyx_t_5)) {
      __pyx_t_3 = __pyx_t_5; __Pyx_INCREF(__pyx_t_3); __pyx_t_6 = 0;
      __pyx_t_7 = NULL;
    } else {
      __pyx_t_6 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = Py_TYPE(__pyx_t_3)->tp_iternext;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (!__pyx_t_7 && PyList_CheckExact(__pyx_t_3)) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_5); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #endif
      } else if (!__pyx_t_7 && PyTuple_CheckExact(__pyx_t_3)) {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_5); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #endif
      } else {
        __pyx_t_5 = __pyx_t_7(__pyx_t_3);
        if (unlikely(!__pyx_t_5)) {
          if (PyErr_Occurred()) {
            if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_5);
      }
      __Pyx_XDECREF(__pyx_v_key);
      __pyx_v_key = __pyx_t_5;
      __pyx_t_5 = 0;
      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_key); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L4;}
      if (__pyx_t_2) {

        /* "rbd.pyx":2846
 *                     raise make_ex(ret, 'error listing metadata for image %s' %
 *                                   (self.image_name,))
 *             keys = [decode_cstr(key) for key in             # <<<<<<<<<<<<<<
 *                         c_keys[:keys_size].split(b'\0') if key]
 *             vals = [decode_cstr(val) for val in
 */
        __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2846; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2846; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_INCREF(__pyx_v_key);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_key);
        __Pyx_GIVEREF(__pyx_v_key);
        __pyx_t_9 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_8), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2846; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_9))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2846; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        goto __pyx_L16;
      }
      __pyx_L16:;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_keys = ((PyObject*)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "rbd.pyx":2848
 *             keys = [decode_cstr(key) for key in
 *                         c_keys[:keys_size].split(b'\0') if key]
 *             vals = [decode_cstr(val) for val in             # <<<<<<<<<<<<<<
 *                         c_vals[:vals_size].split(b'\0') if val]
 *             if len(keys) > 0:
 */
    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2848; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);

    /* "rbd.pyx":2849
 *                         c_keys[:keys_size].split(b'\0') if key]
 *             vals = [decode_cstr(val) for val in
 *                         c_vals[:vals_size].split(b'\0') if val]             # <<<<<<<<<<<<<<
 *             if len(keys) > 0:
 *                 free(self.last_read)
 */
    __pyx_t_3 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_c_vals + 0, __pyx_v_vals_size - 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_t_3), __pyx_n_s__split); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_k_tuple_117), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (PyList_CheckExact(__pyx_t_3) || PyTuple_CheckExact(__pyx_t_3)) {
      __pyx_t_9 = __pyx_t_3; __Pyx_INCREF(__pyx_t_9); __pyx_t_6 = 0;
      __pyx_t_7 = NULL;
    } else {
      __pyx_t_6 = -1; __pyx_t_9 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_7 = Py_TYPE(__pyx_t_9)->tp_iternext;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    for (;;) {
      if (!__pyx_t_7 && PyList_CheckExact(__pyx_t_9)) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_9)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_9, __pyx_t_6); __Pyx_INCREF(__pyx_t_3); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_9, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #endif
      } else if (!__pyx_t_7 && PyTuple_CheckExact(__pyx_t_9)) {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_9)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_9, __pyx_t_6); __Pyx_INCREF(__pyx_t_3); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_9, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
        #endif
      } else {
        __pyx_t_3 = __pyx_t_7(__pyx_t_9);
        if (unlikely(!__pyx_t_3)) {
          if (PyErr_Occurred()) {
            if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_3);
      }
      __Pyx_XDECREF(__pyx_v_val);
      __pyx_v_val = __pyx_t_3;
      __pyx_t_3 = 0;
      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_val); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L4;}
      if (__pyx_t_2) {

        /* "rbd.pyx":2848
 *             keys = [decode_cstr(key) for key in
 *                         c_keys[:keys_size].split(b'\0') if key]
 *             vals = [decode_cstr(val) for val in             # <<<<<<<<<<<<<<
 *                         c_vals[:vals_size].split(b'\0') if val]
 *             if len(keys) > 0:
 */
        __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2848; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2848; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_INCREF(__pyx_v_val);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_val);
        __Pyx_GIVEREF(__pyx_v_val);
        __pyx_t_5 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_8), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2848; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_5))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2848; __pyx_clineno = __LINE__; goto __pyx_L4;}
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        goto __pyx_L19;
      }
      __pyx_L19:;
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_v_vals = ((PyObject*)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "rbd.pyx":2850
 *             vals = [decode_cstr(val) for val in
 *                         c_vals[:vals_size].split(b'\0') if val]
 *             if len(keys) > 0:             # <<<<<<<<<<<<<<
 *                 free(self.last_read)
 *                 self.last_read = strdup(keys[-1])
 */
    __pyx_t_6 = PyList_GET_SIZE(((PyObject *)__pyx_v_keys)); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2850; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __pyx_t_2 = (__pyx_t_6 > 0);
    if (__pyx_t_2) {

      /* "rbd.pyx":2851
 *                         c_vals[:vals_size].split(b'\0') if val]
 *             if len(keys) > 0:
 *                 free(self.last_read)             # <<<<<<<<<<<<<<
 *                 self.last_read = strdup(keys[-1])
 *             self.next_chunk = zip(keys, vals)
 */
      free(__pyx_v_self->last_read);

      /* "rbd.pyx":2852
 *             if len(keys) > 0:
 *                 free(self.last_read)
 *                 self.last_read = strdup(keys[-1])             # <<<<<<<<<<<<<<
 *             self.next_chunk = zip(keys, vals)
 *         finally:
 */
      __pyx_t_4 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_keys), -1, sizeof(long), PyInt_FromLong, 1, 1, 1); if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2852; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = __Pyx_PyObject_AsString(__pyx_t_4); if (unlikely((!__pyx_t_10) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2852; __pyx_clineno = __LINE__; goto __pyx_L4;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_self->last_read = strdup(__pyx_t_10);
      goto __pyx_L20;
    }
    __pyx_L20:;

    /* "rbd.pyx":2853
 *                 free(self.last_read)
 *                 self.last_read = strdup(keys[-1])
 *             self.next_chunk = zip(keys, vals)             # <<<<<<<<<<<<<<
 *         finally:
 *             free(c_keys)
 */
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2853; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(((PyObject *)__pyx_v_keys));
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_keys));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_keys));
    __Pyx_INCREF(((PyObject *)__pyx_v_vals));
    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_vals));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_vals));
    __pyx_t_9 = PyObject_Call(__pyx_builtin_zip, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2853; __pyx_clineno = __LINE__; goto __pyx_L4;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_GIVEREF(__pyx_t_9);
    __Pyx_GOTREF(__pyx_v_self->next_chunk);
    __Pyx_DECREF(__pyx_v_self->next_chunk);
    __pyx_v_self->next_chunk = __pyx_t_9;
    __pyx_t_9 = 0;
  }

  /* "rbd.pyx":2855
 *             self.next_chunk = zip(keys, vals)
 *         finally:
 *             free(c_keys)             # <<<<<<<<<<<<<<
 *             free(c_vals)
 * 
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L5;
    __pyx_L4: {
      __pyx_why = 4;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_ErrFetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L5;
    }
    __pyx_L5:;
    free(__pyx_v_c_keys);

    /* "rbd.pyx":2856
 *         finally:
 *             free(c_keys)
 *             free(c_vals)             # <<<<<<<<<<<<<<
 * 
 * cdef class SnapIterator(object):
 */
    free(__pyx_v_c_vals);
    switch (__pyx_why) {
      case 4: {
        __Pyx_ErrRestore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("rbd.MetadataIterator.get_next_chunk", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_keys);
  __Pyx_XDECREF(__pyx_v_vals);
  __Pyx_XDECREF(__pyx_v_key);
  __Pyx_XDECREF(__pyx_v_val);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_3rbd_12SnapIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3rbd_12SnapIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_3rbd_Image *__pyx_v_image = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__image,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__image)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2877; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_image = ((struct __pyx_obj_3rbd_Image *)values[0]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2877; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.SnapIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_image), __pyx_ptype_3rbd_Image, 1, "image", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2877; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_3rbd_12SnapIterator___init__(((struct __pyx_obj_3rbd_SnapIterator *)__pyx_v_self), __pyx_v_image);
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2877
 *     cdef object image
 * 
 *     def __init__(self, Image image):             # <<<<<<<<<<<<<<
 *         self.image = image
 *         self.snaps = NULL
 */

static int __pyx_pf_3rbd_12SnapIterator___init__(struct __pyx_obj_3rbd_SnapIterator *__pyx_v_self, struct __pyx_obj_3rbd_Image *__pyx_v_image) {
  int __pyx_v_ret;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  void *__pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "rbd.pyx":2878
 * 
 *     def __init__(self, Image image):
 *         self.image = image             # <<<<<<<<<<<<<<
 *         self.snaps = NULL
 *         self.num_snaps = 10
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_image));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_image));
  __Pyx_GOTREF(__pyx_v_self->image);
  __Pyx_DECREF(__pyx_v_self->image);
  __pyx_v_self->image = ((PyObject *)__pyx_v_image);

  /* "rbd.pyx":2879
 *     def __init__(self, Image image):
 *         self.image = image
 *         self.snaps = NULL             # <<<<<<<<<<<<<<
 *         self.num_snaps = 10
 *         while True:
 */
  __pyx_v_self->snaps = NULL;

  /* "rbd.pyx":2880
 *         self.image = image
 *         self.snaps = NULL
 *         self.num_snaps = 10             # <<<<<<<<<<<<<<
 *         while True:
 *             self.snaps = <rbd_snap_info_t*>realloc_chk(self.snaps,
 */
  __pyx_v_self->num_snaps = 10;

  /* "rbd.pyx":2881
 *         self.snaps = NULL
 *         self.num_snaps = 10
 *         while True:             # <<<<<<<<<<<<<<
 *             self.snaps = <rbd_snap_info_t*>realloc_chk(self.snaps,
 *                                                        self.num_snaps *
 */
  while (1) {
    if (!1) break;

    /* "rbd.pyx":2884
 *             self.snaps = <rbd_snap_info_t*>realloc_chk(self.snaps,
 *                                                        self.num_snaps *
 *                                                        sizeof(rbd_snap_info_t))             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_snap_list(image.image, self.snaps, &self.num_snaps)
 */
    __pyx_t_1 = __pyx_f_3rbd_realloc_chk(__pyx_v_self->snaps, (__pyx_v_self->num_snaps * (sizeof(rbd_snap_info_t)))); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2882; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "rbd.pyx":2882
 *         self.num_snaps = 10
 *         while True:
 *             self.snaps = <rbd_snap_info_t*>realloc_chk(self.snaps,             # <<<<<<<<<<<<<<
 *                                                        self.num_snaps *
 *                                                        sizeof(rbd_snap_info_t))
 */
    __pyx_v_self->snaps = ((rbd_snap_info_t *)__pyx_t_1);

    /* "rbd.pyx":2885
 *                                                        self.num_snaps *
 *                                                        sizeof(rbd_snap_info_t))
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_snap_list(image.image, self.snaps, &self.num_snaps)
 *             if ret >= 0:
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":2886
 *                                                        sizeof(rbd_snap_info_t))
 *             with nogil:
 *                 ret = rbd_snap_list(image.image, self.snaps, &self.num_snaps)             # <<<<<<<<<<<<<<
 *             if ret >= 0:
 *                 self.num_snaps = ret
 */
          __pyx_v_ret = rbd_snap_list(__pyx_v_image->image, __pyx_v_self->snaps, (&__pyx_v_self->num_snaps));
        }

        /* "rbd.pyx":2885
 *                                                        self.num_snaps *
 *                                                        sizeof(rbd_snap_info_t))
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_snap_list(image.image, self.snaps, &self.num_snaps)
 *             if ret >= 0:
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }

    /* "rbd.pyx":2887
 *             with nogil:
 *                 ret = rbd_snap_list(image.image, self.snaps, &self.num_snaps)
 *             if ret >= 0:             # <<<<<<<<<<<<<<
 *                 self.num_snaps = ret
 *                 break
 */
    __pyx_t_2 = (__pyx_v_ret >= 0);
    if (__pyx_t_2) {

      /* "rbd.pyx":2888
 *                 ret = rbd_snap_list(image.image, self.snaps, &self.num_snaps)
 *             if ret >= 0:
 *                 self.num_snaps = ret             # <<<<<<<<<<<<<<
 *                 break
 *             elif ret != -errno.ERANGE:
 */
      __pyx_v_self->num_snaps = __pyx_v_ret;

      /* "rbd.pyx":2889
 *             if ret >= 0:
 *                 self.num_snaps = ret
 *                 break             # <<<<<<<<<<<<<<
 *             elif ret != -errno.ERANGE:
 *                 raise make_ex(ret, 'error listing snapshots for image %s' % (image.name,))
 */
      goto __pyx_L4_break;
      goto __pyx_L10;
    }

    /* "rbd.pyx":2890
 *                 self.num_snaps = ret
 *                 break
 *             elif ret != -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error listing snapshots for image %s' % (image.name,))
 * 
 */
    __pyx_t_2 = (__pyx_v_ret != (-ERANGE));
    if (__pyx_t_2) {

      /* "rbd.pyx":2891
 *                 break
 *             elif ret != -errno.ERANGE:
 *                 raise make_ex(ret, 'error listing snapshots for image %s' % (image.name,))             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
      __pyx_t_3 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_v_image->name);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_image->name);
      __Pyx_GIVEREF(__pyx_v_image->name);
      __pyx_t_5 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_118), ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_5));
      __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
      __pyx_t_4 = __pyx_f_3rbd_make_ex(__pyx_t_3, ((PyObject *)__pyx_t_5)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
      __Pyx_Raise(__pyx_t_4, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L10;
    }
    __pyx_L10:;
  }
  __pyx_L4_break:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.SnapIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_3rbd_12SnapIterator_4generator4(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_12SnapIterator_3__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_3rbd_12SnapIterator_3__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_12SnapIterator_2__iter__(((struct __pyx_obj_3rbd_SnapIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2893
 *                 raise make_ex(ret, 'error listing snapshots for image %s' % (image.name,))
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         for i in range(self.num_snaps):
 *             yield {
 */

static PyObject *__pyx_pf_3rbd_12SnapIterator_2__iter__(struct __pyx_obj_3rbd_SnapIterator *__pyx_v_self) {
  struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *)__pyx_tp_new_3rbd___pyx_scope_struct_5___iter__(__pyx_ptype_3rbd___pyx_scope_struct_5___iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = __Pyx_Generator_New((__pyx_generator_body_t) __pyx_gb_3rbd_12SnapIterator_4generator4, (PyObject *) __pyx_cur_scope); if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("rbd.SnapIterator.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_3rbd_12SnapIterator_4generator4(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *__pyx_cur_scope = ((struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("None", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L6_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":2894
 * 
 *     def __iter__(self):
 *         for i in range(self.num_snaps):             # <<<<<<<<<<<<<<
 *             yield {
 *                 'id'   : self.snaps[i].id,
 */
  __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->num_snaps;
  for (__pyx_t_2 = 0; __pyx_t_2 < __pyx_t_1; __pyx_t_2+=1) {
    __pyx_cur_scope->__pyx_v_i = __pyx_t_2;

    /* "rbd.pyx":2895
 *     def __iter__(self):
 *         for i in range(self.num_snaps):
 *             yield {             # <<<<<<<<<<<<<<
 *                 'id'   : self.snaps[i].id,
 *                 'size' : self.snaps[i].size,
 */
    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));

    /* "rbd.pyx":2896
 *         for i in range(self.num_snaps):
 *             yield {
 *                 'id'   : self.snaps[i].id,             # <<<<<<<<<<<<<<
 *                 'size' : self.snaps[i].size,
 *                 'name' : decode_cstr(self.snaps[i].name),
 */
    __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t((__pyx_cur_scope->__pyx_v_self->snaps[__pyx_cur_scope->__pyx_v_i]).id); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__id), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "rbd.pyx":2897
 *             yield {
 *                 'id'   : self.snaps[i].id,
 *                 'size' : self.snaps[i].size,             # <<<<<<<<<<<<<<
 *                 'name' : decode_cstr(self.snaps[i].name),
 *                 }
 */
    __pyx_t_4 = __Pyx_PyInt_to_py_uint64_t((__pyx_cur_scope->__pyx_v_self->snaps[__pyx_cur_scope->__pyx_v_i]).size); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2897; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__size), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "rbd.pyx":2898
 *                 'id'   : self.snaps[i].id,
 *                 'size' : self.snaps[i].size,
 *                 'name' : decode_cstr(self.snaps[i].name),             # <<<<<<<<<<<<<<
 *                 }
 * 
 */
    __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->snaps[__pyx_cur_scope->__pyx_v_i]).name); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_5));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__name), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_r = ((PyObject *)__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
    __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
    if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_generator->resume_label = -1;
  __Pyx_Generator_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return NULL;
}

/* Python wrapper */
static void __pyx_pw_3rbd_12SnapIterator_6__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_3rbd_12SnapIterator_6__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_3rbd_12SnapIterator_5__dealloc__(((struct __pyx_obj_3rbd_SnapIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":2901
 *                 }
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         if self.snaps:
 *             rbd_snap_list_end(self.snaps)
 */

static void __pyx_pf_3rbd_12SnapIterator_5__dealloc__(struct __pyx_obj_3rbd_SnapIterator *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "rbd.pyx":2902
 * 
 *     def __dealloc__(self):
 *         if self.snaps:             # <<<<<<<<<<<<<<
 *             rbd_snap_list_end(self.snaps)
 *             free(self.snaps)
 */
  __pyx_t_1 = (__pyx_v_self->snaps != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2903
 *     def __dealloc__(self):
 *         if self.snaps:
 *             rbd_snap_list_end(self.snaps)             # <<<<<<<<<<<<<<
 *             free(self.snaps)
 * 
 */
    rbd_snap_list_end(__pyx_v_self->snaps);

    /* "rbd.pyx":2904
 *         if self.snaps:
 *             rbd_snap_list_end(self.snaps)
 *             free(self.snaps)             # <<<<<<<<<<<<<<
 * 
 * cdef class TrashIterator(object):
 */
    free(__pyx_v_self->snaps);
    goto __pyx_L3;
  }
  __pyx_L3:;

  __Pyx_RefNannyFinishContext();
}

/* Python wrapper */
static int __pyx_pw_3rbd_13TrashIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3rbd_13TrashIterator_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ioctx = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__ioctx,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ioctx)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2931; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_ioctx = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2931; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("rbd.TrashIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3rbd_13TrashIterator___init__(((struct __pyx_obj_3rbd_TrashIterator *)__pyx_v_self), __pyx_v_ioctx);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2931
 *         rbd_trash_image_info_t *entries
 * 
 *     def __init__(self, ioctx):             # <<<<<<<<<<<<<<
 *         self.ioctx = convert_ioctx(ioctx)
 *         self.num_entries = 1024
 */

static int __pyx_pf_3rbd_13TrashIterator___init__(struct __pyx_obj_3rbd_TrashIterator *__pyx_v_self, PyObject *__pyx_v_ioctx) {
  int __pyx_v_ret;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  rados_ioctx_t __pyx_t_1;
  void *__pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "rbd.pyx":2932
 * 
 *     def __init__(self, ioctx):
 *         self.ioctx = convert_ioctx(ioctx)             # <<<<<<<<<<<<<<
 *         self.num_entries = 1024
 *         self.entries = NULL
 */
  if (!(likely(((__pyx_v_ioctx) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_ioctx, __pyx_ptype_5rados_Ioctx))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2932; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_f_3rbd_convert_ioctx(((struct __pyx_obj_5rados_Ioctx *)__pyx_v_ioctx)); if (unlikely(__pyx_t_1 == NULL && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2932; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_self->ioctx = __pyx_t_1;

  /* "rbd.pyx":2933
 *     def __init__(self, ioctx):
 *         self.ioctx = convert_ioctx(ioctx)
 *         self.num_entries = 1024             # <<<<<<<<<<<<<<
 *         self.entries = NULL
 *         while True:
 */
  __pyx_v_self->num_entries = 1024;

  /* "rbd.pyx":2934
 *         self.ioctx = convert_ioctx(ioctx)
 *         self.num_entries = 1024
 *         self.entries = NULL             # <<<<<<<<<<<<<<
 *         while True:
 *             self.entries = <rbd_trash_image_info_t*>realloc_chk(self.entries,
 */
  __pyx_v_self->entries = NULL;

  /* "rbd.pyx":2935
 *         self.num_entries = 1024
 *         self.entries = NULL
 *         while True:             # <<<<<<<<<<<<<<
 *             self.entries = <rbd_trash_image_info_t*>realloc_chk(self.entries,
 *                                                                 self.num_entries *
 */
  while (1) {
    if (!1) break;

    /* "rbd.pyx":2938
 *             self.entries = <rbd_trash_image_info_t*>realloc_chk(self.entries,
 *                                                                 self.num_entries *
 *                                                                 sizeof(rbd_trash_image_info_t))             # <<<<<<<<<<<<<<
 *             with nogil:
 *                 ret = rbd_trash_list(self.ioctx, self.entries, &self.num_entries)
 */
    __pyx_t_2 = __pyx_f_3rbd_realloc_chk(__pyx_v_self->entries, (__pyx_v_self->num_entries * (sizeof(rbd_trash_image_info_t)))); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "rbd.pyx":2936
 *         self.entries = NULL
 *         while True:
 *             self.entries = <rbd_trash_image_info_t*>realloc_chk(self.entries,             # <<<<<<<<<<<<<<
 *                                                                 self.num_entries *
 *                                                                 sizeof(rbd_trash_image_info_t))
 */
    __pyx_v_self->entries = ((rbd_trash_image_info_t *)__pyx_t_2);

    /* "rbd.pyx":2939
 *                                                                 self.num_entries *
 *                                                                 sizeof(rbd_trash_image_info_t))
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_trash_list(self.ioctx, self.entries, &self.num_entries)
 *             if ret >= 0:
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {

          /* "rbd.pyx":2940
 *                                                                 sizeof(rbd_trash_image_info_t))
 *             with nogil:
 *                 ret = rbd_trash_list(self.ioctx, self.entries, &self.num_entries)             # <<<<<<<<<<<<<<
 *             if ret >= 0:
 *                 self.num_entries = ret
 */
          __pyx_v_ret = rbd_trash_list(__pyx_v_self->ioctx, __pyx_v_self->entries, (&__pyx_v_self->num_entries));
        }

        /* "rbd.pyx":2939
 *                                                                 self.num_entries *
 *                                                                 sizeof(rbd_trash_image_info_t))
 *             with nogil:             # <<<<<<<<<<<<<<
 *                 ret = rbd_trash_list(self.ioctx, self.entries, &self.num_entries)
 *             if ret >= 0:
 */
        /*finally:*/ {
          #ifdef WITH_THREAD
          Py_BLOCK_THREADS
          #endif
        }
    }

    /* "rbd.pyx":2941
 *             with nogil:
 *                 ret = rbd_trash_list(self.ioctx, self.entries, &self.num_entries)
 *             if ret >= 0:             # <<<<<<<<<<<<<<
 *                 self.num_entries = ret
 *                 break
 */
    __pyx_t_3 = (__pyx_v_ret >= 0);
    if (__pyx_t_3) {

      /* "rbd.pyx":2942
 *                 ret = rbd_trash_list(self.ioctx, self.entries, &self.num_entries)
 *             if ret >= 0:
 *                 self.num_entries = ret             # <<<<<<<<<<<<<<
 *                 break
 *             elif ret != -errno.ERANGE:
 */
      __pyx_v_self->num_entries = __pyx_v_ret;

      /* "rbd.pyx":2943
 *             if ret >= 0:
 *                 self.num_entries = ret
 *                 break             # <<<<<<<<<<<<<<
 *             elif ret != -errno.ERANGE:
 *                 raise make_ex(ret, 'error listing trash entries')
 */
      goto __pyx_L4_break;
      goto __pyx_L10;
    }

    /* "rbd.pyx":2944
 *                 self.num_entries = ret
 *                 break
 *             elif ret != -errno.ERANGE:             # <<<<<<<<<<<<<<
 *                 raise make_ex(ret, 'error listing trash entries')
 * 
 */
    __pyx_t_3 = (__pyx_v_ret != (-ERANGE));
    if (__pyx_t_3) {

      /* "rbd.pyx":2945
 *                 break
 *             elif ret != -errno.ERANGE:
 *                 raise make_ex(ret, 'error listing trash entries')             # <<<<<<<<<<<<<<
 * 
 *     __source_string = ['USER', 'MIRRORING']
 */
      __pyx_t_4 = PyInt_FromLong(__pyx_v_ret); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __pyx_f_3rbd_make_ex(__pyx_t_4, ((PyObject *)__pyx_kp_s_119)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_Raise(__pyx_t_5, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L10;
    }
    __pyx_L10:;
  }
  __pyx_L4_break:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("rbd.TrashIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_3rbd_13TrashIterator_4generator5(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value); /* proto */

/* Python wrapper */
static PyObject *__pyx_pw_3rbd_13TrashIterator_3__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_3rbd_13TrashIterator_3__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_3rbd_13TrashIterator_2__iter__(((struct __pyx_obj_3rbd_TrashIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "rbd.pyx":2949
 *     __source_string = ['USER', 'MIRRORING']
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         for i in range(self.num_entries):
 *             yield {
 */

static PyObject *__pyx_pf_3rbd_13TrashIterator_2__iter__(struct __pyx_obj_3rbd_TrashIterator *__pyx_v_self) {
  struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__iter__", 0);
  __pyx_cur_scope = (struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *)__pyx_tp_new_3rbd___pyx_scope_struct_6___iter__(__pyx_ptype_3rbd___pyx_scope_struct_6___iter__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __Pyx_GOTREF(__pyx_cur_scope);
  __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
  __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
  {
    __pyx_GeneratorObject *gen = __Pyx_Generator_New((__pyx_generator_body_t) __pyx_gb_3rbd_13TrashIterator_4generator5, (PyObject *) __pyx_cur_scope); if (unlikely(!gen)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("rbd.TrashIterator.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_3rbd_13TrashIterator_4generator5(__pyx_GeneratorObject *__pyx_generator, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *__pyx_cur_scope = ((struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  size_t __pyx_t_1;
  size_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("None", 0);
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    case 1: goto __pyx_L6_resume_from_yield;
    default: /* CPython raises the right error here */
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":2950
 * 
 *     def __iter__(self):
 *         for i in range(self.num_entries):             # <<<<<<<<<<<<<<
 *             yield {
 *                 'id'          : decode_cstr(self.entries[i].id),
 */
  __pyx_t_1 = __pyx_cur_scope->__pyx_v_self->num_entries;
  for (__pyx_t_2 = 0; __pyx_t_2 < __pyx_t_1; __pyx_t_2+=1) {
    __pyx_cur_scope->__pyx_v_i = __pyx_t_2;

    /* "rbd.pyx":2951
 *     def __iter__(self):
 *         for i in range(self.num_entries):
 *             yield {             # <<<<<<<<<<<<<<
 *                 'id'          : decode_cstr(self.entries[i].id),
 *                 'name'        : decode_cstr(self.entries[i].name),
 */
    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));

    /* "rbd.pyx":2952
 *         for i in range(self.num_entries):
 *             yield {
 *                 'id'          : decode_cstr(self.entries[i].id),             # <<<<<<<<<<<<<<
 *                 'name'        : decode_cstr(self.entries[i].name),
 *                 'source'      : TrashIterator.__source_string[self.entries[i].source],
 */
    __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->entries[__pyx_cur_scope->__pyx_v_i]).id); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_5));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__id), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "rbd.pyx":2953
 *             yield {
 *                 'id'          : decode_cstr(self.entries[i].id),
 *                 'name'        : decode_cstr(self.entries[i].name),             # <<<<<<<<<<<<<<
 *                 'source'      : TrashIterator.__source_string[self.entries[i].source],
 *                 'deletion_time' : datetime.fromtimestamp(self.entries[i].deletion_time),
 */
    __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__decode_cstr); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyBytes_FromString((__pyx_cur_scope->__pyx_v_self->entries[__pyx_cur_scope->__pyx_v_i]).name); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_6));
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_t_6));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
    __pyx_t_6 = 0;
    __pyx_t_6 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2953; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__name), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "rbd.pyx":2954
 *                 'id'          : decode_cstr(self.entries[i].id),
 *                 'name'        : decode_cstr(self.entries[i].name),
 *                 'source'      : TrashIterator.__source_string[self.entries[i].source],             # <<<<<<<<<<<<<<
 *                 'deletion_time' : datetime.fromtimestamp(self.entries[i].deletion_time),
 *                 'deferment_end_time' : datetime.fromtimestamp(self.entries[i].deferment_end_time)
 */
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)((PyObject*)__pyx_ptype_3rbd_TrashIterator)), __pyx_n_s____source_string); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_4 = PyInt_FromLong((__pyx_cur_scope->__pyx_v_self->entries[__pyx_cur_scope->__pyx_v_i]).source); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_GetItem(__pyx_t_6, __pyx_t_4); if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2954; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__source), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "rbd.pyx":2955
 *                 'name'        : decode_cstr(self.entries[i].name),
 *                 'source'      : TrashIterator.__source_string[self.entries[i].source],
 *                 'deletion_time' : datetime.fromtimestamp(self.entries[i].deletion_time),             # <<<<<<<<<<<<<<
 *                 'deferment_end_time' : datetime.fromtimestamp(self.entries[i].deferment_end_time)
 *                 }
 */
    __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__datetime); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2955; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s__fromtimestamp); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2955; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyInt_to_py_time_t((__pyx_cur_scope->__pyx_v_self->entries[__pyx_cur_scope->__pyx_v_i]).deletion_time); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2955; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2955; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2955; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__deletion_time), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "rbd.pyx":2956
 *                 'source'      : TrashIterator.__source_string[self.entries[i].source],
 *                 'deletion_time' : datetime.fromtimestamp(self.entries[i].deletion_time),
 *                 'deferment_end_time' : datetime.fromtimestamp(self.entries[i].deferment_end_time)             # <<<<<<<<<<<<<<
 *                 }
 * 
 */
    __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s__datetime); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s__fromtimestamp); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyInt_to_py_time_t((__pyx_cur_scope->__pyx_v_self->entries[__pyx_cur_scope->__pyx_v_i]).deferment_end_time); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2956; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__deferment_end_time), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_r = ((PyObject *)__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
    __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
    __Pyx_XGIVEREF(__pyx_r);
    __Pyx_RefNannyFinishContext();
    /* return from generator, yielding value */
    __pyx_generator->resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
    __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
    if (unlikely(!__pyx_sent_value)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2951; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  PyErr_SetNone(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_generator->resume_label = -1;
  __Pyx_Generator_clear((PyObject*)__pyx_generator);
  __Pyx_RefNannyFinishContext();
  return NULL;
}

/* Python wrapper */
static void __pyx_pw_3rbd_13TrashIterator_6__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_3rbd_13TrashIterator_6__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_3rbd_13TrashIterator_5__dealloc__(((struct __pyx_obj_3rbd_TrashIterator *)__pyx_v_self));
  __Pyx_RefNannyFinishContext();
}

/* "rbd.pyx":2959
 *                 }
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         rbd_trash_list_cleanup(self.entries, self.num_entries)
 *         if self.entries:
 */

static void __pyx_pf_3rbd_13TrashIterator_5__dealloc__(struct __pyx_obj_3rbd_TrashIterator *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "rbd.pyx":2960
 * 
 *     def __dealloc__(self):
 *         rbd_trash_list_cleanup(self.entries, self.num_entries)             # <<<<<<<<<<<<<<
 *         if self.entries:
 *             free(self.entries)
 */
  rbd_trash_list_cleanup(__pyx_v_self->entries, __pyx_v_self->num_entries);

  /* "rbd.pyx":2961
 *     def __dealloc__(self):
 *         rbd_trash_list_cleanup(self.entries, self.num_entries)
 *         if self.entries:             # <<<<<<<<<<<<<<
 *             free(self.entries)
 * 
 */
  __pyx_t_1 = (__pyx_v_self->entries != 0);
  if (__pyx_t_1) {

    /* "rbd.pyx":2962
 *         rbd_trash_list_cleanup(self.entries, self.num_entries)
 *         if self.entries:
 *             free(self.entries)             # <<<<<<<<<<<<<<
 * 
 */
    free(__pyx_v_self->entries);
    goto __pyx_L3;
  }
  __pyx_L3:;

  __Pyx_RefNannyFinishContext();
}

/* "cpython/datetime.pxd":104
 * # Datetime C API initialization function.
 * # You have to call it before any usage of DateTime CAPI functions.
 * cdef inline void import_datetime():             # <<<<<<<<<<<<<<
 *     PyDateTime_IMPORT
 * 
 */

static CYTHON_INLINE void __pyx_f_7cpython_8datetime_import_datetime(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("import_datetime", 0);

  /* "cpython/datetime.pxd":105
 * # You have to call it before any usage of DateTime CAPI functions.
 * cdef inline void import_datetime():
 *     PyDateTime_IMPORT             # <<<<<<<<<<<<<<
 * 
 * # Create date object using DateTime CAPI factory function.
 */
  PyDateTime_IMPORT;

  __Pyx_RefNannyFinishContext();
}

/* "cpython/datetime.pxd":109
 * # Create date object using DateTime CAPI factory function.
 * # Note, there are no range checks for any of the arguments.
 * cdef inline object date_new(int year, int month, int day):             # <<<<<<<<<<<<<<
 *     return PyDateTimeAPI.Date_FromDate(year, month, day, PyDateTimeAPI.DateType)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_7cpython_8datetime_date_new(int __pyx_v_year, int __pyx_v_month, int __pyx_v_day) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("date_new", 0);

  /* "cpython/datetime.pxd":110
 * # Note, there are no range checks for any of the arguments.
 * cdef inline object date_new(int year, int month, int day):
 *     return PyDateTimeAPI.Date_FromDate(year, month, day, PyDateTimeAPI.DateType)             # <<<<<<<<<<<<<<
 * 
 * # Create time object using DateTime CAPI factory function
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyDateTimeAPI->Date_FromDate(__pyx_v_year, __pyx_v_month, __pyx_v_day, PyDateTimeAPI->DateType); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("cpython.datetime.date_new", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":114
 * # Create time object using DateTime CAPI factory function
 * # Note, there are no range checks for any of the arguments.
 * cdef inline object time_new(int hour, int minute, int second, int microsecond, object tz):             # <<<<<<<<<<<<<<
 *     return PyDateTimeAPI.Time_FromTime(hour, minute, second, microsecond, tz, PyDateTimeAPI.TimeType)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_7cpython_8datetime_time_new(int __pyx_v_hour, int __pyx_v_minute, int __pyx_v_second, int __pyx_v_microsecond, PyObject *__pyx_v_tz) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("time_new", 0);

  /* "cpython/datetime.pxd":115
 * # Note, there are no range checks for any of the arguments.
 * cdef inline object time_new(int hour, int minute, int second, int microsecond, object tz):
 *     return PyDateTimeAPI.Time_FromTime(hour, minute, second, microsecond, tz, PyDateTimeAPI.TimeType)             # <<<<<<<<<<<<<<
 * 
 * # Create datetime object using DateTime CAPI factory function.
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyDateTimeAPI->Time_FromTime(__pyx_v_hour, __pyx_v_minute, __pyx_v_second, __pyx_v_microsecond, __pyx_v_tz, PyDateTimeAPI->TimeType); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("cpython.datetime.time_new", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":119
 * # Create datetime object using DateTime CAPI factory function.
 * # Note, there are no range checks for any of the arguments.
 * cdef inline object datetime_new(int year, int month, int day, int hour, int minute, int second, int microsecond, object tz):             # <<<<<<<<<<<<<<
 *     return PyDateTimeAPI.DateTime_FromDateAndTime(year, month, day, hour, minute, second, microsecond, tz, PyDateTimeAPI.DateTimeType)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_7cpython_8datetime_datetime_new(int __pyx_v_year, int __pyx_v_month, int __pyx_v_day, int __pyx_v_hour, int __pyx_v_minute, int __pyx_v_second, int __pyx_v_microsecond, PyObject *__pyx_v_tz) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("datetime_new", 0);

  /* "cpython/datetime.pxd":120
 * # Note, there are no range checks for any of the arguments.
 * cdef inline object datetime_new(int year, int month, int day, int hour, int minute, int second, int microsecond, object tz):
 *     return PyDateTimeAPI.DateTime_FromDateAndTime(year, month, day, hour, minute, second, microsecond, tz, PyDateTimeAPI.DateTimeType)             # <<<<<<<<<<<<<<
 * 
 * # Create timedelta object using DateTime CAPI factory function.
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyDateTimeAPI->DateTime_FromDateAndTime(__pyx_v_year, __pyx_v_month, __pyx_v_day, __pyx_v_hour, __pyx_v_minute, __pyx_v_second, __pyx_v_microsecond, __pyx_v_tz, PyDateTimeAPI->DateTimeType); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("cpython.datetime.datetime_new", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":124
 * # Create timedelta object using DateTime CAPI factory function.
 * # Note, there are no range checks for any of the arguments.
 * cdef inline object timedelta_new(int days, int seconds, int useconds):             # <<<<<<<<<<<<<<
 *     return PyDateTimeAPI.Delta_FromDelta(days, seconds, useconds, 1, PyDateTimeAPI.DeltaType)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_7cpython_8datetime_timedelta_new(int __pyx_v_days, int __pyx_v_seconds, int __pyx_v_useconds) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("timedelta_new", 0);

  /* "cpython/datetime.pxd":125
 * # Note, there are no range checks for any of the arguments.
 * cdef inline object timedelta_new(int days, int seconds, int useconds):
 *     return PyDateTimeAPI.Delta_FromDelta(days, seconds, useconds, 1, PyDateTimeAPI.DeltaType)             # <<<<<<<<<<<<<<
 * 
 * # More recognizable getters for date/time/datetime/timedelta.
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyDateTimeAPI->Delta_FromDelta(__pyx_v_days, __pyx_v_seconds, __pyx_v_useconds, 1, PyDateTimeAPI->DeltaType); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("cpython.datetime.timedelta_new", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":133
 * 
 * # Get tzinfo of time
 * cdef inline object time_tzinfo(object o):             # <<<<<<<<<<<<<<
 *     if (<PyDateTime_Time*>o).hastzinfo:
 *         return <object>(<PyDateTime_Time*>o).tzinfo
 */

static CYTHON_INLINE PyObject *__pyx_f_7cpython_8datetime_time_tzinfo(PyObject *__pyx_v_o) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("time_tzinfo", 0);

  /* "cpython/datetime.pxd":134
 * # Get tzinfo of time
 * cdef inline object time_tzinfo(object o):
 *     if (<PyDateTime_Time*>o).hastzinfo:             # <<<<<<<<<<<<<<
 *         return <object>(<PyDateTime_Time*>o).tzinfo
 *     else:
 */
  if (((PyDateTime_Time *)__pyx_v_o)->hastzinfo) {

    /* "cpython/datetime.pxd":135
 * cdef inline object time_tzinfo(object o):
 *     if (<PyDateTime_Time*>o).hastzinfo:
 *         return <object>(<PyDateTime_Time*>o).tzinfo             # <<<<<<<<<<<<<<
 *     else:
 *         return None
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)((PyDateTime_Time *)__pyx_v_o)->tzinfo));
    __pyx_r = ((PyObject *)((PyDateTime_Time *)__pyx_v_o)->tzinfo);
    goto __pyx_L0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "cpython/datetime.pxd":137
 *         return <object>(<PyDateTime_Time*>o).tzinfo
 *     else:
 *         return None             # <<<<<<<<<<<<<<
 * 
 * # Get tzinfo of datetime
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
  }
  __pyx_L3:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":140
 * 
 * # Get tzinfo of datetime
 * cdef inline object datetime_tzinfo(object o):             # <<<<<<<<<<<<<<
 *     if (<PyDateTime_DateTime*>o).hastzinfo:
 *         return <object>(<PyDateTime_DateTime*>o).tzinfo
 */

static CYTHON_INLINE PyObject *__pyx_f_7cpython_8datetime_datetime_tzinfo(PyObject *__pyx_v_o) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("datetime_tzinfo", 0);

  /* "cpython/datetime.pxd":141
 * # Get tzinfo of datetime
 * cdef inline object datetime_tzinfo(object o):
 *     if (<PyDateTime_DateTime*>o).hastzinfo:             # <<<<<<<<<<<<<<
 *         return <object>(<PyDateTime_DateTime*>o).tzinfo
 *     else:
 */
  if (((PyDateTime_DateTime *)__pyx_v_o)->hastzinfo) {

    /* "cpython/datetime.pxd":142
 * cdef inline object datetime_tzinfo(object o):
 *     if (<PyDateTime_DateTime*>o).hastzinfo:
 *         return <object>(<PyDateTime_DateTime*>o).tzinfo             # <<<<<<<<<<<<<<
 *     else:
 *         return None
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)((PyDateTime_DateTime *)__pyx_v_o)->tzinfo));
    __pyx_r = ((PyObject *)((PyDateTime_DateTime *)__pyx_v_o)->tzinfo);
    goto __pyx_L0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "cpython/datetime.pxd":144
 *         return <object>(<PyDateTime_DateTime*>o).tzinfo
 *     else:
 *         return None             # <<<<<<<<<<<<<<
 * 
 * # Get year of date
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
  }
  __pyx_L3:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":147
 * 
 * # Get year of date
 * cdef inline int date_year(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_GET_YEAR(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_date_year(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("date_year", 0);

  /* "cpython/datetime.pxd":148
 * # Get year of date
 * cdef inline int date_year(object o):
 *     return PyDateTime_GET_YEAR(o)             # <<<<<<<<<<<<<<
 * 
 * # Get month of date
 */
  __pyx_r = PyDateTime_GET_YEAR(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":151
 * 
 * # Get month of date
 * cdef inline int date_month(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_GET_MONTH(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_date_month(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("date_month", 0);

  /* "cpython/datetime.pxd":152
 * # Get month of date
 * cdef inline int date_month(object o):
 *     return PyDateTime_GET_MONTH(o)             # <<<<<<<<<<<<<<
 * 
 * # Get day of date
 */
  __pyx_r = PyDateTime_GET_MONTH(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":155
 * 
 * # Get day of date
 * cdef inline int date_day(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_GET_DAY(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_date_day(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("date_day", 0);

  /* "cpython/datetime.pxd":156
 * # Get day of date
 * cdef inline int date_day(object o):
 *     return PyDateTime_GET_DAY(o)             # <<<<<<<<<<<<<<
 * 
 * # Get year of datetime
 */
  __pyx_r = PyDateTime_GET_DAY(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":159
 * 
 * # Get year of datetime
 * cdef inline int datetime_year(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_GET_YEAR(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_datetime_year(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("datetime_year", 0);

  /* "cpython/datetime.pxd":160
 * # Get year of datetime
 * cdef inline int datetime_year(object o):
 *     return PyDateTime_GET_YEAR(o)             # <<<<<<<<<<<<<<
 * 
 * # Get month of datetime
 */
  __pyx_r = PyDateTime_GET_YEAR(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":163
 * 
 * # Get month of datetime
 * cdef inline int datetime_month(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_GET_MONTH(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_datetime_month(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("datetime_month", 0);

  /* "cpython/datetime.pxd":164
 * # Get month of datetime
 * cdef inline int datetime_month(object o):
 *     return PyDateTime_GET_MONTH(o)             # <<<<<<<<<<<<<<
 * 
 * # Get day of datetime
 */
  __pyx_r = PyDateTime_GET_MONTH(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":167
 * 
 * # Get day of datetime
 * cdef inline int datetime_day(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_GET_DAY(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_datetime_day(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("datetime_day", 0);

  /* "cpython/datetime.pxd":168
 * # Get day of datetime
 * cdef inline int datetime_day(object o):
 *     return PyDateTime_GET_DAY(o)             # <<<<<<<<<<<<<<
 * 
 * # Get hour of time
 */
  __pyx_r = PyDateTime_GET_DAY(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":171
 * 
 * # Get hour of time
 * cdef inline int time_hour(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_TIME_GET_HOUR(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_time_hour(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("time_hour", 0);

  /* "cpython/datetime.pxd":172
 * # Get hour of time
 * cdef inline int time_hour(object o):
 *     return PyDateTime_TIME_GET_HOUR(o)             # <<<<<<<<<<<<<<
 * 
 * # Get minute of time
 */
  __pyx_r = PyDateTime_TIME_GET_HOUR(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":175
 * 
 * # Get minute of time
 * cdef inline int time_minute(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_TIME_GET_MINUTE(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_time_minute(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("time_minute", 0);

  /* "cpython/datetime.pxd":176
 * # Get minute of time
 * cdef inline int time_minute(object o):
 *     return PyDateTime_TIME_GET_MINUTE(o)             # <<<<<<<<<<<<<<
 * 
 * # Get second of time
 */
  __pyx_r = PyDateTime_TIME_GET_MINUTE(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":179
 * 
 * # Get second of time
 * cdef inline int time_second(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_TIME_GET_SECOND(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_time_second(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("time_second", 0);

  /* "cpython/datetime.pxd":180
 * # Get second of time
 * cdef inline int time_second(object o):
 *     return PyDateTime_TIME_GET_SECOND(o)             # <<<<<<<<<<<<<<
 * 
 * # Get microsecond of time
 */
  __pyx_r = PyDateTime_TIME_GET_SECOND(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":183
 * 
 * # Get microsecond of time
 * cdef inline int time_microsecond(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_TIME_GET_MICROSECOND(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_time_microsecond(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("time_microsecond", 0);

  /* "cpython/datetime.pxd":184
 * # Get microsecond of time
 * cdef inline int time_microsecond(object o):
 *     return PyDateTime_TIME_GET_MICROSECOND(o)             # <<<<<<<<<<<<<<
 * 
 * # Get hour of datetime
 */
  __pyx_r = PyDateTime_TIME_GET_MICROSECOND(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":187
 * 
 * # Get hour of datetime
 * cdef inline int datetime_hour(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_DATE_GET_HOUR(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_datetime_hour(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("datetime_hour", 0);

  /* "cpython/datetime.pxd":188
 * # Get hour of datetime
 * cdef inline int datetime_hour(object o):
 *     return PyDateTime_DATE_GET_HOUR(o)             # <<<<<<<<<<<<<<
 * 
 * # Get minute of datetime
 */
  __pyx_r = PyDateTime_DATE_GET_HOUR(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":191
 * 
 * # Get minute of datetime
 * cdef inline int datetime_minute(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_DATE_GET_MINUTE(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_datetime_minute(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("datetime_minute", 0);

  /* "cpython/datetime.pxd":192
 * # Get minute of datetime
 * cdef inline int datetime_minute(object o):
 *     return PyDateTime_DATE_GET_MINUTE(o)             # <<<<<<<<<<<<<<
 * 
 * # Get second of datetime
 */
  __pyx_r = PyDateTime_DATE_GET_MINUTE(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":195
 * 
 * # Get second of datetime
 * cdef inline int datetime_second(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_DATE_GET_SECOND(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_datetime_second(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("datetime_second", 0);

  /* "cpython/datetime.pxd":196
 * # Get second of datetime
 * cdef inline int datetime_second(object o):
 *     return PyDateTime_DATE_GET_SECOND(o)             # <<<<<<<<<<<<<<
 * 
 * # Get microsecond of datetime
 */
  __pyx_r = PyDateTime_DATE_GET_SECOND(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":199
 * 
 * # Get microsecond of datetime
 * cdef inline int datetime_microsecond(object o):             # <<<<<<<<<<<<<<
 *     return PyDateTime_DATE_GET_MICROSECOND(o)
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_datetime_microsecond(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("datetime_microsecond", 0);

  /* "cpython/datetime.pxd":200
 * # Get microsecond of datetime
 * cdef inline int datetime_microsecond(object o):
 *     return PyDateTime_DATE_GET_MICROSECOND(o)             # <<<<<<<<<<<<<<
 * 
 * # Get days of timedelta
 */
  __pyx_r = PyDateTime_DATE_GET_MICROSECOND(__pyx_v_o);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":203
 * 
 * # Get days of timedelta
 * cdef inline int timedelta_days(object o):             # <<<<<<<<<<<<<<
 *     return (<PyDateTime_Delta*>o).days
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_timedelta_days(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("timedelta_days", 0);

  /* "cpython/datetime.pxd":204
 * # Get days of timedelta
 * cdef inline int timedelta_days(object o):
 *     return (<PyDateTime_Delta*>o).days             # <<<<<<<<<<<<<<
 * 
 * # Get seconds of timedelta
 */
  __pyx_r = ((PyDateTime_Delta *)__pyx_v_o)->days;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":207
 * 
 * # Get seconds of timedelta
 * cdef inline int timedelta_seconds(object o):             # <<<<<<<<<<<<<<
 *     return (<PyDateTime_Delta*>o).seconds
 * 
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_timedelta_seconds(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("timedelta_seconds", 0);

  /* "cpython/datetime.pxd":208
 * # Get seconds of timedelta
 * cdef inline int timedelta_seconds(object o):
 *     return (<PyDateTime_Delta*>o).seconds             # <<<<<<<<<<<<<<
 * 
 * # Get microseconds of timedelta
 */
  __pyx_r = ((PyDateTime_Delta *)__pyx_v_o)->seconds;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "cpython/datetime.pxd":211
 * 
 * # Get microseconds of timedelta
 * cdef inline int timedelta_microseconds(object o):             # <<<<<<<<<<<<<<
 *     return (<PyDateTime_Delta*>o).microseconds
 */

static CYTHON_INLINE int __pyx_f_7cpython_8datetime_timedelta_microseconds(PyObject *__pyx_v_o) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("timedelta_microseconds", 0);

  /* "cpython/datetime.pxd":212
 * # Get microseconds of timedelta
 * cdef inline int timedelta_microseconds(object o):
 *     return (<PyDateTime_Delta*>o).microseconds             # <<<<<<<<<<<<<<
 */
  __pyx_r = ((PyDateTime_Delta *)__pyx_v_o)->microseconds;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static struct __pyx_vtabstruct_3rbd_Completion __pyx_vtable_3rbd_Completion;

static PyObject *__pyx_tp_new_3rbd_Completion(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_3rbd_Completion *p;
  PyObject *o;
  o = (*t->tp_alloc)(t, 0);
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_3rbd_Completion *)o);
  p->__pyx_vtab = __pyx_vtabptr_3rbd_Completion;
  p->image = Py_None; Py_INCREF(Py_None);
  p->oncomplete = Py_None; Py_INCREF(Py_None);
  p->exc_info = Py_None; Py_INCREF(Py_None);
  if (unlikely(__pyx_pw_3rbd_10Completion_1__cinit__(o, a, k) < 0)) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_3rbd_Completion(PyObject *o) {
  struct __pyx_obj_3rbd_Completion *p = (struct __pyx_obj_3rbd_Completion *)o;
  PyObject_GC_UnTrack(o);
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_3rbd_10Completion_9__dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_CLEAR(p->image);
  Py_CLEAR(p->oncomplete);
  Py_CLEAR(p->exc_info);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_3rbd_Completion(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd_Completion *p = (struct __pyx_obj_3rbd_Completion *)o;
  if (p->image) {
    e = (*v)(p->image, a); if (e) return e;
  }
  if (p->oncomplete) {
    e = (*v)(p->oncomplete, a); if (e) return e;
  }
  if (p->exc_info) {
    e = (*v)(p->exc_info, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd_Completion(PyObject *o) {
  struct __pyx_obj_3rbd_Completion *p = (struct __pyx_obj_3rbd_Completion *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->image);
  p->image = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->oncomplete);
  p->oncomplete = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->exc_info);
  p->exc_info = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd_Completion[] = {
  {__Pyx_NAMESTR("is_complete"), (PyCFunction)__pyx_pw_3rbd_10Completion_3is_complete, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_10Completion_2is_complete)},
  {__Pyx_NAMESTR("wait_for_complete_and_cb"), (PyCFunction)__pyx_pw_3rbd_10Completion_5wait_for_complete_and_cb, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_10Completion_4wait_for_complete_and_cb)},
  {__Pyx_NAMESTR("get_return_value"), (PyCFunction)__pyx_pw_3rbd_10Completion_7get_return_value, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_10Completion_6get_return_value)},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_Completion = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_Completion = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_Completion = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_Completion = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd_Completion = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.Completion"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd_Completion), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd_Completion, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number_Completion, /*tp_as_number*/
  &__pyx_tp_as_sequence_Completion, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_Completion, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_Completion, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("completion object"), /*tp_doc*/
  __pyx_tp_traverse_3rbd_Completion, /*tp_traverse*/
  __pyx_tp_clear_3rbd_Completion, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd_Completion, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd_Completion, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_3rbd_MirrorPeerIterator(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  o = (*t->tp_alloc)(t, 0);
  if (unlikely(!o)) return 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd_MirrorPeerIterator(PyObject *o) {
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_3rbd_18MirrorPeerIterator_6__dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  (*Py_TYPE(o)->tp_free)(o);
}

static PyMethodDef __pyx_methods_3rbd_MirrorPeerIterator[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_MirrorPeerIterator = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_MirrorPeerIterator = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_MirrorPeerIterator = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_MirrorPeerIterator = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd_MirrorPeerIterator = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.MirrorPeerIterator"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd_MirrorPeerIterator), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd_MirrorPeerIterator, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number_MirrorPeerIterator, /*tp_as_number*/
  &__pyx_tp_as_sequence_MirrorPeerIterator, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_MirrorPeerIterator, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_MirrorPeerIterator, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  __Pyx_DOCSTR("MirrorPeerIterator(ioctx)\n\n    Iterator over mirror peer info for a pool.\n\n    Yields a dictionary containing information about a peer.\n\n    Keys are:\n\n    * ``uuid`` (str) - uuid of the peer\n\n    * ``cluster_name`` (str) - cluster name of the peer\n\n    * ``client_name`` (str) - client name of the peer\n    "), /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_3rbd_18MirrorPeerIterator_3__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd_MirrorPeerIterator, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_3rbd_18MirrorPeerIterator_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd_MirrorPeerIterator, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_3rbd_MirrorImageStatusIterator(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  o = (*t->tp_alloc)(t, 0);
  if (unlikely(!o)) return 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd_MirrorImageStatusIterator(PyObject *o) {
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_3rbd_25MirrorImageStatusIterator_6__dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  (*Py_TYPE(o)->tp_free)(o);
}

static PyMethodDef __pyx_methods_3rbd_MirrorImageStatusIterator[] = {
  {__Pyx_NAMESTR("get_next_chunk"), (PyCFunction)__pyx_pw_3rbd_25MirrorImageStatusIterator_8get_next_chunk, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_25MirrorImageStatusIterator_7get_next_chunk)},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_MirrorImageStatusIterator = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_MirrorImageStatusIterator = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_MirrorImageStatusIterator = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_MirrorImageStatusIterator = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd_MirrorImageStatusIterator = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.MirrorImageStatusIterator"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd_MirrorImageStatusIterator), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd_MirrorImageStatusIterator, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number_MirrorImageStatusIterator, /*tp_as_number*/
  &__pyx_tp_as_sequence_MirrorImageStatusIterator, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_MirrorImageStatusIterator, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_MirrorImageStatusIterator, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  __Pyx_DOCSTR("MirrorImageStatusIterator(ioctx)\n\n    Iterator over mirror image status for a pool.\n\n    Yields a dictionary containing mirror status of an image.\n\n    Keys are:\n\n        * ``name`` (str) - mirror image name\n\n        * `info` (dict) - mirror image info\n\n        * `state` (int) - mirror state\n\n        * `description` (str) - status description\n\n        * `last_update` (datetime) - last status update time\n\n        * ``up`` (bool) - is mirroring agent up\n    "), /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_3rbd_25MirrorImageStatusIterator_3__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd_MirrorImageStatusIterator, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_3rbd_25MirrorImageStatusIterator_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd_MirrorImageStatusIterator, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_3rbd_Image(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd_Image *p;
  PyObject *o;
  o = (*t->tp_alloc)(t, 0);
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_3rbd_Image *)o);
  p->name = Py_None; Py_INCREF(Py_None);
  p->ioctx = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_3rbd_Image(PyObject *o) {
  struct __pyx_obj_3rbd_Image *p = (struct __pyx_obj_3rbd_Image *)o;
  PyObject_GC_UnTrack(o);
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_3rbd_5Image_11__dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_CLEAR(p->name);
  Py_CLEAR(p->ioctx);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_3rbd_Image(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd_Image *p = (struct __pyx_obj_3rbd_Image *)o;
  if (p->name) {
    e = (*v)(p->name, a); if (e) return e;
  }
  if (p->ioctx) {
    e = (*v)(p->ioctx, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd_Image(PyObject *o) {
  struct __pyx_obj_3rbd_Image *p = (struct __pyx_obj_3rbd_Image *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->name);
  p->name = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->ioctx);
  p->ioctx = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd_Image[] = {
  {__Pyx_NAMESTR("__enter__"), (PyCFunction)__pyx_pw_3rbd_5Image_3__enter__, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_2__enter__)},
  {__Pyx_NAMESTR("__exit__"), (PyCFunction)__pyx_pw_3rbd_5Image_5__exit__, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_4__exit__)},
  {__Pyx_NAMESTR("__get_completion"), (PyCFunction)__pyx_pw_3rbd_5Image_7__get_completion, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_6__get_completion)},
  {__Pyx_NAMESTR("close"), (PyCFunction)__pyx_pw_3rbd_5Image_9close, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_8close)},
  {__Pyx_NAMESTR("resize"), (PyCFunction)__pyx_pw_3rbd_5Image_15resize, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_14resize)},
  {__Pyx_NAMESTR("stat"), (PyCFunction)__pyx_pw_3rbd_5Image_17stat, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_16stat)},
  {__Pyx_NAMESTR("id"), (PyCFunction)__pyx_pw_3rbd_5Image_19id, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_18id)},
  {__Pyx_NAMESTR("block_name_prefix"), (PyCFunction)__pyx_pw_3rbd_5Image_21block_name_prefix, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_20block_name_prefix)},
  {__Pyx_NAMESTR("parent_info"), (PyCFunction)__pyx_pw_3rbd_5Image_23parent_info, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_22parent_info)},
  {__Pyx_NAMESTR("parent_id"), (PyCFunction)__pyx_pw_3rbd_5Image_25parent_id, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_24parent_id)},
  {__Pyx_NAMESTR("old_format"), (PyCFunction)__pyx_pw_3rbd_5Image_27old_format, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_26old_format)},
  {__Pyx_NAMESTR("size"), (PyCFunction)__pyx_pw_3rbd_5Image_29size, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_28size)},
  {__Pyx_NAMESTR("features"), (PyCFunction)__pyx_pw_3rbd_5Image_31features, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_30features)},
  {__Pyx_NAMESTR("update_features"), (PyCFunction)__pyx_pw_3rbd_5Image_33update_features, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_32update_features)},
  {__Pyx_NAMESTR("overlap"), (PyCFunction)__pyx_pw_3rbd_5Image_35overlap, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_34overlap)},
  {__Pyx_NAMESTR("flags"), (PyCFunction)__pyx_pw_3rbd_5Image_37flags, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_36flags)},
  {__Pyx_NAMESTR("is_exclusive_lock_owner"), (PyCFunction)__pyx_pw_3rbd_5Image_39is_exclusive_lock_owner, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_38is_exclusive_lock_owner)},
  {__Pyx_NAMESTR("copy"), (PyCFunction)__pyx_pw_3rbd_5Image_41copy, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_40copy)},
  {__Pyx_NAMESTR("list_snaps"), (PyCFunction)__pyx_pw_3rbd_5Image_43list_snaps, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_42list_snaps)},
  {__Pyx_NAMESTR("create_snap"), (PyCFunction)__pyx_pw_3rbd_5Image_45create_snap, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_44create_snap)},
  {__Pyx_NAMESTR("rename_snap"), (PyCFunction)__pyx_pw_3rbd_5Image_47rename_snap, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_46rename_snap)},
  {__Pyx_NAMESTR("remove_snap"), (PyCFunction)__pyx_pw_3rbd_5Image_49remove_snap, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_48remove_snap)},
  {__Pyx_NAMESTR("remove_snap2"), (PyCFunction)__pyx_pw_3rbd_5Image_51remove_snap2, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_50remove_snap2)},
  {__Pyx_NAMESTR("rollback_to_snap"), (PyCFunction)__pyx_pw_3rbd_5Image_53rollback_to_snap, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_52rollback_to_snap)},
  {__Pyx_NAMESTR("protect_snap"), (PyCFunction)__pyx_pw_3rbd_5Image_55protect_snap, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_54protect_snap)},
  {__Pyx_NAMESTR("unprotect_snap"), (PyCFunction)__pyx_pw_3rbd_5Image_57unprotect_snap, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_56unprotect_snap)},
  {__Pyx_NAMESTR("is_protected_snap"), (PyCFunction)__pyx_pw_3rbd_5Image_59is_protected_snap, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_58is_protected_snap)},
  {__Pyx_NAMESTR("get_snap_limit"), (PyCFunction)__pyx_pw_3rbd_5Image_61get_snap_limit, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_60get_snap_limit)},
  {__Pyx_NAMESTR("set_snap_limit"), (PyCFunction)__pyx_pw_3rbd_5Image_63set_snap_limit, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_62set_snap_limit)},
  {__Pyx_NAMESTR("get_snap_timestamp"), (PyCFunction)__pyx_pw_3rbd_5Image_65get_snap_timestamp, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_64get_snap_timestamp)},
  {__Pyx_NAMESTR("remove_snap_limit"), (PyCFunction)__pyx_pw_3rbd_5Image_67remove_snap_limit, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_66remove_snap_limit)},
  {__Pyx_NAMESTR("set_snap"), (PyCFunction)__pyx_pw_3rbd_5Image_69set_snap, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_68set_snap)},
  {__Pyx_NAMESTR("read"), (PyCFunction)__pyx_pw_3rbd_5Image_71read, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_70read)},
  {__Pyx_NAMESTR("diff_iterate"), (PyCFunction)__pyx_pw_3rbd_5Image_73diff_iterate, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_72diff_iterate)},
  {__Pyx_NAMESTR("write"), (PyCFunction)__pyx_pw_3rbd_5Image_75write, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_74write)},
  {__Pyx_NAMESTR("discard"), (PyCFunction)__pyx_pw_3rbd_5Image_77discard, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_76discard)},
  {__Pyx_NAMESTR("flush"), (PyCFunction)__pyx_pw_3rbd_5Image_79flush, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_78flush)},
  {__Pyx_NAMESTR("invalidate_cache"), (PyCFunction)__pyx_pw_3rbd_5Image_81invalidate_cache, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_80invalidate_cache)},
  {__Pyx_NAMESTR("stripe_unit"), (PyCFunction)__pyx_pw_3rbd_5Image_83stripe_unit, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_82stripe_unit)},
  {__Pyx_NAMESTR("stripe_count"), (PyCFunction)__pyx_pw_3rbd_5Image_85stripe_count, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_84stripe_count)},
  {__Pyx_NAMESTR("create_timestamp"), (PyCFunction)__pyx_pw_3rbd_5Image_87create_timestamp, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_86create_timestamp)},
  {__Pyx_NAMESTR("flatten"), (PyCFunction)__pyx_pw_3rbd_5Image_89flatten, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_88flatten)},
  {__Pyx_NAMESTR("rebuild_object_map"), (PyCFunction)__pyx_pw_3rbd_5Image_91rebuild_object_map, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_90rebuild_object_map)},
  {__Pyx_NAMESTR("list_children"), (PyCFunction)__pyx_pw_3rbd_5Image_93list_children, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_92list_children)},
  {__Pyx_NAMESTR("list_lockers"), (PyCFunction)__pyx_pw_3rbd_5Image_95list_lockers, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_94list_lockers)},
  {__Pyx_NAMESTR("lock_acquire"), (PyCFunction)__pyx_pw_3rbd_5Image_97lock_acquire, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_96lock_acquire)},
  {__Pyx_NAMESTR("lock_release"), (PyCFunction)__pyx_pw_3rbd_5Image_99lock_release, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_98lock_release)},
  {__Pyx_NAMESTR("lock_get_owners"), (PyCFunction)__pyx_pw_3rbd_5Image_101lock_get_owners, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_100lock_get_owners)},
  {__Pyx_NAMESTR("lock_break"), (PyCFunction)__pyx_pw_3rbd_5Image_103lock_break, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_102lock_break)},
  {__Pyx_NAMESTR("lock_exclusive"), (PyCFunction)__pyx_pw_3rbd_5Image_105lock_exclusive, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_104lock_exclusive)},
  {__Pyx_NAMESTR("lock_shared"), (PyCFunction)__pyx_pw_3rbd_5Image_107lock_shared, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_106lock_shared)},
  {__Pyx_NAMESTR("unlock"), (PyCFunction)__pyx_pw_3rbd_5Image_109unlock, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_108unlock)},
  {__Pyx_NAMESTR("break_lock"), (PyCFunction)__pyx_pw_3rbd_5Image_111break_lock, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_110break_lock)},
  {__Pyx_NAMESTR("mirror_image_enable"), (PyCFunction)__pyx_pw_3rbd_5Image_113mirror_image_enable, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_112mirror_image_enable)},
  {__Pyx_NAMESTR("mirror_image_disable"), (PyCFunction)__pyx_pw_3rbd_5Image_115mirror_image_disable, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_114mirror_image_disable)},
  {__Pyx_NAMESTR("mirror_image_promote"), (PyCFunction)__pyx_pw_3rbd_5Image_117mirror_image_promote, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_116mirror_image_promote)},
  {__Pyx_NAMESTR("mirror_image_demote"), (PyCFunction)__pyx_pw_3rbd_5Image_119mirror_image_demote, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_118mirror_image_demote)},
  {__Pyx_NAMESTR("mirror_image_resync"), (PyCFunction)__pyx_pw_3rbd_5Image_121mirror_image_resync, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_120mirror_image_resync)},
  {__Pyx_NAMESTR("mirror_image_get_info"), (PyCFunction)__pyx_pw_3rbd_5Image_123mirror_image_get_info, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_122mirror_image_get_info)},
  {__Pyx_NAMESTR("mirror_image_get_status"), (PyCFunction)__pyx_pw_3rbd_5Image_125mirror_image_get_status, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_124mirror_image_get_status)},
  {__Pyx_NAMESTR("aio_read"), (PyCFunction)__pyx_pw_3rbd_5Image_127aio_read, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_126aio_read)},
  {__Pyx_NAMESTR("aio_write"), (PyCFunction)__pyx_pw_3rbd_5Image_129aio_write, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_128aio_write)},
  {__Pyx_NAMESTR("aio_discard"), (PyCFunction)__pyx_pw_3rbd_5Image_131aio_discard, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_130aio_discard)},
  {__Pyx_NAMESTR("aio_flush"), (PyCFunction)__pyx_pw_3rbd_5Image_133aio_flush, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_132aio_flush)},
  {__Pyx_NAMESTR("metadata_get"), (PyCFunction)__pyx_pw_3rbd_5Image_135metadata_get, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_134metadata_get)},
  {__Pyx_NAMESTR("metadata_set"), (PyCFunction)__pyx_pw_3rbd_5Image_137metadata_set, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_136metadata_set)},
  {__Pyx_NAMESTR("metadata_remove"), (PyCFunction)__pyx_pw_3rbd_5Image_139metadata_remove, METH_O, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_138metadata_remove)},
  {__Pyx_NAMESTR("metadata_list"), (PyCFunction)__pyx_pw_3rbd_5Image_141metadata_list, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_5Image_140metadata_list)},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_Image = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_Image = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_Image = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_Image = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd_Image = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.Image"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd_Image), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd_Image, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  __pyx_pw_3rbd_5Image_13__repr__, /*tp_repr*/
  &__pyx_tp_as_number_Image, /*tp_as_number*/
  &__pyx_tp_as_sequence_Image, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_Image, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_Image, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("Image(ioctx, name, snapshot=None, read_only=False)\n\n    This class represents an RBD image. It is used to perform I/O on\n    the image and interact with snapshots.\n\n    **Note**: Any method of this class may raise :class:`ImageNotFound`\n    if the image has been deleted.\n    "), /*tp_doc*/
  __pyx_tp_traverse_3rbd_Image, /*tp_traverse*/
  __pyx_tp_clear_3rbd_Image, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd_Image, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_3rbd_5Image_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd_Image, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_3rbd_LockOwnerIterator(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd_LockOwnerIterator *p;
  PyObject *o;
  o = (*t->tp_alloc)(t, 0);
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_3rbd_LockOwnerIterator *)o);
  p->image = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_3rbd_LockOwnerIterator(PyObject *o) {
  struct __pyx_obj_3rbd_LockOwnerIterator *p = (struct __pyx_obj_3rbd_LockOwnerIterator *)o;
  PyObject_GC_UnTrack(o);
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_3rbd_17LockOwnerIterator_6__dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_CLEAR(p->image);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_3rbd_LockOwnerIterator(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd_LockOwnerIterator *p = (struct __pyx_obj_3rbd_LockOwnerIterator *)o;
  if (p->image) {
    e = (*v)(p->image, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd_LockOwnerIterator(PyObject *o) {
  struct __pyx_obj_3rbd_LockOwnerIterator *p = (struct __pyx_obj_3rbd_LockOwnerIterator *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->image);
  p->image = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd_LockOwnerIterator[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_LockOwnerIterator = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_LockOwnerIterator = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_LockOwnerIterator = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_LockOwnerIterator = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd_LockOwnerIterator = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.LockOwnerIterator"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd_LockOwnerIterator), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd_LockOwnerIterator, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number_LockOwnerIterator, /*tp_as_number*/
  &__pyx_tp_as_sequence_LockOwnerIterator, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_LockOwnerIterator, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_LockOwnerIterator, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("LockOwnerIterator(Image image)\n\n    Iterator over managed lock owners for an image\n\n    Yields a dictionary containing information about the image's lock\n\n    Keys are:\n\n    * ``mode`` (int) - active lock mode\n\n    * ``owner`` (str) - lock owner name\n    "), /*tp_doc*/
  __pyx_tp_traverse_3rbd_LockOwnerIterator, /*tp_traverse*/
  __pyx_tp_clear_3rbd_LockOwnerIterator, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_3rbd_17LockOwnerIterator_3__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd_LockOwnerIterator, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_3rbd_17LockOwnerIterator_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd_LockOwnerIterator, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_3rbd_MetadataIterator(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd_MetadataIterator *p;
  PyObject *o;
  o = (*t->tp_alloc)(t, 0);
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_3rbd_MetadataIterator *)o);
  p->image_name = Py_None; Py_INCREF(Py_None);
  p->next_chunk = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_3rbd_MetadataIterator(PyObject *o) {
  struct __pyx_obj_3rbd_MetadataIterator *p = (struct __pyx_obj_3rbd_MetadataIterator *)o;
  PyObject_GC_UnTrack(o);
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_3rbd_16MetadataIterator_6__dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_CLEAR(p->image_name);
  Py_CLEAR(p->next_chunk);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_3rbd_MetadataIterator(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd_MetadataIterator *p = (struct __pyx_obj_3rbd_MetadataIterator *)o;
  if (p->image_name) {
    e = (*v)(p->image_name, a); if (e) return e;
  }
  if (p->next_chunk) {
    e = (*v)(p->next_chunk, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd_MetadataIterator(PyObject *o) {
  struct __pyx_obj_3rbd_MetadataIterator *p = (struct __pyx_obj_3rbd_MetadataIterator *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->image_name);
  p->image_name = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->next_chunk);
  p->next_chunk = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd_MetadataIterator[] = {
  {__Pyx_NAMESTR("get_next_chunk"), (PyCFunction)__pyx_pw_3rbd_16MetadataIterator_8get_next_chunk, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_3rbd_16MetadataIterator_7get_next_chunk)},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_MetadataIterator = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_MetadataIterator = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_MetadataIterator = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_MetadataIterator = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd_MetadataIterator = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.MetadataIterator"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd_MetadataIterator), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd_MetadataIterator, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number_MetadataIterator, /*tp_as_number*/
  &__pyx_tp_as_sequence_MetadataIterator, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_MetadataIterator, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_MetadataIterator, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("MetadataIterator(Image image)\n\n    Iterator over metadata list for an image.\n\n    Yields ``(key, value)`` tuple.\n\n    * ``key`` (str) - metadata key\n    * ``value`` (str) - metadata value\n    "), /*tp_doc*/
  __pyx_tp_traverse_3rbd_MetadataIterator, /*tp_traverse*/
  __pyx_tp_clear_3rbd_MetadataIterator, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_3rbd_16MetadataIterator_3__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd_MetadataIterator, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_3rbd_16MetadataIterator_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd_MetadataIterator, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_3rbd_SnapIterator(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd_SnapIterator *p;
  PyObject *o;
  o = (*t->tp_alloc)(t, 0);
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_3rbd_SnapIterator *)o);
  p->image = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_3rbd_SnapIterator(PyObject *o) {
  struct __pyx_obj_3rbd_SnapIterator *p = (struct __pyx_obj_3rbd_SnapIterator *)o;
  PyObject_GC_UnTrack(o);
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_3rbd_12SnapIterator_6__dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_CLEAR(p->image);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_3rbd_SnapIterator(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd_SnapIterator *p = (struct __pyx_obj_3rbd_SnapIterator *)o;
  if (p->image) {
    e = (*v)(p->image, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd_SnapIterator(PyObject *o) {
  struct __pyx_obj_3rbd_SnapIterator *p = (struct __pyx_obj_3rbd_SnapIterator *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->image);
  p->image = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd_SnapIterator[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_SnapIterator = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_SnapIterator = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_SnapIterator = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_SnapIterator = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd_SnapIterator = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.SnapIterator"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd_SnapIterator), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd_SnapIterator, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number_SnapIterator, /*tp_as_number*/
  &__pyx_tp_as_sequence_SnapIterator, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_SnapIterator, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_SnapIterator, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("SnapIterator(Image image)\n\n    Iterator over snapshot info for an image.\n\n    Yields a dictionary containing information about a snapshot.\n\n    Keys are:\n\n    * ``id`` (int) - numeric identifier of the snapshot\n\n    * ``size`` (int) - size of the image at the time of snapshot (in bytes)\n\n    * ``name`` (str) - name of the snapshot\n    "), /*tp_doc*/
  __pyx_tp_traverse_3rbd_SnapIterator, /*tp_traverse*/
  __pyx_tp_clear_3rbd_SnapIterator, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_3rbd_12SnapIterator_3__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd_SnapIterator, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_3rbd_12SnapIterator_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd_SnapIterator, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_3rbd_TrashIterator(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  o = (*t->tp_alloc)(t, 0);
  if (unlikely(!o)) return 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd_TrashIterator(PyObject *o) {
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_3rbd_13TrashIterator_6__dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  (*Py_TYPE(o)->tp_free)(o);
}

static PyMethodDef __pyx_methods_3rbd_TrashIterator[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_TrashIterator = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_TrashIterator = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_TrashIterator = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_TrashIterator = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd_TrashIterator = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.TrashIterator"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd_TrashIterator), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd_TrashIterator, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number_TrashIterator, /*tp_as_number*/
  &__pyx_tp_as_sequence_TrashIterator, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_TrashIterator, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_TrashIterator, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  __Pyx_DOCSTR("TrashIterator(ioctx)\n\n    Iterator over trash entries.\n\n    Yields a dictionary containing trash info of an image.\n\n    Keys are:\n\n        * `id` (str) - image id\n\n        * `name` (str) - image name\n\n        * `source` (str) - source of deletion\n\n        * `deletion_time` (datetime) - time of deletion\n\n        * `deferment_end_time` (datetime) - time that an image is allowed to be\n                                            removed from trash\n    "), /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_3rbd_13TrashIterator_3__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd_TrashIterator, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_3rbd_13TrashIterator_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd_TrashIterator, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *__pyx_freelist_3rbd___pyx_scope_struct____iter__[8];
static int __pyx_freecount_3rbd___pyx_scope_struct____iter__ = 0;

static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct____iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *p;
  PyObject *o;
  if (likely((__pyx_freecount_3rbd___pyx_scope_struct____iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct____iter__)))) {
    o = (PyObject*)__pyx_freelist_3rbd___pyx_scope_struct____iter__[--__pyx_freecount_3rbd___pyx_scope_struct____iter__];
    memset(o, 0, sizeof(struct __pyx_obj_3rbd___pyx_scope_struct____iter__));
    PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  p = ((struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *)o);
  p->__pyx_v_self = 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd___pyx_scope_struct____iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_self);
  if ((__pyx_freecount_3rbd___pyx_scope_struct____iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct____iter__))) {
    __pyx_freelist_3rbd___pyx_scope_struct____iter__[__pyx_freecount_3rbd___pyx_scope_struct____iter__++] = ((struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_3rbd___pyx_scope_struct____iter__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *)o;
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject*)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd___pyx_scope_struct____iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct____iter__ *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_3rbd_MirrorPeerIterator *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd___pyx_scope_struct____iter__[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number___pyx_scope_struct____iter__ = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence___pyx_scope_struct____iter__ = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping___pyx_scope_struct____iter__ = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer___pyx_scope_struct____iter__ = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd___pyx_scope_struct____iter__ = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.__pyx_scope_struct____iter__"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd___pyx_scope_struct____iter__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd___pyx_scope_struct____iter__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number___pyx_scope_struct____iter__, /*tp_as_number*/
  &__pyx_tp_as_sequence___pyx_scope_struct____iter__, /*tp_as_sequence*/
  &__pyx_tp_as_mapping___pyx_scope_struct____iter__, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer___pyx_scope_struct____iter__, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_3rbd___pyx_scope_struct____iter__, /*tp_traverse*/
  __pyx_tp_clear_3rbd___pyx_scope_struct____iter__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd___pyx_scope_struct____iter__, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd___pyx_scope_struct____iter__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *__pyx_freelist_3rbd___pyx_scope_struct_1___iter__[8];
static int __pyx_freecount_3rbd___pyx_scope_struct_1___iter__ = 0;

static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_1___iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *p;
  PyObject *o;
  if (likely((__pyx_freecount_3rbd___pyx_scope_struct_1___iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__)))) {
    o = (PyObject*)__pyx_freelist_3rbd___pyx_scope_struct_1___iter__[--__pyx_freecount_3rbd___pyx_scope_struct_1___iter__];
    memset(o, 0, sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__));
    PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  p = ((struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *)o);
  p->__pyx_v_self = 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd___pyx_scope_struct_1___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_self);
  if ((__pyx_freecount_3rbd___pyx_scope_struct_1___iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__))) {
    __pyx_freelist_3rbd___pyx_scope_struct_1___iter__[__pyx_freecount_3rbd___pyx_scope_struct_1___iter__++] = ((struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_3rbd___pyx_scope_struct_1___iter__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *)o;
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject*)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd___pyx_scope_struct_1___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__ *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_3rbd_MirrorImageStatusIterator *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd___pyx_scope_struct_1___iter__[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number___pyx_scope_struct_1___iter__ = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence___pyx_scope_struct_1___iter__ = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping___pyx_scope_struct_1___iter__ = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer___pyx_scope_struct_1___iter__ = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd___pyx_scope_struct_1___iter__ = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.__pyx_scope_struct_1___iter__"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_1___iter__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd___pyx_scope_struct_1___iter__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number___pyx_scope_struct_1___iter__, /*tp_as_number*/
  &__pyx_tp_as_sequence___pyx_scope_struct_1___iter__, /*tp_as_sequence*/
  &__pyx_tp_as_mapping___pyx_scope_struct_1___iter__, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer___pyx_scope_struct_1___iter__, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_3rbd___pyx_scope_struct_1___iter__, /*tp_traverse*/
  __pyx_tp_clear_3rbd___pyx_scope_struct_1___iter__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd___pyx_scope_struct_1___iter__, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd___pyx_scope_struct_1___iter__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *__pyx_freelist_3rbd___pyx_scope_struct_2_aio_read[8];
static int __pyx_freecount_3rbd___pyx_scope_struct_2_aio_read = 0;

static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_2_aio_read(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *p;
  PyObject *o;
  if (likely((__pyx_freecount_3rbd___pyx_scope_struct_2_aio_read > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read)))) {
    o = (PyObject*)__pyx_freelist_3rbd___pyx_scope_struct_2_aio_read[--__pyx_freecount_3rbd___pyx_scope_struct_2_aio_read];
    memset(o, 0, sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read));
    PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  p = ((struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *)o);
  p->__pyx_v_length = 0;
  p->__pyx_v_oncomplete = 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd___pyx_scope_struct_2_aio_read(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *p = (struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_length);
  Py_CLEAR(p->__pyx_v_oncomplete);
  if ((__pyx_freecount_3rbd___pyx_scope_struct_2_aio_read < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read))) {
    __pyx_freelist_3rbd___pyx_scope_struct_2_aio_read[__pyx_freecount_3rbd___pyx_scope_struct_2_aio_read++] = ((struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_3rbd___pyx_scope_struct_2_aio_read(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *p = (struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *)o;
  if (p->__pyx_v_length) {
    e = (*v)(p->__pyx_v_length, a); if (e) return e;
  }
  if (p->__pyx_v_oncomplete) {
    e = (*v)(p->__pyx_v_oncomplete, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd___pyx_scope_struct_2_aio_read(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *p = (struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->__pyx_v_length);
  p->__pyx_v_length = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_oncomplete);
  p->__pyx_v_oncomplete = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd___pyx_scope_struct_2_aio_read[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number___pyx_scope_struct_2_aio_read = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence___pyx_scope_struct_2_aio_read = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping___pyx_scope_struct_2_aio_read = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer___pyx_scope_struct_2_aio_read = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd___pyx_scope_struct_2_aio_read = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.__pyx_scope_struct_2_aio_read"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_2_aio_read), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd___pyx_scope_struct_2_aio_read, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number___pyx_scope_struct_2_aio_read, /*tp_as_number*/
  &__pyx_tp_as_sequence___pyx_scope_struct_2_aio_read, /*tp_as_sequence*/
  &__pyx_tp_as_mapping___pyx_scope_struct_2_aio_read, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer___pyx_scope_struct_2_aio_read, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_3rbd___pyx_scope_struct_2_aio_read, /*tp_traverse*/
  __pyx_tp_clear_3rbd___pyx_scope_struct_2_aio_read, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd___pyx_scope_struct_2_aio_read, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd___pyx_scope_struct_2_aio_read, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *__pyx_freelist_3rbd___pyx_scope_struct_3___iter__[8];
static int __pyx_freecount_3rbd___pyx_scope_struct_3___iter__ = 0;

static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_3___iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *p;
  PyObject *o;
  if (likely((__pyx_freecount_3rbd___pyx_scope_struct_3___iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__)))) {
    o = (PyObject*)__pyx_freelist_3rbd___pyx_scope_struct_3___iter__[--__pyx_freecount_3rbd___pyx_scope_struct_3___iter__];
    memset(o, 0, sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__));
    PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  p = ((struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *)o);
  p->__pyx_v_self = 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd___pyx_scope_struct_3___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_self);
  if ((__pyx_freecount_3rbd___pyx_scope_struct_3___iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__))) {
    __pyx_freelist_3rbd___pyx_scope_struct_3___iter__[__pyx_freecount_3rbd___pyx_scope_struct_3___iter__++] = ((struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_3rbd___pyx_scope_struct_3___iter__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *)o;
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject*)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd___pyx_scope_struct_3___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__ *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_3rbd_LockOwnerIterator *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd___pyx_scope_struct_3___iter__[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number___pyx_scope_struct_3___iter__ = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence___pyx_scope_struct_3___iter__ = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping___pyx_scope_struct_3___iter__ = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer___pyx_scope_struct_3___iter__ = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd___pyx_scope_struct_3___iter__ = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.__pyx_scope_struct_3___iter__"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_3___iter__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd___pyx_scope_struct_3___iter__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number___pyx_scope_struct_3___iter__, /*tp_as_number*/
  &__pyx_tp_as_sequence___pyx_scope_struct_3___iter__, /*tp_as_sequence*/
  &__pyx_tp_as_mapping___pyx_scope_struct_3___iter__, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer___pyx_scope_struct_3___iter__, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_3rbd___pyx_scope_struct_3___iter__, /*tp_traverse*/
  __pyx_tp_clear_3rbd___pyx_scope_struct_3___iter__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd___pyx_scope_struct_3___iter__, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd___pyx_scope_struct_3___iter__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *__pyx_freelist_3rbd___pyx_scope_struct_4___iter__[8];
static int __pyx_freecount_3rbd___pyx_scope_struct_4___iter__ = 0;

static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_4___iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *p;
  PyObject *o;
  if (likely((__pyx_freecount_3rbd___pyx_scope_struct_4___iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__)))) {
    o = (PyObject*)__pyx_freelist_3rbd___pyx_scope_struct_4___iter__[--__pyx_freecount_3rbd___pyx_scope_struct_4___iter__];
    memset(o, 0, sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__));
    PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  p = ((struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *)o);
  p->__pyx_v_pair = 0;
  p->__pyx_v_self = 0;
  p->__pyx_t_0 = 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd___pyx_scope_struct_4___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_pair);
  Py_CLEAR(p->__pyx_v_self);
  Py_CLEAR(p->__pyx_t_0);
  if ((__pyx_freecount_3rbd___pyx_scope_struct_4___iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__))) {
    __pyx_freelist_3rbd___pyx_scope_struct_4___iter__[__pyx_freecount_3rbd___pyx_scope_struct_4___iter__++] = ((struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_3rbd___pyx_scope_struct_4___iter__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *)o;
  if (p->__pyx_v_pair) {
    e = (*v)(p->__pyx_v_pair, a); if (e) return e;
  }
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject*)p->__pyx_v_self), a); if (e) return e;
  }
  if (p->__pyx_t_0) {
    e = (*v)(p->__pyx_t_0, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd___pyx_scope_struct_4___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__ *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->__pyx_v_pair);
  p->__pyx_v_pair = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_3rbd_MetadataIterator *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_t_0);
  p->__pyx_t_0 = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd___pyx_scope_struct_4___iter__[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number___pyx_scope_struct_4___iter__ = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence___pyx_scope_struct_4___iter__ = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping___pyx_scope_struct_4___iter__ = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer___pyx_scope_struct_4___iter__ = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd___pyx_scope_struct_4___iter__ = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.__pyx_scope_struct_4___iter__"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_4___iter__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd___pyx_scope_struct_4___iter__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number___pyx_scope_struct_4___iter__, /*tp_as_number*/
  &__pyx_tp_as_sequence___pyx_scope_struct_4___iter__, /*tp_as_sequence*/
  &__pyx_tp_as_mapping___pyx_scope_struct_4___iter__, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer___pyx_scope_struct_4___iter__, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_3rbd___pyx_scope_struct_4___iter__, /*tp_traverse*/
  __pyx_tp_clear_3rbd___pyx_scope_struct_4___iter__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd___pyx_scope_struct_4___iter__, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd___pyx_scope_struct_4___iter__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *__pyx_freelist_3rbd___pyx_scope_struct_5___iter__[8];
static int __pyx_freecount_3rbd___pyx_scope_struct_5___iter__ = 0;

static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_5___iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *p;
  PyObject *o;
  if (likely((__pyx_freecount_3rbd___pyx_scope_struct_5___iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__)))) {
    o = (PyObject*)__pyx_freelist_3rbd___pyx_scope_struct_5___iter__[--__pyx_freecount_3rbd___pyx_scope_struct_5___iter__];
    memset(o, 0, sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__));
    PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  p = ((struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *)o);
  p->__pyx_v_self = 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd___pyx_scope_struct_5___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_self);
  if ((__pyx_freecount_3rbd___pyx_scope_struct_5___iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__))) {
    __pyx_freelist_3rbd___pyx_scope_struct_5___iter__[__pyx_freecount_3rbd___pyx_scope_struct_5___iter__++] = ((struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_3rbd___pyx_scope_struct_5___iter__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *)o;
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject*)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd___pyx_scope_struct_5___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__ *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_3rbd_SnapIterator *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd___pyx_scope_struct_5___iter__[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number___pyx_scope_struct_5___iter__ = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence___pyx_scope_struct_5___iter__ = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping___pyx_scope_struct_5___iter__ = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer___pyx_scope_struct_5___iter__ = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd___pyx_scope_struct_5___iter__ = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.__pyx_scope_struct_5___iter__"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_5___iter__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd___pyx_scope_struct_5___iter__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number___pyx_scope_struct_5___iter__, /*tp_as_number*/
  &__pyx_tp_as_sequence___pyx_scope_struct_5___iter__, /*tp_as_sequence*/
  &__pyx_tp_as_mapping___pyx_scope_struct_5___iter__, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer___pyx_scope_struct_5___iter__, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_3rbd___pyx_scope_struct_5___iter__, /*tp_traverse*/
  __pyx_tp_clear_3rbd___pyx_scope_struct_5___iter__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd___pyx_scope_struct_5___iter__, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd___pyx_scope_struct_5___iter__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *__pyx_freelist_3rbd___pyx_scope_struct_6___iter__[8];
static int __pyx_freecount_3rbd___pyx_scope_struct_6___iter__ = 0;

static PyObject *__pyx_tp_new_3rbd___pyx_scope_struct_6___iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *p;
  PyObject *o;
  if (likely((__pyx_freecount_3rbd___pyx_scope_struct_6___iter__ > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__)))) {
    o = (PyObject*)__pyx_freelist_3rbd___pyx_scope_struct_6___iter__[--__pyx_freecount_3rbd___pyx_scope_struct_6___iter__];
    memset(o, 0, sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__));
    PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  p = ((struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *)o);
  p->__pyx_v_self = 0;
  return o;
}

static void __pyx_tp_dealloc_3rbd___pyx_scope_struct_6___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_self);
  if ((__pyx_freecount_3rbd___pyx_scope_struct_6___iter__ < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__))) {
    __pyx_freelist_3rbd___pyx_scope_struct_6___iter__[__pyx_freecount_3rbd___pyx_scope_struct_6___iter__++] = ((struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *)o);
  } else {
    (*Py_TYPE(o)->tp_free)(o);
  }
}

static int __pyx_tp_traverse_3rbd___pyx_scope_struct_6___iter__(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *)o;
  if (p->__pyx_v_self) {
    e = (*v)(((PyObject*)p->__pyx_v_self), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_3rbd___pyx_scope_struct_6___iter__(PyObject *o) {
  struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *p = (struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__ *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->__pyx_v_self);
  p->__pyx_v_self = ((struct __pyx_obj_3rbd_TrashIterator *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_3rbd___pyx_scope_struct_6___iter__[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number___pyx_scope_struct_6___iter__ = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_long*/
  #else
  0, /*reserved*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if PY_VERSION_HEX >= 0x02050000
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence___pyx_scope_struct_6___iter__ = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping___pyx_scope_struct_6___iter__ = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer___pyx_scope_struct_6___iter__ = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

static PyTypeObject __pyx_type_3rbd___pyx_scope_struct_6___iter__ = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("rbd.__pyx_scope_struct_6___iter__"), /*tp_name*/
  sizeof(struct __pyx_obj_3rbd___pyx_scope_struct_6___iter__), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_3rbd___pyx_scope_struct_6___iter__, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  &__pyx_tp_as_number___pyx_scope_struct_6___iter__, /*tp_as_number*/
  &__pyx_tp_as_sequence___pyx_scope_struct_6___iter__, /*tp_as_sequence*/
  &__pyx_tp_as_mapping___pyx_scope_struct_6___iter__, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer___pyx_scope_struct_6___iter__, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_3rbd___pyx_scope_struct_6___iter__, /*tp_traverse*/
  __pyx_tp_clear_3rbd___pyx_scope_struct_6___iter__, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_3rbd___pyx_scope_struct_6___iter__, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_3rbd___pyx_scope_struct_6___iter__, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyMethodDef __pyx_methods[] = {
  {0, 0, 0, 0}
};

#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
  #if PY_VERSION_HEX < 0x03020000
    { PyObject_HEAD_INIT(NULL) NULL, 0, NULL },
  #else
    PyModuleDef_HEAD_INIT,
  #endif
    __Pyx_NAMESTR("rbd"),
    __Pyx_DOCSTR(__pyx_k_120), /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp_s_1, __pyx_k_1, sizeof(__pyx_k_1), 0, 0, 1, 0},
  {&__pyx_n_s_10, __pyx_k_10, sizeof(__pyx_k_10), 0, 0, 1, 1},
  {&__pyx_kp_s_100, __pyx_k_100, sizeof(__pyx_k_100), 0, 0, 1, 0},
  {&__pyx_kp_s_101, __pyx_k_101, sizeof(__pyx_k_101), 0, 0, 1, 0},
  {&__pyx_kp_s_102, __pyx_k_102, sizeof(__pyx_k_102), 0, 0, 1, 0},
  {&__pyx_kp_s_105, __pyx_k_105, sizeof(__pyx_k_105), 0, 0, 1, 0},
  {&__pyx_n_s_106, __pyx_k_106, sizeof(__pyx_k_106), 0, 0, 1, 1},
  {&__pyx_kp_s_107, __pyx_k_107, sizeof(__pyx_k_107), 0, 0, 1, 0},
  {&__pyx_kp_s_108, __pyx_k_108, sizeof(__pyx_k_108), 0, 0, 1, 0},
  {&__pyx_kp_s_109, __pyx_k_109, sizeof(__pyx_k_109), 0, 0, 1, 0},
  {&__pyx_n_s_11, __pyx_k_11, sizeof(__pyx_k_11), 0, 0, 1, 1},
  {&__pyx_kp_s_110, __pyx_k_110, sizeof(__pyx_k_110), 0, 0, 1, 0},
  {&__pyx_kp_s_111, __pyx_k_111, sizeof(__pyx_k_111), 0, 0, 1, 0},
  {&__pyx_kp_s_112, __pyx_k_112, sizeof(__pyx_k_112), 0, 0, 1, 0},
  {&__pyx_kp_s_113, __pyx_k_113, sizeof(__pyx_k_113), 0, 0, 1, 0},
  {&__pyx_kp_s_114, __pyx_k_114, sizeof(__pyx_k_114), 0, 0, 1, 0},
  {&__pyx_kp_s_115, __pyx_k_115, sizeof(__pyx_k_115), 0, 0, 1, 0},
  {&__pyx_kp_s_118, __pyx_k_118, sizeof(__pyx_k_118), 0, 0, 1, 0},
  {&__pyx_kp_s_119, __pyx_k_119, sizeof(__pyx_k_119), 0, 0, 1, 0},
  {&__pyx_n_s_12, __pyx_k_12, sizeof(__pyx_k_12), 0, 0, 1, 1},
  {&__pyx_n_s_121, __pyx_k_121, sizeof(__pyx_k_121), 0, 0, 1, 1},
  {&__pyx_n_s_122, __pyx_k_122, sizeof(__pyx_k_122), 0, 0, 1, 1},
  {&__pyx_n_s_123, __pyx_k_123, sizeof(__pyx_k_123), 0, 0, 1, 1},
  {&__pyx_n_s_124, __pyx_k_124, sizeof(__pyx_k_124), 0, 0, 1, 1},
  {&__pyx_n_s_125, __pyx_k_125, sizeof(__pyx_k_125), 0, 0, 1, 1},
  {&__pyx_n_s_126, __pyx_k_126, sizeof(__pyx_k_126), 0, 0, 1, 1},
  {&__pyx_n_s_127, __pyx_k_127, sizeof(__pyx_k_127), 0, 0, 1, 1},
  {&__pyx_n_s_128, __pyx_k_128, sizeof(__pyx_k_128), 0, 0, 1, 1},
  {&__pyx_n_s_129, __pyx_k_129, sizeof(__pyx_k_129), 0, 0, 1, 1},
  {&__pyx_n_s_13, __pyx_k_13, sizeof(__pyx_k_13), 0, 0, 1, 1},
  {&__pyx_n_s_130, __pyx_k_130, sizeof(__pyx_k_130), 0, 0, 1, 1},
  {&__pyx_n_s_131, __pyx_k_131, sizeof(__pyx_k_131), 0, 0, 1, 1},
  {&__pyx_n_s_132, __pyx_k_132, sizeof(__pyx_k_132), 0, 0, 1, 1},
  {&__pyx_n_s_133, __pyx_k_133, sizeof(__pyx_k_133), 0, 0, 1, 1},
  {&__pyx_n_s_134, __pyx_k_134, sizeof(__pyx_k_134), 0, 0, 1, 1},
  {&__pyx_n_s_135, __pyx_k_135, sizeof(__pyx_k_135), 0, 0, 1, 1},
  {&__pyx_n_s_136, __pyx_k_136, sizeof(__pyx_k_136), 0, 0, 1, 1},
  {&__pyx_n_s_137, __pyx_k_137, sizeof(__pyx_k_137), 0, 0, 1, 1},
  {&__pyx_n_s_138, __pyx_k_138, sizeof(__pyx_k_138), 0, 0, 1, 1},
  {&__pyx_n_s_139, __pyx_k_139, sizeof(__pyx_k_139), 0, 0, 1, 1},
  {&__pyx_n_s_14, __pyx_k_14, sizeof(__pyx_k_14), 0, 0, 1, 1},
  {&__pyx_n_s_140, __pyx_k_140, sizeof(__pyx_k_140), 0, 0, 1, 1},
  {&__pyx_n_s_141, __pyx_k_141, sizeof(__pyx_k_141), 0, 0, 1, 1},
  {&__pyx_n_s_142, __pyx_k_142, sizeof(__pyx_k_142), 0, 0, 1, 1},
  {&__pyx_n_s_143, __pyx_k_143, sizeof(__pyx_k_143), 0, 0, 1, 1},
  {&__pyx_n_s_144, __pyx_k_144, sizeof(__pyx_k_144), 0, 0, 1, 1},
  {&__pyx_n_s_145, __pyx_k_145, sizeof(__pyx_k_145), 0, 0, 1, 1},
  {&__pyx_n_s_146, __pyx_k_146, sizeof(__pyx_k_146), 0, 0, 1, 1},
  {&__pyx_n_s_147, __pyx_k_147, sizeof(__pyx_k_147), 0, 0, 1, 1},
  {&__pyx_n_s_148, __pyx_k_148, sizeof(__pyx_k_148), 0, 0, 1, 1},
  {&__pyx_kp_s_15, __pyx_k_15, sizeof(__pyx_k_15), 0, 0, 1, 0},
  {&__pyx_n_s_152, __pyx_k_152, sizeof(__pyx_k_152), 0, 0, 1, 1},
  {&__pyx_n_s_155, __pyx_k_155, sizeof(__pyx_k_155), 0, 0, 1, 1},
  {&__pyx_n_s_158, __pyx_k_158, sizeof(__pyx_k_158), 0, 0, 1, 1},
  {&__pyx_kp_s_159, __pyx_k_159, sizeof(__pyx_k_159), 0, 0, 1, 0},
  {&__pyx_kp_s_16, __pyx_k_16, sizeof(__pyx_k_16), 0, 0, 1, 0},
  {&__pyx_n_s_160, __pyx_k_160, sizeof(__pyx_k_160), 0, 0, 1, 1},
  {&__pyx_n_s_167, __pyx_k_167, sizeof(__pyx_k_167), 0, 0, 1, 1},
  {&__pyx_kp_s_17, __pyx_k_17, sizeof(__pyx_k_17), 0, 0, 1, 0},
  {&__pyx_n_s_170, __pyx_k_170, sizeof(__pyx_k_170), 0, 0, 1, 1},
  {&__pyx_n_s_174, __pyx_k_174, sizeof(__pyx_k_174), 0, 0, 1, 1},
  {&__pyx_n_s_177, __pyx_k_177, sizeof(__pyx_k_177), 0, 0, 1, 1},
  {&__pyx_kp_b_18, __pyx_k_18, sizeof(__pyx_k_18), 0, 0, 0, 0},
  {&__pyx_n_s_180, __pyx_k_180, sizeof(__pyx_k_180), 0, 0, 1, 1},
  {&__pyx_n_s_183, __pyx_k_183, sizeof(__pyx_k_183), 0, 0, 1, 1},
  {&__pyx_n_s_187, __pyx_k_187, sizeof(__pyx_k_187), 0, 0, 1, 1},
  {&__pyx_n_s_190, __pyx_k_190, sizeof(__pyx_k_190), 0, 0, 1, 1},
  {&__pyx_n_s_193, __pyx_k_193, sizeof(__pyx_k_193), 0, 0, 1, 1},
  {&__pyx_n_s_196, __pyx_k_196, sizeof(__pyx_k_196), 0, 0, 1, 1},
  {&__pyx_n_s_199, __pyx_k_199, sizeof(__pyx_k_199), 0, 0, 1, 1},
  {&__pyx_kp_s_2, __pyx_k_2, sizeof(__pyx_k_2), 0, 0, 1, 0},
  {&__pyx_kp_s_20, __pyx_k_20, sizeof(__pyx_k_20), 0, 0, 1, 0},
  {&__pyx_n_s_202, __pyx_k_202, sizeof(__pyx_k_202), 0, 0, 1, 1},
  {&__pyx_n_s_205, __pyx_k_205, sizeof(__pyx_k_205), 0, 0, 1, 1},
  {&__pyx_n_s_208, __pyx_k_208, sizeof(__pyx_k_208), 0, 0, 1, 1},
  {&__pyx_kp_s_21, __pyx_k_21, sizeof(__pyx_k_21), 0, 0, 1, 0},
  {&__pyx_n_s_211, __pyx_k_211, sizeof(__pyx_k_211), 0, 0, 1, 1},
  {&__pyx_n_s_214, __pyx_k_214, sizeof(__pyx_k_214), 0, 0, 1, 1},
  {&__pyx_n_s_217, __pyx_k_217, sizeof(__pyx_k_217), 0, 0, 1, 1},
  {&__pyx_n_s_218, __pyx_k_218, sizeof(__pyx_k_218), 0, 0, 1, 1},
  {&__pyx_kp_s_22, __pyx_k_22, sizeof(__pyx_k_22), 0, 0, 1, 0},
  {&__pyx_n_s_221, __pyx_k_221, sizeof(__pyx_k_221), 0, 0, 1, 1},
  {&__pyx_n_s_222, __pyx_k_222, sizeof(__pyx_k_222), 0, 0, 1, 1},
  {&__pyx_n_s_225, __pyx_k_225, sizeof(__pyx_k_225), 0, 0, 1, 1},
  {&__pyx_n_s_226, __pyx_k_226, sizeof(__pyx_k_226), 0, 0, 1, 1},
  {&__pyx_n_s_229, __pyx_k_229, sizeof(__pyx_k_229), 0, 0, 1, 1},
  {&__pyx_kp_s_23, __pyx_k_23, sizeof(__pyx_k_23), 0, 0, 1, 0},
  {&__pyx_n_s_230, __pyx_k_230, sizeof(__pyx_k_230), 0, 0, 1, 1},
  {&__pyx_kp_s_231, __pyx_k_231, sizeof(__pyx_k_231), 0, 0, 1, 0},
  {&__pyx_kp_s_24, __pyx_k_24, sizeof(__pyx_k_24), 0, 0, 1, 0},
  {&__pyx_kp_s_25, __pyx_k_25, sizeof(__pyx_k_25), 0, 0, 1, 0},
  {&__pyx_kp_s_26, __pyx_k_26, sizeof(__pyx_k_26), 0, 0, 1, 0},
  {&__pyx_kp_s_27, __pyx_k_27, sizeof(__pyx_k_27), 0, 0, 1, 0},
  {&__pyx_kp_s_28, __pyx_k_28, sizeof(__pyx_k_28), 0, 0, 1, 0},
  {&__pyx_kp_s_29, __pyx_k_29, sizeof(__pyx_k_29), 0, 0, 1, 0},
  {&__pyx_kp_s_30, __pyx_k_30, sizeof(__pyx_k_30), 0, 0, 1, 0},
  {&__pyx_kp_s_31, __pyx_k_31, sizeof(__pyx_k_31), 0, 0, 1, 0},
  {&__pyx_kp_s_32, __pyx_k_32, sizeof(__pyx_k_32), 0, 0, 1, 0},
  {&__pyx_kp_s_34, __pyx_k_34, sizeof(__pyx_k_34), 0, 0, 1, 0},
  {&__pyx_kp_s_36, __pyx_k_36, sizeof(__pyx_k_36), 0, 0, 1, 0},
  {&__pyx_kp_s_37, __pyx_k_37, sizeof(__pyx_k_37), 0, 0, 1, 0},
  {&__pyx_kp_s_38, __pyx_k_38, sizeof(__pyx_k_38), 0, 0, 1, 0},
  {&__pyx_kp_s_39, __pyx_k_39, sizeof(__pyx_k_39), 0, 0, 1, 0},
  {&__pyx_kp_s_4, __pyx_k_4, sizeof(__pyx_k_4), 0, 0, 1, 0},
  {&__pyx_kp_s_40, __pyx_k_40, sizeof(__pyx_k_40), 0, 0, 1, 0},
  {&__pyx_kp_s_41, __pyx_k_41, sizeof(__pyx_k_41), 0, 0, 1, 0},
  {&__pyx_kp_s_42, __pyx_k_42, sizeof(__pyx_k_42), 0, 0, 1, 0},
  {&__pyx_kp_s_43, __pyx_k_43, sizeof(__pyx_k_43), 0, 0, 1, 0},
  {&__pyx_kp_s_44, __pyx_k_44, sizeof(__pyx_k_44), 0, 0, 1, 0},
  {&__pyx_kp_s_45, __pyx_k_45, sizeof(__pyx_k_45), 0, 0, 1, 0},
  {&__pyx_kp_s_46, __pyx_k_46, sizeof(__pyx_k_46), 0, 0, 1, 0},
  {&__pyx_kp_s_47, __pyx_k_47, sizeof(__pyx_k_47), 0, 0, 1, 0},
  {&__pyx_kp_s_48, __pyx_k_48, sizeof(__pyx_k_48), 0, 0, 1, 0},
  {&__pyx_kp_s_49, __pyx_k_49, sizeof(__pyx_k_49), 0, 0, 1, 0},
  {&__pyx_kp_s_5, __pyx_k_5, sizeof(__pyx_k_5), 0, 0, 1, 0},
  {&__pyx_kp_s_50, __pyx_k_50, sizeof(__pyx_k_50), 0, 0, 1, 0},
  {&__pyx_kp_s_51, __pyx_k_51, sizeof(__pyx_k_51), 0, 0, 1, 0},
  {&__pyx_kp_s_52, __pyx_k_52, sizeof(__pyx_k_52), 0, 0, 1, 0},
  {&__pyx_kp_s_53, __pyx_k_53, sizeof(__pyx_k_53), 0, 0, 1, 0},
  {&__pyx_kp_s_54, __pyx_k_54, sizeof(__pyx_k_54), 0, 0, 1, 0},
  {&__pyx_kp_s_55, __pyx_k_55, sizeof(__pyx_k_55), 0, 0, 1, 0},
  {&__pyx_kp_s_56, __pyx_k_56, sizeof(__pyx_k_56), 0, 0, 1, 0},
  {&__pyx_kp_s_57, __pyx_k_57, sizeof(__pyx_k_57), 0, 0, 1, 0},
  {&__pyx_kp_s_58, __pyx_k_58, sizeof(__pyx_k_58), 0, 0, 1, 0},
  {&__pyx_kp_s_59, __pyx_k_59, sizeof(__pyx_k_59), 0, 0, 1, 0},
  {&__pyx_kp_s_60, __pyx_k_60, sizeof(__pyx_k_60), 0, 0, 1, 0},
  {&__pyx_kp_s_61, __pyx_k_61, sizeof(__pyx_k_61), 0, 0, 1, 0},
  {&__pyx_kp_s_62, __pyx_k_62, sizeof(__pyx_k_62), 0, 0, 1, 0},
  {&__pyx_kp_s_63, __pyx_k_63, sizeof(__pyx_k_63), 0, 0, 1, 0},
  {&__pyx_kp_s_64, __pyx_k_64, sizeof(__pyx_k_64), 0, 0, 1, 0},
  {&__pyx_kp_s_65, __pyx_k_65, sizeof(__pyx_k_65), 0, 0, 1, 0},
  {&__pyx_kp_s_66, __pyx_k_66, sizeof(__pyx_k_66), 0, 0, 1, 0},
  {&__pyx_kp_s_67, __pyx_k_67, sizeof(__pyx_k_67), 0, 0, 1, 0},
  {&__pyx_kp_s_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 0, 1, 0},
  {&__pyx_kp_s_70, __pyx_k_70, sizeof(__pyx_k_70), 0, 0, 1, 0},
  {&__pyx_kp_s_71, __pyx_k_71, sizeof(__pyx_k_71), 0, 0, 1, 0},
  {&__pyx_kp_s_73, __pyx_k_73, sizeof(__pyx_k_73), 0, 0, 1, 0},
  {&__pyx_n_s_74, __pyx_k_74, sizeof(__pyx_k_74), 0, 0, 1, 1},
  {&__pyx_kp_s_75, __pyx_k_75, sizeof(__pyx_k_75), 0, 0, 1, 0},
  {&__pyx_kp_s_76, __pyx_k_76, sizeof(__pyx_k_76), 0, 0, 1, 0},
  {&__pyx_kp_s_77, __pyx_k_77, sizeof(__pyx_k_77), 0, 0, 1, 0},
  {&__pyx_kp_s_78, __pyx_k_78, sizeof(__pyx_k_78), 0, 0, 1, 0},
  {&__pyx_kp_s_79, __pyx_k_79, sizeof(__pyx_k_79), 0, 0, 1, 0},
  {&__pyx_kp_s_80, __pyx_k_80, sizeof(__pyx_k_80), 0, 0, 1, 0},
  {&__pyx_kp_s_81, __pyx_k_81, sizeof(__pyx_k_81), 0, 0, 1, 0},
  {&__pyx_kp_s_82, __pyx_k_82, sizeof(__pyx_k_82), 0, 0, 1, 0},
  {&__pyx_kp_s_83, __pyx_k_83, sizeof(__pyx_k_83), 0, 0, 1, 0},
  {&__pyx_kp_s_84, __pyx_k_84, sizeof(__pyx_k_84), 0, 0, 1, 0},
  {&__pyx_n_s_9, __pyx_k_9, sizeof(__pyx_k_9), 0, 0, 1, 1},
  {&__pyx_kp_s_90, __pyx_k_90, sizeof(__pyx_k_90), 0, 0, 1, 0},
  {&__pyx_kp_s_91, __pyx_k_91, sizeof(__pyx_k_91), 0, 0, 1, 0},
  {&__pyx_kp_s_92, __pyx_k_92, sizeof(__pyx_k_92), 0, 0, 1, 0},
  {&__pyx_kp_s_93, __pyx_k_93, sizeof(__pyx_k_93), 0, 0, 1, 0},
  {&__pyx_kp_s_94, __pyx_k_94, sizeof(__pyx_k_94), 0, 0, 1, 0},
  {&__pyx_kp_s_95, __pyx_k_95, sizeof(__pyx_k_95), 0, 0, 1, 0},
  {&__pyx_kp_s_96, __pyx_k_96, sizeof(__pyx_k_96), 0, 0, 1, 0},
  {&__pyx_kp_s_97, __pyx_k_97, sizeof(__pyx_k_97), 0, 0, 1, 0},
  {&__pyx_kp_s_98, __pyx_k_98, sizeof(__pyx_k_98), 0, 0, 1, 0},
  {&__pyx_kp_s_99, __pyx_k_99, sizeof(__pyx_k_99), 0, 0, 1, 0},
  {&__pyx_n_s__ArgumentOutOfRange, __pyx_k__ArgumentOutOfRange, sizeof(__pyx_k__ArgumentOutOfRange), 0, 0, 1, 1},
  {&__pyx_n_s__ConnectionShutdown, __pyx_k__ConnectionShutdown, sizeof(__pyx_k__ConnectionShutdown), 0, 0, 1, 1},
  {&__pyx_n_s__DiskQuotaExceeded, __pyx_k__DiskQuotaExceeded, sizeof(__pyx_k__DiskQuotaExceeded), 0, 0, 1, 1},
  {&__pyx_n_s__Error, __pyx_k__Error, sizeof(__pyx_k__Error), 0, 0, 1, 1},
  {&__pyx_n_s__Exception, __pyx_k__Exception, sizeof(__pyx_k__Exception), 0, 0, 1, 1},
  {&__pyx_n_s__IOError, __pyx_k__IOError, sizeof(__pyx_k__IOError), 0, 0, 1, 1},
  {&__pyx_n_s__ImageBusy, __pyx_k__ImageBusy, sizeof(__pyx_k__ImageBusy), 0, 0, 1, 1},
  {&__pyx_n_s__ImageExists, __pyx_k__ImageExists, sizeof(__pyx_k__ImageExists), 0, 0, 1, 1},
  {&__pyx_n_s__ImageHasSnapshots, __pyx_k__ImageHasSnapshots, sizeof(__pyx_k__ImageHasSnapshots), 0, 0, 1, 1},
  {&__pyx_n_s__ImageNotFound, __pyx_k__ImageNotFound, sizeof(__pyx_k__ImageNotFound), 0, 0, 1, 1},
  {&__pyx_n_s__InvalidArgument, __pyx_k__InvalidArgument, sizeof(__pyx_k__InvalidArgument), 0, 0, 1, 1},
  {&__pyx_n_s__Iterable, __pyx_k__Iterable, sizeof(__pyx_k__Iterable), 0, 0, 1, 1},
  {&__pyx_n_s__KeyError, __pyx_k__KeyError, sizeof(__pyx_k__KeyError), 0, 0, 1, 1},
  {&__pyx_n_s__LogicError, __pyx_k__LogicError, sizeof(__pyx_k__LogicError), 0, 0, 1, 1},
  {&__pyx_n_s__MIRRORING, __pyx_k__MIRRORING, sizeof(__pyx_k__MIRRORING), 0, 0, 1, 1},
  {&__pyx_n_s__MemoryError, __pyx_k__MemoryError, sizeof(__pyx_k__MemoryError), 0, 0, 1, 1},
  {&__pyx_n_s__NoSpace, __pyx_k__NoSpace, sizeof(__pyx_k__NoSpace), 0, 0, 1, 1},
  {&__pyx_n_s__OSError, __pyx_k__OSError, sizeof(__pyx_k__OSError), 0, 0, 1, 1},
  {&__pyx_n_s__PermissionError, __pyx_k__PermissionError, sizeof(__pyx_k__PermissionError), 0, 0, 1, 1},
  {&__pyx_n_s__RBD, __pyx_k__RBD, sizeof(__pyx_k__RBD), 0, 0, 1, 1},
  {&__pyx_n_s__RBD_FEATURES_ALL, __pyx_k__RBD_FEATURES_ALL, sizeof(__pyx_k__RBD_FEATURES_ALL), 0, 0, 1, 1},
  {&__pyx_n_s__ReadOnlyImage, __pyx_k__ReadOnlyImage, sizeof(__pyx_k__ReadOnlyImage), 0, 0, 1, 1},
  {&__pyx_n_s__Timeout, __pyx_k__Timeout, sizeof(__pyx_k__Timeout), 0, 0, 1, 1},
  {&__pyx_n_s__TypeError, __pyx_k__TypeError, sizeof(__pyx_k__TypeError), 0, 0, 1, 1},
  {&__pyx_n_s__USER, __pyx_k__USER, sizeof(__pyx_k__USER), 0, 0, 1, 1},
  {&__pyx_n_s____class__, __pyx_k____class__, sizeof(__pyx_k____class__), 0, 0, 1, 1},
  {&__pyx_n_s____get_completion, __pyx_k____get_completion, sizeof(__pyx_k____get_completion), 0, 0, 1, 1},
  {&__pyx_n_s____import__, __pyx_k____import__, sizeof(__pyx_k____import__), 0, 0, 1, 1},
  {&__pyx_n_s____init__, __pyx_k____init__, sizeof(__pyx_k____init__), 0, 0, 1, 1},
  {&__pyx_n_s____main__, __pyx_k____main__, sizeof(__pyx_k____main__), 0, 0, 1, 1},
  {&__pyx_n_s____metaclass__, __pyx_k____metaclass__, sizeof(__pyx_k____metaclass__), 0, 0, 1, 1},
  {&__pyx_n_s____module__, __pyx_k____module__, sizeof(__pyx_k____module__), 0, 0, 1, 1},
  {&__pyx_n_s____qualname__, __pyx_k____qualname__, sizeof(__pyx_k____qualname__), 0, 0, 1, 1},
  {&__pyx_n_s____reduce__, __pyx_k____reduce__, sizeof(__pyx_k____reduce__), 0, 0, 1, 1},
  {&__pyx_n_s____source_string, __pyx_k____source_string, sizeof(__pyx_k____source_string), 0, 0, 1, 1},
  {&__pyx_n_s____str__, __pyx_k____str__, sizeof(__pyx_k____str__), 0, 0, 1, 1},
  {&__pyx_n_s____test__, __pyx_k____test__, sizeof(__pyx_k____test__), 0, 0, 1, 1},
  {&__pyx_n_s___c_ioctx, __pyx_k___c_ioctx, sizeof(__pyx_k___c_ioctx), 0, 0, 1, 1},
  {&__pyx_n_s___c_name, __pyx_k___c_name, sizeof(__pyx_k___c_name), 0, 0, 1, 1},
  {&__pyx_n_s___client_name, __pyx_k___client_name, sizeof(__pyx_k___client_name), 0, 0, 1, 1},
  {&__pyx_n_s___cluster_name, __pyx_k___cluster_name, sizeof(__pyx_k___cluster_name), 0, 0, 1, 1},
  {&__pyx_n_s___completion_v, __pyx_k___completion_v, sizeof(__pyx_k___completion_v), 0, 0, 1, 1},
  {&__pyx_n_s___delay, __pyx_k___delay, sizeof(__pyx_k___delay), 0, 0, 1, 1},
  {&__pyx_n_s___dest, __pyx_k___dest, sizeof(__pyx_k___dest), 0, 0, 1, 1},
  {&__pyx_n_s___force, __pyx_k___force, sizeof(__pyx_k___force), 0, 0, 1, 1},
  {&__pyx_n_s___image_id, __pyx_k___image_id, sizeof(__pyx_k___image_id), 0, 0, 1, 1},
  {&__pyx_n_s___ioctx, __pyx_k___ioctx, sizeof(__pyx_k___ioctx), 0, 0, 1, 1},
  {&__pyx_n_s___mirror_mode, __pyx_k___mirror_mode, sizeof(__pyx_k___mirror_mode), 0, 0, 1, 1},
  {&__pyx_n_s___name, __pyx_k___name, sizeof(__pyx_k___name), 0, 0, 1, 1},
  {&__pyx_n_s___order, __pyx_k___order, sizeof(__pyx_k___order), 0, 0, 1, 1},
  {&__pyx_n_s___p_ioctx, __pyx_k___p_ioctx, sizeof(__pyx_k___p_ioctx), 0, 0, 1, 1},
  {&__pyx_n_s___p_name, __pyx_k___p_name, sizeof(__pyx_k___p_name), 0, 0, 1, 1},
  {&__pyx_n_s___p_snapname, __pyx_k___p_snapname, sizeof(__pyx_k___p_snapname), 0, 0, 1, 1},
  {&__pyx_n_s___size, __pyx_k___size, sizeof(__pyx_k___size), 0, 0, 1, 1},
  {&__pyx_n_s___src, __pyx_k___src, sizeof(__pyx_k___src), 0, 0, 1, 1},
  {&__pyx_n_s___uuid, __pyx_k___uuid, sizeof(__pyx_k___uuid), 0, 0, 1, 1},
  {&__pyx_n_s___uuid_max_length, __pyx_k___uuid_max_length, sizeof(__pyx_k___uuid_max_length), 0, 0, 1, 1},
  {&__pyx_n_s__args, __pyx_k__args, sizeof(__pyx_k__args), 0, 0, 1, 1},
  {&__pyx_n_s__block_name_prefix, __pyx_k__block_name_prefix, sizeof(__pyx_k__block_name_prefix), 0, 0, 1, 1},
  {&__pyx_n_s__c_info, __pyx_k__c_info, sizeof(__pyx_k__c_info), 0, 0, 1, 1},
  {&__pyx_n_s__c_ioctx, __pyx_k__c_ioctx, sizeof(__pyx_k__c_ioctx), 0, 0, 1, 1},
  {&__pyx_n_s__c_name, __pyx_k__c_name, sizeof(__pyx_k__c_name), 0, 0, 1, 1},
  {&__pyx_n_s__c_names, __pyx_k__c_names, sizeof(__pyx_k__c_names), 0, 0, 1, 1},
  {&__pyx_n_s__client, __pyx_k__client, sizeof(__pyx_k__client), 0, 0, 1, 1},
  {&__pyx_n_s__client_name, __pyx_k__client_name, sizeof(__pyx_k__client_name), 0, 0, 1, 1},
  {&__pyx_n_s__clone, __pyx_k__clone, sizeof(__pyx_k__clone), 0, 0, 1, 1},
  {&__pyx_n_s__close, __pyx_k__close, sizeof(__pyx_k__close), 0, 0, 1, 1},
  {&__pyx_n_s__cluster_name, __pyx_k__cluster_name, sizeof(__pyx_k__cluster_name), 0, 0, 1, 1},
  {&__pyx_n_s__collections, __pyx_k__collections, sizeof(__pyx_k__collections), 0, 0, 1, 1},
  {&__pyx_n_s__completion_v, __pyx_k__completion_v, sizeof(__pyx_k__completion_v), 0, 0, 1, 1},
  {&__pyx_n_s__cookie, __pyx_k__cookie, sizeof(__pyx_k__cookie), 0, 0, 1, 1},
  {&__pyx_n_s__counts, __pyx_k__counts, sizeof(__pyx_k__counts), 0, 0, 1, 1},
  {&__pyx_n_s__create, __pyx_k__create, sizeof(__pyx_k__create), 0, 0, 1, 1},
  {&__pyx_n_s__cstr, __pyx_k__cstr, sizeof(__pyx_k__cstr), 0, 0, 1, 1},
  {&__pyx_n_s__data, __pyx_k__data, sizeof(__pyx_k__data), 0, 0, 1, 1},
  {&__pyx_n_s__data_pool, __pyx_k__data_pool, sizeof(__pyx_k__data_pool), 0, 0, 1, 1},
  {&__pyx_n_s__datetime, __pyx_k__datetime, sizeof(__pyx_k__datetime), 0, 0, 1, 1},
  {&__pyx_n_s__decode, __pyx_k__decode, sizeof(__pyx_k__decode), 0, 0, 1, 1},
  {&__pyx_n_s__decode_cstr, __pyx_k__decode_cstr, sizeof(__pyx_k__decode_cstr), 0, 0, 1, 1},
  {&__pyx_n_s__deferment_end_time, __pyx_k__deferment_end_time, sizeof(__pyx_k__deferment_end_time), 0, 0, 1, 1},
  {&__pyx_n_s__delay, __pyx_k__delay, sizeof(__pyx_k__delay), 0, 0, 1, 1},
  {&__pyx_n_s__deletion_time, __pyx_k__deletion_time, sizeof(__pyx_k__deletion_time), 0, 0, 1, 1},
  {&__pyx_n_s__description, __pyx_k__description, sizeof(__pyx_k__description), 0, 0, 1, 1},
  {&__pyx_n_s__dest, __pyx_k__dest, sizeof(__pyx_k__dest), 0, 0, 1, 1},
  {&__pyx_n_s__dest_ioctx, __pyx_k__dest_ioctx, sizeof(__pyx_k__dest_ioctx), 0, 0, 1, 1},
  {&__pyx_n_s__dest_name, __pyx_k__dest_name, sizeof(__pyx_k__dest_name), 0, 0, 1, 1},
  {&__pyx_n_s__dstname, __pyx_k__dstname, sizeof(__pyx_k__dstname), 0, 0, 1, 1},
  {&__pyx_n_s__enabled, __pyx_k__enabled, sizeof(__pyx_k__enabled), 0, 0, 1, 1},
  {&__pyx_n_s__encode, __pyx_k__encode, sizeof(__pyx_k__encode), 0, 0, 1, 1},
  {&__pyx_n_s__encoding, __pyx_k__encoding, sizeof(__pyx_k__encoding), 0, 0, 1, 1},
  {&__pyx_n_s__errno, __pyx_k__errno, sizeof(__pyx_k__errno), 0, 0, 1, 1},
  {&__pyx_n_s__exc_info, __pyx_k__exc_info, sizeof(__pyx_k__exc_info), 0, 0, 1, 1},
  {&__pyx_n_s__exclusive, __pyx_k__exclusive, sizeof(__pyx_k__exclusive), 0, 0, 1, 1},
  {&__pyx_n_s__extra, __pyx_k__extra, sizeof(__pyx_k__extra), 0, 0, 1, 1},
  {&__pyx_n_s__fadvise_flags, __pyx_k__fadvise_flags, sizeof(__pyx_k__fadvise_flags), 0, 0, 1, 1},
  {&__pyx_n_s__features, __pyx_k__features, sizeof(__pyx_k__features), 0, 0, 1, 1},
  {&__pyx_n_s__flags, __pyx_k__flags, sizeof(__pyx_k__flags), 0, 0, 1, 1},
  {&__pyx_n_s__force, __pyx_k__force, sizeof(__pyx_k__force), 0, 0, 1, 1},
  {&__pyx_n_s__format, __pyx_k__format, sizeof(__pyx_k__format), 0, 0, 1, 1},
  {&__pyx_n_s__from_snapshot, __pyx_k__from_snapshot, sizeof(__pyx_k__from_snapshot), 0, 0, 1, 1},
  {&__pyx_n_s__fromtimestamp, __pyx_k__fromtimestamp, sizeof(__pyx_k__fromtimestamp), 0, 0, 1, 1},
  {&__pyx_n_s__get_next_chunk, __pyx_k__get_next_chunk, sizeof(__pyx_k__get_next_chunk), 0, 0, 1, 1},
  {&__pyx_n_s__get_return_value, __pyx_k__get_return_value, sizeof(__pyx_k__get_return_value), 0, 0, 1, 1},
  {&__pyx_n_s__global_id, __pyx_k__global_id, sizeof(__pyx_k__global_id), 0, 0, 1, 1},
  {&__pyx_n_s__i, __pyx_k__i, sizeof(__pyx_k__i), 0, 0, 1, 1},
  {&__pyx_n_s__id, __pyx_k__id, sizeof(__pyx_k__id), 0, 0, 1, 1},
  {&__pyx_n_s__image, __pyx_k__image, sizeof(__pyx_k__image), 0, 0, 1, 1},
  {&__pyx_n_s__image_id, __pyx_k__image_id, sizeof(__pyx_k__image_id), 0, 0, 1, 1},
  {&__pyx_n_s__include_parent, __pyx_k__include_parent, sizeof(__pyx_k__include_parent), 0, 0, 1, 1},
  {&__pyx_n_s__info, __pyx_k__info, sizeof(__pyx_k__info), 0, 0, 1, 1},
  {&__pyx_n_s__ioctx, __pyx_k__ioctx, sizeof(__pyx_k__ioctx), 0, 0, 1, 1},
  {&__pyx_n_s__iterate_cb, __pyx_k__iterate_cb, sizeof(__pyx_k__iterate_cb), 0, 0, 1, 1},
  {&__pyx_n_s__key, __pyx_k__key, sizeof(__pyx_k__key), 0, 0, 1, 1},
  {&__pyx_n_s__last_update, __pyx_k__last_update, sizeof(__pyx_k__last_update), 0, 0, 1, 1},
  {&__pyx_n_s__length, __pyx_k__length, sizeof(__pyx_k__length), 0, 0, 1, 1},
  {&__pyx_n_s__list, __pyx_k__list, sizeof(__pyx_k__list), 0, 0, 1, 1},
  {&__pyx_n_s__lock_mode, __pyx_k__lock_mode, sizeof(__pyx_k__lock_mode), 0, 0, 1, 1},
  {&__pyx_n_s__lock_owner, __pyx_k__lock_owner, sizeof(__pyx_k__lock_owner), 0, 0, 1, 1},
  {&__pyx_n_s__lockers, __pyx_k__lockers, sizeof(__pyx_k__lockers), 0, 0, 1, 1},
  {&__pyx_n_s__major, __pyx_k__major, sizeof(__pyx_k__major), 0, 0, 1, 1},
  {&__pyx_n_s__map, __pyx_k__map, sizeof(__pyx_k__map), 0, 0, 1, 1},
  {&__pyx_n_s__maxlen, __pyx_k__maxlen, sizeof(__pyx_k__maxlen), 0, 0, 1, 1},
  {&__pyx_n_s__message, __pyx_k__message, sizeof(__pyx_k__message), 0, 0, 1, 1},
  {&__pyx_n_s__minor, __pyx_k__minor, sizeof(__pyx_k__minor), 0, 0, 1, 1},
  {&__pyx_n_s__mirror_mode, __pyx_k__mirror_mode, sizeof(__pyx_k__mirror_mode), 0, 0, 1, 1},
  {&__pyx_n_s__mirror_mode_get, __pyx_k__mirror_mode_get, sizeof(__pyx_k__mirror_mode_get), 0, 0, 1, 1},
  {&__pyx_n_s__mirror_mode_set, __pyx_k__mirror_mode_set, sizeof(__pyx_k__mirror_mode_set), 0, 0, 1, 1},
  {&__pyx_n_s__mirror_peer_add, __pyx_k__mirror_peer_add, sizeof(__pyx_k__mirror_peer_add), 0, 0, 1, 1},
  {&__pyx_n_s__mirror_peer_list, __pyx_k__mirror_peer_list, sizeof(__pyx_k__mirror_peer_list), 0, 0, 1, 1},
  {&__pyx_n_s__mirror_peer_remove, __pyx_k__mirror_peer_remove, sizeof(__pyx_k__mirror_peer_remove), 0, 0, 1, 1},
  {&__pyx_n_s__mode, __pyx_k__mode, sizeof(__pyx_k__mode), 0, 0, 1, 1},
  {&__pyx_n_s__msg, __pyx_k__msg, sizeof(__pyx_k__msg), 0, 0, 1, 1},
  {&__pyx_n_s__name, __pyx_k__name, sizeof(__pyx_k__name), 0, 0, 1, 1},
  {&__pyx_n_s__num_objs, __pyx_k__num_objs, sizeof(__pyx_k__num_objs), 0, 0, 1, 1},
  {&__pyx_n_s__obj_size, __pyx_k__obj_size, sizeof(__pyx_k__obj_size), 0, 0, 1, 1},
  {&__pyx_n_s__object, __pyx_k__object, sizeof(__pyx_k__object), 0, 0, 1, 1},
  {&__pyx_n_s__offset, __pyx_k__offset, sizeof(__pyx_k__offset), 0, 0, 1, 1},
  {&__pyx_n_s__old_format, __pyx_k__old_format, sizeof(__pyx_k__old_format), 0, 0, 1, 1},
  {&__pyx_n_s__oncomplete, __pyx_k__oncomplete, sizeof(__pyx_k__oncomplete), 0, 0, 1, 1},
  {&__pyx_n_s__oncomplete_, __pyx_k__oncomplete_, sizeof(__pyx_k__oncomplete_), 0, 0, 1, 1},
  {&__pyx_n_s__opt, __pyx_k__opt, sizeof(__pyx_k__opt), 0, 0, 1, 1},
  {&__pyx_n_s__opts, __pyx_k__opts, sizeof(__pyx_k__opts), 0, 0, 1, 1},
  {&__pyx_n_s__order, __pyx_k__order, sizeof(__pyx_k__order), 0, 0, 1, 1},
  {&__pyx_n_s__owner, __pyx_k__owner, sizeof(__pyx_k__owner), 0, 0, 1, 1},
  {&__pyx_n_s__p_ioctx, __pyx_k__p_ioctx, sizeof(__pyx_k__p_ioctx), 0, 0, 1, 1},
  {&__pyx_n_s__p_name, __pyx_k__p_name, sizeof(__pyx_k__p_name), 0, 0, 1, 1},
  {&__pyx_n_s__p_snapname, __pyx_k__p_snapname, sizeof(__pyx_k__p_snapname), 0, 0, 1, 1},
  {&__pyx_n_s__parent_name, __pyx_k__parent_name, sizeof(__pyx_k__parent_name), 0, 0, 1, 1},
  {&__pyx_n_s__parent_pool, __pyx_k__parent_pool, sizeof(__pyx_k__parent_pool), 0, 0, 1, 1},
  {&__pyx_n_s__primary, __pyx_k__primary, sizeof(__pyx_k__primary), 0, 0, 1, 1},
  {&__pyx_n_s__range, __pyx_k__range, sizeof(__pyx_k__range), 0, 0, 1, 1},
  {&__pyx_n_s__rbd, __pyx_k__rbd, sizeof(__pyx_k__rbd), 0, 0, 1, 1},
  {&__pyx_n_s__read_only, __pyx_k__read_only, sizeof(__pyx_k__read_only), 0, 0, 1, 1},
  {&__pyx_n_s__remove, __pyx_k__remove, sizeof(__pyx_k__remove), 0, 0, 1, 1},
  {&__pyx_n_s__rename, __pyx_k__rename, sizeof(__pyx_k__rename), 0, 0, 1, 1},
  {&__pyx_n_s__ret, __pyx_k__ret, sizeof(__pyx_k__ret), 0, 0, 1, 1},
  {&__pyx_n_s__return_value, __pyx_k__return_value, sizeof(__pyx_k__return_value), 0, 0, 1, 1},
  {&__pyx_n_s__self, __pyx_k__self, sizeof(__pyx_k__self), 0, 0, 1, 1},
  {&__pyx_n_s__send, __pyx_k__send, sizeof(__pyx_k__send), 0, 0, 1, 1},
  {&__pyx_n_s__size, __pyx_k__size, sizeof(__pyx_k__size), 0, 0, 1, 1},
  {&__pyx_n_s__snapshot, __pyx_k__snapshot, sizeof(__pyx_k__snapshot), 0, 0, 1, 1},
  {&__pyx_n_s__source, __pyx_k__source, sizeof(__pyx_k__source), 0, 0, 1, 1},
  {&__pyx_n_s__split, __pyx_k__split, sizeof(__pyx_k__split), 0, 0, 1, 1},
  {&__pyx_n_s__src, __pyx_k__src, sizeof(__pyx_k__src), 0, 0, 1, 1},
  {&__pyx_n_s__srcname, __pyx_k__srcname, sizeof(__pyx_k__srcname), 0, 0, 1, 1},
  {&__pyx_n_s__state, __pyx_k__state, sizeof(__pyx_k__state), 0, 0, 1, 1},
  {&__pyx_n_s__states, __pyx_k__states, sizeof(__pyx_k__states), 0, 0, 1, 1},
  {&__pyx_n_s__stripe_count, __pyx_k__stripe_count, sizeof(__pyx_k__stripe_count), 0, 0, 1, 1},
  {&__pyx_n_s__stripe_unit, __pyx_k__stripe_unit, sizeof(__pyx_k__stripe_unit), 0, 0, 1, 1},
  {&__pyx_n_s__super, __pyx_k__super, sizeof(__pyx_k__super), 0, 0, 1, 1},
  {&__pyx_n_s__sys, __pyx_k__sys, sizeof(__pyx_k__sys), 0, 0, 1, 1},
  {&__pyx_n_s__tag, __pyx_k__tag, sizeof(__pyx_k__tag), 0, 0, 1, 1},
  {&__pyx_n_s__throw, __pyx_k__throw, sizeof(__pyx_k__throw), 0, 0, 1, 1},
  {&__pyx_n_s__traceback, __pyx_k__traceback, sizeof(__pyx_k__traceback), 0, 0, 1, 1},
  {&__pyx_n_s__trash_get, __pyx_k__trash_get, sizeof(__pyx_k__trash_get), 0, 0, 1, 1},
  {&__pyx_n_s__trash_list, __pyx_k__trash_list, sizeof(__pyx_k__trash_list), 0, 0, 1, 1},
  {&__pyx_n_s__trash_move, __pyx_k__trash_move, sizeof(__pyx_k__trash_move), 0, 0, 1, 1},
  {&__pyx_n_s__trash_remove, __pyx_k__trash_remove, sizeof(__pyx_k__trash_remove), 0, 0, 1, 1},
  {&__pyx_n_s__trash_restore, __pyx_k__trash_restore, sizeof(__pyx_k__trash_restore), 0, 0, 1, 1},
  {&__pyx_n_s__type_, __pyx_k__type_, sizeof(__pyx_k__type_), 0, 0, 1, 1},
  {&__pyx_n_s__up, __pyx_k__up, sizeof(__pyx_k__up), 0, 0, 1, 1},
  {&__pyx_n_s__uuid, __pyx_k__uuid, sizeof(__pyx_k__uuid), 0, 0, 1, 1},
  {&__pyx_n_s__val, __pyx_k__val, sizeof(__pyx_k__val), 0, 0, 1, 1},
  {&__pyx_n_s__value, __pyx_k__value, sizeof(__pyx_k__value), 0, 0, 1, 1},
  {&__pyx_n_s__version, __pyx_k__version, sizeof(__pyx_k__version), 0, 0, 1, 1},
  {&__pyx_n_s__whole_object, __pyx_k__whole_object, sizeof(__pyx_k__whole_object), 0, 0, 1, 1},
  {&__pyx_n_s__zip, __pyx_k__zip, sizeof(__pyx_k__zip), 0, 0, 1, 1},
  {0, 0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_Exception = __Pyx_GetBuiltinName(__pyx_n_s__Exception); if (!__pyx_builtin_Exception) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_object = __Pyx_GetBuiltinName(__pyx_n_s__object); if (!__pyx_builtin_object) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_super = __Pyx_GetBuiltinName(__pyx_n_s__super); if (!__pyx_builtin_super) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s__MemoryError); if (!__pyx_builtin_MemoryError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s__range); if (!__pyx_builtin_range) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s__TypeError); if (!__pyx_builtin_TypeError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_map = __Pyx_GetBuiltinName(__pyx_n_s__map); if (!__pyx_builtin_map) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_zip = __Pyx_GetBuiltinName(__pyx_n_s__zip); if (!__pyx_builtin_zip) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_KeyError = __Pyx_GetBuiltinName(__pyx_n_s__KeyError); if (!__pyx_builtin_KeyError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitCachedConstants(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);

  /* "rbd.pyx":548
 *     cdef void *ret = realloc(ptr, size)
 *     if ret == NULL:
 *         raise MemoryError("realloc failed")             # <<<<<<<<<<<<<<
 *     return ret
 * 
 */
  __pyx_k_tuple_6 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_s_5)); if (unlikely(!__pyx_k_tuple_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_6);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_6));

  /* "rbd.pyx":720
 *                 ((stripe_count is not None) and stripe_count != 0) or
 *                 data_pool):
 *                 raise InvalidArgument('format 1 images do not support feature '             # <<<<<<<<<<<<<<
 *                                       'masks, non-default striping, nor data '
 *                                       'pool')
 */
  __pyx_k_tuple_8 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_s_7)); if (unlikely(!__pyx_k_tuple_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_8);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_8));

  /* "rbd.pyx":844
 *                 elif ret != -errno.ERANGE:
 *                     raise make_ex(ret, 'error listing images')
 *             return [decode_cstr(name) for name in c_names[:ret].split(b'\0')             # <<<<<<<<<<<<<<
 *                     if name]
 *         finally:
 */
  __pyx_k_tuple_19 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_b_18)); if (unlikely(!__pyx_k_tuple_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 844; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_19);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_19));

  /* "rbd.pyx":2102
 *         """
 *         if not isinstance(data, bytes):
 *             raise TypeError('data must be a byte string')             # <<<<<<<<<<<<<<
 *         cdef:
 *             uint64_t _offset = offset, length = len(data)
 */
  __pyx_k_tuple_72 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_s_71)); if (unlikely(!__pyx_k_tuple_72)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_72);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_72));

  /* "rbd.pyx":2227
 *             if ret == 0:
 *                 return []
 *             pools = map(decode_cstr, c_pools[:pools_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             images = map(decode_cstr, c_images[:images_size - 1].split(b'\0'))
 *             return list(zip(pools, images))
 */
  __pyx_k_tuple_85 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_b_18)); if (unlikely(!__pyx_k_tuple_85)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_85);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_85));

  /* "rbd.pyx":2228
 *                 return []
 *             pools = map(decode_cstr, c_pools[:pools_size - 1].split(b'\0'))
 *             images = map(decode_cstr, c_images[:images_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             return list(zip(pools, images))
 *         finally:
 */
  __pyx_k_tuple_86 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_b_18)); if (unlikely(!__pyx_k_tuple_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_86);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_86));

  /* "rbd.pyx":2275
 *             if ret == 0:
 *                 return []
 *             clients = map(decode_cstr, c_clients[:clients_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             cookies = map(decode_cstr, c_cookies[:cookies_size - 1].split(b'\0'))
 *             addrs = map(decode_cstr, c_addrs[:addrs_size - 1].split(b'\0'))
 */
  __pyx_k_tuple_87 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_b_18)); if (unlikely(!__pyx_k_tuple_87)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_87);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_87));

  /* "rbd.pyx":2276
 *                 return []
 *             clients = map(decode_cstr, c_clients[:clients_size - 1].split(b'\0'))
 *             cookies = map(decode_cstr, c_cookies[:cookies_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             addrs = map(decode_cstr, c_addrs[:addrs_size - 1].split(b'\0'))
 *             return {
 */
  __pyx_k_tuple_88 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_b_18)); if (unlikely(!__pyx_k_tuple_88)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2276; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_88);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_88));

  /* "rbd.pyx":2277
 *             clients = map(decode_cstr, c_clients[:clients_size - 1].split(b'\0'))
 *             cookies = map(decode_cstr, c_cookies[:cookies_size - 1].split(b'\0'))
 *             addrs = map(decode_cstr, c_addrs[:addrs_size - 1].split(b'\0'))             # <<<<<<<<<<<<<<
 *             return {
 *                 'tag'       : decode_cstr(c_tag),
 */
  __pyx_k_tuple_89 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_b_18)); if (unlikely(!__pyx_k_tuple_89)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_89);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_89));

  /* "rbd.pyx":2550
 *             Completion completion
 * 
 *         def oncomplete_(completion_v):             # <<<<<<<<<<<<<<
 *             cdef Completion _completion_v = completion_v
 *             return_value = _completion_v.get_return_value()
 */
  __pyx_k_tuple_103 = PyTuple_Pack(3, ((PyObject *)__pyx_n_s__completion_v), ((PyObject *)__pyx_n_s___completion_v), ((PyObject *)__pyx_n_s__return_value)); if (unlikely(!__pyx_k_tuple_103)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2550; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_103);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_103));
  __pyx_k_codeobj_104 = (PyObject*)__Pyx_PyCode_New(1, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_103, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__oncomplete_, 2550, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_104)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2550; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":2847
 *                                   (self.image_name,))
 *             keys = [decode_cstr(key) for key in
 *                         c_keys[:keys_size].split(b'\0') if key]             # <<<<<<<<<<<<<<
 *             vals = [decode_cstr(val) for val in
 *                         c_vals[:vals_size].split(b'\0') if val]
 */
  __pyx_k_tuple_116 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_b_18)); if (unlikely(!__pyx_k_tuple_116)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2847; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_116);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_116));

  /* "rbd.pyx":2849
 *                         c_keys[:keys_size].split(b'\0') if key]
 *             vals = [decode_cstr(val) for val in
 *                         c_vals[:vals_size].split(b'\0') if val]             # <<<<<<<<<<<<<<
 *             if len(keys) > 0:
 *                 free(self.last_read)
 */
  __pyx_k_tuple_117 = PyTuple_Pack(1, ((PyObject *)__pyx_kp_b_18)); if (unlikely(!__pyx_k_tuple_117)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2849; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_117);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_117));

  /* "rbd.pyx":391
 * class OSError(Error):
 *     """ `OSError` class, derived from `Error` """
 *     def __init__(self, message, errno=None):             # <<<<<<<<<<<<<<
 *         super(OSError, self).__init__(message)
 *         self.errno = errno
 */
  __pyx_k_tuple_149 = PyTuple_Pack(3, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__message), ((PyObject *)__pyx_n_s__errno)); if (unlikely(!__pyx_k_tuple_149)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_149);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_149));
  __pyx_k_codeobj_150 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_149, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s____init__, 391, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_150)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_k_tuple_151 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_k_tuple_151)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_151);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_151));

  /* "rbd.pyx":395
 *         self.errno = errno
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         msg = super(OSError, self).__str__()
 *         if self.errno is None:
 */
  __pyx_k_tuple_153 = PyTuple_Pack(2, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__msg)); if (unlikely(!__pyx_k_tuple_153)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_153);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_153));
  __pyx_k_codeobj_154 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_153, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s____str__, 395, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_154)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":401
 *         return '[errno {0}] {1}'.format(self.errno, msg)
 * 
 *     def __reduce__(self):             # <<<<<<<<<<<<<<
 *         return (self.__class__, (self.message, self.errno))
 * 
 */
  __pyx_k_tuple_156 = PyTuple_Pack(1, ((PyObject *)__pyx_n_s__self)); if (unlikely(!__pyx_k_tuple_156)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_156);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_156));
  __pyx_k_codeobj_157 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_156, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s____reduce__, 401, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_157)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":507
 *     return 0
 * 
 * def cstr(val, name, encoding="utf-8", opt=False):             # <<<<<<<<<<<<<<
 *     """
 *     Create a byte string from a Python string
 */
  __pyx_k_tuple_161 = PyTuple_Pack(4, ((PyObject *)__pyx_n_s__val), ((PyObject *)__pyx_n_s__name), ((PyObject *)__pyx_n_s__encoding), ((PyObject *)__pyx_n_s__opt)); if (unlikely(!__pyx_k_tuple_161)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_161);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_161));
  __pyx_k_codeobj_162 = (PyObject*)__Pyx_PyCode_New(4, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_161, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__cstr, 507, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_162)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":527
 *         raise InvalidArgument('%s must be a string' % name)
 * 
 * def decode_cstr(val, encoding="utf-8"):             # <<<<<<<<<<<<<<
 *     """
 *     Decode a byte string into a Python string.
 */
  __pyx_k_tuple_163 = PyTuple_Pack(2, ((PyObject *)__pyx_n_s__val), ((PyObject *)__pyx_n_s__encoding)); if (unlikely(!__pyx_k_tuple_163)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_163);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_163));
  __pyx_k_codeobj_164 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_163, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__decode_cstr, 527, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_164)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":662
 *     This class wraps librbd CRUD functions.
 *     """
 *     def version(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the version number of the ``librbd`` C library.
 */
  __pyx_k_tuple_165 = PyTuple_Pack(4, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__major), ((PyObject *)__pyx_n_s__minor), ((PyObject *)__pyx_n_s__extra)); if (unlikely(!__pyx_k_tuple_165)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_165);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_165));
  __pyx_k_codeobj_166 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_165, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__version, 662, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_166)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":675
 *         return (major, minor, extra)
 * 
 *     def create(self, ioctx, name, size, order=None, old_format=True,             # <<<<<<<<<<<<<<
 *                features=None, stripe_unit=None, stripe_count=None,
 *                data_pool=None):
 */
  __pyx_k_tuple_168 = PyTuple_Pack(16, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__name), ((PyObject *)__pyx_n_s__size), ((PyObject *)__pyx_n_s__order), ((PyObject *)__pyx_n_s__old_format), ((PyObject *)__pyx_n_s__features), ((PyObject *)__pyx_n_s__stripe_unit), ((PyObject *)__pyx_n_s__stripe_count), ((PyObject *)__pyx_n_s__data_pool), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___name), ((PyObject *)__pyx_n_s___size), ((PyObject *)__pyx_n_s___order), ((PyObject *)__pyx_n_s__opts), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_168)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_168);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_168));
  __pyx_k_codeobj_169 = (PyObject*)__Pyx_PyCode_New(10, 0, 16, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_168, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__create, 675, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_169)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":755
 *             raise make_ex(ret, 'error creating image')
 * 
 *     def clone(self, p_ioctx, p_name, p_snapname, c_ioctx, c_name,             # <<<<<<<<<<<<<<
 *               features=None, order=None, stripe_unit=None, stripe_count=None,
 *               data_pool=None):
 */
  __pyx_k_tuple_171 = PyTuple_Pack(18, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__p_ioctx), ((PyObject *)__pyx_n_s__p_name), ((PyObject *)__pyx_n_s__p_snapname), ((PyObject *)__pyx_n_s__c_ioctx), ((PyObject *)__pyx_n_s__c_name), ((PyObject *)__pyx_n_s__features), ((PyObject *)__pyx_n_s__order), ((PyObject *)__pyx_n_s__stripe_unit), ((PyObject *)__pyx_n_s__stripe_count), ((PyObject *)__pyx_n_s__data_pool), ((PyObject *)__pyx_n_s___p_ioctx), ((PyObject *)__pyx_n_s___c_ioctx), ((PyObject *)__pyx_n_s___p_name), ((PyObject *)__pyx_n_s___p_snapname), ((PyObject *)__pyx_n_s___c_name), ((PyObject *)__pyx_n_s__opts), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_171)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_171);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_171));
  __pyx_k_codeobj_172 = (PyObject*)__Pyx_PyCode_New(11, 0, 18, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_171, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__clone, 755, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_172)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_k_tuple_173 = PyTuple_Pack(5, ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_k_tuple_173)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_173);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_173));

  /* "rbd.pyx":823
 *             raise make_ex(ret, 'error creating clone')
 * 
 *     def list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         List image names.
 */
  __pyx_k_tuple_175 = PyTuple_Pack(7, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s__size), ((PyObject *)__pyx_n_s__c_names), ((PyObject *)__pyx_n_s__ret), ((PyObject *)__pyx_n_s__name)); if (unlikely(!__pyx_k_tuple_175)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_175);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_175));
  __pyx_k_codeobj_176 = (PyObject*)__Pyx_PyCode_New(2, 0, 7, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_175, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__list, 823, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_176)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":849
 *             free(c_names)
 * 
 *     def remove(self, ioctx, name):             # <<<<<<<<<<<<<<
 *         """
 *         Delete an RBD image. This may take a long time, since it does
 */
  __pyx_k_tuple_178 = PyTuple_Pack(6, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__name), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___name), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_178)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 849; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_178);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_178));
  __pyx_k_codeobj_179 = (PyObject*)__Pyx_PyCode_New(3, 0, 6, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_178, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__remove, 849, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_179)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 849; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":875
 *             raise make_ex(ret, 'error removing image')
 * 
 *     def rename(self, ioctx, src, dest):             # <<<<<<<<<<<<<<
 *         """
 *         Rename an RBD image.
 */
  __pyx_k_tuple_181 = PyTuple_Pack(8, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__src), ((PyObject *)__pyx_n_s__dest), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___src), ((PyObject *)__pyx_n_s___dest), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_181)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_181);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_181));
  __pyx_k_codeobj_182 = (PyObject*)__Pyx_PyCode_New(4, 0, 8, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_181, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__rename, 875, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_182)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":898
 *             raise make_ex(ret, 'error renaming image')
 * 
 *     def trash_move(self, ioctx, name, delay=0):             # <<<<<<<<<<<<<<
 *         """
 *         Move an RBD image to the trash.
 */
  __pyx_k_tuple_184 = PyTuple_Pack(8, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__name), ((PyObject *)__pyx_n_s__delay), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___name), ((PyObject *)__pyx_n_s___delay), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_184)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_184);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_184));
  __pyx_k_codeobj_185 = (PyObject*)__Pyx_PyCode_New(4, 0, 8, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_184, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__trash_move, 898, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_185)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_k_tuple_186 = PyTuple_Pack(1, ((PyObject *)__pyx_int_0)); if (unlikely(!__pyx_k_tuple_186)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_186);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_186));

  /* "rbd.pyx":920
 *             raise make_ex(ret, 'error moving image to trash')
 * 
 *     def trash_remove(self, ioctx, image_id, force=False):             # <<<<<<<<<<<<<<
 *         """
 *         Delete an RBD image from trash. If image deferment time has not
 */
  __pyx_k_tuple_188 = PyTuple_Pack(8, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__image_id), ((PyObject *)__pyx_n_s__force), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___image_id), ((PyObject *)__pyx_n_s___force), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_188)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_188);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_188));
  __pyx_k_codeobj_189 = (PyObject*)__Pyx_PyCode_New(4, 0, 8, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_188, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__trash_remove, 920, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_189)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":942
 *             raise make_ex(ret, 'error deleting image from trash')
 * 
 *     def trash_get(self, ioctx, image_id):             # <<<<<<<<<<<<<<
 *         """
 *         Retrieve RBD image info from trash
 */
  __pyx_k_tuple_191 = PyTuple_Pack(9, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__image_id), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___image_id), ((PyObject *)__pyx_n_s__c_info), ((PyObject *)__pyx_n_s__ret), ((PyObject *)__pyx_n_s____source_string), ((PyObject *)__pyx_n_s__info)); if (unlikely(!__pyx_k_tuple_191)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_191);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_191));
  __pyx_k_codeobj_192 = (PyObject*)__Pyx_PyCode_New(3, 0, 9, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_191, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__trash_get, 942, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_192)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":985
 *         return info
 * 
 *     def trash_list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         List all entries from trash.
 */
  __pyx_k_tuple_194 = PyTuple_Pack(2, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx)); if (unlikely(!__pyx_k_tuple_194)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_194);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_194));
  __pyx_k_codeobj_195 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_194, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__trash_list, 985, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_195)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":994
 *         return TrashIterator(ioctx)
 * 
 *     def trash_restore(self, ioctx, image_id, name):             # <<<<<<<<<<<<<<
 *         """
 *         Restore an RBD image from trash.
 */
  __pyx_k_tuple_197 = PyTuple_Pack(8, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__image_id), ((PyObject *)__pyx_n_s__name), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___image_id), ((PyObject *)__pyx_n_s___name), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_197);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_197));
  __pyx_k_codeobj_198 = (PyObject*)__Pyx_PyCode_New(4, 0, 8, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_197, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__trash_restore, 994, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1016
 *             raise make_ex(ret, 'error restoring image from trash')
 * 
 *     def mirror_mode_get(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Get pool mirror mode.
 */
  __pyx_k_tuple_200 = PyTuple_Pack(5, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s__mirror_mode), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_200)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1016; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_200);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_200));
  __pyx_k_codeobj_201 = (PyObject*)__Pyx_PyCode_New(2, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_200, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__mirror_mode_get, 1016, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_201)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1016; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1033
 *         return mirror_mode
 * 
 *     def mirror_mode_set(self, ioctx, mirror_mode):             # <<<<<<<<<<<<<<
 *         """
 *         Set pool mirror mode.
 */
  __pyx_k_tuple_203 = PyTuple_Pack(6, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__mirror_mode), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___mirror_mode), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_203)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1033; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_203);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_203));
  __pyx_k_codeobj_204 = (PyObject*)__Pyx_PyCode_New(3, 0, 6, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_203, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__mirror_mode_set, 1033, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_204)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1033; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1050
 *             raise make_ex(ret, 'error setting mirror mode')
 * 
 *     def mirror_peer_add(self, ioctx, cluster_name, client_name):             # <<<<<<<<<<<<<<
 *         """
 *         Add mirror peer.
 */
  __pyx_k_tuple_206 = PyTuple_Pack(10, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__cluster_name), ((PyObject *)__pyx_n_s__client_name), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___uuid), ((PyObject *)__pyx_n_s___uuid_max_length), ((PyObject *)__pyx_n_s___cluster_name), ((PyObject *)__pyx_n_s___client_name), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_206)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_206);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_206));
  __pyx_k_codeobj_207 = (PyObject*)__Pyx_PyCode_New(4, 0, 10, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_206, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__mirror_peer_add, 1050, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_207)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1080
 *             free(_uuid)
 * 
 *     def mirror_peer_remove(self, ioctx, uuid):             # <<<<<<<<<<<<<<
 *         """
 *         Remove mirror peer.
 */
  __pyx_k_tuple_209 = PyTuple_Pack(6, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__uuid), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___uuid), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_209)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1080; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_209);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_209));
  __pyx_k_codeobj_210 = (PyObject*)__Pyx_PyCode_New(3, 0, 6, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_209, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__mirror_peer_remove, 1080, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_210)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1080; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1098
 *             raise make_ex(ret, 'error removing mirror peer')
 * 
 *     def mirror_peer_list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Iterate over the peers of a pool.
 */
  __pyx_k_tuple_212 = PyTuple_Pack(2, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx)); if (unlikely(!__pyx_k_tuple_212)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_212);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_212));
  __pyx_k_codeobj_213 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_212, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s__mirror_peer_list, 1098, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_213)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1108
 *         return MirrorPeerIterator(ioctx)
 * 
 *     def mirror_peer_set_client(self, ioctx, uuid, client_name):             # <<<<<<<<<<<<<<
 *         """
 *         Set mirror peer client name
 */
  __pyx_k_tuple_215 = PyTuple_Pack(8, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__uuid), ((PyObject *)__pyx_n_s__client_name), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___uuid), ((PyObject *)__pyx_n_s___client_name), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_215)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_215);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_215));
  __pyx_k_codeobj_216 = (PyObject*)__Pyx_PyCode_New(4, 0, 8, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_215, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s_217, 1108, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_216)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1130
 *             raise make_ex(ret, 'error setting mirror peer client')
 * 
 *     def mirror_peer_set_cluster(self, ioctx, uuid, cluster_name):             # <<<<<<<<<<<<<<
 *         """
 *         Set mirror peer cluster name
 */
  __pyx_k_tuple_219 = PyTuple_Pack(8, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s__uuid), ((PyObject *)__pyx_n_s__cluster_name), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s___uuid), ((PyObject *)__pyx_n_s___cluster_name), ((PyObject *)__pyx_n_s__ret)); if (unlikely(!__pyx_k_tuple_219)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_219);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_219));
  __pyx_k_codeobj_220 = (PyObject*)__Pyx_PyCode_New(4, 0, 8, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_219, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s_221, 1130, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_220)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1152
 *             raise make_ex(ret, 'error setting mirror peer cluster')
 * 
 *     def mirror_image_status_list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Iterate over the mirror image statuses of a pool.
 */
  __pyx_k_tuple_223 = PyTuple_Pack(2, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx)); if (unlikely(!__pyx_k_tuple_223)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_223);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_223));
  __pyx_k_codeobj_224 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_223, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s_225, 1152, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_224)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "rbd.pyx":1162
 *         return MirrorImageStatusIterator(ioctx)
 * 
 *     def mirror_image_status_summary(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Get mirror image status summary of a pool.
 */
  __pyx_k_tuple_227 = PyTuple_Pack(8, ((PyObject *)__pyx_n_s__self), ((PyObject *)__pyx_n_s__ioctx), ((PyObject *)__pyx_n_s___ioctx), ((PyObject *)__pyx_n_s__states), ((PyObject *)__pyx_n_s__counts), ((PyObject *)__pyx_n_s__maxlen), ((PyObject *)__pyx_n_s__ret), ((PyObject *)__pyx_n_s__i)); if (unlikely(!__pyx_k_tuple_227)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_k_tuple_227);
  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_227));
  __pyx_k_codeobj_228 = (PyObject*)__Pyx_PyCode_New(2, 0, 8, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_227, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_105, __pyx_n_s_229, 1162, __pyx_empty_bytes); if (unlikely(!__pyx_k_codeobj_228)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}

static int __Pyx_InitGlobals(void) {
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initrbd(void); /*proto*/
PyMODINIT_FUNC initrbd(void)
#else
PyMODINIT_FUNC PyInit_rbd(void); /*proto*/
PyMODINIT_FUNC PyInit_rbd(void)
#endif
{
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  #if CYTHON_REFNANNY
  __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
  if (!__Pyx_RefNanny) {
      PyErr_Clear();
      __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
      if (!__Pyx_RefNanny)
          Py_FatalError("failed to import 'refnanny' module");
  }
  #endif
  __Pyx_RefNannySetupContext("PyMODINIT_FUNC PyInit_rbd(void)", 0);
  if ( __Pyx_check_binary_version() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #ifdef __Pyx_CyFunction_USED
  if (__Pyx_CyFunction_init() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  #ifdef __Pyx_FusedFunction_USED
  if (__pyx_FusedFunction_init() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  #ifdef __Pyx_Generator_USED
  if (__pyx_Generator_init() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  /*--- Library function declarations ---*/
  /*--- Threads initialization code ---*/
  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  #ifdef WITH_THREAD /* Python build with threading support? */
  PyEval_InitThreads();
  #endif
  #endif
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4(__Pyx_NAMESTR("rbd"), __pyx_methods, __Pyx_DOCSTR(__pyx_k_120), 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (unlikely(!__pyx_m)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_d);
  #if PY_MAJOR_VERSION >= 3
  {
    PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!PyDict_GetItemString(modules, "rbd")) {
      if (unlikely(PyDict_SetItemString(modules, "rbd", __pyx_m) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
  }
  #endif
  __pyx_b = PyImport_AddModule(__Pyx_NAMESTR(__Pyx_BUILTIN_MODULE_NAME)); if (unlikely(!__pyx_b)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if CYTHON_COMPILING_IN_PYPY
  Py_INCREF(__pyx_b);
  #endif
  if (__Pyx_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  /*--- Initialize various global constants etc. ---*/
  if (unlikely(__Pyx_InitGlobals() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
  if (__Pyx_init_sys_getdefaultencoding_params() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  if (__pyx_module_is_main_rbd) {
    if (__Pyx_SetAttrString(__pyx_m, "__name__", __pyx_n_s____main__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  }
  /*--- Builtin init code ---*/
  if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Constants init code ---*/
  if (unlikely(__Pyx_InitCachedConstants() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Global init code ---*/
  __pyx_v_3rbd_errno_to_exception = Py_None; Py_INCREF(Py_None);
  /*--- Variable export code ---*/
  /*--- Function export code ---*/
  /*--- Type init code ---*/
  __pyx_vtabptr_3rbd_Completion = &__pyx_vtable_3rbd_Completion;
  __pyx_vtable_3rbd_Completion._complete = (void (*)(struct __pyx_obj_3rbd_Completion *))__pyx_f_3rbd_10Completion__complete;
  __pyx_vtable_3rbd_Completion.__pyx___persist = (PyObject *(*)(struct __pyx_obj_3rbd_Completion *))__pyx_f_3rbd_10Completion___persist;
  __pyx_vtable_3rbd_Completion.__pyx___unpersist = (PyObject *(*)(struct __pyx_obj_3rbd_Completion *))__pyx_f_3rbd_10Completion___unpersist;
  if (PyType_Ready(&__pyx_type_3rbd_Completion) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetVtable(__pyx_type_3rbd_Completion.tp_dict, __pyx_vtabptr_3rbd_Completion) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "Completion", (PyObject *)&__pyx_type_3rbd_Completion) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd_Completion = &__pyx_type_3rbd_Completion;
  if (PyType_Ready(&__pyx_type_3rbd_MirrorPeerIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "MirrorPeerIterator", (PyObject *)&__pyx_type_3rbd_MirrorPeerIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd_MirrorPeerIterator = &__pyx_type_3rbd_MirrorPeerIterator;
  if (PyType_Ready(&__pyx_type_3rbd_MirrorImageStatusIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "MirrorImageStatusIterator", (PyObject *)&__pyx_type_3rbd_MirrorImageStatusIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd_MirrorImageStatusIterator = &__pyx_type_3rbd_MirrorImageStatusIterator;
  if (PyType_Ready(&__pyx_type_3rbd_Image) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1338; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if CYTHON_COMPILING_IN_CPYTHON
  {
    PyObject *wrapper = __Pyx_GetAttrString((PyObject *)&__pyx_type_3rbd_Image, "__init__"); if (unlikely(!wrapper)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1338; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
      __pyx_wrapperbase_3rbd_5Image___init__ = *((PyWrapperDescrObject *)wrapper)->d_base;
      __pyx_wrapperbase_3rbd_5Image___init__.doc = __pyx_doc_3rbd_5Image___init__;
      ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_3rbd_5Image___init__;
    }
  }
  #endif
  if (__Pyx_SetAttrString(__pyx_m, "Image", (PyObject *)&__pyx_type_3rbd_Image) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1338; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd_Image = &__pyx_type_3rbd_Image;
  if (PyType_Ready(&__pyx_type_3rbd_LockOwnerIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "LockOwnerIterator", (PyObject *)&__pyx_type_3rbd_LockOwnerIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd_LockOwnerIterator = &__pyx_type_3rbd_LockOwnerIterator;
  if (PyType_Ready(&__pyx_type_3rbd_MetadataIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "MetadataIterator", (PyObject *)&__pyx_type_3rbd_MetadataIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd_MetadataIterator = &__pyx_type_3rbd_MetadataIterator;
  if (PyType_Ready(&__pyx_type_3rbd_SnapIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2858; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "SnapIterator", (PyObject *)&__pyx_type_3rbd_SnapIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2858; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd_SnapIterator = &__pyx_type_3rbd_SnapIterator;
  if (PyType_Ready(&__pyx_type_3rbd_TrashIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "TrashIterator", (PyObject *)&__pyx_type_3rbd_TrashIterator) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd_TrashIterator = &__pyx_type_3rbd_TrashIterator;
  if (PyType_Ready(&__pyx_type_3rbd___pyx_scope_struct____iter__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd___pyx_scope_struct____iter__ = &__pyx_type_3rbd___pyx_scope_struct____iter__;
  if (PyType_Ready(&__pyx_type_3rbd___pyx_scope_struct_1___iter__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd___pyx_scope_struct_1___iter__ = &__pyx_type_3rbd___pyx_scope_struct_1___iter__;
  if (PyType_Ready(&__pyx_type_3rbd___pyx_scope_struct_2_aio_read) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2519; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd___pyx_scope_struct_2_aio_read = &__pyx_type_3rbd___pyx_scope_struct_2_aio_read;
  if (PyType_Ready(&__pyx_type_3rbd___pyx_scope_struct_3___iter__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd___pyx_scope_struct_3___iter__ = &__pyx_type_3rbd___pyx_scope_struct_3___iter__;
  if (PyType_Ready(&__pyx_type_3rbd___pyx_scope_struct_4___iter__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd___pyx_scope_struct_4___iter__ = &__pyx_type_3rbd___pyx_scope_struct_4___iter__;
  if (PyType_Ready(&__pyx_type_3rbd___pyx_scope_struct_5___iter__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd___pyx_scope_struct_5___iter__ = &__pyx_type_3rbd___pyx_scope_struct_5___iter__;
  if (PyType_Ready(&__pyx_type_3rbd___pyx_scope_struct_6___iter__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_3rbd___pyx_scope_struct_6___iter__ = &__pyx_type_3rbd___pyx_scope_struct_6___iter__;
  /*--- Type import code ---*/
  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__Pyx_BUILTIN_MODULE_NAME, "type", 
  #if CYTHON_COMPILING_IN_PYPY
  sizeof(PyTypeObject),
  #else
  sizeof(PyHeapTypeObject),
  #endif
  0); if (unlikely(!__pyx_ptype_7cpython_4type_type)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7cpython_4bool_bool = __Pyx_ImportType(__Pyx_BUILTIN_MODULE_NAME, "bool", sizeof(PyBoolObject), 0); if (unlikely(!__pyx_ptype_7cpython_4bool_bool)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7cpython_7complex_complex = __Pyx_ImportType(__Pyx_BUILTIN_MODULE_NAME, "complex", sizeof(PyComplexObject), 0); if (unlikely(!__pyx_ptype_7cpython_7complex_complex)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7cpython_8datetime_date = __Pyx_ImportType("datetime", "date", sizeof(PyDateTime_Date), 0); if (unlikely(!__pyx_ptype_7cpython_8datetime_date)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7cpython_8datetime_time = __Pyx_ImportType("datetime", "time", sizeof(PyDateTime_Time), 0); if (unlikely(!__pyx_ptype_7cpython_8datetime_time)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7cpython_8datetime_datetime = __Pyx_ImportType("datetime", "datetime", sizeof(PyDateTime_DateTime), 0); if (unlikely(!__pyx_ptype_7cpython_8datetime_datetime)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7cpython_8datetime_timedelta = __Pyx_ImportType("datetime", "timedelta", sizeof(PyDateTime_Delta), 0); if (unlikely(!__pyx_ptype_7cpython_8datetime_timedelta)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_7cpython_8datetime_tzinfo = __Pyx_ImportType("datetime", "tzinfo", sizeof(PyDateTime_TZInfo), 0); if (unlikely(!__pyx_ptype_7cpython_8datetime_tzinfo)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_5rados_Rados = __Pyx_ImportType("rados", "Rados", sizeof(struct __pyx_obj_5rados_Rados), 1); if (unlikely(!__pyx_ptype_5rados_Rados)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_5rados_Ioctx = __Pyx_ImportType("rados", "Ioctx", sizeof(struct __pyx_obj_5rados_Ioctx), 1); if (unlikely(!__pyx_ptype_5rados_Ioctx)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Variable import code ---*/
  /*--- Function import code ---*/
  /*--- Execution code ---*/

  /* "rbd.pyx":18
 * 
 * import cython
 * import sys             # <<<<<<<<<<<<<<
 * 
 * from cpython cimport PyObject, ref, exc
 */
  __pyx_t_1 = __Pyx_Import(((PyObject *)__pyx_n_s__sys), 0, -1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__sys, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":26
 * from libc.string cimport strdup
 * 
 * from collections import Iterable             # <<<<<<<<<<<<<<
 * from datetime import datetime
 * 
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__Iterable));
  PyList_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__Iterable));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__Iterable));
  __pyx_t_2 = __Pyx_Import(((PyObject *)__pyx_n_s__collections), ((PyObject *)__pyx_t_1), -1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s__Iterable); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__Iterable, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":27
 * 
 * from collections import Iterable
 * from datetime import datetime             # <<<<<<<<<<<<<<
 * 
 * cimport rados
 */
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__datetime));
  PyList_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__datetime));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__datetime));
  __pyx_t_1 = __Pyx_Import(((PyObject *)__pyx_n_s__datetime), ((PyObject *)__pyx_t_2), -1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s__datetime); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__datetime, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":342
 *                           size_t *vals_len)
 * 
 * RBD_FEATURE_LAYERING = _RBD_FEATURE_LAYERING             # <<<<<<<<<<<<<<
 * RBD_FEATURE_STRIPINGV2 = _RBD_FEATURE_STRIPINGV2
 * RBD_FEATURE_EXCLUSIVE_LOCK = _RBD_FEATURE_EXCLUSIVE_LOCK
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURE_LAYERING); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_121, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":343
 * 
 * RBD_FEATURE_LAYERING = _RBD_FEATURE_LAYERING
 * RBD_FEATURE_STRIPINGV2 = _RBD_FEATURE_STRIPINGV2             # <<<<<<<<<<<<<<
 * RBD_FEATURE_EXCLUSIVE_LOCK = _RBD_FEATURE_EXCLUSIVE_LOCK
 * RBD_FEATURE_OBJECT_MAP = _RBD_FEATURE_OBJECT_MAP
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURE_STRIPINGV2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_122, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":344
 * RBD_FEATURE_LAYERING = _RBD_FEATURE_LAYERING
 * RBD_FEATURE_STRIPINGV2 = _RBD_FEATURE_STRIPINGV2
 * RBD_FEATURE_EXCLUSIVE_LOCK = _RBD_FEATURE_EXCLUSIVE_LOCK             # <<<<<<<<<<<<<<
 * RBD_FEATURE_OBJECT_MAP = _RBD_FEATURE_OBJECT_MAP
 * RBD_FEATURE_FAST_DIFF = _RBD_FEATURE_FAST_DIFF
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURE_EXCLUSIVE_LOCK); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_123, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":345
 * RBD_FEATURE_STRIPINGV2 = _RBD_FEATURE_STRIPINGV2
 * RBD_FEATURE_EXCLUSIVE_LOCK = _RBD_FEATURE_EXCLUSIVE_LOCK
 * RBD_FEATURE_OBJECT_MAP = _RBD_FEATURE_OBJECT_MAP             # <<<<<<<<<<<<<<
 * RBD_FEATURE_FAST_DIFF = _RBD_FEATURE_FAST_DIFF
 * RBD_FEATURE_DEEP_FLATTEN = _RBD_FEATURE_DEEP_FLATTEN
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURE_OBJECT_MAP); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_124, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":346
 * RBD_FEATURE_EXCLUSIVE_LOCK = _RBD_FEATURE_EXCLUSIVE_LOCK
 * RBD_FEATURE_OBJECT_MAP = _RBD_FEATURE_OBJECT_MAP
 * RBD_FEATURE_FAST_DIFF = _RBD_FEATURE_FAST_DIFF             # <<<<<<<<<<<<<<
 * RBD_FEATURE_DEEP_FLATTEN = _RBD_FEATURE_DEEP_FLATTEN
 * RBD_FEATURE_JOURNALING = _RBD_FEATURE_JOURNALING
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURE_FAST_DIFF); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_125, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":347
 * RBD_FEATURE_OBJECT_MAP = _RBD_FEATURE_OBJECT_MAP
 * RBD_FEATURE_FAST_DIFF = _RBD_FEATURE_FAST_DIFF
 * RBD_FEATURE_DEEP_FLATTEN = _RBD_FEATURE_DEEP_FLATTEN             # <<<<<<<<<<<<<<
 * RBD_FEATURE_JOURNALING = _RBD_FEATURE_JOURNALING
 * RBD_FEATURE_DATA_POOL = _RBD_FEATURE_DATA_POOL
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURE_DEEP_FLATTEN); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_126, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":348
 * RBD_FEATURE_FAST_DIFF = _RBD_FEATURE_FAST_DIFF
 * RBD_FEATURE_DEEP_FLATTEN = _RBD_FEATURE_DEEP_FLATTEN
 * RBD_FEATURE_JOURNALING = _RBD_FEATURE_JOURNALING             # <<<<<<<<<<<<<<
 * RBD_FEATURE_DATA_POOL = _RBD_FEATURE_DATA_POOL
 * 
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURE_JOURNALING); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_127, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":349
 * RBD_FEATURE_DEEP_FLATTEN = _RBD_FEATURE_DEEP_FLATTEN
 * RBD_FEATURE_JOURNALING = _RBD_FEATURE_JOURNALING
 * RBD_FEATURE_DATA_POOL = _RBD_FEATURE_DATA_POOL             # <<<<<<<<<<<<<<
 * 
 * RBD_FEATURES_INCOMPATIBLE = _RBD_FEATURES_INCOMPATIBLE
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURE_DATA_POOL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_128, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":351
 * RBD_FEATURE_DATA_POOL = _RBD_FEATURE_DATA_POOL
 * 
 * RBD_FEATURES_INCOMPATIBLE = _RBD_FEATURES_INCOMPATIBLE             # <<<<<<<<<<<<<<
 * RBD_FEATURES_RW_INCOMPATIBLE = _RBD_FEATURES_RW_INCOMPATIBLE
 * RBD_FEATURES_MUTABLE = _RBD_FEATURES_MUTABLE
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURES_INCOMPATIBLE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_129, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":352
 * 
 * RBD_FEATURES_INCOMPATIBLE = _RBD_FEATURES_INCOMPATIBLE
 * RBD_FEATURES_RW_INCOMPATIBLE = _RBD_FEATURES_RW_INCOMPATIBLE             # <<<<<<<<<<<<<<
 * RBD_FEATURES_MUTABLE = _RBD_FEATURES_MUTABLE
 * RBD_FEATURES_SINGLE_CLIENT = _RBD_FEATURES_SINGLE_CLIENT
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURES_RW_INCOMPATIBLE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_130, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":353
 * RBD_FEATURES_INCOMPATIBLE = _RBD_FEATURES_INCOMPATIBLE
 * RBD_FEATURES_RW_INCOMPATIBLE = _RBD_FEATURES_RW_INCOMPATIBLE
 * RBD_FEATURES_MUTABLE = _RBD_FEATURES_MUTABLE             # <<<<<<<<<<<<<<
 * RBD_FEATURES_SINGLE_CLIENT = _RBD_FEATURES_SINGLE_CLIENT
 * RBD_FEATURES_ALL = _RBD_FEATURES_ALL
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURES_MUTABLE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_131, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":354
 * RBD_FEATURES_RW_INCOMPATIBLE = _RBD_FEATURES_RW_INCOMPATIBLE
 * RBD_FEATURES_MUTABLE = _RBD_FEATURES_MUTABLE
 * RBD_FEATURES_SINGLE_CLIENT = _RBD_FEATURES_SINGLE_CLIENT             # <<<<<<<<<<<<<<
 * RBD_FEATURES_ALL = _RBD_FEATURES_ALL
 * 
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURES_SINGLE_CLIENT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_132, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":355
 * RBD_FEATURES_MUTABLE = _RBD_FEATURES_MUTABLE
 * RBD_FEATURES_SINGLE_CLIENT = _RBD_FEATURES_SINGLE_CLIENT
 * RBD_FEATURES_ALL = _RBD_FEATURES_ALL             # <<<<<<<<<<<<<<
 * 
 * RBD_FLAG_OBJECT_MAP_INVALID = _RBD_FLAG_OBJECT_MAP_INVALID
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FEATURES_ALL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__RBD_FEATURES_ALL, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":357
 * RBD_FEATURES_ALL = _RBD_FEATURES_ALL
 * 
 * RBD_FLAG_OBJECT_MAP_INVALID = _RBD_FLAG_OBJECT_MAP_INVALID             # <<<<<<<<<<<<<<
 * 
 * RBD_MIRROR_MODE_DISABLED = _RBD_MIRROR_MODE_DISABLED
 */
  __pyx_t_1 = PyInt_FromLong(RBD_FLAG_OBJECT_MAP_INVALID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_133, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":359
 * RBD_FLAG_OBJECT_MAP_INVALID = _RBD_FLAG_OBJECT_MAP_INVALID
 * 
 * RBD_MIRROR_MODE_DISABLED = _RBD_MIRROR_MODE_DISABLED             # <<<<<<<<<<<<<<
 * RBD_MIRROR_MODE_IMAGE = _RBD_MIRROR_MODE_IMAGE
 * RBD_MIRROR_MODE_POOL = _RBD_MIRROR_MODE_POOL
 */
  __pyx_t_1 = PyInt_FromLong(RBD_MIRROR_MODE_DISABLED); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_134, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":360
 * 
 * RBD_MIRROR_MODE_DISABLED = _RBD_MIRROR_MODE_DISABLED
 * RBD_MIRROR_MODE_IMAGE = _RBD_MIRROR_MODE_IMAGE             # <<<<<<<<<<<<<<
 * RBD_MIRROR_MODE_POOL = _RBD_MIRROR_MODE_POOL
 * 
 */
  __pyx_t_1 = PyInt_FromLong(RBD_MIRROR_MODE_IMAGE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_135, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":361
 * RBD_MIRROR_MODE_DISABLED = _RBD_MIRROR_MODE_DISABLED
 * RBD_MIRROR_MODE_IMAGE = _RBD_MIRROR_MODE_IMAGE
 * RBD_MIRROR_MODE_POOL = _RBD_MIRROR_MODE_POOL             # <<<<<<<<<<<<<<
 * 
 * RBD_MIRROR_IMAGE_DISABLING = _RBD_MIRROR_IMAGE_DISABLING
 */
  __pyx_t_1 = PyInt_FromLong(RBD_MIRROR_MODE_POOL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_136, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":363
 * RBD_MIRROR_MODE_POOL = _RBD_MIRROR_MODE_POOL
 * 
 * RBD_MIRROR_IMAGE_DISABLING = _RBD_MIRROR_IMAGE_DISABLING             # <<<<<<<<<<<<<<
 * RBD_MIRROR_IMAGE_ENABLED = _RBD_MIRROR_IMAGE_ENABLED
 * RBD_MIRROR_IMAGE_DISABLED = _RBD_MIRROR_IMAGE_DISABLED
 */
  __pyx_t_1 = PyInt_FromLong(RBD_MIRROR_IMAGE_DISABLING); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 363; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_137, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 363; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":364
 * 
 * RBD_MIRROR_IMAGE_DISABLING = _RBD_MIRROR_IMAGE_DISABLING
 * RBD_MIRROR_IMAGE_ENABLED = _RBD_MIRROR_IMAGE_ENABLED             # <<<<<<<<<<<<<<
 * RBD_MIRROR_IMAGE_DISABLED = _RBD_MIRROR_IMAGE_DISABLED
 * 
 */
  __pyx_t_1 = PyInt_FromLong(RBD_MIRROR_IMAGE_ENABLED); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_138, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":365
 * RBD_MIRROR_IMAGE_DISABLING = _RBD_MIRROR_IMAGE_DISABLING
 * RBD_MIRROR_IMAGE_ENABLED = _RBD_MIRROR_IMAGE_ENABLED
 * RBD_MIRROR_IMAGE_DISABLED = _RBD_MIRROR_IMAGE_DISABLED             # <<<<<<<<<<<<<<
 * 
 * MIRROR_IMAGE_STATUS_STATE_UNKNOWN = _MIRROR_IMAGE_STATUS_STATE_UNKNOWN
 */
  __pyx_t_1 = PyInt_FromLong(RBD_MIRROR_IMAGE_DISABLED); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_139, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":367
 * RBD_MIRROR_IMAGE_DISABLED = _RBD_MIRROR_IMAGE_DISABLED
 * 
 * MIRROR_IMAGE_STATUS_STATE_UNKNOWN = _MIRROR_IMAGE_STATUS_STATE_UNKNOWN             # <<<<<<<<<<<<<<
 * MIRROR_IMAGE_STATUS_STATE_ERROR = _MIRROR_IMAGE_STATUS_STATE_ERROR
 * MIRROR_IMAGE_STATUS_STATE_SYNCING = _MIRROR_IMAGE_STATUS_STATE_SYNCING
 */
  __pyx_t_1 = PyInt_FromLong(MIRROR_IMAGE_STATUS_STATE_UNKNOWN); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_140, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":368
 * 
 * MIRROR_IMAGE_STATUS_STATE_UNKNOWN = _MIRROR_IMAGE_STATUS_STATE_UNKNOWN
 * MIRROR_IMAGE_STATUS_STATE_ERROR = _MIRROR_IMAGE_STATUS_STATE_ERROR             # <<<<<<<<<<<<<<
 * MIRROR_IMAGE_STATUS_STATE_SYNCING = _MIRROR_IMAGE_STATUS_STATE_SYNCING
 * MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY = _MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY
 */
  __pyx_t_1 = PyInt_FromLong(MIRROR_IMAGE_STATUS_STATE_ERROR); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_141, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":369
 * MIRROR_IMAGE_STATUS_STATE_UNKNOWN = _MIRROR_IMAGE_STATUS_STATE_UNKNOWN
 * MIRROR_IMAGE_STATUS_STATE_ERROR = _MIRROR_IMAGE_STATUS_STATE_ERROR
 * MIRROR_IMAGE_STATUS_STATE_SYNCING = _MIRROR_IMAGE_STATUS_STATE_SYNCING             # <<<<<<<<<<<<<<
 * MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY = _MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY
 * MIRROR_IMAGE_STATUS_STATE_REPLAYING = _MIRROR_IMAGE_STATUS_STATE_REPLAYING
 */
  __pyx_t_1 = PyInt_FromLong(MIRROR_IMAGE_STATUS_STATE_SYNCING); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_142, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":370
 * MIRROR_IMAGE_STATUS_STATE_ERROR = _MIRROR_IMAGE_STATUS_STATE_ERROR
 * MIRROR_IMAGE_STATUS_STATE_SYNCING = _MIRROR_IMAGE_STATUS_STATE_SYNCING
 * MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY = _MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY             # <<<<<<<<<<<<<<
 * MIRROR_IMAGE_STATUS_STATE_REPLAYING = _MIRROR_IMAGE_STATUS_STATE_REPLAYING
 * MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY = _MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY
 */
  __pyx_t_1 = PyInt_FromLong(MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_143, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":371
 * MIRROR_IMAGE_STATUS_STATE_SYNCING = _MIRROR_IMAGE_STATUS_STATE_SYNCING
 * MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY = _MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY
 * MIRROR_IMAGE_STATUS_STATE_REPLAYING = _MIRROR_IMAGE_STATUS_STATE_REPLAYING             # <<<<<<<<<<<<<<
 * MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY = _MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY
 * MIRROR_IMAGE_STATUS_STATE_STOPPED = _MIRROR_IMAGE_STATUS_STATE_STOPPED
 */
  __pyx_t_1 = PyInt_FromLong(MIRROR_IMAGE_STATUS_STATE_REPLAYING); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_144, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":372
 * MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY = _MIRROR_IMAGE_STATUS_STATE_STARTING_REPLAY
 * MIRROR_IMAGE_STATUS_STATE_REPLAYING = _MIRROR_IMAGE_STATUS_STATE_REPLAYING
 * MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY = _MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY             # <<<<<<<<<<<<<<
 * MIRROR_IMAGE_STATUS_STATE_STOPPED = _MIRROR_IMAGE_STATUS_STATE_STOPPED
 * 
 */
  __pyx_t_1 = PyInt_FromLong(MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_145, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":373
 * MIRROR_IMAGE_STATUS_STATE_REPLAYING = _MIRROR_IMAGE_STATUS_STATE_REPLAYING
 * MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY = _MIRROR_IMAGE_STATUS_STATE_STOPPING_REPLAY
 * MIRROR_IMAGE_STATUS_STATE_STOPPED = _MIRROR_IMAGE_STATUS_STATE_STOPPED             # <<<<<<<<<<<<<<
 * 
 * RBD_LOCK_MODE_EXCLUSIVE = _RBD_LOCK_MODE_EXCLUSIVE
 */
  __pyx_t_1 = PyInt_FromLong(MIRROR_IMAGE_STATUS_STATE_STOPPED); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_146, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":375
 * MIRROR_IMAGE_STATUS_STATE_STOPPED = _MIRROR_IMAGE_STATUS_STATE_STOPPED
 * 
 * RBD_LOCK_MODE_EXCLUSIVE = _RBD_LOCK_MODE_EXCLUSIVE             # <<<<<<<<<<<<<<
 * RBD_LOCK_MODE_SHARED = _RBD_LOCK_MODE_SHARED
 * 
 */
  __pyx_t_1 = PyInt_FromLong(RBD_LOCK_MODE_EXCLUSIVE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_147, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":376
 * 
 * RBD_LOCK_MODE_EXCLUSIVE = _RBD_LOCK_MODE_EXCLUSIVE
 * RBD_LOCK_MODE_SHARED = _RBD_LOCK_MODE_SHARED             # <<<<<<<<<<<<<<
 * 
 * RBD_IMAGE_OPTION_FORMAT = _RBD_IMAGE_OPTION_FORMAT
 */
  __pyx_t_1 = PyInt_FromLong(RBD_LOCK_MODE_SHARED); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_148, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":378
 * RBD_LOCK_MODE_SHARED = _RBD_LOCK_MODE_SHARED
 * 
 * RBD_IMAGE_OPTION_FORMAT = _RBD_IMAGE_OPTION_FORMAT             # <<<<<<<<<<<<<<
 * RBD_IMAGE_OPTION_FEATURES = _RBD_IMAGE_OPTION_FEATURES
 * RBD_IMAGE_OPTION_ORDER = _RBD_IMAGE_OPTION_ORDER
 */
  __pyx_t_1 = PyInt_FromLong(RBD_IMAGE_OPTION_FORMAT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_9, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":379
 * 
 * RBD_IMAGE_OPTION_FORMAT = _RBD_IMAGE_OPTION_FORMAT
 * RBD_IMAGE_OPTION_FEATURES = _RBD_IMAGE_OPTION_FEATURES             # <<<<<<<<<<<<<<
 * RBD_IMAGE_OPTION_ORDER = _RBD_IMAGE_OPTION_ORDER
 * RBD_IMAGE_OPTION_STRIPE_UNIT = _RBD_IMAGE_OPTION_STRIPE_UNIT
 */
  __pyx_t_1 = PyInt_FromLong(RBD_IMAGE_OPTION_FEATURES); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_10, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":380
 * RBD_IMAGE_OPTION_FORMAT = _RBD_IMAGE_OPTION_FORMAT
 * RBD_IMAGE_OPTION_FEATURES = _RBD_IMAGE_OPTION_FEATURES
 * RBD_IMAGE_OPTION_ORDER = _RBD_IMAGE_OPTION_ORDER             # <<<<<<<<<<<<<<
 * RBD_IMAGE_OPTION_STRIPE_UNIT = _RBD_IMAGE_OPTION_STRIPE_UNIT
 * RBD_IMAGE_OPTION_STRIPE_COUNT = _RBD_IMAGE_OPTION_STRIPE_COUNT
 */
  __pyx_t_1 = PyInt_FromLong(RBD_IMAGE_OPTION_ORDER); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_11, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":381
 * RBD_IMAGE_OPTION_FEATURES = _RBD_IMAGE_OPTION_FEATURES
 * RBD_IMAGE_OPTION_ORDER = _RBD_IMAGE_OPTION_ORDER
 * RBD_IMAGE_OPTION_STRIPE_UNIT = _RBD_IMAGE_OPTION_STRIPE_UNIT             # <<<<<<<<<<<<<<
 * RBD_IMAGE_OPTION_STRIPE_COUNT = _RBD_IMAGE_OPTION_STRIPE_COUNT
 * RBD_IMAGE_OPTION_DATA_POOL = _RBD_IMAGE_OPTION_DATA_POOL
 */
  __pyx_t_1 = PyInt_FromLong(RBD_IMAGE_OPTION_STRIPE_UNIT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_12, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":382
 * RBD_IMAGE_OPTION_ORDER = _RBD_IMAGE_OPTION_ORDER
 * RBD_IMAGE_OPTION_STRIPE_UNIT = _RBD_IMAGE_OPTION_STRIPE_UNIT
 * RBD_IMAGE_OPTION_STRIPE_COUNT = _RBD_IMAGE_OPTION_STRIPE_COUNT             # <<<<<<<<<<<<<<
 * RBD_IMAGE_OPTION_DATA_POOL = _RBD_IMAGE_OPTION_DATA_POOL
 * 
 */
  __pyx_t_1 = PyInt_FromLong(RBD_IMAGE_OPTION_STRIPE_COUNT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_13, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":383
 * RBD_IMAGE_OPTION_STRIPE_UNIT = _RBD_IMAGE_OPTION_STRIPE_UNIT
 * RBD_IMAGE_OPTION_STRIPE_COUNT = _RBD_IMAGE_OPTION_STRIPE_COUNT
 * RBD_IMAGE_OPTION_DATA_POOL = _RBD_IMAGE_OPTION_DATA_POOL             # <<<<<<<<<<<<<<
 * 
 * class Error(Exception):
 */
  __pyx_t_1 = PyInt_FromLong(RBD_IMAGE_OPTION_DATA_POOL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_14, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":385
 * RBD_IMAGE_OPTION_DATA_POOL = _RBD_IMAGE_OPTION_DATA_POOL
 * 
 * class Error(Exception):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_builtin_Exception);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_builtin_Exception);
  __Pyx_GIVEREF(__pyx_builtin_Exception);
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__Error, __pyx_n_s__Error, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__Error, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":389
 * 
 * 
 * class OSError(Error):             # <<<<<<<<<<<<<<
 *     """ `OSError` class, derived from `Error` """
 *     def __init__(self, message, errno=None):
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));

  /* "rbd.pyx":391
 * class OSError(Error):
 *     """ `OSError` class, derived from `Error` """
 *     def __init__(self, message, errno=None):             # <<<<<<<<<<<<<<
 *         super(OSError, self).__init__(message)
 *         self.errno = errno
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_7OSError_1__init__, 0, __pyx_n_s_152, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_150)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, ((PyObject *)__pyx_k_tuple_151));
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s____init__, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":395
 *         self.errno = errno
 * 
 *     def __str__(self):             # <<<<<<<<<<<<<<
 *         msg = super(OSError, self).__str__()
 *         if self.errno is None:
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_7OSError_3__str__, 0, __pyx_n_s_155, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_154)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s____str__, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":401
 *         return '[errno {0}] {1}'.format(self.errno, msg)
 * 
 *     def __reduce__(self):             # <<<<<<<<<<<<<<
 *         return (self.__class__, (self.message, self.errno))
 * 
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_7OSError_5__reduce__, 0, __pyx_n_s_158, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_157)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s____reduce__, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":389
 * 
 * 
 * class OSError(Error):             # <<<<<<<<<<<<<<
 *     """ `OSError` class, derived from `Error` """
 *     def __init__(self, message, errno=None):
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__Error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  if (PyDict_SetItemString(((PyObject *)__pyx_t_1), "__doc__", ((PyObject *)__pyx_kp_s_159)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__OSError, __pyx_n_s__OSError, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__OSError, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":404
 *         return (self.__class__, (self.message, self.errno))
 * 
 * class PermissionError(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__PermissionError, __pyx_n_s__PermissionError, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__PermissionError, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":408
 * 
 * 
 * class ImageNotFound(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__ImageNotFound, __pyx_n_s__ImageNotFound, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__ImageNotFound, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":412
 * 
 * 
 * class ImageExists(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__ImageExists, __pyx_n_s__ImageExists, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__ImageExists, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":416
 * 
 * 
 * class IOError(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__IOError, __pyx_n_s__IOError, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__IOError, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":420
 * 
 * 
 * class NoSpace(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__NoSpace, __pyx_n_s__NoSpace, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__NoSpace, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":424
 * 
 * 
 * class IncompleteWriteError(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s_74, __pyx_n_s_74, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_74, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":428
 * 
 * 
 * class InvalidArgument(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__InvalidArgument, __pyx_n_s__InvalidArgument, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__InvalidArgument, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 428; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":432
 * 
 * 
 * class LogicError(Error):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__Error); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__LogicError, __pyx_n_s__LogicError, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__LogicError, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":436
 * 
 * 
 * class ReadOnlyImage(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__ReadOnlyImage, __pyx_n_s__ReadOnlyImage, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__ReadOnlyImage, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":440
 * 
 * 
 * class ImageBusy(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__ImageBusy, __pyx_n_s__ImageBusy, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__ImageBusy, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":444
 * 
 * 
 * class ImageHasSnapshots(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 444; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 444; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 444; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__ImageHasSnapshots, __pyx_n_s__ImageHasSnapshots, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 444; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__ImageHasSnapshots, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 444; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":448
 * 
 * 
 * class FunctionNotSupported(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s_160, __pyx_n_s_160, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_160, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":452
 * 
 * 
 * class ArgumentOutOfRange(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__ArgumentOutOfRange, __pyx_n_s__ArgumentOutOfRange, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__ArgumentOutOfRange, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":456
 * 
 * 
 * class ConnectionShutdown(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__ConnectionShutdown, __pyx_n_s__ConnectionShutdown, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__ConnectionShutdown, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":460
 * 
 * 
 * class Timeout(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__Timeout, __pyx_n_s__Timeout, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__Timeout, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":463
 *     pass
 * 
 * class DiskQuotaExceeded(OSError):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__OSError); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_CreateClass(((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_1), __pyx_n_s__DiskQuotaExceeded, __pyx_n_s__DiskQuotaExceeded, __pyx_n_s__rbd); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__DiskQuotaExceeded, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":467
 * 
 * 
 * cdef errno_to_exception = {             # <<<<<<<<<<<<<<
 *     errno.EPERM     : PermissionError,
 *     errno.ENOENT    : ImageNotFound,
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));

  /* "rbd.pyx":468
 * 
 * cdef errno_to_exception = {
 *     errno.EPERM     : PermissionError,             # <<<<<<<<<<<<<<
 *     errno.ENOENT    : ImageNotFound,
 *     errno.EIO       : IOError,
 */
  __pyx_t_3 = PyInt_FromLong(EPERM); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s__PermissionError); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_3, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":469
 * cdef errno_to_exception = {
 *     errno.EPERM     : PermissionError,
 *     errno.ENOENT    : ImageNotFound,             # <<<<<<<<<<<<<<
 *     errno.EIO       : IOError,
 *     errno.ENOSPC    : NoSpace,
 */
  __pyx_t_2 = PyInt_FromLong(ENOENT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__ImageNotFound); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_2, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":470
 *     errno.EPERM     : PermissionError,
 *     errno.ENOENT    : ImageNotFound,
 *     errno.EIO       : IOError,             # <<<<<<<<<<<<<<
 *     errno.ENOSPC    : NoSpace,
 *     errno.EEXIST    : ImageExists,
 */
  __pyx_t_3 = PyInt_FromLong(EIO); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s__IOError); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_3, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":471
 *     errno.ENOENT    : ImageNotFound,
 *     errno.EIO       : IOError,
 *     errno.ENOSPC    : NoSpace,             # <<<<<<<<<<<<<<
 *     errno.EEXIST    : ImageExists,
 *     errno.EINVAL    : InvalidArgument,
 */
  __pyx_t_2 = PyInt_FromLong(ENOSPC); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__NoSpace); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_2, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":472
 *     errno.EIO       : IOError,
 *     errno.ENOSPC    : NoSpace,
 *     errno.EEXIST    : ImageExists,             # <<<<<<<<<<<<<<
 *     errno.EINVAL    : InvalidArgument,
 *     errno.EROFS     : ReadOnlyImage,
 */
  __pyx_t_3 = PyInt_FromLong(EEXIST); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s__ImageExists); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_3, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":473
 *     errno.ENOSPC    : NoSpace,
 *     errno.EEXIST    : ImageExists,
 *     errno.EINVAL    : InvalidArgument,             # <<<<<<<<<<<<<<
 *     errno.EROFS     : ReadOnlyImage,
 *     errno.EBUSY     : ImageBusy,
 */
  __pyx_t_2 = PyInt_FromLong(EINVAL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__InvalidArgument); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_2, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":474
 *     errno.EEXIST    : ImageExists,
 *     errno.EINVAL    : InvalidArgument,
 *     errno.EROFS     : ReadOnlyImage,             # <<<<<<<<<<<<<<
 *     errno.EBUSY     : ImageBusy,
 *     errno.ENOTEMPTY : ImageHasSnapshots,
 */
  __pyx_t_3 = PyInt_FromLong(EROFS); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s__ReadOnlyImage); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_3, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":475
 *     errno.EINVAL    : InvalidArgument,
 *     errno.EROFS     : ReadOnlyImage,
 *     errno.EBUSY     : ImageBusy,             # <<<<<<<<<<<<<<
 *     errno.ENOTEMPTY : ImageHasSnapshots,
 *     errno.ENOSYS    : FunctionNotSupported,
 */
  __pyx_t_2 = PyInt_FromLong(EBUSY); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__ImageBusy); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_2, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":476
 *     errno.EROFS     : ReadOnlyImage,
 *     errno.EBUSY     : ImageBusy,
 *     errno.ENOTEMPTY : ImageHasSnapshots,             # <<<<<<<<<<<<<<
 *     errno.ENOSYS    : FunctionNotSupported,
 *     errno.EDOM      : ArgumentOutOfRange,
 */
  __pyx_t_3 = PyInt_FromLong(ENOTEMPTY); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s__ImageHasSnapshots); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_3, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":477
 *     errno.EBUSY     : ImageBusy,
 *     errno.ENOTEMPTY : ImageHasSnapshots,
 *     errno.ENOSYS    : FunctionNotSupported,             # <<<<<<<<<<<<<<
 *     errno.EDOM      : ArgumentOutOfRange,
 *     errno.ESHUTDOWN : ConnectionShutdown,
 */
  __pyx_t_2 = PyInt_FromLong(ENOSYS); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_160); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_2, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":478
 *     errno.ENOTEMPTY : ImageHasSnapshots,
 *     errno.ENOSYS    : FunctionNotSupported,
 *     errno.EDOM      : ArgumentOutOfRange,             # <<<<<<<<<<<<<<
 *     errno.ESHUTDOWN : ConnectionShutdown,
 *     errno.ETIMEDOUT : Timeout,
 */
  __pyx_t_3 = PyInt_FromLong(EDOM); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s__ArgumentOutOfRange); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_3, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":479
 *     errno.ENOSYS    : FunctionNotSupported,
 *     errno.EDOM      : ArgumentOutOfRange,
 *     errno.ESHUTDOWN : ConnectionShutdown,             # <<<<<<<<<<<<<<
 *     errno.ETIMEDOUT : Timeout,
 *     errno.EDQUOT    : DiskQuotaExceeded,
 */
  __pyx_t_2 = PyInt_FromLong(ESHUTDOWN); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__ConnectionShutdown); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_2, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":480
 *     errno.EDOM      : ArgumentOutOfRange,
 *     errno.ESHUTDOWN : ConnectionShutdown,
 *     errno.ETIMEDOUT : Timeout,             # <<<<<<<<<<<<<<
 *     errno.EDQUOT    : DiskQuotaExceeded,
 * }
 */
  __pyx_t_3 = PyInt_FromLong(ETIMEDOUT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s__Timeout); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_3, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "rbd.pyx":481
 *     errno.ESHUTDOWN : ConnectionShutdown,
 *     errno.ETIMEDOUT : Timeout,
 *     errno.EDQUOT    : DiskQuotaExceeded,             # <<<<<<<<<<<<<<
 * }
 * 
 */
  __pyx_t_2 = PyInt_FromLong(EDQUOT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s__DiskQuotaExceeded); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_1, __pyx_t_2, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_XGOTREF(__pyx_v_3rbd_errno_to_exception);
  __Pyx_DECREF(__pyx_v_3rbd_errno_to_exception);
  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
  __pyx_v_3rbd_errno_to_exception = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "rbd.pyx":507
 *     return 0
 * 
 * def cstr(val, name, encoding="utf-8", opt=False):             # <<<<<<<<<<<<<<
 *     """
 *     Create a byte string from a Python string
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k_3 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3rbd_1cstr, NULL, __pyx_n_s__rbd); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__cstr, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":527
 *         raise InvalidArgument('%s must be a string' % name)
 * 
 * def decode_cstr(val, encoding="utf-8"):             # <<<<<<<<<<<<<<
 *     """
 *     Decode a byte string into a Python string.
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3rbd_3decode_cstr, NULL, __pyx_n_s__rbd); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__decode_cstr, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "rbd.pyx":658
 * 
 * 
 * class RBD(object):             # <<<<<<<<<<<<<<
 *     """
 *     This class wraps librbd CRUD functions.
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));

  /* "rbd.pyx":662
 *     This class wraps librbd CRUD functions.
 *     """
 *     def version(self):             # <<<<<<<<<<<<<<
 *         """
 *         Get the version number of the ``librbd`` C library.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_1version, 0, __pyx_n_s_167, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_166)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__version, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":675
 *         return (major, minor, extra)
 * 
 *     def create(self, ioctx, name, size, order=None, old_format=True,             # <<<<<<<<<<<<<<
 *                features=None, stripe_unit=None, stripe_count=None,
 *                data_pool=None):
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_3create, 0, __pyx_n_s_170, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_169)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults), 1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_t_3)->__pyx_arg_old_format = __pyx_t_2;
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_3rbd_3RBD_40__defaults__);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__create, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":755
 *             raise make_ex(ret, 'error creating image')
 * 
 *     def clone(self, p_ioctx, p_name, p_snapname, c_ioctx, c_name,             # <<<<<<<<<<<<<<
 *               features=None, order=None, stripe_unit=None, stripe_count=None,
 *               data_pool=None):
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_5clone, 0, __pyx_n_s_174, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_172)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, ((PyObject *)__pyx_k_tuple_173));
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__clone, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":823
 *             raise make_ex(ret, 'error creating clone')
 * 
 *     def list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         List image names.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_7list, 0, __pyx_n_s_177, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_176)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__list, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":849
 *             free(c_names)
 * 
 *     def remove(self, ioctx, name):             # <<<<<<<<<<<<<<
 *         """
 *         Delete an RBD image. This may take a long time, since it does
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_9remove, 0, __pyx_n_s_180, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_179)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 849; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__remove, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 849; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":875
 *             raise make_ex(ret, 'error removing image')
 * 
 *     def rename(self, ioctx, src, dest):             # <<<<<<<<<<<<<<
 *         """
 *         Rename an RBD image.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_11rename, 0, __pyx_n_s_183, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_182)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__rename, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 875; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":898
 *             raise make_ex(ret, 'error renaming image')
 * 
 *     def trash_move(self, ioctx, name, delay=0):             # <<<<<<<<<<<<<<
 *         """
 *         Move an RBD image to the trash.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_13trash_move, 0, __pyx_n_s_187, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_185)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, ((PyObject *)__pyx_k_tuple_186));
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__trash_move, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":920
 *             raise make_ex(ret, 'error moving image to trash')
 * 
 *     def trash_remove(self, ioctx, image_id, force=False):             # <<<<<<<<<<<<<<
 *         """
 *         Delete an RBD image from trash. If image deferment time has not
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_15trash_remove, 0, __pyx_n_s_190, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_189)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults1), 1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_t_3)->__pyx_arg_force = __pyx_t_2;
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_3rbd_3RBD_42__defaults__);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__trash_remove, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 920; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":942
 *             raise make_ex(ret, 'error deleting image from trash')
 * 
 *     def trash_get(self, ioctx, image_id):             # <<<<<<<<<<<<<<
 *         """
 *         Retrieve RBD image info from trash
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_17trash_get, 0, __pyx_n_s_193, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_192)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__trash_get, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":985
 *         return info
 * 
 *     def trash_list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         List all entries from trash.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_19trash_list, 0, __pyx_n_s_196, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_195)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__trash_list, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 985; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":994
 *         return TrashIterator(ioctx)
 * 
 *     def trash_restore(self, ioctx, image_id, name):             # <<<<<<<<<<<<<<
 *         """
 *         Restore an RBD image from trash.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_21trash_restore, 0, __pyx_n_s_199, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_198)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__trash_restore, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":1016
 *             raise make_ex(ret, 'error restoring image from trash')
 * 
 *     def mirror_mode_get(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Get pool mirror mode.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_23mirror_mode_get, 0, __pyx_n_s_202, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_201)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1016; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__mirror_mode_get, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1016; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":1033
 *         return mirror_mode
 * 
 *     def mirror_mode_set(self, ioctx, mirror_mode):             # <<<<<<<<<<<<<<
 *         """
 *         Set pool mirror mode.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_25mirror_mode_set, 0, __pyx_n_s_205, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_204)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1033; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__mirror_mode_set, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1033; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":1050
 *             raise make_ex(ret, 'error setting mirror mode')
 * 
 *     def mirror_peer_add(self, ioctx, cluster_name, client_name):             # <<<<<<<<<<<<<<
 *         """
 *         Add mirror peer.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_27mirror_peer_add, 0, __pyx_n_s_208, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_207)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__mirror_peer_add, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1050; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":1080
 *             free(_uuid)
 * 
 *     def mirror_peer_remove(self, ioctx, uuid):             # <<<<<<<<<<<<<<
 *         """
 *         Remove mirror peer.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_29mirror_peer_remove, 0, __pyx_n_s_211, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_210)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1080; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__mirror_peer_remove, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1080; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":1098
 *             raise make_ex(ret, 'error removing mirror peer')
 * 
 *     def mirror_peer_list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Iterate over the peers of a pool.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_31mirror_peer_list, 0, __pyx_n_s_214, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_213)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s__mirror_peer_list, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":1108
 *         return MirrorPeerIterator(ioctx)
 * 
 *     def mirror_peer_set_client(self, ioctx, uuid, client_name):             # <<<<<<<<<<<<<<
 *         """
 *         Set mirror peer client name
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_33mirror_peer_set_client, 0, __pyx_n_s_218, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_216)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s_217, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":1130
 *             raise make_ex(ret, 'error setting mirror peer client')
 * 
 *     def mirror_peer_set_cluster(self, ioctx, uuid, cluster_name):             # <<<<<<<<<<<<<<
 *         """
 *         Set mirror peer cluster name
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_35mirror_peer_set_cluster, 0, __pyx_n_s_222, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_220)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s_221, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":1152
 *             raise make_ex(ret, 'error setting mirror peer cluster')
 * 
 *     def mirror_image_status_list(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Iterate over the mirror image statuses of a pool.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_37mirror_image_status_list, 0, __pyx_n_s_226, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_224)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s_225, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":1162
 *         return MirrorImageStatusIterator(ioctx)
 * 
 *     def mirror_image_status_summary(self, ioctx):             # <<<<<<<<<<<<<<
 *         """
 *         Get mirror image status summary of a pool.
 */
  __pyx_t_3 = __Pyx_CyFunction_NewEx(&__pyx_mdef_3rbd_3RBD_39mirror_image_status_summary, 0, __pyx_n_s_230, NULL, __pyx_n_s__rbd, ((PyObject *)__pyx_k_codeobj_228)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyObject_SetItem(__pyx_t_1, __pyx_n_s_229, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "rbd.pyx":658
 * 
 * 
 * class RBD(object):             # <<<<<<<<<<<<<<
 *     """
 *     This class wraps librbd CRUD functions.
 */
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_builtin_object);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_builtin_object);
  __Pyx_GIVEREF(__pyx_builtin_object);
  if (PyDict_SetItemString(((PyObject *)__pyx_t_1), "__doc__", ((PyObject *)__pyx_kp_s_231)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = __Pyx_CreateClass(((PyObject *)__pyx_t_3), ((PyObject *)__pyx_t_1), __pyx_n_s__RBD, __pyx_n_s__RBD, __pyx_n_s__rbd); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s__RBD, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "rbd.pyx":1352
 *     cdef rados_ioctx_t _ioctx
 * 
 *     def __init__(self, ioctx, name, snapshot=None, read_only=False):             # <<<<<<<<<<<<<<
 *         """
 *         Open the image at the given snapshot.
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k_35 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "rbd.pyx":2029
 * 
 *     def diff_iterate(self, offset, length, from_snapshot, iterate_cb,
 *                      include_parent = True, whole_object = False):             # <<<<<<<<<<<<<<
 *         """
 *         Iterate over the changed extents of an image.
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2029; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k_68 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2029; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k_69 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "rbd.pyx":2947
 *                 raise make_ex(ret, 'error listing trash entries')
 * 
 *     __source_string = ['USER', 'MIRRORING']             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
  __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__USER));
  PyList_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__USER));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__USER));
  __Pyx_INCREF(((PyObject *)__pyx_n_s__MIRRORING));
  PyList_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_n_s__MIRRORING));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__MIRRORING));
  if (PyDict_SetItem((PyObject *)__pyx_ptype_3rbd_TrashIterator->tp_dict, __pyx_n_s____source_string, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  PyType_Modified(__pyx_ptype_3rbd_TrashIterator);

  /* "rbd.pyx":1
 * # cython: embedsignature=True             # <<<<<<<<<<<<<<
 * """
 * This module is a thin wrapper around librbd.
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  if (PyDict_SetItem(__pyx_d, __pyx_n_s____test__, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "cpython/datetime.pxd":211
 * 
 * # Get microseconds of timedelta
 * cdef inline int timedelta_microseconds(object o):             # <<<<<<<<<<<<<<
 *     return (<PyDateTime_Delta*>o).microseconds
 */
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  if (__pyx_m) {
    __Pyx_AddTraceback("init rbd", __pyx_clineno, __pyx_lineno, __pyx_filename);
    Py_DECREF(__pyx_m); __pyx_m = 0;
  } else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_ImportError, "init rbd");
  }
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
}

/* Runtime support code */
#if CYTHON_REFNANNY
static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
    PyObject *m = NULL, *p = NULL;
    void *r = NULL;
    m = PyImport_ImportModule((char *)modname);
    if (!m) goto end;
    p = PyObject_GetAttrString(m, (char *)"RefNannyAPI");
    if (!p) goto end;
    r = PyLong_AsVoidPtr(p);
end:
    Py_XDECREF(p);
    Py_XDECREF(m);
    return (__Pyx_RefNannyAPIStruct *)r;
}
#endif /* CYTHON_REFNANNY */

static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
    if (unlikely(!result)) {
        PyErr_Format(PyExc_NameError,
#if PY_MAJOR_VERSION >= 3
            "name '%U' is not defined", name);
#else
            "name '%s' is not defined", PyString_AS_STRING(name));
#endif
    }
    return result;
}

static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *more_or_less;
    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    PyErr_Format(PyExc_TypeError,
                 "%s() takes %s %" CYTHON_FORMAT_SSIZE_T "d positional argument%s (%" CYTHON_FORMAT_SSIZE_T "d given)",
                 func_name, more_or_less, num_expected,
                 (num_expected == 1) ? "" : "s", num_found);
}

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AsString(kw_name));
        #endif
}

static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;
    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
            continue;
        }
        name = first_kw_arg;
        #if PY_MAJOR_VERSION < 3
        if (likely(PyString_CheckExact(key)) || likely(PyString_Check(key))) {
            while (*name) {
                if ((CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**name) == PyString_GET_SIZE(key))
                        && _PyString_Eq(**name, key)) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    if ((**argname == key) || (
                            (CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**argname) == PyString_GET_SIZE(key))
                             && _PyString_Eq(**argname, key))) {
                        goto arg_passed_twice;
                    }
                    argname++;
                }
            }
        } else
        #endif
        if (likely(PyUnicode_Check(key))) {
            while (*name) {
                int cmp = (**name == key) ? 0 :
                #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                    (PyUnicode_GET_SIZE(**name) != PyUnicode_GET_SIZE(key)) ? 1 :
                #endif
                    PyUnicode_Compare(**name, key);
                if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                if (cmp == 0) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    int cmp = (**argname == key) ? 0 :
                    #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                        (PyUnicode_GET_SIZE(**argname) != PyUnicode_GET_SIZE(key)) ? 1 :
                    #endif
                        PyUnicode_Compare(**argname, key);
                    if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                    if (cmp == 0) goto arg_passed_twice;
                    argname++;
                }
            }
        } else
            goto invalid_keyword_type;
        if (kwds2) {
            if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
        } else {
            goto invalid_keyword;
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, key);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%s() got an unexpected keyword argument '%s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}

static CYTHON_INLINE PyObject *__Pyx_GetModuleGlobalName(PyObject *name) {
    PyObject *result;
#if CYTHON_COMPILING_IN_CPYTHON
    result = PyDict_GetItem(__pyx_d, name);
    if (result) {
        Py_INCREF(result);
    } else {
#else
    result = PyObject_GetItem(__pyx_d, name);
    if (!result) {
        PyErr_Clear();
#endif
        result = __Pyx_GetBuiltinName(name);
    }
    return result;
}

static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_Restore(type, value, tb);
#endif
}
static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#else
    PyErr_Fetch(type, value, tb);
#endif
}

#if PY_MAJOR_VERSION < 3
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
                        CYTHON_UNUSED PyObject *cause) {
    Py_XINCREF(type);
    if (!value || value == Py_None)
        value = NULL;
    else
        Py_INCREF(value);
    if (!tb || tb == Py_None)
        tb = NULL;
    else {
        Py_INCREF(tb);
        if (!PyTraceBack_Check(tb)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: arg 3 must be a traceback or None");
            goto raise_error;
        }
    }
    #if PY_VERSION_HEX < 0x02050000
    if (PyClass_Check(type)) {
    #else
    if (PyType_Check(type)) {
    #endif
#if CYTHON_COMPILING_IN_PYPY
        if (!value) {
            Py_INCREF(Py_None);
            value = Py_None;
        }
#endif
        PyErr_NormalizeException(&type, &value, &tb);
    } else {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        value = type;
        #if PY_VERSION_HEX < 0x02050000
        if (PyInstance_Check(type)) {
            type = (PyObject*) ((PyInstanceObject*)type)->in_class;
            Py_INCREF(type);
        } else {
            type = 0;
            PyErr_SetString(PyExc_TypeError,
                "raise: exception must be an old-style class or instance");
            goto raise_error;
        }
        #else
        type = (PyObject*) Py_TYPE(type);
        Py_INCREF(type);
        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: exception class must be a subclass of BaseException");
            goto raise_error;
        }
        #endif
    }
    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}
#else /* Python 3+ */
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
    PyObject* owned_instance = NULL;
    if (tb == Py_None) {
        tb = 0;
    } else if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto bad;
    }
    if (value == Py_None)
        value = 0;
    if (PyExceptionInstance_Check(type)) {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto bad;
        }
        value = type;
        type = (PyObject*) Py_TYPE(value);
    } else if (PyExceptionClass_Check(type)) {
        PyObject *args;
        if (!value)
            args = PyTuple_New(0);
        else if (PyTuple_Check(value)) {
            Py_INCREF(value);
            args = value;
        } else
            args = PyTuple_Pack(1, value);
        if (!args)
            goto bad;
        owned_instance = PyEval_CallObject(type, args);
        Py_DECREF(args);
        if (!owned_instance)
            goto bad;
        value = owned_instance;
        if (!PyExceptionInstance_Check(value)) {
            PyErr_Format(PyExc_TypeError,
                         "calling %R should have returned an instance of "
                         "BaseException, not %R",
                         type, Py_TYPE(value));
            goto bad;
        }
    } else {
        PyErr_SetString(PyExc_TypeError,
            "raise: exception class must be a subclass of BaseException");
        goto bad;
    }
#if PY_VERSION_HEX >= 0x03030000
    if (cause) {
#else
    if (cause && cause != Py_None) {
#endif
        PyObject *fixed_cause;
        if (cause == Py_None) {
            fixed_cause = NULL;
        } else if (PyExceptionClass_Check(cause)) {
            fixed_cause = PyObject_CallObject(cause, NULL);
            if (fixed_cause == NULL)
                goto bad;
        } else if (PyExceptionInstance_Check(cause)) {
            fixed_cause = cause;
            Py_INCREF(fixed_cause);
        } else {
            PyErr_SetString(PyExc_TypeError,
                            "exception causes must derive from "
                            "BaseException");
            goto bad;
        }
        PyException_SetCause(value, fixed_cause);
    }
    PyErr_SetObject(type, value);
    if (tb) {
        PyThreadState *tstate = PyThreadState_GET();
        PyObject* tmp_tb = tstate->curexc_traceback;
        if (tb != tmp_tb) {
            Py_INCREF(tb);
            tstate->curexc_traceback = tb;
            Py_XDECREF(tmp_tb);
        }
    }
bad:
    Py_XDECREF(owned_instance);
    return;
}
#endif

static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (!j) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck) {
#if CYTHON_COMPILING_IN_CPYTHON
    if (wraparound & unlikely(i < 0)) i += PyList_GET_SIZE(o);
    if ((!boundscheck) || likely((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        PyObject *r = PyList_GET_ITEM(o, i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck) {
#if CYTHON_COMPILING_IN_CPYTHON
    if (wraparound & unlikely(i < 0)) i += PyTuple_GET_SIZE(o);
    if ((!boundscheck) || likely((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
        PyObject *r = PyTuple_GET_ITEM(o, i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                     int is_list, int wraparound, int boundscheck) {
#if CYTHON_COMPILING_IN_CPYTHON
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
        if ((!boundscheck) || (likely((n >= 0) & (n < PyList_GET_SIZE(o))))) {
            PyObject *r = PyList_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    }
    else if (PyTuple_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
        if ((!boundscheck) || likely((n >= 0) & (n < PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    } else {
        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
        if (likely(m && m->sq_item)) {
            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
                Py_ssize_t l = m->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (PyErr_ExceptionMatches(PyExc_OverflowError))
                        PyErr_Clear();
                    else
                        return NULL;
                }
            }
            return m->sq_item(o, i);
        }
    }
#else
    if (is_list || PySequence_Check(o)) {
        return PySequence_GetItem(o, i);
    }
#endif
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
}

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *local_type, *local_value, *local_tb;
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    local_type = tstate->curexc_type;
    local_value = tstate->curexc_value;
    local_tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#else
    PyErr_Fetch(&local_type, &local_value, &local_tb);
#endif
    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
#if CYTHON_COMPILING_IN_CPYTHON
    if (unlikely(tstate->curexc_type))
#else
    if (unlikely(PyErr_Occurred()))
#endif
        goto bad;
    #if PY_MAJOR_VERSION >= 3
    if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
        goto bad;
    #endif
    Py_INCREF(local_type);
    Py_INCREF(local_value);
    Py_INCREF(local_tb);
    *type = local_type;
    *value = local_value;
    *tb = local_tb;
#if CYTHON_COMPILING_IN_CPYTHON
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = local_type;
    tstate->exc_value = local_value;
    tstate->exc_traceback = local_tb;
    /* Make sure tstate is in a consistent state when we XDECREF
       these objects (DECREF may run arbitrary code). */
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(local_type, local_value, local_tb);
#endif
    return 0;
bad:
    *type = 0;
    *value = 0;
    *tb = 0;
    Py_XDECREF(local_type);
    Py_XDECREF(local_value);
    Py_XDECREF(local_tb);
    return -1;
}

static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (unlikely(!type)) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (likely(PyObject_TypeCheck(obj, type)))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                 Py_TYPE(obj)->tp_name, type->tp_name);
    return 0;
}

static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname) {
    PyErr_Format(PyExc_NameError, "free variable '%s' referenced before assignment in enclosing scope", varname);
}

static PyObject *
__Pyx_CyFunction_get_doc(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *closure)
{
    if (unlikely(op->func_doc == NULL)) {
        if (op->func.m_ml->ml_doc) {
#if PY_MAJOR_VERSION >= 3
            op->func_doc = PyUnicode_FromString(op->func.m_ml->ml_doc);
#else
            op->func_doc = PyString_FromString(op->func.m_ml->ml_doc);
#endif
            if (unlikely(op->func_doc == NULL))
                return NULL;
        } else {
            Py_INCREF(Py_None);
            return Py_None;
        }
    }
    Py_INCREF(op->func_doc);
    return op->func_doc;
}
static int
__Pyx_CyFunction_set_doc(__pyx_CyFunctionObject *op, PyObject *value)
{
    PyObject *tmp = op->func_doc;
    if (value == NULL)
        value = Py_None; /* Mark as deleted */
    Py_INCREF(value);
    op->func_doc = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_name(__pyx_CyFunctionObject *op)
{
    if (unlikely(op->func_name == NULL)) {
#if PY_MAJOR_VERSION >= 3
        op->func_name = PyUnicode_InternFromString(op->func.m_ml->ml_name);
#else
        op->func_name = PyString_InternFromString(op->func.m_ml->ml_name);
#endif
        if (unlikely(op->func_name == NULL))
            return NULL;
    }
    Py_INCREF(op->func_name);
    return op->func_name;
}
static int
__Pyx_CyFunction_set_name(__pyx_CyFunctionObject *op, PyObject *value)
{
    PyObject *tmp;
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value))) {
#else
    if (unlikely(value == NULL || !PyString_Check(value))) {
#endif
        PyErr_SetString(PyExc_TypeError,
                        "__name__ must be set to a string object");
        return -1;
    }
    tmp = op->func_name;
    Py_INCREF(value);
    op->func_name = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_qualname(__pyx_CyFunctionObject *op)
{
    Py_INCREF(op->func_qualname);
    return op->func_qualname;
}
static int
__Pyx_CyFunction_set_qualname(__pyx_CyFunctionObject *op, PyObject *value)
{
    PyObject *tmp;
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value))) {
#else
    if (unlikely(value == NULL || !PyString_Check(value))) {
#endif
        PyErr_SetString(PyExc_TypeError,
                        "__qualname__ must be set to a string object");
        return -1;
    }
    tmp = op->func_qualname;
    Py_INCREF(value);
    op->func_qualname = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_self(__pyx_CyFunctionObject *m, CYTHON_UNUSED void *closure)
{
    PyObject *self;
    self = m->func_closure;
    if (self == NULL)
        self = Py_None;
    Py_INCREF(self);
    return self;
}
static PyObject *
__Pyx_CyFunction_get_dict(__pyx_CyFunctionObject *op)
{
    if (unlikely(op->func_dict == NULL)) {
        op->func_dict = PyDict_New();
        if (unlikely(op->func_dict == NULL))
            return NULL;
    }
    Py_INCREF(op->func_dict);
    return op->func_dict;
}
static int
__Pyx_CyFunction_set_dict(__pyx_CyFunctionObject *op, PyObject *value)
{
    PyObject *tmp;
    if (unlikely(value == NULL)) {
        PyErr_SetString(PyExc_TypeError,
               "function's dictionary may not be deleted");
        return -1;
    }
    if (unlikely(!PyDict_Check(value))) {
        PyErr_SetString(PyExc_TypeError,
               "setting function's dictionary to a non-dict");
        return -1;
    }
    tmp = op->func_dict;
    Py_INCREF(value);
    op->func_dict = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_globals(CYTHON_UNUSED __pyx_CyFunctionObject *op)
{
    PyObject* dict = PyModule_GetDict(__pyx_m);
    Py_XINCREF(dict);
    return dict;
}
static PyObject *
__Pyx_CyFunction_get_closure(CYTHON_UNUSED __pyx_CyFunctionObject *op)
{
    Py_INCREF(Py_None);
    return Py_None;
}
static PyObject *
__Pyx_CyFunction_get_code(__pyx_CyFunctionObject *op)
{
    PyObject* result = (op->func_code) ? op->func_code : Py_None;
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_init_defaults(__pyx_CyFunctionObject *op) {
    PyObject *res = op->defaults_getter((PyObject *) op);
    if (unlikely(!res))
        return -1;
    op->defaults_tuple = PyTuple_GET_ITEM(res, 0);
    Py_INCREF(op->defaults_tuple);
    op->defaults_kwdict = PyTuple_GET_ITEM(res, 1);
    Py_INCREF(op->defaults_kwdict);
    Py_DECREF(res);
    return 0;
}
static int
__Pyx_CyFunction_set_defaults(__pyx_CyFunctionObject *op, PyObject* value) {
    PyObject* tmp;
    if (!value) {
        value = Py_None;
    } else if (value != Py_None && !PyTuple_Check(value)) {
        PyErr_SetString(PyExc_TypeError,
                        "__defaults__ must be set to a tuple object");
        return -1;
    }
    Py_INCREF(value);
    tmp = op->defaults_tuple;
    op->defaults_tuple = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_defaults(__pyx_CyFunctionObject *op) {
    PyObject* result = op->defaults_tuple;
    if (unlikely(!result)) {
        if (op->defaults_getter) {
            if (__Pyx_CyFunction_init_defaults(op) < 0) return NULL;
            result = op->defaults_tuple;
        } else {
            result = Py_None;
        }
    }
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_set_kwdefaults(__pyx_CyFunctionObject *op, PyObject* value) {
    PyObject* tmp;
    if (!value) {
        value = Py_None;
    } else if (value != Py_None && !PyDict_Check(value)) {
        PyErr_SetString(PyExc_TypeError,
                        "__kwdefaults__ must be set to a dict object");
        return -1;
    }
    Py_INCREF(value);
    tmp = op->defaults_kwdict;
    op->defaults_kwdict = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_kwdefaults(__pyx_CyFunctionObject *op) {
    PyObject* result = op->defaults_kwdict;
    if (unlikely(!result)) {
        if (op->defaults_getter) {
            if (__Pyx_CyFunction_init_defaults(op) < 0) return NULL;
            result = op->defaults_kwdict;
        } else {
            result = Py_None;
        }
    }
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_set_annotations(__pyx_CyFunctionObject *op, PyObject* value) {
    PyObject* tmp;
    if (!value || value == Py_None) {
        value = NULL;
    } else if (!PyDict_Check(value)) {
        PyErr_SetString(PyExc_TypeError,
                        "__annotations__ must be set to a dict object");
        return -1;
    }
    Py_XINCREF(value);
    tmp = op->func_annotations;
    op->func_annotations = value;
    Py_XDECREF(tmp);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_annotations(__pyx_CyFunctionObject *op) {
    PyObject* result = op->func_annotations;
    if (unlikely(!result)) {
        result = PyDict_New();
        if (unlikely(!result)) return NULL;
        op->func_annotations = result;
    }
    Py_INCREF(result);
    return result;
}
static PyGetSetDef __pyx_CyFunction_getsets[] = {
    {(char *) "func_doc", (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
    {(char *) "__doc__",  (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
    {(char *) "func_name", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
    {(char *) "__name__", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
    {(char *) "__qualname__", (getter)__Pyx_CyFunction_get_qualname, (setter)__Pyx_CyFunction_set_qualname, 0, 0},
    {(char *) "__self__", (getter)__Pyx_CyFunction_get_self, 0, 0, 0},
    {(char *) "func_dict", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
    {(char *) "__dict__", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
    {(char *) "func_globals", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
    {(char *) "__globals__", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
    {(char *) "func_closure", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
    {(char *) "__closure__", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
    {(char *) "func_code", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
    {(char *) "__code__", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
    {(char *) "func_defaults", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
    {(char *) "__defaults__", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
    {(char *) "__kwdefaults__", (getter)__Pyx_CyFunction_get_kwdefaults, (setter)__Pyx_CyFunction_set_kwdefaults, 0, 0},
    {(char *) "__annotations__", (getter)__Pyx_CyFunction_get_annotations, (setter)__Pyx_CyFunction_set_annotations, 0, 0},
    {0, 0, 0, 0, 0}
};
#ifndef PY_WRITE_RESTRICTED /* < Py2.5 */
#define PY_WRITE_RESTRICTED WRITE_RESTRICTED
#endif
static PyMemberDef __pyx_CyFunction_members[] = {
    {(char *) "__module__", T_OBJECT, offsetof(__pyx_CyFunctionObject, func.m_module), PY_WRITE_RESTRICTED, 0},
    {0, 0, 0,  0, 0}
};
static PyObject *
__Pyx_CyFunction_reduce(__pyx_CyFunctionObject *m, CYTHON_UNUSED PyObject *args)
{
#if PY_MAJOR_VERSION >= 3
    return PyUnicode_FromString(m->func.m_ml->ml_name);
#else
    return PyString_FromString(m->func.m_ml->ml_name);
#endif
}
static PyMethodDef __pyx_CyFunction_methods[] = {
    {__Pyx_NAMESTR("__reduce__"), (PyCFunction)__Pyx_CyFunction_reduce, METH_VARARGS, 0},
    {0, 0, 0, 0}
};
static PyObject *__Pyx_CyFunction_New(PyTypeObject *type, PyMethodDef *ml, int flags, PyObject* qualname,
                                      PyObject *closure, PyObject *module, PyObject* code) {
    __pyx_CyFunctionObject *op = PyObject_GC_New(__pyx_CyFunctionObject, type);
    if (op == NULL)
        return NULL;
    op->flags = flags;
    op->func_weakreflist = NULL;
    op->func.m_ml = ml;
    op->func.m_self = (PyObject *) op;
    Py_XINCREF(closure);
    op->func_closure = closure;
    Py_XINCREF(module);
    op->func.m_module = module;
    op->func_dict = NULL;
    op->func_name = NULL;
    Py_INCREF(qualname);
    op->func_qualname = qualname;
    op->func_doc = NULL;
    op->func_classobj = NULL;
    Py_XINCREF(code);
    op->func_code = code;
    op->defaults_pyobjects = 0;
    op->defaults = NULL;
    op->defaults_tuple = NULL;
    op->defaults_kwdict = NULL;
    op->defaults_getter = NULL;
    op->func_annotations = NULL;
    PyObject_GC_Track(op);
    return (PyObject *) op;
}
static int
__Pyx_CyFunction_clear(__pyx_CyFunctionObject *m)
{
    Py_CLEAR(m->func_closure);
    Py_CLEAR(m->func.m_module);
    Py_CLEAR(m->func_dict);
    Py_CLEAR(m->func_name);
    Py_CLEAR(m->func_qualname);
    Py_CLEAR(m->func_doc);
    Py_CLEAR(m->func_code);
    Py_CLEAR(m->func_classobj);
    Py_CLEAR(m->defaults_tuple);
    Py_CLEAR(m->defaults_kwdict);
    Py_CLEAR(m->func_annotations);
    if (m->defaults) {
        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
        int i;
        for (i = 0; i < m->defaults_pyobjects; i++)
            Py_XDECREF(pydefaults[i]);
        PyMem_Free(m->defaults);
        m->defaults = NULL;
    }
    return 0;
}
static void __Pyx_CyFunction_dealloc(__pyx_CyFunctionObject *m)
{
    PyObject_GC_UnTrack(m);
    if (m->func_weakreflist != NULL)
        PyObject_ClearWeakRefs((PyObject *) m);
    __Pyx_CyFunction_clear(m);
    PyObject_GC_Del(m);
}
static int __Pyx_CyFunction_traverse(__pyx_CyFunctionObject *m, visitproc visit, void *arg)
{
    Py_VISIT(m->func_closure);
    Py_VISIT(m->func.m_module);
    Py_VISIT(m->func_dict);
    Py_VISIT(m->func_name);
    Py_VISIT(m->func_qualname);
    Py_VISIT(m->func_doc);
    Py_VISIT(m->func_code);
    Py_VISIT(m->func_classobj);
    Py_VISIT(m->defaults_tuple);
    Py_VISIT(m->defaults_kwdict);
    if (m->defaults) {
        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
        int i;
        for (i = 0; i < m->defaults_pyobjects; i++)
            Py_VISIT(pydefaults[i]);
    }
    return 0;
}
static PyObject *__Pyx_CyFunction_descr_get(PyObject *func, PyObject *obj, PyObject *type)
{
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    if (m->flags & __Pyx_CYFUNCTION_STATICMETHOD) {
        Py_INCREF(func);
        return func;
    }
    if (m->flags & __Pyx_CYFUNCTION_CLASSMETHOD) {
        if (type == NULL)
            type = (PyObject *)(Py_TYPE(obj));
        return PyMethod_New(func,
                            type, (PyObject *)(Py_TYPE(type)));
    }
    if (obj == Py_None)
        obj = NULL;
    return PyMethod_New(func, obj, type);
}
static PyObject*
__Pyx_CyFunction_repr(__pyx_CyFunctionObject *op)
{
#if PY_MAJOR_VERSION >= 3
    return PyUnicode_FromFormat("<cyfunction %U at %p>",
                                op->func_qualname, (void *)op);
#else
    return PyString_FromFormat("<cyfunction %s at %p>",
                               PyString_AsString(op->func_qualname), (void *)op);
#endif
}
#if CYTHON_COMPILING_IN_PYPY
static PyObject * __Pyx_CyFunction_Call(PyObject *func, PyObject *arg, PyObject *kw) {
    PyCFunctionObject* f = (PyCFunctionObject*)func;
    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
    PyObject *self = PyCFunction_GET_SELF(func);
    Py_ssize_t size;
    switch (PyCFunction_GET_FLAGS(func) & ~(METH_CLASS | METH_STATIC | METH_COEXIST)) {
    case METH_VARARGS:
        if (likely(kw == NULL) || PyDict_Size(kw) == 0)
            return (*meth)(self, arg);
        break;
    case METH_VARARGS | METH_KEYWORDS:
        return (*(PyCFunctionWithKeywords)meth)(self, arg, kw);
    case METH_NOARGS:
        if (likely(kw == NULL) || PyDict_Size(kw) == 0) {
            size = PyTuple_GET_SIZE(arg);
            if (size == 0)
                return (*meth)(self, NULL);
            PyErr_Format(PyExc_TypeError,
                "%.200s() takes no arguments (%zd given)",
                f->m_ml->ml_name, size);
            return NULL;
        }
        break;
    case METH_O:
        if (likely(kw == NULL) || PyDict_Size(kw) == 0) {
            size = PyTuple_GET_SIZE(arg);
            if (size == 1)
                return (*meth)(self, PyTuple_GET_ITEM(arg, 0));
            PyErr_Format(PyExc_TypeError,
                "%.200s() takes exactly one argument (%zd given)",
                f->m_ml->ml_name, size);
            return NULL;
        }
        break;
    default:
        PyErr_SetString(PyExc_SystemError, "Bad call flags in "
                        "__Pyx_CyFunction_Call. METH_OLDARGS is no "
                        "longer supported!");
        return NULL;
    }
    PyErr_Format(PyExc_TypeError, "%.200s() takes no keyword arguments",
                 f->m_ml->ml_name);
    return NULL;
}
#else
static PyObject * __Pyx_CyFunction_Call(PyObject *func, PyObject *arg, PyObject *kw) {
	return PyCFunction_Call(func, arg, kw);
}
#endif
static PyTypeObject __pyx_CyFunctionType_type = {
    PyVarObject_HEAD_INIT(0, 0)
    __Pyx_NAMESTR("cython_function_or_method"), /*tp_name*/
    sizeof(__pyx_CyFunctionObject),   /*tp_basicsize*/
    0,                                  /*tp_itemsize*/
    (destructor) __Pyx_CyFunction_dealloc, /*tp_dealloc*/
    0,                                  /*tp_print*/
    0,                                  /*tp_getattr*/
    0,                                  /*tp_setattr*/
#if PY_MAJOR_VERSION < 3
    0,                                  /*tp_compare*/
#else
    0,                                  /*reserved*/
#endif
    (reprfunc) __Pyx_CyFunction_repr,   /*tp_repr*/
    0,                                  /*tp_as_number*/
    0,                                  /*tp_as_sequence*/
    0,                                  /*tp_as_mapping*/
    0,                                  /*tp_hash*/
    __Pyx_CyFunction_Call,              /*tp_call*/
    0,                                  /*tp_str*/
    0,                                  /*tp_getattro*/
    0,                                  /*tp_setattro*/
    0,                                  /*tp_as_buffer*/
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC, /* tp_flags*/
    0,                                  /*tp_doc*/
    (traverseproc) __Pyx_CyFunction_traverse,   /*tp_traverse*/
    (inquiry) __Pyx_CyFunction_clear,   /*tp_clear*/
    0,                                  /*tp_richcompare*/
    offsetof(__pyx_CyFunctionObject, func_weakreflist), /* tp_weaklistoffse */
    0,                                  /*tp_iter*/
    0,                                  /*tp_iternext*/
    __pyx_CyFunction_methods,           /*tp_methods*/
    __pyx_CyFunction_members,           /*tp_members*/
    __pyx_CyFunction_getsets,           /*tp_getset*/
    0,                                  /*tp_base*/
    0,                                  /*tp_dict*/
    __Pyx_CyFunction_descr_get,         /*tp_descr_get*/
    0,                                  /*tp_descr_set*/
    offsetof(__pyx_CyFunctionObject, func_dict),/*tp_dictoffset*/
    0,                                  /*tp_init*/
    0,                                  /*tp_alloc*/
    0,                                  /*tp_new*/
    0,                                  /*tp_free*/
    0,                                  /*tp_is_gc*/
    0,                                  /*tp_bases*/
    0,                                  /*tp_mro*/
    0,                                  /*tp_cache*/
    0,                                  /*tp_subclasses*/
    0,                                  /*tp_weaklist*/
    0,                                  /*tp_del*/
#if PY_VERSION_HEX >= 0x02060000
    0,                                  /*tp_version_tag*/
#endif
};
static int __Pyx_CyFunction_init(void) {
#if !CYTHON_COMPILING_IN_PYPY
    __pyx_CyFunctionType_type.tp_call = PyCFunction_Call;
#endif
    if (PyType_Ready(&__pyx_CyFunctionType_type) < 0)
        return -1;
    __pyx_CyFunctionType = &__pyx_CyFunctionType_type;
    return 0;
}
static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *func, size_t size, int pyobjects) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults = PyMem_Malloc(size);
    if (!m->defaults)
        return PyErr_NoMemory();
    memset(m->defaults, 0, size);
    m->defaults_pyobjects = pyobjects;
    return m->defaults;
}
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *func, PyObject *tuple) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults_tuple = tuple;
    Py_INCREF(tuple);
}
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *func, PyObject *dict) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults_kwdict = dict;
    Py_INCREF(dict);
}
static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *func, PyObject *dict) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->func_annotations = dict;
    Py_INCREF(dict);
}

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact)
{
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (none_allowed && obj == Py_None) return 1;
    else if (exact) {
        if (Py_TYPE(obj) == type) return 1;
    }
    else {
        if (PyObject_TypeCheck(obj, type)) return 1;
    }
    PyErr_Format(PyExc_TypeError,
        "Argument '%s' has incorrect type (expected %s, got %s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
    return 0;
}

static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
    PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
    if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
        PyErr_Format(PyExc_ImportError,
        #if PY_MAJOR_VERSION < 3
            "cannot import name %.230s", PyString_AS_STRING(name));
        #else
            "cannot import name %S", name);
        #endif
    }
    return value;
}

static CYTHON_INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
#else
    PyErr_GetExcInfo(type, value, tb);
#endif
}
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(type, value, tb);
#endif
}

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    #if PY_VERSION_HEX < 0x03030000
    PyObject *py_import;
    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s____import__);
    if (!py_import)
        goto bad;
    #endif
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    #if PY_VERSION_HEX >= 0x02050000
    {
        #if PY_MAJOR_VERSION >= 3
        if (level == -1) {
            if (strchr(__Pyx_MODULE_NAME, '.')) {
                #if PY_VERSION_HEX < 0x03030000
                PyObject *py_level = PyInt_FromLong(1);
                if (!py_level)
                    goto bad;
                module = PyObject_CallFunctionObjArgs(py_import,
                    name, global_dict, empty_dict, list, py_level, NULL);
                Py_DECREF(py_level);
                #else
                module = PyImport_ImportModuleLevelObject(
                    name, global_dict, empty_dict, list, 1);
                #endif
                if (!module) {
                    if (!PyErr_ExceptionMatches(PyExc_ImportError))
                        goto bad;
                    PyErr_Clear();
                }
            }
            level = 0; /* try absolute import on failure */
        }
        #endif
        if (!module) {
            #if PY_VERSION_HEX < 0x03030000
            PyObject *py_level = PyInt_FromLong(level);
            if (!py_level)
                goto bad;
            module = PyObject_CallFunctionObjArgs(py_import,
                name, global_dict, empty_dict, list, py_level, NULL);
            Py_DECREF(py_level);
            #else
            module = PyImport_ImportModuleLevelObject(
                name, global_dict, empty_dict, list, level);
            #endif
        }
    }
    #else
    if (level>0) {
        PyErr_SetString(PyExc_RuntimeError, "Relative import is not supported for Python <=2.4.");
        goto bad;
    }
    module = PyObject_CallFunctionObjArgs(py_import,
        name, global_dict, empty_dict, list, NULL);
    #endif
bad:
    #if PY_VERSION_HEX < 0x03030000
    Py_XDECREF(py_import);
    #endif
    Py_XDECREF(empty_list);
    Py_XDECREF(empty_dict);
    return module;
}

static PyObject *__Pyx_FindPy2Metaclass(PyObject *bases) {
    PyObject *metaclass;
#if PY_MAJOR_VERSION < 3
    if (PyTuple_Check(bases) && PyTuple_GET_SIZE(bases) > 0) {
        PyObject *base = PyTuple_GET_ITEM(bases, 0);
        metaclass = __Pyx_PyObject_GetAttrStr(base, __pyx_n_s____class__);
        if (!metaclass) {
            PyErr_Clear();
            metaclass = (PyObject*) Py_TYPE(base);
        }
    } else {
        metaclass = (PyObject *) &PyClass_Type;
    }
#else
    if (PyTuple_Check(bases) && PyTuple_GET_SIZE(bases) > 0) {
        PyObject *base = PyTuple_GET_ITEM(bases, 0);
        metaclass = (PyObject*) Py_TYPE(base);
    } else {
        metaclass = (PyObject *) &PyType_Type;
    }
#endif
    Py_INCREF(metaclass);
    return metaclass;
}

static PyObject *__Pyx_CreateClass(PyObject *bases, PyObject *dict, PyObject *name,
                                   PyObject *qualname, PyObject *modname) {
    PyObject *result;
    PyObject *metaclass;
    if (PyDict_SetItem(dict, __pyx_n_s____module__, modname) < 0)
        return NULL;
    if (PyDict_SetItem(dict, __pyx_n_s____qualname__, qualname) < 0)
        return NULL;
    metaclass = PyDict_GetItem(dict, __pyx_n_s____metaclass__);
    if (metaclass) {
        Py_INCREF(metaclass);
    } else {
        metaclass = __Pyx_FindPy2Metaclass(bases);
    }
    result = PyObject_CallFunctionObjArgs(metaclass, name, bases, dict, NULL);
    Py_DECREF(metaclass);
    return result;
}

static CYTHON_INLINE uint64_t __Pyx_PyInt_from_py_uint64_t(PyObject* x) {
    const uint64_t neg_one = (uint64_t)-1, const_zero = (uint64_t)0;
    const int is_unsigned = const_zero < neg_one;
    if (sizeof(uint64_t) == sizeof(char)) {
        if (is_unsigned)
            return (uint64_t)__Pyx_PyInt_AsUnsignedChar(x);
        else
            return (uint64_t)__Pyx_PyInt_AsSignedChar(x);
    } else if (sizeof(uint64_t) == sizeof(short)) {
        if (is_unsigned)
            return (uint64_t)__Pyx_PyInt_AsUnsignedShort(x);
        else
            return (uint64_t)__Pyx_PyInt_AsSignedShort(x);
    } else if (sizeof(uint64_t) == sizeof(int)) {
        if (is_unsigned)
            return (uint64_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (uint64_t)__Pyx_PyInt_AsSignedInt(x);
    } else if (sizeof(uint64_t) == sizeof(long)) {
        if (is_unsigned)
            return (uint64_t)__Pyx_PyInt_AsUnsignedLong(x);
        else
            return (uint64_t)__Pyx_PyInt_AsSignedLong(x);
    } else if (sizeof(uint64_t) == sizeof(PY_LONG_LONG)) {
        if (is_unsigned)
            return (uint64_t)__Pyx_PyInt_AsUnsignedLongLong(x);
        else
            return (uint64_t)__Pyx_PyInt_AsSignedLongLong(x);
    }  else {
        #if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
        PyErr_SetString(PyExc_RuntimeError,
                        "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
        #else
        uint64_t val;
        PyObject *v = __Pyx_PyNumber_Int(x);
        #if PY_MAJOR_VERSION < 3
        if (likely(v) && !PyLong_Check(v)) {
            PyObject *tmp = v;
            v = PyNumber_Long(tmp);
            Py_DECREF(tmp);
        }
        #endif
        if (likely(v)) {
            int one = 1; int is_little = (int)*(unsigned char *)&one;
            unsigned char *bytes = (unsigned char *)&val;
            int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                          bytes, sizeof(val),
                                          is_little, !is_unsigned);
            Py_DECREF(v);
            if (likely(!ret))
                return val;
        }
        #endif
        return (uint64_t)-1;
    }
}

static CYTHON_INLINE PyObject *__Pyx_PyInt_to_py_time_t(time_t val) {
    const time_t neg_one = (time_t)-1, const_zero = (time_t)0;
    const int is_unsigned = const_zero < neg_one;
    if ((sizeof(time_t) == sizeof(char))  ||
        (sizeof(time_t) == sizeof(short))) {
        return PyInt_FromLong((long)val);
    } else if ((sizeof(time_t) == sizeof(int)) ||
               (sizeof(time_t) == sizeof(long))) {
        if (is_unsigned)
            return PyLong_FromUnsignedLong((unsigned long)val);
        else
            return PyInt_FromLong((long)val);
    } else if (sizeof(time_t) == sizeof(PY_LONG_LONG)) {
        if (is_unsigned)
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG)val);
        else
            return PyLong_FromLongLong((PY_LONG_LONG)val);
    } else {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&val;
        return _PyLong_FromByteArray(bytes, sizeof(time_t),
                                     little, !is_unsigned);
    }
}

static CYTHON_INLINE PyObject *__Pyx_PyInt_to_py_uint64_t(uint64_t val) {
    const uint64_t neg_one = (uint64_t)-1, const_zero = (uint64_t)0;
    const int is_unsigned = const_zero < neg_one;
    if ((sizeof(uint64_t) == sizeof(char))  ||
        (sizeof(uint64_t) == sizeof(short))) {
        return PyInt_FromLong((long)val);
    } else if ((sizeof(uint64_t) == sizeof(int)) ||
               (sizeof(uint64_t) == sizeof(long))) {
        if (is_unsigned)
            return PyLong_FromUnsignedLong((unsigned long)val);
        else
            return PyInt_FromLong((long)val);
    } else if (sizeof(uint64_t) == sizeof(PY_LONG_LONG)) {
        if (is_unsigned)
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG)val);
        else
            return PyLong_FromLongLong((PY_LONG_LONG)val);
    } else {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&val;
        return _PyLong_FromByteArray(bytes, sizeof(uint64_t),
                                     little, !is_unsigned);
    }
}

static CYTHON_INLINE uint8_t __Pyx_PyInt_from_py_uint8_t(PyObject* x) {
    const uint8_t neg_one = (uint8_t)-1, const_zero = (uint8_t)0;
    const int is_unsigned = const_zero < neg_one;
    if (sizeof(uint8_t) == sizeof(char)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedChar(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedChar(x);
    } else if (sizeof(uint8_t) == sizeof(short)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedShort(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedShort(x);
    } else if (sizeof(uint8_t) == sizeof(int)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedInt(x);
    } else if (sizeof(uint8_t) == sizeof(long)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedLong(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedLong(x);
    } else if (sizeof(uint8_t) == sizeof(PY_LONG_LONG)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedLongLong(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedLongLong(x);
    }  else {
        #if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
        PyErr_SetString(PyExc_RuntimeError,
                        "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
        #else
        uint8_t val;
        PyObject *v = __Pyx_PyNumber_Int(x);
        #if PY_MAJOR_VERSION < 3
        if (likely(v) && !PyLong_Check(v)) {
            PyObject *tmp = v;
            v = PyNumber_Long(tmp);
            Py_DECREF(tmp);
        }
        #endif
        if (likely(v)) {
            int one = 1; int is_little = (int)*(unsigned char *)&one;
            unsigned char *bytes = (unsigned char *)&val;
            int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                          bytes, sizeof(val),
                                          is_little, !is_unsigned);
            Py_DECREF(v);
            if (likely(!ret))
                return val;
        }
        #endif
        return (uint8_t)-1;
    }
}

static CYTHON_INLINE uint32_t __Pyx_PyInt_from_py_uint32_t(PyObject* x) {
    const uint32_t neg_one = (uint32_t)-1, const_zero = (uint32_t)0;
    const int is_unsigned = const_zero < neg_one;
    if (sizeof(uint32_t) == sizeof(char)) {
        if (is_unsigned)
            return (uint32_t)__Pyx_PyInt_AsUnsignedChar(x);
        else
            return (uint32_t)__Pyx_PyInt_AsSignedChar(x);
    } else if (sizeof(uint32_t) == sizeof(short)) {
        if (is_unsigned)
            return (uint32_t)__Pyx_PyInt_AsUnsignedShort(x);
        else
            return (uint32_t)__Pyx_PyInt_AsSignedShort(x);
    } else if (sizeof(uint32_t) == sizeof(int)) {
        if (is_unsigned)
            return (uint32_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (uint32_t)__Pyx_PyInt_AsSignedInt(x);
    } else if (sizeof(uint32_t) == sizeof(long)) {
        if (is_unsigned)
            return (uint32_t)__Pyx_PyInt_AsUnsignedLong(x);
        else
            return (uint32_t)__Pyx_PyInt_AsSignedLong(x);
    } else if (sizeof(uint32_t) == sizeof(PY_LONG_LONG)) {
        if (is_unsigned)
            return (uint32_t)__Pyx_PyInt_AsUnsignedLongLong(x);
        else
            return (uint32_t)__Pyx_PyInt_AsSignedLongLong(x);
    }  else {
        #if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
        PyErr_SetString(PyExc_RuntimeError,
                        "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
        #else
        uint32_t val;
        PyObject *v = __Pyx_PyNumber_Int(x);
        #if PY_MAJOR_VERSION < 3
        if (likely(v) && !PyLong_Check(v)) {
            PyObject *tmp = v;
            v = PyNumber_Long(tmp);
            Py_DECREF(tmp);
        }
        #endif
        if (likely(v)) {
            int one = 1; int is_little = (int)*(unsigned char *)&one;
            unsigned char *bytes = (unsigned char *)&val;
            int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                          bytes, sizeof(val),
                                          is_little, !is_unsigned);
            Py_DECREF(v);
            if (likely(!ret))
                return val;
        }
        #endif
        return (uint32_t)-1;
    }
}

static CYTHON_INLINE int __Pyx_ErrOccurredWithGIL(void) {
  int err;
  #ifdef WITH_THREAD
  PyGILState_STATE _save = PyGILState_Ensure();
  #endif
  err = !!PyErr_Occurred();
  #ifdef WITH_THREAD
  PyGILState_Release(_save);
  #endif
  return err;
}

static CYTHON_INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject* x) {
    const unsigned char neg_one = (unsigned char)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(unsigned char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned char)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to unsigned char" :
                    "value too large to convert to unsigned char");
            }
            return (unsigned char)-1;
        }
        return (unsigned char)val;
    }
    return (unsigned char)__Pyx_PyInt_AsUnsignedLong(x);
}

static CYTHON_INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject* x) {
    const unsigned short neg_one = (unsigned short)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(unsigned short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned short)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to unsigned short" :
                    "value too large to convert to unsigned short");
            }
            return (unsigned short)-1;
        }
        return (unsigned short)val;
    }
    return (unsigned short)__Pyx_PyInt_AsUnsignedLong(x);
}

static CYTHON_INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject* x) {
    const unsigned int neg_one = (unsigned int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(unsigned int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to unsigned int" :
                    "value too large to convert to unsigned int");
            }
            return (unsigned int)-1;
        }
        return (unsigned int)val;
    }
    return (unsigned int)__Pyx_PyInt_AsUnsignedLong(x);
}

static CYTHON_INLINE char __Pyx_PyInt_AsChar(PyObject* x) {
    const char neg_one = (char)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(char)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to char" :
                    "value too large to convert to char");
            }
            return (char)-1;
        }
        return (char)val;
    }
    return (char)__Pyx_PyInt_AsLong(x);
}

static CYTHON_INLINE short __Pyx_PyInt_AsShort(PyObject* x) {
    const short neg_one = (short)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(short)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to short" :
                    "value too large to convert to short");
            }
            return (short)-1;
        }
        return (short)val;
    }
    return (short)__Pyx_PyInt_AsLong(x);
}

static CYTHON_INLINE int __Pyx_PyInt_AsInt(PyObject* x) {
    const int neg_one = (int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to int" :
                    "value too large to convert to int");
            }
            return (int)-1;
        }
        return (int)val;
    }
    return (int)__Pyx_PyInt_AsLong(x);
}

static CYTHON_INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject* x) {
    const signed char neg_one = (signed char)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(signed char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed char)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to signed char" :
                    "value too large to convert to signed char");
            }
            return (signed char)-1;
        }
        return (signed char)val;
    }
    return (signed char)__Pyx_PyInt_AsSignedLong(x);
}

static CYTHON_INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject* x) {
    const signed short neg_one = (signed short)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(signed short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed short)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to signed short" :
                    "value too large to convert to signed short");
            }
            return (signed short)-1;
        }
        return (signed short)val;
    }
    return (signed short)__Pyx_PyInt_AsSignedLong(x);
}

static CYTHON_INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject* x) {
    const signed int neg_one = (signed int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(signed int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to signed int" :
                    "value too large to convert to signed int");
            }
            return (signed int)-1;
        }
        return (signed int)val;
    }
    return (signed int)__Pyx_PyInt_AsSignedLong(x);
}

static CYTHON_INLINE int __Pyx_PyInt_AsLongDouble(PyObject* x) {
    const int neg_one = (int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to int" :
                    "value too large to convert to int");
            }
            return (int)-1;
        }
        return (int)val;
    }
    return (int)__Pyx_PyInt_AsLong(x);
}

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
#include "longintrepr.h"
#endif
#endif
static CYTHON_INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject* x) {
    const unsigned long neg_one = (unsigned long)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned long");
            return (unsigned long)-1;
        }
        return (unsigned long)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(unsigned long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (unsigned long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned long");
                return (unsigned long)-1;
            }
            return (unsigned long)PyLong_AsUnsignedLong(x);
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(unsigned long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(unsigned long) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(unsigned long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            return (unsigned long)PyLong_AsLong(x);
        }
    } else {
        unsigned long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned long)-1;
        val = __Pyx_PyInt_AsUnsignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
#include "longintrepr.h"
#endif
#endif
static CYTHON_INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject* x) {
    const unsigned PY_LONG_LONG neg_one = (unsigned PY_LONG_LONG)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned PY_LONG_LONG");
            return (unsigned PY_LONG_LONG)-1;
        }
        return (unsigned PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(unsigned PY_LONG_LONG)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (unsigned PY_LONG_LONG) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned PY_LONG_LONG");
                return (unsigned PY_LONG_LONG)-1;
            }
            return (unsigned PY_LONG_LONG)PyLong_AsUnsignedLongLong(x);
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(unsigned PY_LONG_LONG)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(unsigned PY_LONG_LONG) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(unsigned PY_LONG_LONG) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            return (unsigned PY_LONG_LONG)PyLong_AsLongLong(x);
        }
    } else {
        unsigned PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsUnsignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
#include "longintrepr.h"
#endif
#endif
static CYTHON_INLINE long __Pyx_PyInt_AsLong(PyObject* x) {
    const long neg_one = (long)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to long");
            return (long)-1;
        }
        return (long)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to long");
                return (long)-1;
            }
            return (long)PyLong_AsUnsignedLong(x);
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(long) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            return (long)PyLong_AsLong(x);
        }
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (long)-1;
        val = __Pyx_PyInt_AsLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
#include "longintrepr.h"
#endif
#endif
static CYTHON_INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject* x) {
    const PY_LONG_LONG neg_one = (PY_LONG_LONG)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to PY_LONG_LONG");
            return (PY_LONG_LONG)-1;
        }
        return (PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(PY_LONG_LONG)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (PY_LONG_LONG) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to PY_LONG_LONG");
                return (PY_LONG_LONG)-1;
            }
            return (PY_LONG_LONG)PyLong_AsUnsignedLongLong(x);
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(PY_LONG_LONG)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(PY_LONG_LONG) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(PY_LONG_LONG) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            return (PY_LONG_LONG)PyLong_AsLongLong(x);
        }
    } else {
        PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
#include "longintrepr.h"
#endif
#endif
static CYTHON_INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject* x) {
    const signed long neg_one = (signed long)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to signed long");
            return (signed long)-1;
        }
        return (signed long)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(signed long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (signed long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to signed long");
                return (signed long)-1;
            }
            return (signed long)PyLong_AsUnsignedLong(x);
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(signed long)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(signed long) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(signed long) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            return (signed long)PyLong_AsLong(x);
        }
    } else {
        signed long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed long)-1;
        val = __Pyx_PyInt_AsSignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
#include "longintrepr.h"
#endif
#endif
static CYTHON_INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject* x) {
    const signed PY_LONG_LONG neg_one = (signed PY_LONG_LONG)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to signed PY_LONG_LONG");
            return (signed PY_LONG_LONG)-1;
        }
        return (signed PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(signed PY_LONG_LONG)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return (signed PY_LONG_LONG) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to signed PY_LONG_LONG");
                return (signed PY_LONG_LONG)-1;
            }
            return (signed PY_LONG_LONG)PyLong_AsUnsignedLongLong(x);
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#if CYTHON_USE_PYLONG_INTERNALS
            if (sizeof(digit) <= sizeof(signed PY_LONG_LONG)) {
                switch (Py_SIZE(x)) {
                    case  0: return 0;
                    case  1: return +(signed PY_LONG_LONG) ((PyLongObject*)x)->ob_digit[0];
                    case -1: return -(signed PY_LONG_LONG) ((PyLongObject*)x)->ob_digit[0];
                }
            }
#endif
#endif
            return (signed PY_LONG_LONG)PyLong_AsLongLong(x);
        }
    } else {
        signed PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsSignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
                                  CYTHON_UNUSED int lineno, CYTHON_UNUSED const char *filename) {
    PyObject *old_exc, *old_val, *old_tb;
    PyObject *ctx;
    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
    #if PY_MAJOR_VERSION < 3
    ctx = PyString_FromString(name);
    #else
    ctx = PyUnicode_FromString(name);
    #endif
    __Pyx_ErrRestore(old_exc, old_val, old_tb);
    if (!ctx) {
        PyErr_WriteUnraisable(Py_None);
    } else {
        PyErr_WriteUnraisable(ctx);
        Py_DECREF(ctx);
    }
}

static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
#if CYTHON_COMPILING_IN_CPYTHON
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = *type;
    tstate->exc_value = *value;
    tstate->exc_traceback = *tb;
#else
    PyErr_GetExcInfo(&tmp_type, &tmp_value, &tmp_tb);
    PyErr_SetExcInfo(*type, *value, *tb);
#endif
    *type = tmp_type;
    *value = tmp_value;
    *tb = tmp_tb;
}

static PyObject *__Pyx_Generator_Next(PyObject *self);
static PyObject *__Pyx_Generator_Send(PyObject *self, PyObject *value);
static PyObject *__Pyx_Generator_Close(PyObject *self);
static PyObject *__Pyx_Generator_Throw(PyObject *gen, PyObject *args);
static PyTypeObject *__pyx_GeneratorType = 0;
#define __Pyx_Generator_CheckExact(obj) (Py_TYPE(obj) == __pyx_GeneratorType)
#define __Pyx_Generator_Undelegate(gen) Py_CLEAR((gen)->yieldfrom)
#if 1 || PY_VERSION_HEX < 0x030300B0
static int __Pyx_PyGen_FetchStopIterationValue(PyObject **pvalue) {
    PyObject *et, *ev, *tb;
    PyObject *value = NULL;
    __Pyx_ErrFetch(&et, &ev, &tb);
    if (!et) {
        Py_XDECREF(tb);
        Py_XDECREF(ev);
        Py_INCREF(Py_None);
        *pvalue = Py_None;
        return 0;
    }
    if (unlikely(et != PyExc_StopIteration) &&
            unlikely(!PyErr_GivenExceptionMatches(et, PyExc_StopIteration))) {
        __Pyx_ErrRestore(et, ev, tb);
        return -1;
    }
    if (likely(et == PyExc_StopIteration)) {
        if (likely(!ev) || !PyObject_IsInstance(ev, PyExc_StopIteration)) {
            if (!ev) {
                Py_INCREF(Py_None);
                ev = Py_None;
            }
            Py_XDECREF(tb);
            Py_DECREF(et);
            *pvalue = ev;
            return 0;
        }
    }
    PyErr_NormalizeException(&et, &ev, &tb);
    if (unlikely(!PyObject_IsInstance(ev, PyExc_StopIteration))) {
        __Pyx_ErrRestore(et, ev, tb);
        return -1;
    }
    Py_XDECREF(tb);
    Py_DECREF(et);
#if PY_VERSION_HEX >= 0x030300A0
    value = ((PyStopIterationObject *)ev)->value;
    Py_INCREF(value);
    Py_DECREF(ev);
#else
    {
        PyObject* args = PyObject_GetAttr(ev, __pyx_n_s__args);
        Py_DECREF(ev);
        if (likely(args)) {
            value = PyObject_GetItem(args, 0);
            Py_DECREF(args);
        }
        if (unlikely(!value)) {
            __Pyx_ErrRestore(NULL, NULL, NULL);
            Py_INCREF(Py_None);
            value = Py_None;
        }
    }
#endif
    *pvalue = value;
    return 0;
}
#endif
static CYTHON_INLINE
void __Pyx_Generator_ExceptionClear(__pyx_GeneratorObject *self) {
    PyObject *exc_type = self->exc_type;
    PyObject *exc_value = self->exc_value;
    PyObject *exc_traceback = self->exc_traceback;
    self->exc_type = NULL;
    self->exc_value = NULL;
    self->exc_traceback = NULL;
    Py_XDECREF(exc_type);
    Py_XDECREF(exc_value);
    Py_XDECREF(exc_traceback);
}
static CYTHON_INLINE
int __Pyx_Generator_CheckRunning(__pyx_GeneratorObject *gen) {
    if (unlikely(gen->is_running)) {
        PyErr_SetString(PyExc_ValueError,
                        "generator already executing");
        return 1;
    }
    return 0;
}
static CYTHON_INLINE
PyObject *__Pyx_Generator_SendEx(__pyx_GeneratorObject *self, PyObject *value) {
    PyObject *retval;
    assert(!self->is_running);
    if (unlikely(self->resume_label == 0)) {
        if (unlikely(value && value != Py_None)) {
            PyErr_SetString(PyExc_TypeError,
                            "can't send non-None value to a "
                            "just-started generator");
            return NULL;
        }
    }
    if (unlikely(self->resume_label == -1)) {
        PyErr_SetNone(PyExc_StopIteration);
        return NULL;
    }
    if (value) {
#if CYTHON_COMPILING_IN_PYPY
#else
        /* Generators always return to their most recent caller, not
         * necessarily their creator. */
        if (self->exc_traceback) {
            PyThreadState *tstate = PyThreadState_GET();
            PyTracebackObject *tb = (PyTracebackObject *) self->exc_traceback;
            PyFrameObject *f = tb->tb_frame;
            Py_XINCREF(tstate->frame);
            assert(f->f_back == NULL);
            f->f_back = tstate->frame;
        }
#endif
        __Pyx_ExceptionSwap(&self->exc_type, &self->exc_value,
                            &self->exc_traceback);
    } else {
        __Pyx_Generator_ExceptionClear(self);
    }
    self->is_running = 1;
    retval = self->body((PyObject *) self, value);
    self->is_running = 0;
    if (retval) {
        __Pyx_ExceptionSwap(&self->exc_type, &self->exc_value,
                            &self->exc_traceback);
#if CYTHON_COMPILING_IN_PYPY
#else
        /* Don't keep the reference to f_back any longer than necessary.  It
         * may keep a chain of frames alive or it could create a reference
         * cycle. */
        if (self->exc_traceback) {
            PyTracebackObject *tb = (PyTracebackObject *) self->exc_traceback;
            PyFrameObject *f = tb->tb_frame;
            Py_CLEAR(f->f_back);
        }
#endif
    } else {
        __Pyx_Generator_ExceptionClear(self);
    }
    return retval;
}
static CYTHON_INLINE
PyObject *__Pyx_Generator_FinishDelegation(__pyx_GeneratorObject *gen) {
    PyObject *ret;
    PyObject *val = NULL;
    __Pyx_Generator_Undelegate(gen);
    __Pyx_PyGen_FetchStopIterationValue(&val);
    ret = __Pyx_Generator_SendEx(gen, val);
    Py_XDECREF(val);
    return ret;
}
static PyObject *__Pyx_Generator_Next(PyObject *self) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject*) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(__Pyx_Generator_CheckRunning(gen)))
        return NULL;
    if (yf) {
        PyObject *ret;
        gen->is_running = 1;
        ret = Py_TYPE(yf)->tp_iternext(yf);
        gen->is_running = 0;
        if (likely(ret)) {
            return ret;
        }
        return __Pyx_Generator_FinishDelegation(gen);
    }
    return __Pyx_Generator_SendEx(gen, Py_None);
}
static PyObject *__Pyx_Generator_Send(PyObject *self, PyObject *value) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject*) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(__Pyx_Generator_CheckRunning(gen)))
        return NULL;
    if (yf) {
        PyObject *ret;
        gen->is_running = 1;
        if (__Pyx_Generator_CheckExact(yf)) {
            ret = __Pyx_Generator_Send(yf, value);
        } else {
            if (value == Py_None)
                ret = PyIter_Next(yf);
            else
                ret = __Pyx_PyObject_CallMethod1(yf, __pyx_n_s__send, value);
        }
        gen->is_running = 0;
        if (likely(ret)) {
            return ret;
        }
        return __Pyx_Generator_FinishDelegation(gen);
    }
    return __Pyx_Generator_SendEx(gen, value);
}
static int __Pyx_Generator_CloseIter(__pyx_GeneratorObject *gen, PyObject *yf) {
    PyObject *retval = NULL;
    int err = 0;
    if (__Pyx_Generator_CheckExact(yf)) {
        retval = __Pyx_Generator_Close(yf);
        if (!retval)
            return -1;
    } else {
        PyObject *meth;
        gen->is_running = 1;
        meth = PyObject_GetAttr(yf, __pyx_n_s__close);
        if (unlikely(!meth)) {
            if (!PyErr_ExceptionMatches(PyExc_AttributeError)) {
                PyErr_WriteUnraisable(yf);
            }
            PyErr_Clear();
        } else {
            retval = PyObject_CallFunction(meth, NULL);
            Py_DECREF(meth);
            if (!retval)
                err = -1;
        }
        gen->is_running = 0;
    }
    Py_XDECREF(retval);
    return err;
}
static PyObject *__Pyx_Generator_Close(PyObject *self) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    PyObject *retval, *raised_exception;
    PyObject *yf = gen->yieldfrom;
    int err = 0;
    if (unlikely(__Pyx_Generator_CheckRunning(gen)))
        return NULL;
    if (yf) {
        Py_INCREF(yf);
        err = __Pyx_Generator_CloseIter(gen, yf);
        __Pyx_Generator_Undelegate(gen);
        Py_DECREF(yf);
    }
    if (err == 0)
#if PY_VERSION_HEX < 0x02050000
        PyErr_SetNone(PyExc_StopIteration);
#else
        PyErr_SetNone(PyExc_GeneratorExit);
#endif
    retval = __Pyx_Generator_SendEx(gen, NULL);
    if (retval) {
        Py_DECREF(retval);
        PyErr_SetString(PyExc_RuntimeError,
                        "generator ignored GeneratorExit");
        return NULL;
    }
    raised_exception = PyErr_Occurred();
    if (!raised_exception
        || raised_exception == PyExc_StopIteration
#if PY_VERSION_HEX >= 0x02050000
        || raised_exception == PyExc_GeneratorExit
        || PyErr_GivenExceptionMatches(raised_exception, PyExc_GeneratorExit)
#endif
        || PyErr_GivenExceptionMatches(raised_exception, PyExc_StopIteration))
    {
        if (raised_exception) PyErr_Clear();      /* ignore these errors */
        Py_INCREF(Py_None);
        return Py_None;
    }
    return NULL;
}
static PyObject *__Pyx_Generator_Throw(PyObject *self, PyObject *args) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    PyObject *typ;
    PyObject *tb = NULL;
    PyObject *val = NULL;
    PyObject *yf = gen->yieldfrom;
    if (!PyArg_UnpackTuple(args, (char *)"throw", 1, 3, &typ, &val, &tb))
        return NULL;
    if (unlikely(__Pyx_Generator_CheckRunning(gen)))
        return NULL;
    if (yf) {
        PyObject *ret;
        Py_INCREF(yf);
#if PY_VERSION_HEX >= 0x02050000
        if (PyErr_GivenExceptionMatches(typ, PyExc_GeneratorExit)) {
            int err = __Pyx_Generator_CloseIter(gen, yf);
            Py_DECREF(yf);
            __Pyx_Generator_Undelegate(gen);
            if (err < 0)
                return __Pyx_Generator_SendEx(gen, NULL);
            goto throw_here;
        }
#endif
        gen->is_running = 1;
        if (__Pyx_Generator_CheckExact(yf)) {
            ret = __Pyx_Generator_Throw(yf, args);
        } else {
            PyObject *meth = PyObject_GetAttr(yf, __pyx_n_s__throw);
            if (unlikely(!meth)) {
                Py_DECREF(yf);
                if (!PyErr_ExceptionMatches(PyExc_AttributeError)) {
                    gen->is_running = 0;
                    return NULL;
                }
                PyErr_Clear();
                __Pyx_Generator_Undelegate(gen);
                gen->is_running = 0;
                goto throw_here;
            }
            ret = PyObject_CallObject(meth, args);
            Py_DECREF(meth);
        }
        gen->is_running = 0;
        Py_DECREF(yf);
        if (!ret) {
            ret = __Pyx_Generator_FinishDelegation(gen);
        }
        return ret;
    }
throw_here:
    __Pyx_Raise(typ, val, tb, NULL);
    return __Pyx_Generator_SendEx(gen, NULL);
}
static int __Pyx_Generator_traverse(PyObject *self, visitproc visit, void *arg) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    Py_VISIT(gen->closure);
    Py_VISIT(gen->classobj);
    Py_VISIT(gen->yieldfrom);
    Py_VISIT(gen->exc_type);
    Py_VISIT(gen->exc_value);
    Py_VISIT(gen->exc_traceback);
    return 0;
}
static int __Pyx_Generator_clear(PyObject *self) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    Py_CLEAR(gen->closure);
    Py_CLEAR(gen->classobj);
    Py_CLEAR(gen->yieldfrom);
    Py_CLEAR(gen->exc_type);
    Py_CLEAR(gen->exc_value);
    Py_CLEAR(gen->exc_traceback);
    return 0;
}
static void __Pyx_Generator_dealloc(PyObject *self) {
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    PyObject_GC_UnTrack(gen);
    if (gen->gi_weakreflist != NULL)
        PyObject_ClearWeakRefs(self);
    PyObject_GC_Track(self);
    if (gen->resume_label > 0) {
        Py_TYPE(gen)->tp_del(self);
        if (self->ob_refcnt > 0)
            return;                     /* resurrected.  :( */
    }
    PyObject_GC_UnTrack(self);
    __Pyx_Generator_clear(self);
    PyObject_GC_Del(gen);
}
static void __Pyx_Generator_del(PyObject *self) {
    PyObject *res;
    PyObject *error_type, *error_value, *error_traceback;
    __pyx_GeneratorObject *gen = (__pyx_GeneratorObject *) self;
    if (gen->resume_label <= 0)
        return ;
    assert(self->ob_refcnt == 0);
    self->ob_refcnt = 1;
    __Pyx_ErrFetch(&error_type, &error_value, &error_traceback);
    res = __Pyx_Generator_Close(self);
    if (res == NULL)
        PyErr_WriteUnraisable(self);
    else
        Py_DECREF(res);
    __Pyx_ErrRestore(error_type, error_value, error_traceback);
    /* Undo the temporary resurrection; can't use DECREF here, it would
     * cause a recursive call.
     */
    assert(self->ob_refcnt > 0);
    if (--self->ob_refcnt == 0)
        return; /* this is the normal path out */
    /* close() resurrected it!  Make it look like the original Py_DECREF
     * never happened.
     */
    {
        Py_ssize_t refcnt = self->ob_refcnt;
        _Py_NewReference(self);
        self->ob_refcnt = refcnt;
    }
#if CYTHON_COMPILING_IN_CPYTHON
    assert(PyType_IS_GC(self->ob_type) &&
           _Py_AS_GC(self)->gc.gc_refs != _PyGC_REFS_UNTRACKED);
    /* If Py_REF_DEBUG, _Py_NewReference bumped _Py_RefTotal, so
     * we need to undo that. */
    _Py_DEC_REFTOTAL;
#endif
    /* If Py_TRACE_REFS, _Py_NewReference re-added self to the object
     * chain, so no more to do there.
     * If COUNT_ALLOCS, the original decref bumped tp_frees, and
     * _Py_NewReference bumped tp_allocs:  both of those need to be
     * undone.
     */
#ifdef COUNT_ALLOCS
    --Py_TYPE(self)->tp_frees;
    --Py_TYPE(self)->tp_allocs;
#endif
}
static PyMemberDef __pyx_Generator_memberlist[] = {
    {(char *) "gi_running",
#if PY_VERSION_HEX >= 0x02060000
     T_BOOL,
#else
     T_BYTE,
#endif
     offsetof(__pyx_GeneratorObject, is_running),
     READONLY,
     NULL},
    {0, 0, 0, 0, 0}
};
static PyMethodDef __pyx_Generator_methods[] = {
    {__Pyx_NAMESTR("send"), (PyCFunction) __Pyx_Generator_Send, METH_O, 0},
    {__Pyx_NAMESTR("throw"), (PyCFunction) __Pyx_Generator_Throw, METH_VARARGS, 0},
    {__Pyx_NAMESTR("close"), (PyCFunction) __Pyx_Generator_Close, METH_NOARGS, 0},
    {0, 0, 0, 0}
};
static PyTypeObject __pyx_GeneratorType_type = {
    PyVarObject_HEAD_INIT(0, 0)
    __Pyx_NAMESTR("generator"),         /*tp_name*/
    sizeof(__pyx_GeneratorObject),      /*tp_basicsize*/
    0,                                  /*tp_itemsize*/
    (destructor) __Pyx_Generator_dealloc,/*tp_dealloc*/
    0,                                  /*tp_print*/
    0,                                  /*tp_getattr*/
    0,                                  /*tp_setattr*/
#if PY_MAJOR_VERSION < 3
    0,                                  /*tp_compare*/
#else
    0,                                  /*reserved*/
#endif
    0,                                   /*tp_repr*/
    0,                                  /*tp_as_number*/
    0,                                  /*tp_as_sequence*/
    0,                                  /*tp_as_mapping*/
    0,                                  /*tp_hash*/
    0,                                  /*tp_call*/
    0,                                  /*tp_str*/
    0,                                  /*tp_getattro*/
    0,                                  /*tp_setattro*/
    0,                                  /*tp_as_buffer*/
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC, /* tp_flags*/
    0,                                  /*tp_doc*/
    (traverseproc) __Pyx_Generator_traverse,   /*tp_traverse*/
    0,                                  /*tp_clear*/
    0,                                  /*tp_richcompare*/
    offsetof(__pyx_GeneratorObject, gi_weakreflist), /* tp_weaklistoffse */
    0,                                  /*tp_iter*/
    (iternextfunc) __Pyx_Generator_Next, /*tp_iternext*/
    __pyx_Generator_methods,            /*tp_methods*/
    __pyx_Generator_memberlist,         /*tp_members*/
    0,                                  /*tp_getset*/
    0,                                  /*tp_base*/
    0,                                  /*tp_dict*/
    0,                                  /*tp_descr_get*/
    0,                                  /*tp_descr_set*/
    0,                                  /*tp_dictoffset*/
    0,                                  /*tp_init*/
    0,                                  /*tp_alloc*/
    0,                                  /*tp_new*/
    0,                                  /*tp_free*/
    0,                                  /*tp_is_gc*/
    0,                                  /*tp_bases*/
    0,                                  /*tp_mro*/
    0,                                  /*tp_cache*/
    0,                                  /*tp_subclasses*/
    0,                                  /*tp_weaklist*/
    __Pyx_Generator_del,                /*tp_del*/
#if PY_VERSION_HEX >= 0x02060000
    0,                                  /*tp_version_tag*/
#endif
};
static __pyx_GeneratorObject *__Pyx_Generator_New(__pyx_generator_body_t body,
                                                  PyObject *closure) {
    __pyx_GeneratorObject *gen =
        PyObject_GC_New(__pyx_GeneratorObject, &__pyx_GeneratorType_type);
    if (gen == NULL)
        return NULL;
    gen->body = body;
    gen->closure = closure;
    Py_XINCREF(closure);
    gen->is_running = 0;
    gen->resume_label = 0;
    gen->classobj = NULL;
    gen->yieldfrom = NULL;
    gen->exc_type = NULL;
    gen->exc_value = NULL;
    gen->exc_traceback = NULL;
    gen->gi_weakreflist = NULL;
    PyObject_GC_Track(gen);
    return gen;
}
static int __pyx_Generator_init(void) {
    __pyx_GeneratorType_type.tp_getattro = PyObject_GenericGetAttr;
    __pyx_GeneratorType_type.tp_iter = PyObject_SelfIter;
    if (PyType_Ready(&__pyx_GeneratorType_type)) {
        return -1;
    }
    __pyx_GeneratorType = &__pyx_GeneratorType_type;
    return 0;
}

static int __Pyx_check_binary_version(void) {
    char ctversion[4], rtversion[4];
    PyOS_snprintf(ctversion, 4, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
    PyOS_snprintf(rtversion, 4, "%s", Py_GetVersion());
    if (ctversion[0] != rtversion[0] || ctversion[2] != rtversion[2]) {
        char message[200];
        PyOS_snprintf(message, sizeof(message),
                      "compiletime version %s of module '%.100s' "
                      "does not match runtime version %s",
                      ctversion, __Pyx_MODULE_NAME, rtversion);
        #if PY_VERSION_HEX < 0x02050000
        return PyErr_Warn(NULL, message);
        #else
        return PyErr_WarnEx(NULL, message, 1);
        #endif
    }
    return 0;
}

static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
#if PY_VERSION_HEX >= 0x02070000 && !(PY_MAJOR_VERSION==3&&PY_MINOR_VERSION==0)
    PyObject *ob = PyCapsule_New(vtable, 0, 0);
#else
    PyObject *ob = PyCObject_FromVoidPtr(vtable, 0);
#endif
    if (!ob)
        goto bad;
    if (PyDict_SetItemString(dict, "__pyx_vtable__", ob) < 0)
        goto bad;
    Py_DECREF(ob);
    return 0;
bad:
    Py_XDECREF(ob);
    return -1;
}

#ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
static PyObject *__Pyx_ImportModule(const char *name) {
    PyObject *py_name = 0;
    PyObject *py_module = 0;
    py_name = __Pyx_PyIdentifier_FromString(name);
    if (!py_name)
        goto bad;
    py_module = PyImport_Import(py_name);
    Py_DECREF(py_name);
    return py_module;
bad:
    Py_XDECREF(py_name);
    return 0;
}
#endif

#ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name,
    size_t size, int strict)
{
    PyObject *py_module = 0;
    PyObject *result = 0;
    PyObject *py_name = 0;
    char warning[200];
    Py_ssize_t basicsize;
#ifdef Py_LIMITED_API
    PyObject *py_basicsize;
#endif
    py_module = __Pyx_ImportModule(module_name);
    if (!py_module)
        goto bad;
    py_name = __Pyx_PyIdentifier_FromString(class_name);
    if (!py_name)
        goto bad;
    result = PyObject_GetAttr(py_module, py_name);
    Py_DECREF(py_name);
    py_name = 0;
    Py_DECREF(py_module);
    py_module = 0;
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError,
            "%s.%s is not a type object",
            module_name, class_name);
        goto bad;
    }
#ifndef Py_LIMITED_API
    basicsize = ((PyTypeObject *)result)->tp_basicsize;
#else
    py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
    if (!py_basicsize)
        goto bad;
    basicsize = PyLong_AsSsize_t(py_basicsize);
    Py_DECREF(py_basicsize);
    py_basicsize = 0;
    if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
        goto bad;
#endif
    if (!strict && (size_t)basicsize > size) {
        PyOS_snprintf(warning, sizeof(warning),
            "%s.%s size changed, may indicate binary incompatibility",
            module_name, class_name);
        #if PY_VERSION_HEX < 0x02050000
        if (PyErr_Warn(NULL, warning) < 0) goto bad;
        #else
        if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
        #endif
    }
    else if ((size_t)basicsize != size) {
        PyErr_Format(PyExc_ValueError,
            "%s.%s has the wrong size, try recompiling",
            module_name, class_name);
        goto bad;
    }
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(py_module);
    Py_XDECREF(result);
    return NULL;
}
#endif

static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
    int start = 0, mid = 0, end = count - 1;
    if (end >= 0 && code_line > entries[end].code_line) {
        return count;
    }
    while (start < end) {
        mid = (start + end) / 2;
        if (code_line < entries[mid].code_line) {
            end = mid;
        } else if (code_line > entries[mid].code_line) {
             start = mid + 1;
        } else {
            return mid;
        }
    }
    if (code_line <= entries[mid].code_line) {
        return mid;
    } else {
        return mid + 1;
    }
}
static PyCodeObject *__pyx_find_code_object(int code_line) {
    PyCodeObject* code_object;
    int pos;
    if (unlikely(!code_line) || unlikely(!__pyx_code_cache.entries)) {
        return NULL;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if (unlikely(pos >= __pyx_code_cache.count) || unlikely(__pyx_code_cache.entries[pos].code_line != code_line)) {
        return NULL;
    }
    code_object = __pyx_code_cache.entries[pos].code_object;
    Py_INCREF(code_object);
    return code_object;
}
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object) {
    int pos, i;
    __Pyx_CodeObjectCacheEntry* entries = __pyx_code_cache.entries;
    if (unlikely(!code_line)) {
        return;
    }
    if (unlikely(!entries)) {
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Malloc(64*sizeof(__Pyx_CodeObjectCacheEntry));
        if (likely(entries)) {
            __pyx_code_cache.entries = entries;
            __pyx_code_cache.max_count = 64;
            __pyx_code_cache.count = 1;
            entries[0].code_line = code_line;
            entries[0].code_object = code_object;
            Py_INCREF(code_object);
        }
        return;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if ((pos < __pyx_code_cache.count) && unlikely(__pyx_code_cache.entries[pos].code_line == code_line)) {
        PyCodeObject* tmp = entries[pos].code_object;
        entries[pos].code_object = code_object;
        Py_DECREF(tmp);
        return;
    }
    if (__pyx_code_cache.count == __pyx_code_cache.max_count) {
        int new_max = __pyx_code_cache.max_count + 64;
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Realloc(
            __pyx_code_cache.entries, new_max*sizeof(__Pyx_CodeObjectCacheEntry));
        if (unlikely(!entries)) {
            return;
        }
        __pyx_code_cache.entries = entries;
        __pyx_code_cache.max_count = new_max;
    }
    for (i=__pyx_code_cache.count; i>pos; i--) {
        entries[i] = entries[i-1];
    }
    entries[pos].code_line = code_line;
    entries[pos].code_object = code_object;
    __pyx_code_cache.count++;
    Py_INCREF(code_object);
}

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"
static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
            const char *funcname, int c_line,
            int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(filename);
    #else
    py_srcfile = PyUnicode_FromString(filename);
    #endif
    if (!py_srcfile) goto bad;
    if (c_line) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_code = __Pyx_PyCode_New(
        0,            /*int argcount,*/
        0,            /*int kwonlyargcount,*/
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        __pyx_empty_bytes, /*PyObject *code,*/
        __pyx_empty_tuple, /*PyObject *consts,*/
        __pyx_empty_tuple, /*PyObject *names,*/
        __pyx_empty_tuple, /*PyObject *varnames,*/
        __pyx_empty_tuple, /*PyObject *freevars,*/
        __pyx_empty_tuple, /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        py_line,      /*int firstlineno,*/
        __pyx_empty_bytes  /*PyObject *lnotab*/
    );
    Py_DECREF(py_srcfile);
    Py_DECREF(py_funcname);
    return py_code;
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    return NULL;
}
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyObject *py_globals = 0;
    PyFrameObject *py_frame = 0;
    py_code = __pyx_find_code_object(c_line ? c_line : py_line);
    if (!py_code) {
        py_code = __Pyx_CreateCodeObjectForTraceback(
            funcname, c_line, py_line, filename);
        if (!py_code) goto bad;
        __pyx_insert_code_object(c_line ? c_line : py_line, py_code);
    }
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_GET(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = py_line;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else  /* Python 3+ has unicode identifiers */
        if (t->is_unicode | t->is_str) {
            if (t->intern) {
                *t->p = PyUnicode_InternFromString(t->s);
            } else if (t->encoding) {
                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
            } else {
                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
            }
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(char* c_str) {
    return __Pyx_PyUnicode_FromStringAndSize(c_str, strlen(c_str));
}
static CYTHON_INLINE char* __Pyx_PyObject_AsString(PyObject* o) {
    Py_ssize_t ignore;
    return __Pyx_PyObject_AsStringAndSize(o, &ignore);
}
static CYTHON_INLINE char* __Pyx_PyObject_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
    if (
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
            __Pyx_sys_getdefaultencoding_not_ascii &&
#endif
            PyUnicode_Check(o)) {
#if PY_VERSION_HEX < 0x03030000
        char* defenc_c;
        PyObject* defenc = _PyUnicode_AsDefaultEncodedString(o, NULL);
        if (!defenc) return NULL;
        defenc_c = PyBytes_AS_STRING(defenc);
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
        {
            char* end = defenc_c + PyBytes_GET_SIZE(defenc);
            char* c;
            for (c = defenc_c; c < end; c++) {
                if ((unsigned char) (*c) >= 128) {
                    PyUnicode_AsASCIIString(o);
                    return NULL;
                }
            }
        }
#endif /*__PYX_DEFAULT_STRING_ENCODING_IS_ASCII*/
        *length = PyBytes_GET_SIZE(defenc);
        return defenc_c;
#else /* PY_VERSION_HEX < 0x03030000 */
        if (PyUnicode_READY(o) == -1) return NULL;
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
        if (PyUnicode_IS_ASCII(o)) {
            *length = PyUnicode_GET_DATA_SIZE(o);
            return PyUnicode_AsUTF8(o);
        } else {
            PyUnicode_AsASCIIString(o);
            return NULL;
        }
#else /* __PYX_DEFAULT_STRING_ENCODING_IS_ASCII */
        return PyUnicode_AsUTF8AndSize(o, length);
#endif /* __PYX_DEFAULT_STRING_ENCODING_IS_ASCII */
#endif /* PY_VERSION_HEX < 0x03030000 */
    } else
#endif /* __PYX_DEFAULT_STRING_ENCODING_IS_ASCII  || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT */
    {
        char* result;
        int r = PyBytes_AsStringAndSize(o, &result, length);
        if (r < 0) {
            return NULL;
        } else {
            return result;
        }
    }
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   int is_true = x == Py_True;
   if (is_true | (x == Py_False) | (x == Py_None)) return is_true;
   else return PyObject_IsTrue(x);
}
static CYTHON_INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x) {
  PyNumberMethods *m;
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_MAJOR_VERSION < 3
  if (PyInt_Check(x) || PyLong_Check(x))
#else
  if (PyLong_Check(x))
#endif
    return Py_INCREF(x), x;
  m = Py_TYPE(x)->tp_as_number;
#if PY_MAJOR_VERSION < 3
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = PyNumber_Long(x);
  }
#else
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Long(x);
  }
#endif
  if (res) {
#if PY_MAJOR_VERSION < 3
    if (!PyInt_Check(res) && !PyLong_Check(res)) {
#else
    if (!PyLong_Check(res)) {
#endif
      PyErr_Format(PyExc_TypeError,
                   "__%s__ returned non-%s (type %.200s)",
                   name, name, Py_TYPE(res)->tp_name);
      Py_DECREF(res);
      return NULL;
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject* x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
#if PY_VERSION_HEX < 0x02050000
   if (ival <= LONG_MAX)
       return PyInt_FromLong((long)ival);
   else {
       unsigned char *bytes = (unsigned char *) &ival;
       int one = 1; int little = (int)*(unsigned char*)&one;
       return _PyLong_FromByteArray(bytes, sizeof(size_t), little, 0);
   }
#else
   return PyInt_FromSize_t(ival);
#endif
}
static CYTHON_INLINE size_t __Pyx_PyInt_AsSize_t(PyObject* x) {
   unsigned PY_LONG_LONG val = __Pyx_PyInt_AsUnsignedLongLong(x);
   if (unlikely(val != (unsigned PY_LONG_LONG)(size_t)val)) {
       if ((val != (unsigned PY_LONG_LONG)-1) || !PyErr_Occurred())
           PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to size_t");
       return (size_t)-1;
   }
   return (size_t)val;
}


#endif /* Py_PYTHON_H */
